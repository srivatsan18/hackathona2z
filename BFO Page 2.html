<!DOCTYPE html>
<!-- saved from url=(0795)https://www.amazon.in/dppui/checkout?_encoding=UTF8&items%5B0%5D.giftInfo.giftSentToSelf=0&asin=B07VRS84D1&cor.0=IN&clientId=kswag&displayedPriceCurrency=INR&displayedPrice=1296.75&quantity=1&quantityLimit=1000&preview=0&x-client-id=ebook-dp-others&csrf=g%2BolBZccGmXbcWfmUm1pXbsDF1qr1N6g8tBgV2Fy88L0AAAADAAAAABjx4uRcmF3AAAAABVX8CwXqz4nuL9RKX%2F%2F%2Fw%3D%3D&destinationUrl=%2Fapi%2Fbifrost%2Facquisitions%2Fv1%2Fasins%2FB07VRS84D1%3F_encoding%3DUTF8%26amp%3Bx-client-id%3Debook-dp-others%26amp%3Bcsrf%3Dg%252BolBZccGmXbcWfmUm1pXbsDF1qr1N6g8tBgV2Fy88L0AAAADAAAAABjx4uRcmF3AAAAABVX8CwXqz4nuL9RKX%252F%252F%252Fw%253D%253D%26amp%3Bitems%255B0%255D.action.displayedPrice.value%3D1296.75%26amp%3Bitems%255B0%255D.action.displayedPrice.currency%3DINR%26amp%3Bitems%255B0%255D.action.actionType%3DGift -->
<html lang="en-in" class="a-ws a-js a-audio a-video a-canvas a-svg a-drag-drop a-geolocation a-history a-webworker a-autofocus a-input-placeholder a-textarea-placeholder a-local-storage a-gradients a-hires a-transform3d a-touch-scrolling a-text-shadow a-text-stroke a-box-shadow a-border-radius a-border-image a-opacity a-transform a-transition a-ember" data-19ax5a9jf="dingo" data-aui-build-date="3.22.2-2023-01-13"><!-- sp:feature:head-start --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script async="" src="./BFO Page_files/a9-tq-forensics.min.js" crossorigin="anonymous"></script><script async="" src="./BFO Page_files/31YXrY93hfL.js" crossorigin="anonymous"></script><script>var aPageStart = (new Date()).getTime();</script>
<!-- sp:end-feature:head-start -->
<!-- sp:feature:csm:head-open-part1 -->

<script type="text/javascript">var ue_t0=ue_t0||+new Date();</script>
<!-- sp:end-feature:csm:head-open-part1 -->
<!-- sp:feature:cs-optimization -->
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://images-eu.ssl-images-amazon.com/">
<link rel="dns-prefetch" href="https://m.media-amazon.com/">
<link rel="dns-prefetch" href="https://completion.amazon.com/">
<!-- sp:end-feature:cs-optimization -->
<!-- sp:feature:csm:head-open-part2 -->
<script type="text/javascript">
window.ue_ihb = (window.ue_ihb || window.ueinit || 0) + 1;
if (window.ue_ihb === 1) {

var ue_csm = window,
    ue_hob = +new Date();
(function(d){var e=d.ue=d.ue||{},f=Date.now||function(){return+new Date};e.d=function(b){return f()-(b?0:d.ue_t0)};e.stub=function(b,a){if(!b[a]){var c=[];b[a]=function(){c.push([c.slice.call(arguments),e.d(),d.ue_id])};b[a].replay=function(b){for(var a;a=c.shift();)b(a[0],a[1],a[2])};b[a].isStub=1}};e.exec=function(b,a){return function(){try{return b.apply(this,arguments)}catch(c){ueLogError(c,{attribution:a||"undefined",logLevel:"WARN"})}}}})(ue_csm);


    var ue_err_chan = 'jserr-rw';
(function(d,e){function h(f,b){if(!(a.ec>a.mxe)&&f){a.ter.push(f);b=b||{};var c=f.logLevel||b.logLevel;c&&c!==k&&c!==m&&c!==n&&c!==p||a.ec++;c&&c!=k||a.ecf++;b.pageURL=""+(e.location?e.location.href:"");b.logLevel=c;b.attribution=f.attribution||b.attribution;a.erl.push({ex:f,info:b})}}function l(a,b,c,e,g){d.ueLogError({m:a,f:b,l:c,c:""+e,err:g,fromOnError:1,args:arguments},g?{attribution:g.attribution,logLevel:g.logLevel}:void 0);return!1}var k="FATAL",m="ERROR",n="WARN",p="DOWNGRADED",a={ec:0,ecf:0,
pec:0,ts:0,erl:[],ter:[],buffer:[],mxe:50,startTimer:function(){a.ts++;setInterval(function(){d.ue&&a.pec<a.ec&&d.uex("at");a.pec=a.ec},1E4)}};l.skipTrace=1;h.skipTrace=1;h.isStub=1;d.ueLogError=h;d.ue_err=a;e.onerror=l})(ue_csm,window);


var ue_id = 'E2WFHK2PD2NF0NVZ86FC',
    ue_url = '/rd/uedata',
    ue_navtiming = 1,
    ue_mid = 'A21TJRUUN4KGV',
    ue_sid = '257-6328836-0330509',
    ue_sn = 'www.amazon.in',
    ue_furl = 'fls-eu.amazon.in',
    ue_surl = 'https://unagi-eu.amazon.com/1/events/com.amazon.csm.nexusclient.prod',
    ue_int = 1,
    ue_fcsn = 1,
    ue_urt = 3,
    ue_rpl_ns = 'cel-rpl',
    ue_ddq = 1,
    ue_fpf = '//fls-eu.amazon.in/1/batch/1/OP/A21TJRUUN4KGV:257-6328836-0330509:E2WFHK2PD2NF0NVZ86FC$uedata=s:',
    ue_sbuimp = 1,
    ue_cel_lclia = 1,
    ue_ibft = 1,
    ue_sswmts = 0,
    ue_jsmtf = 0,
    ue_fnt = 0,
    ue_lpsi = 6000,
    ue_csa_errors = 1,
    ue_no_counters = 0,

    ue_swi = 1;
var ue_viz=function(){(function(b,e,a){function k(c){if(b.ue.viz.length<p&&!l){var a=c.type;c=c.originalEvent;/^focus./.test(a)&&c&&(c.toElement||c.fromElement||c.relatedTarget)||(a=e[m]||("blur"==a||"focusout"==a?"hidden":"visible"),b.ue.viz.push(a+":"+(+new Date-b.ue.t0)),"visible"==a&&(b.ue.isl&&q("at"),l=1))}}for(var l=0,q=b.uex,f,g,m,n=["","webkit","o","ms","moz"],d=0,p=20,h=0;h<n.length&&!d;h++)if(a=n[h],f=(a?a+"H":"h")+"idden",d="boolean"==typeof e[f])g=a+"visibilitychange",m=(a?a+"V":"v")+
"isibilityState";k({});d&&e.addEventListener(g,k,0);b.ue&&d&&(b.ue.pageViz={event:g,propHid:f})})(ue_csm,ue_csm.document,ue_csm.window)};

(function(d,h,N){function H(a){return a&&a.replace&&a.replace(/^\s+|\s+$/g,"")}function u(a){return"undefined"===typeof a}function B(a,b){for(var c in b)b[v](c)&&(a[c]=b[c])}function I(a){try{var b=N.cookie.match(RegExp("(^| )"+a+"=([^;]+)"));if(b)return b[2].trim()}catch(c){}}function O(m,b,c){var q=(x||{}).type;if("device"!==c||2!==q&&1!==q)m&&(d.ue_id=a.id=a.rid=m,w&&(w=w.replace(/((.*?:){2})(\w+)/,function(a,b){return b+m})),D&&(e("id",D,m),D=0)),b&&(w&&(w=w.replace(/(.*?:)(\w|-)+/,function(a,
c){return c+b})),d.ue_sid=b),c&&a.tag("page-source:"+c),d.ue_fpf=w}function P(){var a={};return function(b){b&&(a[b]=1);b=[];for(var c in a)a[v](c)&&b.push(c);return b}}function y(d,b,c,q){q=q||+new E;var f,l;if(b||u(c)){if(d)for(l in f=b?e("t",b)||e("t",b,{}):a.t,f[d]=q,c)c[v](l)&&e(l,b,c[l]);return q}}function e(d,b,c){var e=b&&b!=a.id?a.sc[b]:a;e||(e=a.sc[b]={});"id"===d&&c&&(Q=1);return e[d]=c||e[d]}function R(d,b,c,e,f){c="on"+c;var l=b[c];"function"===typeof l?d&&(a.h[d]=l):l=function(){};b[c]=
function(a){f?(e(a),l(a)):(l(a),e(a))};b[c]&&(b[c].isUeh=1)}function S(m,b,c,q){function p(b,c){var d=[b],g=0,f={},l,h;c?(d.push("m=1"),f[c]=1):f=a.sc;for(h in f)if(f[v](h)){var q=e("wb",h),p=e("t",h)||{},n=e("t0",h)||a.t0,k;if(c||2==q){q=q?g++:"";d.push("sc"+q+"="+h);for(k in p)u(p[k])||null===p[k]||d.push(k+q+"="+(p[k]-n));d.push("t"+q+"="+p[m]);if(e("ctb",h)||e("wb",h))l=1}}!J&&l&&d.push("ctb=1");return d.join("&")}function l(b,c,g,e){if(b){var f=d.ue_err;d.ue_url&&!e&&b&&0<b.length&&(e=new Image,
a.iel.push(e),e.src=b,a.count&&a.count("postbackImageSize",b.length));if(w){var m=h.encodeURIComponent;m&&b&&(e=new Image,b=""+d.ue_fpf+m(b)+":"+(+new E-d.ue_t0),a.iel.push(e),e.src=b)}else a.log&&(a.log(b,"uedata",{n:1}),a.ielf.push(b));f&&!f.ts&&f.startTimer();a.b&&(f=a.b,a.b="",l(f,c,g,1))}}function A(b){var c=x?x.type:F,d=2==c||a.isBFonMshop,c=c&&!d,e=a.bfini;Q||(e&&1<e&&(b+="&bfform=1",c||(a.isBFT=e-1)),d&&(b+="&bfnt=1",a.isBFT=a.isBFT||1),a.ssw&&a.isBFT&&(a.isBFonMshop&&(a.isNRBF=0),u(a.isNRBF)&&
(d=a.ssw(a.oid),d.e||u(d.val)||(a.isNRBF=1<d.val?0:1)),u(a.isNRBF)||(b+="&nrbf="+a.isNRBF)),a.isBFT&&!a.isNRBF&&(b+="&bft="+a.isBFT));return b}if(!a.paused&&(b||u(c))){for(var k in c)c[v](k)&&e(k,b,c[k]);a.isBFonMshop||y("pc",b,c);k="ld"===m&&b&&e("wb",b);var s=e("id",b)||a.id;k||s===a.oid||(D=b,ba(s,(e("t",b)||{}).tc||+e("t0",b),+e("t0",b)));var s=e("id",b)||a.id,t=e("id2",b),g=a.url+"?"+m+"&v="+a.v+"&id="+s,J=e("ctb",b)||e("wb",b),z;J&&(g+="&ctb="+J);t&&(g+="&id2="+t);1<d.ueinit&&(g+="&ic="+d.ueinit);
if(!("ld"!=m&&"ul"!=m||b&&b!=s)){if("ld"==m){try{h[K]&&h[K].isUeh&&(h[K]=null)}catch(I){}if(h.chrome)for(t=0;t<L.length;t++)T(G,L[t]);(t=N.ue_backdetect)&&t.ue_back&&t.ue_back.value++;d._uess&&(z=d._uess());a.isl=1}a._bf&&(g+="&bf="+a._bf());d.ue_navtiming&&f&&(e("ctb",s,"1"),a.isBFonMshop||y("tc",F,F,M));!C||a.isBFonMshop||U||(f&&B(a.t,{na_:f.navigationStart,ul_:f.unloadEventStart,_ul:f.unloadEventEnd,rd_:f.redirectStart,_rd:f.redirectEnd,fe_:f.fetchStart,lk_:f.domainLookupStart,_lk:f.domainLookupEnd,
co_:f.connectStart,_co:f.connectEnd,sc_:f.secureConnectionStart,rq_:f.requestStart,rs_:f.responseStart,_rs:f.responseEnd,dl_:f.domLoading,di_:f.domInteractive,de_:f.domContentLoadedEventStart,_de:f.domContentLoadedEventEnd,_dc:f.domComplete,ld_:f.loadEventStart,_ld:f.loadEventEnd,ntd:("function"!==typeof C.now||u(M)?0:new E(M+C.now())-new E)+a.t0}),x&&B(a.t,{ty:x.type+a.t0,rc:x.redirectCount+a.t0}),U=1);a.isBFonMshop||B(a.t,{hob:d.ue_hob,hoe:d.ue_hoe});a.ifr&&(g+="&ifr=1")}y(m,b,c,q);var r,n;k||b&&
b!==s||ca(b);(c=d.ue_mbl)&&c.cnt&&!k&&(g+=c.cnt());k?e("wb",b,2):"ld"==m&&(a.lid=H(s));for(r in a.sc)if(1==e("wb",r))break;if(k){if(a.s)return;g=p(g,null)}else c=p(g,null),c!=g&&(c=A(c),a.b=c),z&&(g+=z),g=p(g,b||a.id);g=A(g);if(a.b||k)for(r in a.sc)2==e("wb",r)&&delete a.sc[r];z=0;a._rt&&(g+="&rt="+a._rt());c=h.csa;if(!k&&c)for(n in r=e("t",b)||{},c=c("PageTiming"),r)r[v](n)&&c("mark",da[n]||n,r[n]);k||(a.s=0,(n=d.ue_err)&&0<n.ec&&n.pec<n.ec&&(n.pec=n.ec,g+="&ec="+n.ec+"&ecf="+n.ecf),z=e("ctb",b),
"ld"!==m||b||a.markers?a.markers&&a.isl&&!k&&b&&B(a.markers,e("t",b)):(a.markers={},B(a.markers,e("t",b))),e("t",b,{}));a.tag&&a.tag().length&&(g+="&csmtags="+a.tag().join("|"),a.tag=P());n=a.viz||[];(r=n.length)&&(g+="&viz="+n.splice(0,r).join("|"));u(d.ue_pty)||(g+="&pty="+d.ue_pty+"&spty="+d.ue_spty+"&pti="+d.ue_pti);a.tabid&&(g+="&tid="+a.tabid);a.aftb&&(g+="&aftb=1");!a._ui||b&&b!=s||(g+=a._ui());a.a=g;l(g,m,z,k)}}function ca(a){var b=h.ue_csm_markers||{},c;for(c in b)b[v](c)&&y(c,a,F,b[c])}
function A(a,b,c){c=c||h;if(c[V])c[V](a,b,!1);else if(c[W])c[W]("on"+a,b)}function T(a,b,c){c=c||h;if(c[X])c[X](a,b,!1);else if(c[Y])c[Y]("on"+a,b)}function Z(){function a(){d.onUl()}function b(a){return function(){c[a]||(c[a]=1,S(a))}}var c={},e,f;d.onLd=b("ld");d.onLdEnd=b("ld");d.onUl=b("ul");e={stop:b("os")};h.chrome?(A(G,a),L.push(a)):e[G]=d.onUl;for(f in e)e[v](f)&&R(0,h,f,e[f]);d.ue_viz&&ue_viz();A("load",d.onLd);y("ue")}function ba(e,b,c){var f=d.ue_mbl,p=h.csa,l=p&&p("SPA"),p=p&&p("PageTiming");
f&&f.ajax&&f.ajax(b,c);l&&p&&(l("newPage",{requestId:e,transitionType:"soft"}),p("mark","transitionStart",b));a.tag("ajax-transition")}d.ueinit=(d.ueinit||0)+1;var a=d.ue=d.ue||{};a.t0=h.aPageStart||d.ue_t0;a.id=d.ue_id;a.url=d.ue_url;a.rid=d.ue_id;a.a="";a.b="";a.h={};a.s=1;a.t={};a.sc={};a.iel=[];a.ielf=[];a.viz=[];a.v="0.237578.0";a.paused=!1;var v="hasOwnProperty",G="beforeunload",K="on"+G,V="addEventListener",X="removeEventListener",W="attachEvent",Y="detachEvent",da={cf:"criticalFeature",af:"aboveTheFold",
fn:"functional",fp:"firstPaint",fcp:"firstContentfulPaint",bb:"bodyBegin",be:"bodyEnd",ld:"loaded"},E=h.Date,C=h.performance||h.webkitPerformance,f=(C||{}).timing,x=(C||{}).navigation,M=(f||{}).navigationStart,w=d.ue_fpf,Q=0,U=0,L=[],D=0,F;a.oid=H(a.id);a.lid=H(a.id);a._t0=a.t0;a.tag=P();a.ifr=h.top!==h.self||h.frameElement?1:0;a.markers=null;a.attach=A;a.detach=T;if("000-0000000-8675309"===d.ue_sid){var $=I("cdn-rid"),aa=I("session-id");$&&aa&&O($,aa,"cdn")}d.uei=Z;d.ueh=R;d.ues=e;d.uet=y;d.uex=
S;a.reset=O;a.pause=function(d){a.paused=d};Z()})(ue_csm,ue_csm.window,ue_csm.document);


ue.stub(ue,"event");ue.stub(ue,"onSushiUnload");ue.stub(ue,"onSushiFlush");

ue.stub(ue,"log");ue.stub(ue,"onunload");ue.stub(ue,"onflush");
(function(b){var a=b.ue,g=1===b.ue_no_counters;a.cv={};a.cv.scopes={};a.cv.buffer=[];a.count=function(b,f,c){var e={},d=a.cv,h=c&&0===c.c;e.counter=b;e.value=f;e.t=a.d();c&&c.scope&&(d=a.cv.scopes[c.scope]=a.cv.scopes[c.scope]||{},e.scope=c.scope);if(void 0===f)return d[b];d[b]=f;d=0;c&&c.bf&&(d=1);g||(ue_csm.ue_sclog||!a.clog||0!==d||h?a.log&&a.log(e,"csmcount",{c:1,bf:d}):a.clog(e,"csmcount",{bf:d}));a.cv.buffer.push({c:b,v:f})};a.count("baselineCounter2",1);a&&a.event&&(a.event({requestId:b.ue_id||
"rid",server:b.ue_sn||"sn",obfuscatedMarketplaceId:b.ue_mid||"mid"},"csm","csm.CSMBaselineEvent.4"),a.count("nexusBaselineCounter",1,{bf:1}))})(ue_csm);



var ue_hoe = +new Date();
}
window.ueinit = window.ue_ihb;
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://www.amazon.in/dppui/www.amazon.in" title="Open URL: www.amazon.in (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://www.amazon.in/dppui/www.amazon.in" title="Open URL in Popup: www.amazon.in (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>

<!-- 6q7i6cst4j0hi0m70kiuxc8ootsyo -->
<script>window.ue && ue.count && ue.count('CSMLibrarySize', 9831)</script>
<!-- sp:end-feature:csm:head-open-part2 -->
<!-- sp:feature:aui-assets -->
<link rel="stylesheet" href="./BFO Page_files/11EIQ5IGqaL._RC_01ZTHTZObnL.css,41C-I1lXVwL.css,31ufSReDtSL.css,013z33uKh2L.css,017DsKjNQJL.css,0131vqwP5UL.css,41EWOOlBJ9L.css,11TIuySqr6L.css,01ElnPiDxWL.css,11Qjwq-j69L.css,01Dm5eKVxwL.css,01IdKcBuAdL.css,01y-XAlI+2L.css,21P6CS3L9LL.css,01oDR3IULNL.css">
<script>
(function(d,f,R,H){function x(a){A&&A.tag&&A.tag(k(":","aui",a))}function n(a,b){A&&A.count&&A.count("aui:"+a,0===b?0:b||(A.count("aui:"+a)||0)+1)}function t(a){try{return a.test(navigator.userAgent)}catch(b){return!1}}function u(a){return"function"===typeof a}function B(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function k(a,b,c,d){b=b&&c?b+a+c:b||c;return d?k(a,b,d):b}function I(a,b,c){try{Object.defineProperty(a,b,{value:c,writable:!1})}catch(y){a[b]=
c}return c}function ta(a,b,c){var d=c=a.length,g=function(){d--||(S.push(b),T||(setTimeout(da,0),T=!0))};for(g();c--;)ea[a[c]]?g():(C[a[c]]=C[a[c]]||[]).push(g)}function ua(a,b,c,d,g){var e=f.createElement(a?"script":"link");B(e,"error",d);g&&B(e,"load",g);a?(e.type="text/javascript",e.async=!0,c&&/AUIClients|images[/]I/.test(b)&&e.setAttribute("crossorigin","anonymous"),e.src=b):(e.rel="stylesheet",e.href=b);f.getElementsByTagName("head")[0].appendChild(e)}function fa(a,b){return function(c,y){function g(){ua(b,
c,e,function(b){U?n("resource_unload"):e?(e=!1,n("resource_retry"),g()):(n("resource_error"),a.log("Asset failed to load: "+c));b&&b.stopPropagation?b.stopPropagation():d.event&&(d.event.cancelBubble=!0)},y)}if(ha[c])return!1;ha[c]=!0;n("resource_count");var e=!0;return!g()}}function va(a,b,c){for(var d={name:a,guard:function(c){return b.guardFatal(a,c)},guardTime:function(a){return b.guardTime(a)},logError:function(c,e,d){b.logError(c,e,d,a)}},g=[],e=0;e<c.length;e++)J.hasOwnProperty(c[e])&&(g[e]=
V.hasOwnProperty(c[e])?V[c[e]](J[c[e]],d):J[c[e]]);return g}function D(a,b,c,y,g){return function(e,f){function n(){var a=null;y?a=f:u(f)&&(m.start=w(),a=f.apply(d,va(e,l,h)),m.end=w());if(b){J[e]=a;a=e;for(ea[a]=!0;(C[a]||[]).length;)C[a].shift()();delete C[a]}m.done=!0}var l=g||this;u(e)&&(f=e,e=H);b&&(e=e?e.replace(ia,""):"__NONAME__",W.hasOwnProperty(e)&&l.error(k(", reregistered by ",k(" by ",e+" already registered",W[e]),l.attribution),e),W[e]=l.attribution);for(var h=[],r=0;r<a.length;r++)h[r]=
a[r].replace(ia,"");var m=E[e||"anon"+ ++wa]={depend:h,registered:w(),namespace:l.namespace};e&&xa.hasOwnProperty(e);c?n():ta(h,l.guardFatal(e,n),e);return{decorate:function(a){V[e]=l.guardFatal(e,a)}}}}function ja(a){return function(){var b=Array.prototype.slice.call(arguments);return{execute:D(b,!1,a,!1,this),register:D(b,!0,a,!1,this)}}}function X(a,b){return function(c,d){d||(d=c,c=H);var g=this.attribution;return function(){z.push(b||{attribution:g,name:c,logLevel:a});var e=d.apply(this,arguments);
z.pop();return e}}}function K(a,b){this.load={js:fa(this,!0),css:fa(this)};I(this,"namespace",b);I(this,"attribution",a)}function ka(){f.body?v.trigger("a-bodyBegin"):setTimeout(ka,20)}function F(a,b){a.className=Y(a,b)+" "+b}function Y(a,b){return(" "+a.className+" ").split(" "+b+" ").join(" ").replace(/^ | $/g,"")}function la(a){try{return a()}catch(b){return!1}}function L(){if(M){var a={w:d.innerWidth||h.clientWidth,h:d.innerHeight||h.clientHeight};5<Math.abs(a.w-Z.w)||50<a.h-Z.h?(Z=a,N=4,(a=m.mobile||
m.tablet?450<a.w&&a.w>a.h:1250<=a.w)?F(h,"a-ws"):h.className=Y(h,"a-ws")):0<N&&(N--,ma=setTimeout(L,16))}}function ya(a){(M=a===H?!M:!!a)&&L()}function za(){return M}"use strict";var O=R.now=R.now||function(){return+new R},w=function(a){return a&&a.now?a.now.bind(a):O}(d.performance),P=w(),xa={},p=d.AmazonUIPageJS||d.P;if(p&&p.when&&p.register){P=[];for(var q=f.currentScript;q;q=q.parentElement)q.id&&P.push(q.id);return p.log("A copy of P has already been loaded on this page.","FATAL",P.join(" "))}var A=
d.ue;x();x("aui_build_date:3.22.2-2023-01-13");var S=[],Aa=[],T=!1;var da=function(){for(var a=setTimeout(da,0),b=O();Aa.length||S.length;)if(S.shift()(),50<O()-b)return;clearTimeout(a);T=!1};var ea={},C={},ha={},U=!1;B(d,"beforeunload",function(){U=!0;setTimeout(function(){U=!1},1E4)});var ia=/^prv:/,W={},J={},V={},E={},wa=0,aa=String.fromCharCode(92),z=[],na=!0,oa=d.onerror;d.onerror=function(a,b,c,y,g){g&&"object"===typeof g||(g=Error(a,b,c),g.columnNumber=y,g.stack=b||c||y?k(aa,g.message,"at "+
k(":",b,c,y)):H);var e=z.pop()||{};g.attribution=k(":",g.attribution||e.attribution,e.name);g.logLevel=e.logLevel;g.attribution&&console&&console.log&&console.log([g.logLevel||"ERROR",a,"thrown by",g.attribution].join(" "));z=[];oa&&(e=[].slice.call(arguments),e[4]=g,oa.apply(d,e))};K.prototype={logError:function(a,b,c,y){b={message:b,logLevel:c||"ERROR",attribution:k(":",this.attribution,y)};if(d.ueLogError)return d.ueLogError(a||b,a?b:null),!0;console&&console.error&&(console.log(b),console.error(a));
return!1},error:function(a,b,c,d){a=Error(k(":",d,a,c));a.attribution=k(":",this.attribution,b);throw a;},guardError:X(),guardFatal:X("FATAL"),guardCurrent:function(a){var b=z[z.length-1];return b?X(b.logLevel,b).call(this,a):a},guardTime:function(a){var b=z[z.length-1],c=b&&b.name;return c&&c in E?function(){var b=w(),d=a.apply(this,arguments);E[c].async=(E[c].async||0)+w()-b;return d}:a},log:function(a,b,c){return this.logError(null,a,b,c)},declare:D([],!0,!0,!0),register:D([],!0),execute:D([]),
AUI_BUILD_DATE:"3.22.2-2023-01-13",when:ja(),now:ja(!0),trigger:function(a,b,c){var f=O();this.declare(a,{data:b,pageElapsedTime:f-(d.aPageStart||NaN),triggerTime:f});c&&c.instrument&&G.when("prv:a-logTrigger").execute(function(b){b(a)})},handleTriggers:function(){this.log("handleTriggers deprecated")},attributeErrors:function(a){return new K(a)},_namespace:function(a,b){return new K(a,b)},setPriority:function(a){na?na=!1:this.log("setPriority only accept the first call.")}};var v=I(d,"AmazonUIPageJS",
new K);var G=v._namespace("PageJS","AmazonUI");G.declare("prv:p-debug",E);v.declare("p-recorder-events",[]);v.declare("p-recorder-stop",function(){});I(d,"P",v);ka();if(f.addEventListener){var pa;f.addEventListener("DOMContentLoaded",pa=function(){v.trigger("a-domready");f.removeEventListener("DOMContentLoaded",pa,!1)},!1)}var h=f.documentElement,ba=function(){var a=["O","ms","Moz","Webkit"],b=f.createElement("div");return{testGradients:function(){return!0},test:function(c){var d=c.charAt(0).toUpperCase()+
c.substr(1);c=(a.join(d+" ")+d+" "+c).split(" ");for(d=c.length;d--;)if(""===b.style[c[d]])return!0;return!1},testTransform3d:function(){return!0}}}();p=h.className;var qa=/(^| )a-mobile( |$)/.test(p),ra=/(^| )a-tablet( |$)/.test(p),m={audio:function(){return!!f.createElement("audio").canPlayType},video:function(){return!!f.createElement("video").canPlayType},canvas:function(){return!!f.createElement("canvas").getContext},svg:function(){return!!f.createElementNS&&!!f.createElementNS("http://www.w3.org/2000/svg",
"svg").createSVGRect},offline:function(){return navigator.hasOwnProperty&&navigator.hasOwnProperty("onLine")&&navigator.onLine},dragDrop:function(){return"draggable"in f.createElement("span")},geolocation:function(){return!!navigator.geolocation},history:function(){return!(!d.history||!d.history.pushState)},webworker:function(){return!!d.Worker},autofocus:function(){return"autofocus"in f.createElement("input")},inputPlaceholder:function(){return"placeholder"in f.createElement("input")},textareaPlaceholder:function(){return"placeholder"in
f.createElement("textarea")},localStorage:function(){return"localStorage"in d&&null!==d.localStorage},orientation:function(){return"orientation"in d},touch:function(){return"ontouchend"in f},gradients:function(){return ba.testGradients()},hires:function(){var a=d.devicePixelRatio&&1.5<=d.devicePixelRatio||d.matchMedia&&d.matchMedia("(min-resolution:144dpi)").matches;n("hiRes"+(qa?"Mobile":ra?"Tablet":"Desktop"),a?1:0);return a},transform3d:function(){return ba.testTransform3d()},touchScrolling:function(){return t(/Windowshop|android|OS ([5-9]|[1-9][0-9]+)(_[0-9]{1,2})+ like Mac OS X|SOFTWARE=([5-9]|[1-9][0-9]+)(.[0-9]{1,2})+.*DEVICE=iPhone|Chrome|Silk|Firefox|Trident.+?; Touch/i)},
ios:function(){return t(/OS [1-9][0-9]*(_[0-9]*)+ like Mac OS X/i)&&!t(/trident|Edge/i)},android:function(){return t(/android.([1-9]|[L-Z])/i)&&!t(/trident|Edge/i)},mobile:function(){return qa},tablet:function(){return ra},rtl:function(){return"rtl"===h.dir}};for(q in m)m.hasOwnProperty(q)&&(m[q]=la(m[q]));for(var ca="textShadow textStroke boxShadow borderRadius borderImage opacity transform transition".split(" "),Q=0;Q<ca.length;Q++)m[ca[Q]]=la(function(){return ba.test(ca[Q])});var M=!0,ma=0,Z=
{w:0,h:0},N=4;L();B(d,"resize",function(){clearTimeout(ma);N=4;L()});var sa={getItem:function(a){try{return d.localStorage.getItem(a)}catch(b){}},setItem:function(a,b){try{return d.localStorage.setItem(a,b)}catch(c){}}};h.className=Y(h,"a-no-js");F(h,"a-js");!t(/OS [1-8](_[0-9]*)+ like Mac OS X/i)||d.navigator.standalone||t(/safari/i)||F(h,"a-ember");p=[];for(q in m)m.hasOwnProperty(q)&&m[q]&&p.push("a-"+q.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}));F(h,p.join(" "));h.setAttribute("data-aui-build-date",
"3.22.2-2023-01-13");v.register("p-detect",function(){return{capabilities:m,localStorage:m.localStorage&&sa,toggleResponsiveGrid:ya,responsiveGridEnabled:za}});t(/UCBrowser/i)||m.localStorage&&F(h,sa.getItem("a-font-class"));v.declare("a-event-revised-handling",!1);v.execute("RetailPageServiceWorker",function(){function a(a,b){l.controller&&a?(a={feature:"retail_service_worker_messaging",command:a},b&&(a.data=b),l.controller.postMessage(a)):a&&n("sw:sw_message_no_ctrl",1)}function b(a){var b=a.data;
if(b&&"retail_service_worker_messaging"===b.feature&&b.command&&b.data){var c=b.data;a=d.ue;var e=d.ueLogError;switch(b.command){case "log_counter":a&&u(a.count)&&c.name&&a.count(c.name,0===c.value?0:c.value||1);break;case "log_tag":a&&u(a.tag)&&c.tag&&(a.tag(c.tag),b=d.uex,a.isl&&u(b)&&b("at"));break;case "log_error":e&&u(e)&&c.message&&e({message:c.message,logLevel:c.level||"ERROR",attribution:c.attribution||"RetailServiceWorker"});break;case "log_weblab_trigger":a&&u(a.trigger)&&c.weblab&&c.treatment&&
a.trigger(c.weblab,c.treatment);break;default:n("sw:unsupported_message_command",1)}}}function c(a,b){return"sw:"+(b||"")+":"+a+":"}function h(a,b,c){v.logError(a,"[AUI SW] Failed to "+c+" service worker: ","ERROR","RetailPageServiceWorker");n(b+"failure")}function g(){p.forEach(function(a){x(a)})}function e(a){return a.capabilities.isAmazonApp&&a.capabilities.android}function m(a,b,d){if(b)if(b.mshop&&e(a))a=c(d,"mshop_and"),b=b.mshop.action,p.push(a+"supported"),b(a,d);else if(b.browser){a=t(/Chrome/i)&&
!t(/Edge/i)&&!t(/OPR/i)&&!a.capabilities.isAmazonApp&&!t(new RegExp(aa+"bwv"+aa+"b"));var g=b.browser;b=c(d,"browser");a?(a=g.action,p.push(b+"supported"),a(b,d)):p.push(b+"unsupported")}}function q(a,b,d){a&&p.push(c("register",d)+"unsupported");b&&p.push(c("unregister",d)+"unsupported");g()}try{var l=navigator.serviceWorker}catch(Ba){x("sw:nav_err")}(function(){if(l){var c=function(){a("page_loaded",{rid:d.ue_id,mid:d.ue_mid,pty:d.ue_pty,sid:d.ue_sid,spty:d.ue_spty,furl:d.ue_furl})};B(l,"message",
b);a("client_messaging_ready");v.when("load").execute(c);B(l,"controllerchange",function(){a("client_messaging_ready");"complete"===f.readyState&&c()})}})();var p=[],r=function(a,b){var c=d.uex,e=d.uet;a=k(":","aui","sw",a);"ld"===b&&u(c)?c("ld",a,{wb:1}):u(e)&&e(b,a,{wb:1})},z=function(a,b,c){function e(a){b&&u(b.failure)&&b.failure(a)}function g(){m=setTimeout(function(){x(k(":","sw:"+h,f.TIMED_OUT));e({ok:!1,statusCode:f.TIMED_OUT,done:!1});r(h,"ld")},c||4E3)}var f={NO_CONTROLLER:"no_ctrl",TIMED_OUT:"timed_out",
UNSUPPORTED_BROWSER:"unsupported_browser",UNEXPECTED_RESPONSE:"unexpected_response"},h=k(":",a.feature,a.command),m,p=!0;if("MessageChannel"in d&&l&&"controller"in l)if(l.controller){var q=new MessageChannel;q.port1.onmessage=function(c){(c=c.data)&&c.feature===a.feature&&c.command===a.command?(p&&(r(h,"cf"),p=!1),r(h,"af"),clearTimeout(m),c.done||g(),c.ok?b&&u(b.success)&&b.success(c):e(c),c.done&&r(h,"ld")):n(k(":","sw:"+h,f.UNEXPECTED_RESPONSE),1)};g();r(h,"bb");l.controller.postMessage(a,[q.port2])}else x(k(":",
"sw:"+a.feature,f.NO_CONTROLLER)),e({ok:!1,statusCode:f.NO_CONTROLLER,done:!0});else x(k(":","sw:"+a.feature,f.UNSUPPORTED_BROWSER)),e({ok:!1,statusCode:f.UNSUPPORTED_BROWSER,done:!0})};(function(){l?(r("ctrl_changed","bb"),l.addEventListener("controllerchange",function(){x("sw:ctrl_changed");r("ctrl_changed","ld")})):n(k(":","sw:ctrl_changed","sw_unsupp"),1)})();(function(){var a=function(){r(b,"ld");var a=d.uex;z({feature:"page_proxy",command:"request_feature_tags"},{success:function(b){b=b.data;
Array.isArray(b)&&b.forEach(function(a){"string"===typeof a?x(k(":","sw:ppft",a)):n(k(":","sw:ppft","invalid_tag"),1)});n(k(":","sw:ppft","success"),1);A&&A.isl&&u(a)&&a("at")},failure:function(a){n(k(":","sw:ppft","error:"+(a.statusCode||"ppft_error")),1)}})};if("requestIdleCallback"in d){var b=k(":","ppft","callback_ricb");d.requestIdleCallback(a,{timeout:1E3})}else b=k(":","ppft","callback_timeout"),setTimeout(a,0);r(b,"bb")})();var w={reg:{},unreg:{}};w.unreg.mshop={action:function(a,b){try{l.getRegistrations().then(function(c){c.forEach(function(c){c.unregister().then(function(){n(a+
"success")}).catch(function(c){h(c,a,b)})})})}catch(Ca){x("sw:api_error")}}};w.reg.browser={action:function(a,b){l.register("/service-worker.js").then(function(){n(a+"success")}).catch(function(c){h(c,a,b)})}};(function(a){var b=a.reg,c=a.unreg;l&&l.getRegistrations?(G.when("A").execute(function(b){if((a.reg.mshop||a.unreg.mshop)&&"function"===typeof e&&e(b)){var g=a.reg.mshop?"T1":"C",f=d.ue;f&&f.trigger?f.trigger("MSHOP_SW_CLIENT_446196",g):n("sw:mshop:wt:failed")}m(b,c,"unregister")}),B(d,"load",
function(){G.when("A").execute(function(a){m(a,b,"register");g()})})):(q(b&&b.browser,c&&c.browser,"browser"),G.when("A").execute(function(a){"function"===typeof e&&e(a)&&q(b&&b.mshop,c&&c.mshop,"mshop_and")}))})(w)});v.declare("a-fix-event-off",!1);n("pagejs:pkgExecTime",w()-P)})(window,document,Date);
(function(b){function q(a,e,d){function g(a,b,c){var f=Array(e.length);~l&&(f[l]={});~m&&(f[m]=c);for(c=0;c<n.length;c++){var g=n[c],h=a[c];f[g]=h}for(c=0;c<p.length;c++)g=p[c],h=b[c],f[g]=h;a=d.apply(null,f);return~l?f[l]:a}"string"!==typeof a&&b.P.error("C001");-1===a.indexOf("@")&&-1<a.indexOf("/")&&(-1<a.indexOf("es3")||-1<a.indexOf("evergreen"))&&(a=a.substring(0,a.lastIndexOf("/")));if(!r[a]){r[a]=!0;d||(d=e,e=[]);a=a.split(":",2);var c=a[1]?a[0]:void 0,f=(a[1]||a[0]).replace(/@capability\//,
"@c/"),k=c?b.P._namespace(c):b.P,t=!f.lastIndexOf("@c/",0),u=!f.lastIndexOf("@m/",0),n=[];a=[];var p=[],v=[],m=-1,l=-1;for(c=0;c<e.length;c++){var h=e[c];"module"===h&&k.error("C002");"exports"===h?l=c:"require"===h?m=c:h.lastIndexOf("@p/",0)?h.lastIndexOf("@c/",0)&&h.lastIndexOf("@m/",0)?(n.push(c),a.push("mix:"+h)):(p.push(c),v.push(h)):(n.push(c),a.push(h.substr(3)))}k.when.apply(k,a).register("mix:"+f,function(){var a=[].slice.call(arguments);return t||u||~m||p.length?{capabilities:v,cardModuleFactory:function(b,
c){b=g(a,b,c);b.P=k;return b},require:~m?q:void 0}:g(a,[],function(){})});(t||u)&&k.when("mix:@amzn/mix.client-runtime","mix:"+f).execute(function(a,b){a.registerCapabilityModule(f,b)});k.when("mix:"+f).register("xcp:"+f,function(a){return a});var q=function(a,b,c){try{var e=-1<f.indexOf("/")?f.split("/")[0]:f,d=a[0],g=d.lastIndexOf("./",0)?d:e+"/"+d.substr(2),h=g.lastIndexOf("@p/",0)?"mix:"+g:g.substr(3);k.when(h).execute(function(a){try{b(a)}catch(x){c(x)}})}catch(w){c(w)}}}}"use strict";var r=
{};b.mix_d||((b.Promise?P:P.when("3p-promise")).register("@p/promise-is-ready",function(a){b.Promise=b.Promise||a}),(Array.prototype.includes?P:P.when("a-polyfill")).register("@p/polyfill-is-ready",function(){}),b.mix_d=function(a,b,d){P.when("@p/promise-is-ready","@p/polyfill-is-ready").execute("@p/mix-d-deps",function(){q(a,b,d)})},b.xcp_d=b.mix_d,P.when("mix:@amzn/mix.client-runtime").execute(function(a){P.declare("xcp:@xcp/runtime",a)}));b.mixTimeout||(b.mixTimeout=function(a,e,d){b.mixCardInitTimeouts||
(b.mixCardInitTimeouts={});b.mixCardInitTimeouts[e]&&clearTimeout(b.mixCardInitTimeouts[e]);b.mixCardInitTimeouts[e]=setTimeout(function(){P.log("Client-side initialization timeout","WARN",a)},d)});b.mix_csa_map=b.mix_csa_map||{};b.mix_csa_internal=b.mix_csa_internal||function(a,e,d){return b.mix_csa_map[e]=b.mix_csa_map[e]||b.csa(a,d)};b.mix_csa_internal_key=b.mix_csa_internal_key||function(a,b){for(var d="",e=0;e<b.length;e++){var c=b[e];void 0!==a[c]&&"object"!==typeof a[c]&&(d+=c+":"+a[c]+",")}if(!d)throw Error("bad mix-csa key gen.");
return d};b.mix_csa_event=b.mix_csa_event||function(a){try{var e=b.mix_csa_internal_key(a,["producerId"])}catch(d){return P.logError(d,"MIX C005","WARN",void 0),function(){}}try{return b.mix_csa_internal("Events",e,a)}catch(d){return P.logError(d,"MIX C004","WARN",e),function(){}}};b.mix_csa=b.mix_csa||function(a,e){try{e=e||"";var d=document.querySelectorAll(a);if(1<d.length)for(var g=0;g<d.length;g++){if(d[g].querySelector(e)){var c=d[g];break}}else 1===d.length&&(c=d[0]);if(!c)throw Error(" ");
return b.mix_csa_internal("Content",a,{element:c})}catch(f){return P.logError(f,"MIX C004","WARN",a),function(){}}}})(window);
(window.AmazonUIPageJS ? AmazonUIPageJS : P).when('sp.load.js').execute(function() {
  (window.AmazonUIPageJS ? AmazonUIPageJS : P).load.js('https://m.media-amazon.com/images/I/61NeHXhGwSL.js?AUIClients/AmazonUIjQuery&KK9dlo3A#412402-T1.412405-T1');
  (window.AmazonUIPageJS ? AmazonUIPageJS : P).load.js('https://m.media-amazon.com/images/I/11Y+5x+kkTL._RC|51fH61+ExwL.js,11yKORv-GTL.js,11giXtZCwVL.js,01+z+uIeJ-L.js,01VRMV3FBdL.js,21SDJtBU-PL.js,012FVc3131L.js,11rRjDLdAVL.js,516j7qaWchL.js,11kWu3cNjYL.js,11wr1I7-WYL.js,11OREnu1epL.js,11qVTZscrRL.js,21ssiLNIZvL.js,0190vxtlzcL.js,51+N26vFcBL.js,01JYHc2oIlL.js,31nfKXylf6L.js,01ezj5Rkz1L.js,11bEz2VIYrL.js,31o2NGTXThL.js,01rpauTep4L.js,01AQFKfTYzL.js_.js?AUIClients/AmazonUI&3baaHUwd#432724-T1');
  (window.AmazonUIPageJS ? AmazonUIPageJS : P).load.js('https://m.media-amazon.com/images/I/51SrwqaWgEL.js?AUIClients/CardJsRuntimeBuzzCopyBuild');
});
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="http://www.w3.org/2000/svg" title="Open URL: http://www.w3.org/2000/svg (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="http://www.w3.org/2000/svg" title="Open URL in Popup: http://www.w3.org/2000/svg (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>
<!-- sp:end-feature:aui-assets -->
<!-- sp:feature:nav-inline-css -->
<!-- sp:end-feature:nav-inline-css -->
<!-- sp:feature:host-assets -->
<!--&&&Portal&Delimiter&&&--><!-- sp:end-feature:host-assets -->
<!-- sp:feature:csm:head-close -->
<script type="text/javascript">
window.ue_ihe = (window.ue_ihe || 0) + 1;
if (window.ue_ihe === 1) {
(function(c){c&&1===c.ue_jsmtf&&"object"===typeof c.P&&"function"===typeof c.P.when&&c.P.when("mshop-interactions").execute(function(e){"object"===typeof e&&"function"===typeof e.addListener&&e.addListener(function(b){"object"===typeof b&&"ORIGIN"===b.dataSource&&"number"===typeof b.clickTime&&"object"===typeof b.events&&"number"===typeof b.events.pageVisible&&(c.ue_jsmtf_interaction={pv:b.events.pageVisible,ct:b.clickTime})})})})(ue_csm);
(function(c,e,b){function m(a){f||(f=d[a.type].id,"undefined"===typeof a.clientX?(h=a.pageX,k=a.pageY):(h=a.clientX,k=a.clientY),2!=f||l&&(l!=h||n!=k)?(r(),g.isl&&e.setTimeout(function(){p("at",g.id)},0)):(l=h,n=k,f=0))}function r(){for(var a in d)d.hasOwnProperty(a)&&g.detach(a,m,d[a].parent)}function s(){for(var a in d)d.hasOwnProperty(a)&&g.attach(a,m,d[a].parent)}function t(){var a="";!q&&f&&(q=1,a+="&ui="+f);return a}var g=c.ue,p=c.uex,q=0,f=0,l,n,h,k,d={click:{id:1,parent:b},mousemove:{id:2,
parent:b},scroll:{id:3,parent:e},keydown:{id:4,parent:b}};g&&p&&(s(),g._ui=t)})(ue_csm,window,document);


(function(s,l){function m(b,e,c){c=c||new Date(+new Date+t);c="expires="+c.toUTCString();n.cookie=b+"="+e+";"+c+";path=/"}function p(b){b+="=";for(var e=n.cookie.split(";"),c=0;c<e.length;c++){for(var a=e[c];" "==a.charAt(0);)a=a.substring(1);if(0===a.indexOf(b))return decodeURIComponent(a.substring(b.length,a.length))}return""}function q(b,e,c){if(!e)return b;-1<b.indexOf("{")&&(b="");for(var a=b.split("&"),f,d=!1,h=!1,g=0;g<a.length;g++)f=a[g].split(":"),f[0]==e?(!c||d?a.splice(g,1):(f[1]=c,a[g]=
f.join(":")),h=d=!0):2>f.length&&(a.splice(g,1),h=!0);h&&(b=a.join("&"));!d&&c&&(0<b.length&&(b+="&"),b+=e+":"+c);return b}var k=s.ue||{},t=3024E7,n=ue_csm.document||l.document,r=null,d;a:{try{d=l.localStorage;break a}catch(u){}d=void 0}k.count&&k.count("csm.cookieSize",document.cookie.length);k.cookie={get:p,set:m,updateCsmHit:function(b,e,c){try{var a;if(!(a=r)){var f;a:{try{if(d&&d.getItem){f=d.getItem("csm-hit");break a}}catch(k){}f=void 0}a=f||p("csm-hit")||"{}"}a=q(a,b,e);r=a=q(a,"t",+new Date);
try{d&&d.setItem&&d.setItem("csm-hit",a)}catch(h){}m("csm-hit",a,c)}catch(g){"function"==typeof l.ueLogError&&ueLogError(Error("Cookie manager: "+g.message),{logLevel:"WARN"})}}}})(ue_csm,window);


(function(l,e){function c(b){b="";var c=a.isBFT?"b":"s",d=""+a.oid,g=""+a.lid,h=d;d!=g&&20==g.length&&(c+="a",h+="-"+g);a.tabid&&(b=a.tabid+"+");b+=c+"-"+h;b!=f&&100>b.length&&(f=b,a.cookie?a.cookie.updateCsmHit(m,b+("|"+ +new Date)):e.cookie="csm-hit="+b+("|"+ +new Date)+n+"; path=/")}function p(){f=0}function d(b){!0===e[a.pageViz.propHid]?f=0:!1===e[a.pageViz.propHid]&&c({type:"visible"})}var n="; expires="+(new Date(+new Date+6048E5)).toGMTString(),m="tb",f,a=l.ue||{},k=a.pageViz&&a.pageViz.event&&
a.pageViz.propHid;a.attach&&(a.attach("click",c),a.attach("keyup",c),k||(a.attach("focus",c),a.attach("blur",p)),k&&(a.attach(a.pageViz.event,d,e),d({})));a.aftb=1})(ue_csm,ue_csm.document);


ue_csm.ue.stub(ue,"impression");


ue.stub(ue,"trigger");


if(window.ue&&uet) { uet('bb'); }

}
</script>
<script>window.ue && ue.count && ue.count('CSMLibrarySize', 3172)</script>
<!-- sp:end-feature:csm:head-close -->
<!-- sp:feature:head-close -->
<script>
window.P && P.register('bb');
if (typeof ues === 'function') {
  ues('t0', 'portal-bb', new Date());
  ues('ctb', 'portal-bb', 1);
}
</script>
<script type="text/javascript" async="" crossorigin="anonymous" src="./BFO Page_files/61NeHXhGwSL.js"></script><script type="text/javascript" async="" crossorigin="anonymous" src="./BFO Page_files/11Y+5x+kkTL._RC_51fH61+ExwL.js,11yKORv-GTL.js,11giXtZCwVL.js,01+z+uIeJ-L.js,01VRMV3FBdL.js,21SDJtBU-PL.js,012FVc3131L.js,11rRjDLdAVL.js,516j7qaWchL.js,11kWu3cNjYL.js,11wr1I7-WYL.js,11OREnu1epL.js,11qVTZscrRL.js,21ssiLNIZvL.js,0190vxtlzcL.js,51+N26vFcBL.js"></script><script type="text/javascript" async="" crossorigin="anonymous" src="./BFO Page_files/51SrwqaWgEL.js"></script><script type="text/javascript" async="" crossorigin="anonymous" src="./BFO Page_files/31cu23aPw1L.js"></script><script type="text/javascript" async="" crossorigin="anonymous" src="./BFO Page_files/616k0lTB8IL.js"></script><script type="text/javascript" async="" crossorigin="anonymous" src="./BFO Page_files/21r3m5-l8mL.js"></script><script>(function codeWrapper(isGM) {
    var log, setValue, getValue, addStyle, copyValueToClipboard;   // Aliases for GM_setValue etc methods, for non-GM browsers, e.g. Chrome
    var activePopup = null;

function MonitoringTeamStringLinks() {
    var STRING_LIMIT = 5000;
    var POPUP = "popup";
    var HIDDEN = "hidden";
    var COPY = "copy";
    var LINK_REPLACEMENT_BATCH_SIZE = 50;      // We replace links on the page in batches of this size to improve browser responsiveness
    var LINK_REPLACEMENT_BATCH_INTERVAL = 100; // We sleep for this many milliseconds between batches to allow the browser to process UI events
    var isDecorating = false;

    var HOST_LINKS = [
        {
           id: "mp",
           url: [
               { match: "[.]dca", url: "https://monitorportal.dca.amazon.com/hosts/overview?&name={STRING}" },
               { match: null,     url: "https://monitorportal.amazon.com/hosts/overview?&name={STRING}" }
           ],
           title: "Monitor Portal overview",
           category: "Monitoring",
           color: "black", backgroundColor: "yellow",
        },
        {
           id: "sym",
           url: [
               { match: "[.]dca", url: "https://monitor.dca.amazon.com/symon/verify.cgi?%5Fencoding=UTF8&host={STRING}" },
               { match: null,     url: "https://monitor.amazon.com/symon/verify.cgi?%5Fencoding=UTF8&host={STRING}" }
           ],
           title: "SYMON Verify",
           category: "Monitoring",
           color: "black", backgroundColor: "#00ff00",
        },
        {
           id: "emo",
           url: [
               { match: "[.]dca", url: null },
               { match: null,     url: "https://monitor.amazon.com/symon/hostping.cgi?step=search&hostname={STRING}&hostclass=" }
           ],
           title: "External Monitoring Config",
           category: "Monitoring",
           color: "#00ff00", backgroundColor: "black",
        },
        {
           id: "igr",
           url: [
               { match: "[.]dca", url: "https://monitorportal.dca.amazon.com/igraph?StartTime1=-PT3H&EndTime1=-PT0M&DataSet1=prod&HostGroup1=NONE&Class1=CPU&Object1=cpu&Metric1=Utilization&Period1=OneMinute&Stat1=avg&SchemaName1=Snitch&Host1={STRING}&search=host={STRING}+schemaname=Snitch" },
               { match: null,     url: "https://monitorportal.amazon.com/igraph?StartTime1=-PT3H&EndTime1=-PT0M&DataSet1=prod&HostGroup1=NONE&Class1=CPU&Object1=cpu&Metric1=Utilization&Period1=OneMinute&Stat1=avg&SchemaName1=Snitch&Host1={STRING}&search=host={STRING}+schemaname=Snitch" }
           ],
           title: "iGraph (CPU)",
           category: "Monitoring",
           color: "#FFFFFF", backgroundColor: "#7091BB",
           open: HIDDEN,
        },
        {
           id: "tim",
           url: [
               { match: "[.]dca", url: null },
               { match: null,     url: "https://monitorportal.amazon.com/timber/list?key1=host&value1={STRING}" }
           ],
           title: "Timber Logs",
           category: "Monitoring",
           color: "#FFFFFF", backgroundColor: "#966D30",
        },
        {
           id: "ssh",
           url: "ssh://{STRING}",
           title: "SSH",
           category: "SSH",
           color: "white", backgroundColor: "#ff6600",
        },
        {
           id: "ssb",
           url: "ssh://{STRING}",
           title: "SSH via Bastion",
           category: "SSH",
           color: "white", backgroundColor: "#cc3300",
        },
        {
           id: "hos",
           url: [
               { match: "[.]dca", url: "https://infrastructure.dca.amazon.com/automation/hostDetails.cgi?hw_id=&hostname={STRING}&show_reboots=on&show_ticket_log=on" },
               { match: null,     url: "https://infrastructure.amazon.com/automation/hostDetails.cgi?hw_id=&hostname={STRING}&show_reboots=on&show_ticket_log=on" }
           ],
           title: "Host Details",
           category: "Infrastructure",
           color: "white", backgroundColor: "#0084ff",
        },
        {
           id: "reb",
           url: [
               { match: "[.]dca", url: "https://infrastructure.dca.amazon.com/automation/rebootServer.cgi?%5Fencoding=UTF8&hostname={STRING}&reason=Can't%20ping%20it" },
               { match: null,     url: "https://infrastructure.amazon.com/automation/rebootServer.cgi?%5Fencoding=UTF8&hostname={STRING}&reason=Can't%20ping%20it" }
           ],
           title: "Reboot Host",
           category: "Infrastructure",
           color: "white", backgroundColor: "red",
        },
        {
           id: "rep",
           url: [
               { match: "[.]dca", url: "https://infrastructure.dca.amazon.com/automation/repurposeSelectHosts.cgi?hostname_regex={STRING}" },
               { match: null,     url: "https://infrastructure.amazon.com/automation/repurposeSelectHosts.cgi?hostname_regex={STRING}" }
           ],
           title: "Repurpose Host",
           category: "Infrastructure",
           color: "black", backgroundColor: "#E851E3",
        },
        {
           id: "swp",
           url: [
               { match: "[.]dca", url: "https://infrastructure.dca.amazon.com/automation/hostSwapSelectHosts.cgi?hostname_regex={STRING}" },
               { match: null,     url: "https://infrastructure.amazon.com/automation/hostSwapSelectHosts.cgi?hostname_regex={STRING}" }
           ],
           title: "Swap Host",
           category: "Infrastructure",
           color: "black", backgroundColor: "#E851E3",
        },
        {
           id: "ser",
           url: [
               { match: "[.]dca", url: null },
               { match: null,     url: "https://lbdashboard.amazon.com/cgi-bin/showservices.cgi?input={STRING}&lbGroup=all&action=Find+Server&collateServices=on&resolveIPs=on" }
           ],
           title: "Show Services",
           category: "Infrastructure",
           color: "white", backgroundColor: "blue",
        },
        {
           id: "vip",
           url: [
               { match: "[.]bjs|[.]cn-north-1",     url: "https://vip-management.bjs.aws-border.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]bom|[.]ap-south-1",     url: "https://vip-management.bom.aws-border.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]cmh|[.]us-east-2",      url: "https://vip-management.cmh.aws-border.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]dca",                   url: "https://vip-management.dca.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]dub|[.]eu-west-1",      url: "https://vip-management-dub.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]fra|[.]eu-central-1",   url: "https://vip-management.fra.aws-border.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]gru|[.]sa-east-1",      url: "https://vip-management-gru.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]icn|[.]ap-northeast-2", url: "https://vip-management.icn.aws-border.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]lhr|[.]eu-west-2",      url: "https://vip-management.lhr.aws-border.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]nrt|[.]ap-northeast-1", url: "https://vip-management-nrt.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]pdt|[.]us-gov-west-1",  url: "https://vip-management.pdt.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]pdx|[.]us-west-2",      url: "https://vip-management.pdx.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]pek",                   url: "https://vip-management-pek.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]sea",                   url: "https://vip-management-sea.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]sfo|[.]us-west-1",      url: "https://vip-management-sfo.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]sin|[.]ap-southeast-1", url: "https://vip-management-sin.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]syd|[.]ap-southeast-2", url: "https://vip-management-syd.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]yul|[.]ca-central-1",   url: "https://vip-management.yul.aws-border.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: "[.]zhy|[.]cn-northwest-1", url: "https://vip-management.zhy.aws-border.com/vipmgmt/StartWithHost.mhtml?host={STRING}" },
               { match: null,                       url: "https://vip-management.amazon.com/vipmgmt/StartWithHost.mhtml?host={STRING}" }
           ],
           title: "VIPs fronting host",
           category: "Infrastructure",
           color: "white", backgroundColor: "#9400d3",
        },
        {
           id: "vnm",
           url: [
               { match: "[.]dca", url: "http://vip-management.dca.amazon.com/vipmgmt/StartWithDnsName.mhtml?vip={STRING}" },
               { match: null,     url: "http://vip-management.amazon.com/vipmgmt/StartWithDnsName.mhtml?vip={STRING}" }
           ],
           title: "VIP with same name",
           category: "Infrastructure",
           color: "white", backgroundColor: "#9400d3",
        },
        {
           id: "tos",
           url: [
               { match: "[.]bjs|[.]cn-north-1",       url: "https://toaster-bjs.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]bom|[.]ap-south-1",       url: "https://toaster.bom.aws-border.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]cdg|[.]eu-west-3",        url: "https://toaster.cdg.aws-border.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]cmh|[.]us-east-2",        url: "https://toaster.cmh.aws-border.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]dca",                     url: "https://toaster.dca.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]dub|[.]eu-west-1",        url: "https://toaster-dub.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]fra|[.]eu-central-1",     url: "https://toaster.fra.aws-border.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]gru|[.]sa-east-1",        url: "https://toaster-gru.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]iad|[.]vdc|[.]us-east-1", url: "https://toaster-iad.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]icn|[.]ap-northeast-2",   url: "https://toaster.icn.aws-border.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]kix|[.]ap-northeast-3",   url: "https://toaster.kix.aws-border.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]lck|[.]us-isob-east-1",   url: "https://toaster.lck.aws-border.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]lhr|[.]eu-west-2",        url: "https://toaster.lhr.aws-border.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]nrt|[.]ap-northeast-1",   url: "https://toaster-nrt.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]pdx|[.]us-west-2",        url: "https://toaster-pdx.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]sfo|[.]us-west-1",        url: "https://toaster-sfo.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]sin|[.]ap-southeast-1",   url: "https://toaster-sin.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]syd|[.]ap-southeast-2",   url: "https://toaster-syd.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]yul|[.]ca-central-1",     url: "https://toaster.yul.aws-border.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: "[.]zhy|[.]cn-northwest-1",   url: "https://toaster-zhy.amazon.com/cgi-bin/toaster.cgi?host={STRING}" },
               { match: null,                         url: "https://toaster.amazon.com/cgi-bin/toaster.cgi?host={STRING}" }
           ],
           title: "Toaster Host Checker",
           category: "Infrastructure",
           color: "white",
           backgroundColor: "#008455"
        },
        {
           id: "apo",
           url: [
               { match: "[.]dca", url: "https://apollo.dca.amazon.com/hosts/{STRING}" },
               { match: null,     url: "https://apollo.amazon.com/hosts/{STRING}" }
           ],
           title: "Apollo Environments",
           category: "Other",
           color: "black", backgroundColor: "white",
        },
        {
           id: "odi",
           url: [
               { match: "[.]dca", url: "https://odin.dca.amazon.com/#search/materialSetsPage=0&namespacesPage=0&searchCategory=EndHost&searchInactive=false&searchQuery={STRING}&searchGroup=true" },
               { match: null,     url: "https://odin.amazon.com/#search/materialSetsPage=0&namespacesPage=0&searchCategory=EndHost&searchInactive=false&searchQuery={STRING}&searchGroup=true" }
           ],
           title: "Odin Material Sets",
           category: "Other",
           color: "#E47911", backgroundColor: "white",
        },
        {
           id: "tt",
           url: [
               { match: "[.]dca", url: "https://issues.dca.amazon.com/issues/search?mode=search&sort=score%20desc&q={STRING}" },
               { match: null,     url: "https://tt.amazon.com/search?ticket_type=Regular+Ticket&status=&create_date=&modified_date=&assigned_individual=&impact=&requester_login=&cc_email=&category=&type=&item=&hostname={STRING}&asin=&upc=&vendor_id=&purchase_order_id=&sort1=create_date&sortdir1=desc&sort2=&sortdir2=asc&sort3=&sortdir3=asc&assigned_group=&case_type=&custom_fields_serialized=hostname&search=Search!" }
           ],
           title: "Search for Issues",
           category: "Other",
           color: "white", backgroundColor: "blue",
        }
    ];

    var ssbHostLinksIndex = 0;
    for (var i = 0; i < HOST_LINKS.length; i++) {
        if (HOST_LINKS[i].id === 'ssb') {
            ssbHostLinksIndex = i;
            break;
        }
    }

    var HOSTCLASS_LINKS = [
        {
           id: "mp",
           url: [
               { match: "-DCA|-WMA", url: "https://monitorportal.dca.amazon.com/hostclasses_hosts/overview?&name={STRING}" },
               { match: null,        url: "https://monitorportal.amazon.com/hostclasses_hosts/overview?&name={STRING}" }
           ],
           title: "Monitor Portal overview",
           category: "Monitoring",
           color: "black", backgroundColor: "yellow",
        },
        {
           id: "emo",
           url: [
               { match: "-DCA|-WMA", url: null },
               { match: null,        url: "https://monitor.amazon.com/symon/hostping.cgi?step=search&hostclass={STRING}&hostname=" }
           ],
           title: "External Monitoring Config",
           category: "Monitoring",
           color: "#00ff00", backgroundColor: "black",
        },
        {
           id: "lw",
           url: [
               { match: "-DCA|-WMA", url: null },
               { match: null,        url: "https://livewatch.amazon.com/hostclasses/{STRING}/any/metrics" }
           ],
           title: "LiveWatch graphs",
           category: "Monitoring",
           color: "white", backgroundColor: "blue",
        },
        {
           id: "id",
           url: [
               { match: "-DCA|-WMA", url: "https://infrastructure.dca.amazon.com/automation/customerHome.cgi?_encoding=UTF8&hostclass={STRING}" },
               { match: null,        url: "https://infrastructure.amazon.com/automation/customerHome.cgi?_encoding=UTF8&hostclass={STRING}" }
           ],
           title: "Infrastructure Dashboard",
           category: "Infrastructure",
           color: "black", backgroundColor: "#87cefa",
        },
        {
           id: "per",
           url: [
               { match: "-DCA|-WMA", url: "https://permissions.dca.amazon.com/hostclass.mhtml?show_ownership=1&hostclass={STRING}" },
               { match: null,        url: "https://permissions.amazon.com/hostclass.mhtml?show_ownership=1&hostclass={STRING}" }
           ],
           title: "Permissions",
           category: "Infrastructure",
           color: "black", backgroundColor: "#FFCCCC",
        },
        {
           id: "chc",
           url: [
               { match: "-DCA|-WMA", url: "https://infrastructure.dca.amazon.com/automation/createHostclass.cgi?parent_hostclass=OTHER&other_hostclass={STRING}&hostclass={STRING}-" },
               { match: null,        url: "https://infrastructure.amazon.com/automation/createHostclass.cgi?parent_hostclass=OTHER&other_hostclass={STRING}&hostclass={STRING}-" }
           ],
           title: "Create Child Hostclass",
           category: "Infrastructure",
           color: "white", backgroundColor: "#5D41F3",
        },
        {
           id: "rep",
           url: [
               { match: "-DCA|-WMA", url: "https://infrastructure.dca.amazon.com/automation/repurposeSelectHosts.cgi?hostclass_regex={STRING}" },
               { match: null,        url: "https://infrastructure.amazon.com/automation/repurposeSelectHosts.cgi?hostclass_regex={STRING}" }
           ],
           title: "Repurpose Hostclass",
           category: "Infrastructure",
           color: "black", backgroundColor: "#E851E3",
        },
        {
           id: "ser",
           url: [
               { match: "-DCA|-WMA", url: null },
               { match: null,        url: "https://lbdashboard.amazon.com/cgi-bin/showservices.cgi?input={STRING}&lbGroup=all&action=Find+Hostclass&collateServices=on&resolveIPs=on" }
           ],
           title: "Show Services",
           category: "Infrastructure",
           color: "white", backgroundColor: "#999966",
        },
        {
           id: "vip",
           url: [
               { match: "-ARN", url: "https://vip-management.arn.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-BAH", url: "https://vip-management.bah.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-BJS", url: "https://vip-management.bjs.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-BOM", url: "https://vip-management.bom.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-CMH", url: "https://vip-management.cmh.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-DUB", url: "https://vip-management-dub.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-FRA", url: "https://vip-management.fra.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-HKG", url: "https://vip-management-hkg.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-GRU", url: "https://vip-management-gru.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-IAD", url: "https://vip-management-iad.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-ICN", url: "https://vip-management.icn.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-KIX", url: "https://vip-management.kix.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-LHR", url: "https://vip-management.lhr.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-NRT", url: "https://vip-management-nrt.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-PDT", url: "https://vip-management.pdt.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-PDX", url: "https://vip-management.pdx.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-PEK", url: "https://vip-management-pek.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-SEA", url: "https://vip-management-sea.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-SFO", url: "https://vip-management-sfo.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-SIN", url: "https://vip-management-sin.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-SYD", url: "https://vip-management-syd.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-YUL", url: "https://vip-management.yul.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-ZHY", url: "https://vip-management.zhy.aws-border.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: "-DCA|-WMA", url: "http://vip-management.dca.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" },
               { match: null,        url: "http://vip-management.amazon.com/vipmgmt/StartWithHostclass.mhtml?hostclass={STRING}" }
           ],
           title: "Show VIPs",
           category: "Infrastructure",
           color: "white", backgroundColor: "#9400d3",
        },
        {
           id: "tos",
           url: [
               { match: "-DCA|-WMA", url: "https://toaster.dca.amazon.com/cgi-bin/hostclass.cgi?hostclass={STRING}" },
               { match: null,        url: "https://toaster.amazon.com/cgi-bin/hostclass.cgi?hostclass={STRING}" }
           ],
           title: "Toaster Hostclass Checker",
           category: "Infrastructure",
           color: "white",
           backgroundColor: "#008455"
        },
        {
           id: "apo",
           url: [
               { match: "-DCA|-WMA", url: "https://apollo.dca.amazon.com/hosts/{STRING}" },
               { match: null,        url: "https://apollo.amazon.com/hosts/{STRING}" }
           ],
           title: "Apollo Environments",
           category: "Other",
           color: "black", backgroundColor: "white",
        },
        {
           id: "odi",
           url: [
               { match: "-DCA|-WMA", url: "https://odin.dca.amazon.com/#search/materialSetsPage=0&namespacesPage=0&searchCatagory=HostClass&searchInactive=false&searchQuery={STRING}&searchGroup=true" },
               { match: null,        url: "https://odin.amazon.com/#search/materialSetsPage=0&namespacesPage=0&searchCatagory=HostClass&searchInactive=false&searchQuery={STRING}&searchGroup=true" }
           ],
           title: "Odin Material Sets",
           category: "Other",
           color: "#E47911", backgroundColor: "white",
        }
    ];

    var VIP_LINKS = [
        {
           id: "vip",
           url: [
               { match: "[.]dca", url: "http://vip-management.dca.amazon.com/vipmgmt/StartWithDnsName.mhtml?vip={STRING}" },
               { match: null,     url: "http://vip-management.amazon.com/vipmgmt/StartWithDnsName.mhtml?vip={STRING}" }
           ],
           title: "Show VIPs",
           category: "Infrastructure",
           color: "white", backgroundColor: "#9400d3",
        },
        {
           id: "ser",
           url: [
               { match: "[.]dca", url: null },
               { match: null,     url: "https://lbdashboard.amazon.com/cgi-bin/showservices.cgi?input={STRING}&lbGroup=all&action=Find+VIP&collateServices=on&resolveIPs=on" }
           ],
           title: "Show Services",
           category: "Infrastructure",
           color: "white", backgroundColor: "#999966",
        },
        {
           id: "cer",
           url: [
               { match: "[.]dca", url: "http://vip-management.dca.amazon.com/certificates/?dns={STRING}" },
               { match: null,     url: "http://vip-management.amazon.com/certificates/?dns={STRING}" }
           ],
           title: "Certificates",
           category: "Infrastructure",
           color: "yellow", backgroundColor: "#006400",
        },
        {
            id: "wib",
            url: "http://willitblend.amazon.com/fqdn/{STRING}",
            title: "WillItBlend VIP Checker",
            category: "Infrastructure",
            color: "#00FF00", backgroundColor: "black",
        },
    ];

    var ASIN_LINKS = [
        {
           id: "us",
           url: "https://www.amazon.com/dp/{STRING}",
           title: "US Detail Page",
           category: "NA",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "ca",
           url: "https://www.amazon.ca/dp/{STRING}",
           title: "CA Detail Page",
           category: "NA",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "uk",
           url: "https://www.amazon.co.uk/dp/{STRING}",
           title: "UK Detail Page",
           category: "EU",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "de",
           url: "https://www.amazon.de/dp/{STRING}",
           title: "DE Detail Page",
           category: "EU",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "fr",
           url: "https://www.amazon.fr/dp/{STRING}",
           title: "FR Detail Page",
           category: "EU",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "jp",
           url: "https://www.amazon.co.jp/dp/{STRING}",
           title: "JP Detail Page",
           category: "FE",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "cn",
           url: "https://www.amazon.cn/dp/{STRING}",
           title: "CN Detail Page",
           category: "CN",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "dse",
           url: "https://gcs.amazon.com/datastore-explorer.cgi?asin={STRING}&entity=all&depth=-1&colour=99CCFF&keephtml=true&x=9&y=20",
           title: "Datastore Explorer",
           category: "ASIN",
           color: "black", backgroundColor: "green",
        }
    ];

    var TT_LINKS = [
        {
           id: "tt",
           url: "https://tt.amazon.com/{STRING}",
           title: "Trouble Ticket",
           category: "Remedy",
           color: "white", backgroundColor: "blue",
        }
    ];

    var ENV_LINKS = [
        {
           id: "apo",
           url: "https://apollo.amazon.com/environments/{STRING}",
           title: "Apollo Environment",
           category: "Apollo",
           color: "black", backgroundColor: "white",
        }
    ];

    var LINK_LINKS = [
        {
           id: "lnk",
           url: "{STRING}",
           title: "Open URL",
           category: "Links",
           color: "black", backgroundColor: "yellow"
        },
        {
           id: "pop",
           url: "{STRING}",
           title: "Open URL in Popup",
           category: "Links",
           color: "black", backgroundColor: "cyan",
           open: POPUP
        }
    ];

    var ENV_PREVIEW_LINK_LINKS = [
        {
           id: "alp",
           url: "https://apollo.amazon.com/operational_configuration.html?environmentId={STRING}&stage=Alpha&opConfigAction=preview",
           title: "Preview Op Config - Alpha",
           category: "Apollo Preview",
           color: "black", backgroundColor: "yellow"
        },
        {
           id: "bet",
           url: "https://apollo.amazon.com/operational_configuration.html?environmentId={STRING}&stage=Beta&opConfigAction=preview",
           title: "Preview Op Config - Beta",
           category: "Apollo Preview",
           color: "black", backgroundColor: "yellow"
        },
        {
           id: "gam",
           url: "https://apollo.amazon.com/operational_configuration.html?environmentId={STRING}&stage=Gamma&opConfigAction=preview",
           title: "Preview Op Config - Gamma",
           category: "Apollo Preview",
           color: "black", backgroundColor: "yellow"
        },
        {
           id: "prd",
           url: "https://apollo.amazon.com/operational_configuration.html?environmentId={STRING}&stage=Prod&opConfigAction=preview",
           title: "Preview Op Config - Prod",
           category: "Apollo Preview",
           color: "black", backgroundColor: "yellow"
        }
    ];

    var ASG_LINKS = [
        {
           id: "arc",
           url: "https://arcturus.amazon.com/autoscaling/group?auto_scaling_group={STRING}&namespace=963362704314",
           title: "Arcturus - AutoScaling Group",
           category: "AWS",
           color: "white", backgroundColor: "blue"
        }
    ];

    var CM_LINKS = [
        {
           id: "cm",
           url: "https://cm.amazon.com/{STRING}",
           title: "Change Management (CM)",
           category: "Remedy",
           color: "black", backgroundColor: "#ffd39b",
        }
    ];

    var WEBLAB_LINKS = [
        {
           id: "wl",
           url: "https://weblab.amazon.com/exec/search?query={STRING}&allowRedirect=true&a=execSearch",
           title: "Weblab",
           category: "Weblab",
           color: "black", backgroundColor: "yellow",
        }
    ];

    var PASTURE_LINKS = [
        {
           id: "us",
           url: "https://greener-na.aka.amazon.com/GreenerPasture/#objectId=USAmazon:{STRING}",
           title: "US Pasture",
           category: "NA",
           color: "black", backgroundColor: "lightgreen",
        },
        {
           id: "ca",
           url: "https://greener-na.aka.amazon.com/GreenerPasture/#objectId=CAAmazon:{STRING}",
           title: "CA Pasture",
           category: "NA",
           color: "black", backgroundColor: "lightgreen",
        },
        {
           id: "gb",
           url: "https://greener-eu.aka.amazon.com/GreenerPasture/#objectId=GBAmazon:{STRING}",
           title: "GB Pasture",
           category: "EU",
           color: "black", backgroundColor: "lightgreen",
        },
        {
           id: "fr",
           url: "https://greener-eu.aka.amazon.com/GreenerPasture/#objectId=FRAmazon:{STRING}",
           title: "FR Pasture",
           category: "EU",
           color: "black", backgroundColor: "lightgreen",
        },
        {
           id: "de",
           url: "https://greener-eu.aka.amazon.com/GreenerPasture/#objectId=DEAmazon:{STRING}",
           title: "DE Pasture",
           category: "EU",
           color: "black", backgroundColor: "lightgreen",
        },
        {
           id: "jp",
           url: "https://greener-fe.aka.amazon.com/GreenerPasture/#objectId=JPAmazon:{STRING}",
           title: "JP Pasture",
           category: "FE",
           color: "black", backgroundColor: "lightgreen",
        },
        {
           id: "cn",
           url: "https://greener-cn.aka.amazon.com/GreenerPasture/#objectId=CNAmazon:{STRING}",
           title: "CN Pasture",
           category: "CN",
           color: "black", backgroundColor: "lightgreen",
        }

    ];

    var AWS_ACCOUNT_ID_LINKS = [
        {
           id: "sot",
           url: "https://aws-tools.amazon.com/servicetools/search.aws?searchType=ACCOUNT&query={STRING}",
           title: "Service Owner Tool",
           category: "Identification",
           color: "black", backgroundColor: "yellow",
        },
        {
            id: "iam",
            url: "https://iam-tools.amazon.com/accounts/{STRING}",
            title: "IAM Support Tool",
            category: "Identification",
            color: "black", backgroundColor: "#ffa500",
        },
        {
            id: "isn",
            url: "https://isengard.amazon.com/roles/{STRING}",
            title: "Isengard (AWS teams)",
            category: "Identification",
            color: "black", backgroundColor: "#00ff00",
        },
        {
            id: "con",
            url: "https://access.amazon.com/search?search_scope=aws&search_term={STRING}",
            title: "Conduit (CDO teams)",
            category: "Identification",
            color: "white", backgroundColor: "#cc3300",
        },
        {
           id: "cwm",
           url: "https://arcturus.amazon.com/cloudwatch?cluster=prod-iad&account={STRING}&commit=fetch+metrics",
           title: "CloudWatch Metrics us-east-1",
           category: "Monitoring",
           color: "#00ff00", backgroundColor: "black",
        },
        {
           id: "cwa",
           url: "https://arcturus.amazon.com/alarms/account?cluster=prod-iad&account={STRING}&commit=Search",
           title: "CloudWatch Alarms us-east-1",
           category: "Monitoring",
           color: "#FFFFFF", backgroundColor: "#7091BB",
        },
    ];

    var CUSTOMERID_LINKS = [
        {
           id: "5d",
           url: "https://atv-pex-tools-na.amazon.com/customer_events_tool.do?customerIdEmail={STRING}&streamingSessionId=&asin=&deviceTypeId=All&timeSelector=on&isFixedTime=false&startTime=5days&endTime=0days",
           title: "5 days QoS",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "10d",
           url: "https://atv-pex-tools-na.amazon.com/customer_events_tool.do?customerIdEmail={STRING}&streamingSessionId=&asin=&deviceTypeId=All&timeSelector=on&isFixedTime=false&startTime=10days&endTime=0days",
           title: "10 days QoS",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "15d",
           url: "https://atv-pex-tools-na.amazon.com/customer_events_tool.do?customerIdEmail={STRING}&streamingSessionId=&asin=&deviceTypeId=All&timeSelector=on&isFixedTime=false&startTime=15days&endTime=0days",
           title: "15 days QoS",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "20d",
           url: "https://atv-pex-tools-na.amazon.com/customer_events_tool.do?customerIdEmail={STRING}&streamingSessionId=&asin=&deviceTypeId=All&timeSelector=on&isFixedTime=false&startTime=20days&endTime=0days",
           title: "20 days QoS",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "25d",
           url: "https://atv-pex-tools-na.amazon.com/customer_events_tool.do?customerIdEmail={STRING}&streamingSessionId=&asin=&deviceTypeId=All&timeSelector=on&isFixedTime=false&startTime=25days&endTime=0days",
           title: "25 days QoS",
           color: "black", backgroundColor: "#ffa500",
        },
        {
           id: "30d",
           url: "https://atv-pex-tools-na.amazon.com/customer_events_tool.do?customerIdEmail={STRING}&streamingSessionId=&asin=&deviceTypeId=All&timeSelector=on&isFixedTime=false&startTime=30days&endTime=0days",
           title: "30 days QoS",
           // category: "NA",
           color: "black", backgroundColor: "#ffa500",
        },
    ];

    var CODE_LINKS = [
        {
           id: "vs",
           url: "https://code.amazon.com/version-sets/{STRING}",
           title: "Version Set",
           category: "Version Set",
           color: "black", backgroundColor: "yellow",
        },
        {
           id: "cb",
           url: "https://code.amazon.com/packages/{STRING}",
           title: "Code Browse",
           category: "Code",
           color: "black", backgroundColor: "yellow",
        },
        {
           id: "apo",
           url: "https://apollo.amazon.com/environments/{STRING}",
           title: "Apollo Environment",
           category: "Apollo",
           color: "black", backgroundColor: "white",
        },
    ];

    var EC2_INSTANCE_LINKS = [
        {
           id: "adm",
           url: "https://admiral-iad.ec2.amazon.com/search?q={STRING}",
           title: "EC2 Admiral",
           category: "Admiral",
           color: "black", backgroundColor: "pink",
        }
    ];

    var LINK_DEFS = [
        { id: "ASG_LINKS",
          links: ASG_LINKS
        },
        { id: "ASIN_LINKS",
          links: ASIN_LINKS
        },
        { id: "CM_LINKS",
          links: CM_LINKS
        },
        { id: "ENV_LINKS",
          links: ENV_LINKS
        },
        { id: "ENV_PREVIEW_LINK_LINKS",
          links: ENV_PREVIEW_LINK_LINKS
        },
        { id: "HOSTCLASS_LINKS",
          links: HOSTCLASS_LINKS
        },
        { id: "HOST_LINKS",
          links: HOST_LINKS
        },
        { id: "LINK_LINKS",
          links: LINK_LINKS
        },
        { id: "PASTURE_LINKS",
          links: PASTURE_LINKS
        },
        { id: "TT_LINKS",
          links: TT_LINKS
        },
        { id: "VIP_LINKS",
          links: VIP_LINKS
        },
        { id: "CUSTOMERID_LINKS",
          links: CUSTOMERID_LINKS
        },
        { id: "AWS_ACCOUNT_ID_LINKS",
          links: AWS_ACCOUNT_ID_LINKS
        },
        { id: "WEBLAB_LINKS",
          links: WEBLAB_LINKS
        },
        { id: "CODE_LINKS",
          links: CODE_LINKS
        },
        { id: "EC2_INSTANCE_LINKS",
          links: EC2_INSTANCE_LINKS
        }
    ];
 
    var DC_MATCH = "vdc|[a-z][a-z][a-z][0-9]+|desktop|laptop|us-east-1[a-z]?|us-west-[0-9]|ap-northeast-[0-9]|ap-southeast-[0-9]|ap-south-[0-9]|eu-central-[0-9]|eu-west-[0-9]"

    // SUBSTITUTIONS specifies all the things on a page that should be matched and
    // decorated with links.  Each entry has the following required properties:
    //
    //   id: A short string indicating the category of entity being matched.
    //       All entries sharing the same ID will be enabled & disabled as a group.
    //   regexp: The pattern to match
    //   regexpFlags: The regexp flags to use in the pattern match
    //   string: The format of the input string given to the link generator(s).  The format string
    //           may contain:
    //               {REGEXPi}  : Will be substituted with the i-th (0-based) match group matched by regexp.
    //               {REGEXPiH} : Will be substituted with the i-th match group, URI encoded.
    //   defaultLinks: A comma-separated string containing the link IDs (see below) that should be enabled by default.
    //   links: The list of link generators for this substitution.  A generator is an object which takes the input string
    //          produced by the 'string' formatter above, and produces the link to insert.
    //          Each generator is an object with the following properties:
    //
    //              id: A short string indicating what type of link this generates.
    //              url: The href of the generated link, specified as a list of {match,url} pairs.
    //                   The first URL whose corresponding 'match' matches the input string is used. match:null
    //                   is used as the default URL if none of the others match.
    //                   Within the URL, {STRING} is substituted with the input string.
    //              color, backgroundColor: The color of the links
    //              title: Name of the link type in the configuration UI.
    //              category: Short string to group the configuration UI for different links together
    //              open: Says what to do when link is clicked:
    //                       (default): Normal browser link
    //                      "popup": Opens link in a popup window
    //                      "hidden": Opens the link without displaying it (for side-effects)
    //                      "copy":  Copies the matched text, instead of opening a link.
    //
    // A substitution may have the optional properties:
    //
    //   negativeRegexp: The pattern that disqualifies a piece of text from being linked, even if regexp matches.
    //   negativeRegexpFlags: The regexp matching flags to apply on negativeRegexp.
    //   siteRegexp: The pattern of page URLs which the matching will occur on. default is all pages.
    //   matchLinks: If true, matches against the href of links.  The default is false, which matches the page text.

    var SUBSTITUTIONS = {
        entries: [
           // Hostname matching and link configuration
           {
              id: "link",
              regexp: '(\\b([a-z][-a-z0-9+.]+://|www\\.)[^\\s\'"<>()]+)',
              regexpFlags: "gi",
              string: "{REGEXP0}",
              defaultLinks: "lnk,pop",
              links: LINK_LINKS,
           },
           {
              id: "host",
              // Look for <blah>.<blah>.<blah>.<blah>
              regexp: "\\b(([A-Za-z0-9-_]+[.]){2,}(amazon[.][a-z]+|[a-z0-9-]+[.]internal|[a-z0-9-]+[.]substrate|ec2.border|a9.com|amazonaws.com|co.[a-z][a-z]))\\b", regexpFlags: "g",
              string: "{REGEXP0}",
              defaultLinks: "cd,ssh",
              links: HOST_LINKS,
           },
           {
              id: "host",
              // Look for <blah>.<dc>
              regexp: "\\b([a-z][a-z0-9-.]+[.](" + DC_MATCH + "))\\b",
              regexpFlags: "g",
              string: "{REGEXP0}.amazon.com",
              defaultLinks: "cd,ssh",
              links: HOST_LINKS,
           },
           // VIP matching and link configuration
           {
              id: "vip",
              regexp: "([a-z0-9-.]+[.]amazon[.]com)",
              regexpFlags: "g",
              string: "{REGEXP0}",
              defaultLinks: "ser,vip",
              links: VIP_LINKS,
           },
           // Hostclass matching and link configuration
           {
              id: "hostclass",
              regexp: "\\b([A-Z][A-Z0-9-]{2,}-[A-Z0-9-]{3,}[A-Z0-9])\\b",
              negativeRegexp: "\\b(?:GMT-[0-9]{4})\\b",
              regexpFlags: "g",
              negativeRegexpFlags: "g",
              string: "{REGEXP0}",
              defaultLinks: "cd,vip",
              links: HOSTCLASS_LINKS,
           },
           // Auto-scaling Group Names
           {
              id: "asg",
              regexp: "\\b(([a-z_A-Z0-9-]{1,30}\/)+(Prod|Gamma|Beta|Alpha)\/-\/[A-Z_a-z0-9-]*)",
              regexpFlags: "g",
              string: "{REGEXP0}",
              defaultLinks: "cd,arc",
              links: ASG_LINKS,
           },
           // Apollo environments string matching and link configuration
           {
              id: "apoenv",
              regexp: "\\b([a-z_A-Z0-9-/]{1,100})/(Prod|Gamma|Beta|Alpha)",
              regexpFlags: "g",
              string: "{REGEXP0}/-/stages/{REGEXP1}",
              defaultLinks: "apo,cd",
              links: ENV_LINKS,
           },
           // Apollo environments preview links
           {
              id: "apoenvPreviewLink",
              regexp: "https://apollo.amazon.com/operational_configuration.html[?]environmentId=([0-9]*).*preview",
              regexpFlags: "",
              string: "{REGEXP0}",
              defaultLinks: "alp,bet,gam,prd",
              matchLinks: true,
              links: ENV_PREVIEW_LINK_LINKS,
           },
           // TT matching and link configuration
           {
              id: "tt",
              regexp: "\\b([E0][0-9]{9})\\b",
              regexpFlags: "g",
              string: "{REGEXP0}",
              defaultLinks: "tt",
              links: TT_LINKS,
           },
           // CM matching and link configuration
           {
              id: "cm",
              regexp: "\\b(1[0-9]{7})\\b",
              regexpFlags: "g",
              string: "{REGEXP0}",
              defaultLinks: "cm",
              links: CM_LINKS,
           },
           // Don't match stuff that doesn't look like ASINs
           {
              regexp: "\\b([A-Z]{10})\\b",
              regexpFlags: "g",
           },
           {
              regexp: "[@./-]\\b([0-9]{10})\\b",
              regexpFlags: "g",
           },
           // ASIN matching and link configuration
           {
              id: "asin",
              regexp: "\\b([A-Z1-9][A-Z0-9]{9})\\b(?![./-@])",
              regexpFlags: "g", string: "{REGEXP0}", defaultLinks: "us", links: ASIN_LINKS,
           },
           // AWS Account ID matching and link configuration
           {
              id: "aws",
              regexp: "\\b((\\d{4})-(\\d{4})-(\\d{4}))\\b",
              regexpFlags: "g", string: "{REGEXP1}{REGEXP2}{REGEXP3}", defaultLinks: "sot", links: AWS_ACCOUNT_ID_LINKS,
           },
           {
              id: "aws",
              regexp: "\\b(\\d{12})\\b",
              regexpFlags: "g", string: "{REGEXP0}", defaultLinks: "sot", links: AWS_ACCOUNT_ID_LINKS,
           },
           // Customer ID matching and link configuration
           {
              id: "cus",
              regexp: "\\b(A[A-Z0-9]{12,16})\\b",
              regexpFlags: "g", string: "{REGEXP0}", defaultLinks: "5d", links: CUSTOMERID_LINKS,
              siteRegexp: "^https*://tt.amazon.com"
           },
           // Weblab matching and link configuration
           {
              id: "wl",
              // Look for blah_1234
              regexp: "\\b([a-zA-Z_]+_[0-9]{4,})\\b",
              regexpFlags: "g",
              string: "{REGEXP0}",
              defaultLinks: "wl",
              links: WEBLAB_LINKS,
           },
           // Order ID matching and link configuration
           {
              id: "pasture",
              regexp: "([0-9]{3}-[0-9]{7}-[0-9]{7})",
              regexpFlags: "g",
              string: "{REGEXP0}",
              defaultLinks: "us",
              links: PASTURE_LINKS,
           },
           // Code link matching and link configuration
           // leave this at end since this is pretty loose regex
           // no defaultLinks to keep current behavior
           // and let user opt in
           {
              id: "code",
              regexp: "\\b([a-z_A-Z0-9-/]{1,100}/[a-z_A-Z0-9-/]{1,100})\\b",
              regexpFlags: "g",
              string: "{REGEXP0}",
              links: CODE_LINKS,
           },
           // EC2 Instance IDs
           {
              id: "ec2Instance",
              // The Prod infra tools use an EC2.<id> convention
              regexp: "\\b(?:(?:i-)|(?:EC2\\.))([a-z0-9]{8}(?:[a-z0-9]{9})?)\\b",
              regexpFlags: "g",
              string: "i-{REGEXP0}",
              links: EC2_INSTANCE_LINKS,
              defaultLinks: "adm" 
           }
        ]
    };

    var STYLES = "\
        span.stringLinks {\
            -webkit-user-select: none;\
            -khtml-user-select: none;\
            -moz-user-select: none;\
            -o-user-select: none;\
            -ms-user-select: none;\
            user-select: none;\
            padding: 1px 0px 1px 0px;\
            margin: 1px 2px 1px 2px;\
            border: 1px solid black;\
            font-family: Verdana,Geneva,sans-serif;\
            font-size:7pt;\
            font-weight:bold;\
        }\
        span.stringLinksInner a::selection { \
            background: transparent;\
        }\
        span.stringLinksInner a::-moz-selection { \
            background: transparent;\
        }\
        @media print {\
            span.stringLinks {\
                display: none;\
            }\
        }\
        #stringLinks span.stringLinksInner a, #stringLinks span.stringLinksInner a:hover,\
        #stringLinks span.stringLinksInner a:focus, #stringLinks span.stringLinksInner a:active  {\
            font-size: 7pt;\
            font-weight: bold;\
            background-color: inherit;\
            padding: 0;\
        }\
        #stringLinks span.stringLinksInner {\
            padding: 0px 3px 0px 3px;\
            margin: 0px 0px 0px 0px;\
            border: 1px solid white;\
        }\
        \
        div.stringLinksCMenu {\
            z-index: 1000;\
            position: absolute;\
        }\
        div.stringLinksCMenuHelp {\
            z-index: 1001;\
            position: absolute;\
            top: 3px;\
            left: 237px;\
        }\
        ul.stringLinksCMenu {\
            text-align: left; \
            width: 250px;\
            left: 0px; top: 0px;\
            border: 1px solid #A7A6AA;\
            background: #FFFFFF;\
            font-size: 12px; \
            text-decoration: none;\
            padding: 2px;\
            margin: 0;\
            overflow: hidden;\
            white-space: nowrap;\
            list-style-type: none;\
            position: absolute;\
        }\
        div.stringLinksPopup div.pageContainer,\
        div.stringLinksInline div.pageContainer {\
            width: 100%; height: 100%;\
            position: relative;\
        }\
        div.stringLinksPopupOverlay {\
            width: 100%; height: 100%;\
            position: absolute;\
            z-index: 9999;\
            display: none;\
            top: 0px; left: 0px;\
            background-color: white;\
            font-size: 20px;\
            text-align: center;\
            vertical-align: middle;\
            float: left;\
        }\
        div.stringLinksPopupOverlay span {\
            vertical-align: middle;\
            position: absolute;\
            top: 50%;\
            margin: -30px 0 0 -60px;\
        }\
        div.stringLinksPopupLoading {\
            background: white url(data:image/png;base64,R0lGODlhGAAYAPYAAP///x0WwPPz+7Gv6WNf00I8yiwmxK6r6Pz8/ZeU4S4oxB0WwOjo+E5JzUxHzezr+Tkzxzcxx+bm9/j4/JOQ4PHx+qOg5aGf5GJd00lDzCIbwScgwkM+ytzb9MPB7TQtxnl02e7t+V5Z0jw2yGdi1LOx6SQdwaek5uPi9tfV8ykiw4F+25GO4Ly6646K35yZ43Nv1/b2/EdBy9HQ8be06qyp53562llU0FdS0D44yVNOz8zK8FxX0YyJ3mxo1Xdz2Li26jIrxeHg9oN/3L687AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJBQAAACwAAAAAGAAYAAAHmoAAgoOEhYaHgxUWBA4aCxwkJwKIhBMJBguZmpkqLBOUDw2bo5kKEogMEKSkLYgIoqubK5QJsZsNCIgCCraZBiiUA72ZJZQABMMgxgAFvRyfxpixGx3LANKxHtbNth8hy8i9IssHwwsXxgLYsSYpxrXDz5QIDubKlAwR5q2UErC2poxNoLBukwoX0IxVuIAhQ6YRBC5MskaxUCAAIfkECQUAAAAsAAAAABgAGAAAB6GAAIKDhIWGh4MVFgQOGhsOGAcxiIQTCQYLmZqZGwkIlA8Nm6OaMgyHDBCkqwsjEoUIoqykNxWFCbOkNoYCCrmaJjWHA7+ZHzOIBMUND5QFvzATlACYsy/TgtWsIpPTz7kyr5TKv8eUB8ULGzSIAtq/CYi46Qswn7AO9As4toUMEfRcHZIgC9wpRBMovNvU6d60ChcwZFigwYGIAwKwaUQUCAAh+QQJBQAAACwAAAAAGAAYAAAHooAAgoOEhYaHgxUWBA4aCzkkJwKIhBMJBguZmpkqLAiUDw2bo5oyEocMEKSrCxCnhAiirKs3hQmzsy+DAgq4pBogKIMDvpvAwoQExQvHhwW+zYiYrNGU06wNHpSCz746O5TKyzwzhwfLmgQphQLX6D4dhLfomgmwDvQLOoYMEegRyApJkIWLQ0BDEyi426Six4RtgipcwJAhUwQCFypA3IgoEAAh+QQJBQAAACwAAAAAGAAYAAAHrYAAgoOEhYaHgxUWBA4aCxwkJzGIhBMJBguZmpkGLAiUDw2bo5oZEocMEKSrCxCnhAiirKsZn4MJs7MJgwIKuawqFYIDv7MnggTFozlDLZMABcpBPjUMhpisJiIJKZQA2KwfP0DPh9HFGjwJQobJypoQK0S2B++kF4IC4PbBt/aaPWA5+CdjQiEGEd5FQHFIgqxcHF4dmkBh3yYVLmx5q3ABQ4ZMBUhYEOCtpLdAACH5BAkFAAAALAAAAAAYABgAAAeegACCg4SFhoeDFRYEDhoaDgQWFYiEEwkGC5mamQYJE5QPDZujmg0PhwwQpKsLEAyFCKKsqw0IhAmzswmDAgq5rAoCggO/sxaCBMWsBIIFyqsRgpjPoybS1KMqzdibBcjcmswAB+CZxwAC09gGwoK43LuDCA7YDp+EDBHPEa+GErK5GkigNIGCulEGKNyjBKDCBQwZMmXAcGESw4uUAgEAIfkECQUAAAAsAAAAABgAGAAAB62AAIKDhIWGh4MVFgQOGgscJCcxiIQTCQYLmZqZBiwIlA8Nm6OaGRKHDBCkqwsQp4QIoqyrGZ+DCbOzCYMCCrmsKhWCA7+zJ4IExaM5Qy2TAAXKQT41DIaYrCYiCSmUANisHz9Az4fRxRo8CUKGycqaECtEtgfvpBeCAuD2wbf2mj1gOfgnY0IhBhHeRUBxSIKsXBxeHZpAYd8mFS5seatwAUOGTAVIWBDgraS3QAAh+QQJBQAAACwAAAAAGAAYAAAHooAAgoOEhYaHgxUWBA4aCzkkJwKIhBMJBguZmpkqLAiUDw2bo5oyEocMEKSrCxCnhAiirKs3hQmzsy+DAgq4pBogKIMDvpvAwoQExQvHhwW+zYiYrNGU06wNHpSCz746O5TKyzwzhwfLmgQphQLX6D4dhLfomgmwDvQLOoYMEegRyApJkIWLQ0BDEyi426Six4RtgipcwJAhUwQCFypA3IgoEAAh+QQJBQAAACwAAAAAGAAYAAAHoYAAgoOEhYaHgxUWBA4aGw4YBzGIhBMJBguZmpkbCQiUDw2bo5oyDIcMEKSrCyMShQiirKQ3FYUJs6Q2hgIKuZomNYcDv5kfM4gExQ0PlAW/MBOUAJizL9OC1awik9PPuTKvlMq/x5QHxQsbNIgC2r8JiLjpCzCfsA70Czi2hQwR9FwdkiAL3ClEEyi829Tp3rQKFzBkWKDBgYgDArBpRBQIADsAAAAAAAAAAAA=) no-repeat scroll center;\
        }\
        input.stringLinksAddressBar {\
            width: 100%;\
        }\
        div.stringLinksPopup {\
            text-align: center;\
            margin: 0 auto;\
            position: absolute;\
            z-index: 502;\
            border: 1px solid black;\
            overflow: hidden;\
            background-color: white;\
            box-shadow: 3px 3px 4px #000;\
            border-radius: 8px;\
        }\
        div.stringLinksInline {\
            text-align: center;\
            border: 1px solid black;\
            overflow: hidden;\
            background-color: white;\
            box-shadow: 3px 3px 4px #000;\
            border-radius: 8px;\
        }\
        div.stringLinksPopup a, div.stringLinksPopup a:hover, div.stringLinksPopup a:visited,\
        div.stringLinksInline a, div.stringLinksInline a:hover, div.stringLinksInline a:visited {\
            color: white !important;\
            background-color: inherit;\
        }\
        div.stringLinksPopup iframe,\
        div.stringLinksInline iframe {\
            width: 100%;\
            height: 100%;\
            position: absolute;\
            top: 0; left: 0;\
            border-width: 0px;\
            background-color: white;\
        }\
        div.stringLinksHeader {\
            background:#5A7EAA url(https://monitorportal.amazon.com/images/header_background.png) repeat-x scroll 0 0;\
            padding: 4px;\
            color: #ffffff;\
            text-align: right;\
            font-family: arial;\
            font-size: 14px;\
        }\
        div.stringLinksPopup div.stringLinksHeader {\
        }\
        ul.stringLinksCMenu li {\
            float: left;\
            margin-right: 1px;\
            position: relative;\
            width: 250px;\
        }\
        ul.stringLinksCMenu .box {\
            position: absolute; \
            left: 18px; \
            top: 1px; \
            text-decoration: none; \
            border: none; \
            padding: 0; \
        }\
        ul.stringLinksCMenu li.title {\
            font-weight: bold; \
        } \
        \
        ul.stringLinksCMenu li div {\
            display: block;\
        }\
        \
        ul.stringLinksCMenu li a.sel {\
            line-height: 18px;\
            padding: 0 4px 0 4px;\
            font-weight: normal;\
            font-family: Tahoma,Verdana,Arial,Helvetica,sans-serif; \
            text-decoration: none; \
            color: blue; \
            position: relative; \
            left: 40px; \
            width: 100%;\
            display: inline-block;\
        }\
        ul.stringLinksCMenu li a.sel:link {\
            color: black; \
        }\
        ul.stringLinksCMenu li a.sel:visited {\
            color: black; \
        }\
        \
        ul.stringLinksCMenu li hr {\
            width: 99%;\
            border: 0;\
            height: 1px;\
            color: #BBBBBB; \
            background-color: #BBBBBB; \
            margin-top: 4px;\
            margin-bottom: 4px;\
            visibility: visible;\
        }\
        ul.stringLinksCMenu li:hover a.sel { background-color: #0099FF; color: #FFFFFF; }\
        ul.stringLinksCMenu li:hover ul {display: block; position: absolute; top: 0; left: 246px; width:250px;}\
        ul.stringLinksCMenu li:hover ul li ul {display: none;}\
        ul.stringLinksCMenu li:hover ul li a.sel { display: block; background-color: #F6F6F6; color: #000000; }\
        ul.stringLinksCMenu li:hover ul li a.sel:hover { background-color: #0099FF; color: #FFFFFF; }\
        ul.stringLinksCMenu li:hover ul.left { left: -250px; }\
        #stagetabs ul.tabs li a { display: inline; }\
        #stagetabs ul.tabs li span.stringLinks a { font-size: 7pt; }\
        #searchresult-main div.searchresult-component.host { width: inherit; }\
        #searchresult-main div.searchresult-component.hostclass { width: inherit; }\
        #monitor-amazon-com #graph-control span.stringLinks, \
        #monitor-amazon-com #graph-control span.stringLinksInner { display: inline-block; }\
        .dynDiv_moveDiv {\
             cursor: move;\
             position: absolute;\
             overflow: hidden;\
        }\
        \
        .dynDiv_resizeDiv_tl,.dynDiv_resizeDiv_tr,.dynDiv_resizeDiv_bl,.dynDiv_resizeDiv_br {\
             width: 10px;\
             height: 10px;\
             background: #FFFFCC url(data:image/png;base64,R0lGODlhCwALALMAAISEhN7e3szMzI2Njebm5pSUlOzs7NbW1v///wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEHAAgALAAAAAALAAsAAAQ0MICAJCVDTIQPHxRlAB6xleDnBcVYbhJRoN4BEMhbD/hL2b1b4cfL8Ui5W9JQMeIEA+YhAgA7) no-repeat scroll center;\
             border: 1px solid #000;\
             border-radius: 3px; \
             -moz-border-radius: 3px; \
             position: absolute;\
        }\
        \
        .dynDiv_resizeDiv_tl {\
             top: -1px;\
             left: -1px;\
        }\
        \
        .dynDiv_resizeDiv_tr {\
             top: -1px;\
             right: -1px;\
        }\
        \
        .dynDiv_resizeDiv_bl {\
             bottom: -1px;\
             left: -1px;\
        }\
        \
        .dynDiv_resizeDiv_br {\
             bottom: -1px;\
             right: -1px;\
        }\
        \
        .dynDiv_moveParentDiv {\
             width: 100%;\
             margin: auto;\
             height: 16px;\
             font-size: 15px;\
             position: absolute;\
             top: -1px;\
             left: -1px;\
             background: #faa;\
             border: 1px solid #aaa;\
             border-left: 0;\
             border-right: 0;\
             padding: 0;\
             overflow: hidden;\
             white-space:nowrap;\
        }\
        \
        .dynDiv_minmaxDiv {\
             position: absolute;\
             top: 1px;\
             right: 15px;\
             width: 15px;\
             height: 15px;\
             background: #faa;\
             font-size: 15px;\
             padding: 0;\
             margin: 0;\
        }\
        ";

    var incognito = false;
    var ctrlRightClick = false;
    var INCOGNITO_MODE = "IncognitoMode";
    var RIGHT_CLICK_MODE = "RightClick";
    var ON_DEMAND_ID = "OnDemand";
    var WHITELIST_ID = "Whitelist";
    var GREYLIST_ID = "Greylist";
    var DEFAULT_WHITELIST = "";
    var DEFAULT_GREYLIST = "http[s]?://permissions.amazon.com/.*,http[s]?://codereviewer.amazon.com/.*,http[s]?://cr.amazon.com/.*,http[s]?://cm-new.amazon.com/.*,http[s]?://cm.amazon.com/.*,http[s]?://monitorportal.*.amazon.com/reports.*,http[s]?://tt.amazon.com/search.*,http[s]?://exchange.amazon.com/.*(s=Draft|(a=(New|Reply))).*";
    var whitelist = [];
    var greylist = [];

    function initialize() {
       addCopyLinksToAll();
       initWhiteGreylists();
       addStyle(STYLES);
       mergeCustomDefinitions();

       ContextMenu.init();
       document.addEventListener("click", stringLinksHideContextMenu, false);
       document.addEventListener("keydown", checkKeyPress, false);
       document.addEventListener("mouseup", popupMouseUp, false);
       window.StringLinks = { decorateStrings: decorateStrings,
                                  removeStringLinks: removeStringLinks,
                                  openDefaultPopup: openDefaultPopup,
                                  setIncognitoMode: setIncognitoMode,
                                  setRightClickMode: setRightClickMode,
                                  version: "2.0.67" };
       if (document.getElementById("StringLinksOff")) {
           return;
       }

       var incognitoMarker = document.getElementById("StringLinksIncognito");
       if (incognitoMarker) {
          incognito = true;
          incognitoMarker.innerHTML = "Note: StringLinks is working in <i>incognito mode</i>. Please right-click on matched strings to see options";
          incognitoMarker.style.display = "";
       }
       var onDemand = getValue(ON_DEMAND_ID, "off");
       var incognitoMode = getValue(INCOGNITO_MODE, "off");
       if (incognitoMode == "on") {
          incognito = true;
       }

       evaluateRightClickMode();

       if (onDemand === 'off' || document.getElementById("StringLinksForce")) {
           interceptCustomPageAjaxRequests();

           // Do white/greylisting. Whitelisting is highest priority, over a greylist
           if (whitelist.length > 0) {
               // For whitelist, only decorate if page is on whitelist
               if (amOnWhiteGreylist(whitelist)) {
                   decorateStrings(false);
               }
           }
           else if (! amOnWhiteGreylist(greylist)) {
               // For greylist, only decorate if page is not on greylist
               decorateStrings(true);
           }
           if (/cloudwatch\/home/.test(window.location.href)) {
               setInterval(function() {
                   if (/^#alpine:/.test(window.location.hash)) {
                       decorateStrings(true, true);
                   }
               }, 1000);
           }
       }
    }

    function addCopyLinksToAll() {
       for (var i = 0; i < LINK_DEFS.length; i++) {
          LINK_DEFS[i].links.push({
             id: "cpy",
             url: "{STRING}",
             title: "Copy Value to Clipboard ",
             color: "white", backgroundColor: "black",
             open: COPY
          });
       }
    }

    function interceptCustomPageAjaxRequests() {
        interceptCMAjaxRequests();
        interceptTTAjaxRequests();
        interceptApolloCapacityExpanderRequests();
    }

    function isOnCMPage() {
        return /https:..cm.amazon.com.[0-9]/.test(window.location.href);
    }

    function interceptCMAjaxRequests() {
        if (!isOnCMPage()) {
            return;
        }
        var originalRefreshApprovers = window.refresh_approvers;
        var originalEditOverview = window.edit_overview;
        var originalOnSaveOverview = window.on_save_overview;
        window.refresh_approvers = function() {
            var ret = originalRefreshApprovers.apply(this, arguments);
            setTimeout(decorateStrings, 0);
            return ret;
        };
        window.edit_overview = function() {
            removeStringLinks();
            return originalEditOverview.apply(this, arguments);
        };
        window.on_save_overview = function() {
            var ret = originalOnSaveOverview.apply(this, arguments);
            setTimeout(decorateStrings, 0);
            return ret;
        };
    }
    function interceptTTAjaxRequests() {
        if (! /https:..tt.amazon.com.[0-9]/.test(window.location.href)) {
            return;
        }
        var originalRegisterActionMenus = window.registerActionMenus ;
        window.registerActionMenus = function() {
            var ret = originalRegisterActionMenus();
            setTimeout(decorateStrings, 0);
            return ret;
        };
    }

    function interceptApolloCapacityExpanderRequests() {
        if (! /https:..apollo.[a-z.]*amazon.com/.test(window.location.href)) {
            return;
        }
        if ($) {
            function trapExpanderClicks() {        // Trap clicks on hostclass/asg expander icons
                var CHECK_DELAY_MS = 250;
                var capacityTable = $(this).closest('table');        // Find parent table
                function checkForChange() {
                    // When table stops containing "expandInProgress" then it's time to run stringLinks
                    if (/expandInProgress/.test(capacityTable.html())) {
                        window.setTimeout(checkForChange, CHECK_DELAY_MS);
                    }
                    else {
                        decorateStrings(true);
                        $('.expanderButton').unbind('click.stringLinks');
                        $('.expanderButton').bind('click.stringLinks', trapExpanderClicks);
                    }
                };
                window.setTimeout(checkForChange, CHECK_DELAY_MS);
            };
            $('.expanderButton').bind('click.stringLinks', trapExpanderClicks);
        }
    }

    function removeStringLinkWhichBreaksCMPage() {
        if (!isOnCMPage()) {
            return;
        }
        var cmIdTd = document.getElementById('cm_id');
        if (cmIdTd) {
            var badLink = getFirstElementByClassName(cmIdTd, "stringLinks");
            if (badLink) {
                cmIdTd.removeChild(badLink);
            }
        }
    }

    function mergeCustomDefinitions() {
        mergeCustomSubstitutions();
        mergeCustomLinks();
    }

    function mergeCustomSubstitutions() {
       var customSub = getValue('SUBSTITUTIONS', "");
       setValue('SUBSTITUTIONS', customSub);

       if (customSub != "") {
           var entry;
           try {
               var customEntries = JSON.parse("[" + customSub + "]");
               for (var j = 0; j < customEntries.length; j++) {
                   entry = customEntries[j];
                   if (validateSubstitution('SUBSTITUTIONS', j, entry)) {
                       SUBSTITUTIONS.entries.splice(0, 0, entry);
                       entry.links = addNewLinkDefinition(entry.links);
                   }
               }
           }
           catch (e) {
               log("Bad custom substitution definition '" + entry.id + "', entry: '" + customSub + "', exception: " + e);
           }
       }
    }

    function addNewLinkDefinition(linkId) {
       for (var i = 0; i < LINK_DEFS.length; i++) {
           var linkDef = LINK_DEFS[i];
           if (linkDef.id === linkId) {
               return linkDef.links;
           }
       }
       var linkDef = {id: linkId, links: []};
       LINK_DEFS.push(linkDef);
       return linkDef.links;
    }

    function mergeCustomLinks() {
       for (var i = 0; i < LINK_DEFS.length; i++) {
           var linkDef = LINK_DEFS[i];
           var customLinks = getValue(linkDef.id, "");
           setValue(linkDef.id, customLinks);

           if (customLinks != "") {
               try {
                   var customLinksArray = JSON.parse("[" + customLinks + "]");
                   for (var j = 0; j < customLinksArray.length; j++) {
                       var link = customLinksArray[j];
                       if (validateLink(linkDef.id, j, link)) {
                           addLink(linkDef.links, link);
                       }
                   }
               }
               catch (e) {
                   log("Bad custom link definition '" + linkDef.id + "', entry: '" + customLinks + "', exception: " + e);
               }
           }
       }
    }

    function addLink(links, link) {
       if (link.category) {
           var foundCategory = false;
           for (var i = 0; i < links.length; i++) {
               var categoryMatch = (links[i].category === link.category);
               if (!foundCategory && categoryMatch) {
                   foundCategory = true;
               }
               else if (foundCategory && ! categoryMatch) {
                   // We're one past the category, add it here
                   links.splice(i, 0, link);
                   return;
               }
           }
       }

       links.push(link);
    }

    function validateSubstitution(id, index, link) {
        return validateStringLinkObject(id, index, link, ["id", "regexp", "regexpFlags", "string", "defaultLinks", "links"]);
    }

    function validateLink(id, index, link) {
        return validateStringLinkObject(id, index, link, ["id", "url", "title", "color", "backgroundColor"]);
    }

    function validateStringLinkObject(id, index, link, requiredFields) {
        var missingFields = [];
        for (var i = 0; i < requiredFields.length; i++) {
            var field = requiredFields[i];
            var fieldValue = link[field];
            if (! fieldValue || typeof fieldValue != "string") {
                missingFields.push(field);
            }
        }
        if (missingFields.length === 0) {
            return true;
        }
        log("Rejecting stringLink def " + index + " of " + id + " because it does not define the following string fields: " + missingFields.join(", "));
        return false;
    }

    function initWhiteGreylists() {
        restoreWhiteGreylist(WHITELIST_ID, DEFAULT_WHITELIST, true);
        restoreWhiteGreylist(GREYLIST_ID, DEFAULT_GREYLIST, false);
    }

    function restoreWhiteGreylist(id, defaultVal, isWhite) {
       var listVal = getValue(id, defaultVal);
       setValue(id, listVal);
       storeInArray = listVal.split(",");
       if (storeInArray.length === 1 && storeInArray[0].length === 0) {
           storeInArray = [];
       }
       if (isWhite) {
           whitelist = storeInArray;
       }
       else {
           greylist = storeInArray;
       }
    }

    function amOnWhiteGreylist(list) {
        var location = window.location.href;
        for (var i = 0; i < list.length; i++) {
            if (new RegExp('^' + list[i]).test(location)) {
                return true;
            }
        }
        return false;
    }

    function checkKeyPress(e) {
        // Check for Ctrl-Alt-S
        if (e.ctrlKey && e.altKey && ((e.which == 115) || (e.which == 83))) {
            removeStringLinks();
            if (! e.shiftKey) {
                decorateStrings(false);
            }
        }
    }

    function removeStringLinks() {
        removeStringLinksInContainer(document);
    }

    function removeStringLinksInContainer(container) {
        [].forEach.call(container.querySelectorAll('span.stringLinks'), function(e){
            e.parentNode.removeChild(e);
        });
    }

    function trapLinkClicks(ev) {
       if (/StringLinks(Popup|Inline),/.test(this.href)) {
           return openLinkInFrame(this, ev);
       }
       if ((ev.ctrlKey && ev.shiftKey) || /StringLinksPopup,/.test(this.href)){
           return openPopup.call(this, ev);
       }
    }

    function getLinkArgs(argString, args) {
       var argList = argString.split(",");
       for (var i = 0; i < argList.length; i++) {
           var split = argList[i].split("_");
           if (split.length === 2) {
               args[split[0]] = split[1];
           }
       }
    }

    function openLinkInFrame(link, ev) {
       var linkDef = { href: link.href, title: link.href };
       var after;
       if (/StringLinksInline,/.test(link.href)) {
           var match = /(.*)[#]StringLinksInline,(.*)_EndInline/.exec(link.href);
           linkDef.href = match[1];
           linkDef.title = match[1];
           getLinkArgs(match[2], linkDef);
           after = link;
       }
       else if (/StringLinksPopup,/.test(link.href)) {
           var match = /(.*)[#]StringLinksPopup,(.*)_EndPopup/.exec(link.href);
           linkDef.href = match[1];
           linkDef.title = match[1];
           getLinkArgs(match[2], linkDef);
       }
       return openPopup.call(linkDef, ev, after);

    }

    function decorateStrings(limitedMode, replaceLive) {
       if (isDecorating) {
          return;
       }
       isDecorating = true;
       if (!replaceLive) {
           removeStringLinks();
       }
       // Retrieve enabled substitutions. They are stored in about:config for this script.
       // They are a comma-separated list of link ids stored under the value "< entry.id>Links"
       for (var r = 0; r < SUBSTITUTIONS.entries.length; r++) {
          var entry = SUBSTITUTIONS.entries[r];
          if (!entry.id)
             continue;
          var enabledLinks = getEnabledLinks(entry);
          entry.enabledLinks = enabledLinks;

          // Mark each link as enabled/disabled depending on whether it's in the list of enabled
          // links or not.   If enabled links is 'all' then all links are enabled
          var linkIdsForThisEntry = [];
          for (var linkNum = entry.links.length - 1; linkNum >= 0; linkNum--) {
             var link = entry.links[linkNum];
             linkIdsForThisEntry.push(link.id);
             var enabled = true;
             if (entry.enabledLinks != 'all' && ! new RegExp('\\b' + link.id + '\\b').test(entry.enabledLinks)) {
                enabled = false;
             }
             link.enabled = enabled;

             // Allow link colors to be overriden, example entry:
             //    host.sni.color = <foreground>,<background>
             var linkColorOverride = getValue(entry.id + "." + link.id + ".color");
             if (linkColorOverride) {
                var colors = linkColorOverride.split(",");
                if (colors.length == 2) {
                   link.color = colors[0];
                   link.backgroundColor = colors[1];
                }
             }
          }
          setValue(entry.id + "Links_Choose_From_This_List", linkIdsForThisEntry.join(","));
       }

       // Grab the text and link nodes
       var textNode, text = document.evaluate("//text()[normalize-space(.)!='']",document,null,6,null);
       var links = document.evaluate("//a[@href]",document,null,6,null);
       var limit = limitNumberIf(text.snapshotLength, STRING_LIMIT, limitedMode);
       var on = true;

       var i = 0, batchEnd;
       var batchAddStringNodes = function(){
           // Check for matches on string nodes
           for (batchEnd = i + LINK_REPLACEMENT_BATCH_SIZE; (i < batchEnd) && (i < limit); i++) {
              var textNode = text.snapshotItem(limit - i - 1);
              if (textNode.textContent === "StringLinksToggle") {
                  on = !on;
              }
              else if (on) {
                  checkForMatches(textNode, textNode.textContent, false, replaceLive);
              }
           }

           if (i < limit) {
               // We're lower than the limit, so sleep to let the browser catch up and do another batch:
               window.setTimeout(batchAddStringNodes, LINK_REPLACEMENT_BATCH_INTERVAL);
           } else {
               // We completed the entire list, so now begin batching the link nodes
               limit = limitNumberIf(links.snapshotLength, STRING_LIMIT, limitedMode);
               i = 0;
               batchAddLinkNodes();
           }
       }

       var batchAddLinkNodes = function(){
           // Check for matches on link nodes
           for (batchEnd = i + LINK_REPLACEMENT_BATCH_SIZE; (i < batchEnd) && (i < links.snapshotLength); i++) {
              var node = links.snapshotItem(limit - i - 1);
              node.addEventListener("click", trapLinkClicks, true);
              checkForAutoDisplayLinks(node);
              if (i < limit) {
                 checkForMatches(node, node.href, true, replaceLive);
              }
           }

           if (i < links.snapshotLength) {
               // We're lower than the limit, so sleep to let the browser catch up and do another batch:
               window.setTimeout(batchAddLinkNodes, LINK_REPLACEMENT_BATCH_INTERVAL);
           } else {
               removeStringLinkWhichBreaksCMPage();
               isDecorating = false;
           }
       }

       batchAddStringNodes();
    }

    function checkForAutoDisplayLinks(link) {
        if (/StringLinks(Popup|Inline),auto_on,/.test(link.href)) {
           openLinkInFrame(link);
        }
    }

    function limitNumberIf(num, limitValue, shouldLimit) {
       if (shouldLimit && num > limitValue) {
          return limitValue;
       }
       return num;
    }

    function getEnabledLinks(entry) {
       var configId = entry.id + "Links";
       var enabledLinks = getValue(configId);
       if (!enabledLinks && entry.defaultLinks) {
          enabledLinks = entry.defaultLinks;
       }

       setValue(configId, enabledLinks);
       return enabledLinks;
    }

    function checkForMatches(node, textContent, doOnlyLinks, replaceLive) {
       // Go through all configured substitutions
       for (var entryNum = 0; entryNum < SUBSTITUTIONS.entries.length; entryNum++) {
          var entry = SUBSTITUTIONS.entries[entryNum];
          var entryIsMatchLinks = entry.matchLinks == true;
          if (doOnlyLinks != entryIsMatchLinks) {
             continue;
          }
          // If entry has a "site" matcher, then only string match if we're on the right site
          if (entry.siteRegexp && ! new RegExp(entry.siteRegexp, "g").test(window.location.href)) {
             continue;
          }

          var regexp = new RegExp(entry.regexp, entry.regexpFlags);
          var match = regexp.exec(textContent);
          if (entry.negativeRegexp) {
            var negativeRegexp = new RegExp(entry.negativeRegexp, entry.negativeRegexpFlags);
            if (negativeRegexp.exec(textContent)) {
              match = false;
            }
          }
          if (match) {
             // Matching a blank entry means terminate. Those entries are used for
             // stopping matching of certain strings that we don't want to match
             // following regexps
             if (!entry.id)
                break;

            if (replaceLive) {
                removeStringLinksInContainer(node.parentNode);
            }

            var string = entry.string;
            for (var i = 1; i < match.length; i++) {
                string = string.replace(new RegExp("{REGEXP" + (i - 1) + "}", "g"), match[i]);
                string = string.replace(new RegExp("{REGEXP" + (i - 1) + "H}", "g"), encodeURIComponent(match[i]));
            }

             // We got a match, let's insert image links for all enabled links
             var lastLink = null;
             var links = getLinksForEntry(entry, string);
             for (var linkNum = links.length - 1; linkNum >= 0; linkNum--) {
                var link = links[linkNum];

                // Skip this entry if it's not enabled
                if (link.enabled && !incognito) {
                   var insertedLink = insertLink(entryNum, link, string, node);
                   if (insertedLink != null) {
                       lastLink = insertedLink;
                   }
                }
             }
             if (lastLink && getValue("addSeparator") && !incognito) {
                var separatorSpan = document.createElement('span');
                var separatorText = document.createTextNode(" |");
                separatorSpan.appendChild(separatorText);
                lastLink.parentNode.insertBefore(separatorSpan, lastLink);
             }

             // If no links were added (all disabled) then add contextmenu to the matched
             // textnode's parent

             if (incognito || (!lastLink && links.length > 0))
                node.parentNode.addEventListener("contextmenu", function(ev) {
                           return displayContextMenu(ev, entryNum, string);
                       }, false);

             // Skip other entries, first match wins
             break;
          }
       }
    }

    function getLinksForEntry(entry, string) {
        var links = entry.links;
        if (entry.id == "host") {
            setBastionLink(links, ssbHostLinksIndex, getBastionAndHostnameFromString(string));
        }
        return links;
    }

    function setBastionLink(links, index, bastionInfo) {
        var sshUrl = bastionInfo.bastion == null ?
                       'ssh://' + bastionInfo.hostname :
                       'ssh://' + bastionInfo.bastion + '?cmd=' + encodeURIComponent('[[ `hostname` != *' + bastionInfo.hostname + '* ]] && exec ssh-nirvana ' + bastionInfo.hostname);
        links[index].url = sshUrl;
    }

    var HOST_MATCH_TO_BASTION_TABLE = [
        {
            regex: /[.]zhy[0-9]*[.]/,
            bastion: "bastion-zhy.amazon.com"
        },
        {
            regex: /[.]bjs[0-9]*[.]/,
            bastion: "bastion-bjs.amazon.com"
        },
        {
            regex: /(.*.bom.*.amazon.com|.*.bom.|.*.bom..|.*.ap-south-1.amazon.com|.*.ap-south-1)/,
            bastion: "bastion-bom.amazon.com"
        },
        {
            regex: /(.*.cmh.*.amazon.com|.*.cmh.|.*.cmh..|.*.us-east-2.amazon.com|.*.us-east-2)/,
            bastion: "bastion-cmh.amazon.com"
        },
        {
            regex: /(.*.dub.*.amazon.com|.*.dub.|.*.dub..|.*.eu-west-1.amazon.com|.*.eu-west-1)/,
            bastion: "security-bastions-prod-dub.amazon.com"
        },
        {
            regex: /(.*.fra.*.amazon.com|.*.fra.|.*.fra..|.*.eu-central-1.amazon.com|.*.eu-central-1)/,
            bastion: "bastion-fra.amazon.com"
        },
        {
            regex: /(.*.gru.*.amazon.com|.*.gru.|.*.gru..|.*.sa-east-1.amazon.com|.*.sa-east-1)/,
            bastion: "security-bastions-prod-gru.amazon.com"
        },
        {
            regex: /(.*.iad.*.amazon.com|.*.iad.|.*.iad..|.*.vdc.amazon.com|.*.vdc|.*.us-east-.*.amazon.com|.*.us-east-.)/,
            bastion: "security-bastions-prod-iad.amazon.com"
        },
        {
            regex: /(.*.icn.*.amazon.com|.*.icn.|.*.icn..|.*.ap-northeast-2.amazon.com|.*.ap-northeast-2)/,
            bastion: "bastion-icn.amazon.com"
        },
        {
            regex: /(.*.lhr.*.amazon.com|.*.lhr.|.*.lhr..|.*.eu-west-2.amazon.com|.*.eu-west-2)/,
            bastion: "security-bastions-prod-lhr.amazon.com"
        },
        {
            regex: /(.*.lux.*.amazon.com|.*.lux.|.*.lux..)/,
            bastion: "security-bastions-prod-lux.amazon.com"
        },
        {
            regex: /(.*.nrt.*.amazon.com|.*.nrt.|.*.nrt..|.*.ap-northeast-.*.amazon.com|.*.ap-northeast-.)/,
            bastion: "security-bastions-prod-nrt.amazon.com"
        },
        {
            regex: /(.*.pdx.*.amazon.com|.*.pdx.|.*.pdx..|.*.us-west-2.amazon.com|.*.us-west-2)/,
            bastion: "security-bastions-prod-pdx.amazon.com"
        },
        {
            regex: /(.*.pek.*.amazon.com|.*.pek.|.*.pek..)/,
            bastion: "security-bastions-prod-pek.amazon.com"
        },
        {
            regex: /(.*.sea.*.amazon.com|.*.sea.|.*.sea..)/,
            bastion: "security-bastions-prod-sea.amazon.com"
        },
        {
            regex: /(.*.sfo.*.amazon.com|.*.sfo.|.*.sfo..)/,
            bastion: "security-bastions-prod-sfo.amazon.com"
        },
        {
            regex: /(.*.sin.*.amazon.com|.*.sin.|.*.sin..|.*.ap-southeast-1.amazon.com|.*.ap-southeast-1)/,
            bastion: "security-bastions-prod-sin.amazon.com"
        },
        {
            regex: /(.*.syd.*.amazon.com|.*.syd.|.*.syd..|.*.ap-southeast-2.amazon.com|.*.ap-southeast-2)/,
            bastion: "security-bastions-prod-syd.amazon.com"
        },
        {
            regex: /(.*.yul.*.amazon.com|.*.yul.|.*.yul..|.*.ca-central-1.amazon.com|.*.ca-central-1)/,
            bastion: "security-bastions-prod-yul.amazon.com"
        },
        {
            regex: /(.*.zhy.*.amazon.com|.*.zhy.|.*.zhy..|.*.cn-northwest-1.amazon.com|.*.cn-northwest-1)/,
            bastion: "bastion-zhy.amazon.com"
        }
    ];

    function getBastionAndHostnameFromString(string) {
        var bastion = null;
        var hostname = string;
        if (/aes0[.]internal/.test(string) || /ec2[.]substrate/.test(string)) {
            var matchZone = string.match(/^[^.]*[.]([^.]*)/);
            if (matchZone != null && matchZone.length == 2) {
                var zone = matchZone[1];
                zone = zone.replace("z-", "z").replace(/-[0-9]*$/, "");
                bastion = "bastion-" + zone + ".ec2.amazon.com";
            }
        }
        else if (/ec2[.]border/.test(string)) {
            var matchZone = string.match(/^.*-([^.]*-[-0-9])/);
            if (matchZone != null && matchZone.length == 2) {
                var zone = matchZone[1];
                zone = zone.replace("z-", "z").replace(/-[0-9]*$/, "");
                var matchHost = string.match(/^(.*)-(\w+\d+-\d+|z-\d+)/);
                if (matchHost != null && matchHost.length == 3) {
                    var az = matchHost[2];
                    hostname = matchHost[1] + "." + az + ".";
                    hostname += /^z-/.test(az) ? "aes0.internal" : "ec2.substrate";
                    bastion = "bastion-" + zone + ".ec2.amazon.com";
                }
            }
        }
        else {
            for (var i = 0; i < HOST_MATCH_TO_BASTION_TABLE.length; i++) {
                if (HOST_MATCH_TO_BASTION_TABLE[i].regex.test(string)) {
                    bastion = HOST_MATCH_TO_BASTION_TABLE[i].bastion;
                    break;
                }
            }
        }
        return { bastion: bastion, hostname: hostname };
    }

    function getStringInLink(link, string) {
       var stringInLink = string;
       if (link.replace) {
           stringInLink = string.replace(link.replace, link.replaceWith);
       }
       return stringInLink;
    }

    function getLinkContainer(entryNum, link, string, withLink) {
       var entry = SUBSTITUTIONS.entries[entryNum];
       var href  = getLinkUrlForString(link, getStringInLink(link, string));
       if (href == null) {
           return null;
       }

       // Create link with text in it
       var linkNode    = document.createElement(withLink ? 'a' : 'span');
       var linkText    = document.createTextNode(' '  + link.id.toUpperCase());
       if (withLink) {
           linkNode.href   = href;
           linkNode.title  = link.title + ": " + string + " (right-click for more options)";
       }
       if (link.open) {
           if (link.open === POPUP) {
               linkNode.addEventListener("click", openPopup, true);
           }
           else if (link.open === HIDDEN) {
               linkNode.addEventListener("click", openHidden, true);
           }
           else if (link.open === COPY) {
               linkNode.string = string;
               linkNode.href = "javascript:void(0)";
               linkNode.addEventListener("click", copyValue, true);
           }
       }
       linkNode.style.color = link.color ? link.color: 'black';
       linkNode.style.textDecoration = 'none';
       linkNode.style.fontSize = '7pt';
       linkNode.style.fontFamily = 'Verdana,Geneva,sans-serif';
       linkNode.style.padding = '0';
       linkNode.appendChild(linkText);

       // Put link in a span
       var container = document.createElement('span');
       container.className = "stringLinks";
       container.id = "stringLinks";
       var innerContainer = document.createElement('span');
       innerContainer.className = "stringLinksInner";
       innerContainer.style.backgroundColor = link.backgroundColor ? link.backgroundColor: 'white';
       innerContainer.style.display = 'inline-block';
       innerContainer.style.lineHeight = 'normal';
       container.appendChild(innerContainer);
       innerContainer.appendChild(linkNode);

       return container;
    }

    function copyValue() {
       copyValueToClipboard(this.string);
       return false;
    }

    function getLinkUrlForString(link, string) {
        var url = link.url;
        if (Array.isArray(link.url)) {
            for (var i = 0; i < link.url.length; i++) {
                var match = link.url[i].match;
                if (match == null || new RegExp(match).test(string)) {
                    url = link.url[i].url;
                    break;
                }
            }
        }
        return url == null ? null : url.replace(/{STRING}/g, getStringInLink(link, string));
    }

    function sanitizeLink(linkStr) {
       var link = linkStr || '';
       link = link.trim();
       return ((link == '') || (link == 'about:blank')) ? null : link;
    }

    function getLinkFromElement(el) {
       var href = sanitizeLink(el.href) || sanitizeLink(el.text) || sanitizeLink(el.title) || 'about:blank';
       if (/^http:[a-zA-Z0-9-.]*\.amazon\.com\//.test(href)) {
           href = href.replace(/^http:/, "https:");
       }
       return href;
    }

    function openPopup(ev, after) {
       var MARGIN = 50;
       var popupArea = getPopupArea(this, MARGIN);
       var div = document.createElement('div');
       var title = this.title.replace(/:.*/, "");
       var href = getLinkFromElement(this);
       if (!after) {
           div.setAttribute("class", "stringLinksPopup dynDiv_moveDiv");
           div.style.left   = popupArea.x + "px";
           div.style.top    = popupArea.y + "px";
       }
       else {
           div.setAttribute("class", "stringLinksInline");
       }
       div.style.width  = popupArea.width + "px";
       div.style.height = popupArea.height + "px";
       div.innerHTML = '<div class="stringLinksHeader">\
                                <div class="stringLinksAddressBarContainer" style="float: left; width: ' + (popupArea.width - 150) + 'px;">\
                                    <input class="stringLinksAddressBar" name="stringLinksAddressBar" type="text" value="' + href + '">\
                                </div>\
                                <div style="float: right;">[<a class="stringLinksClose" href="#">Close</a>]</div>\
                                <div style="float: right;">[<a class="stringLinksNewTab" href="' + href + '" target="_blank">New tab</a>]&nbsp;</div>\
                                <div style="clear: both;"></div>\
                            </div>\
                       <div class="pageContainer">\
                           <div class="stringLinksPopupOverlay stringLinksPopupMoving"><span>Moving/resizing</span></div>\
                           <div class="stringLinksPopupOverlay stringLinksPopupLoading"></div>\
                           <iframe src="' + href + '">' + href + '</iframe><div style="clear: both;">\
                       </div>';
        if (!after) {
            var resize = document.createElement('div');
            resize.setAttribute("class", "dynDiv_resizeDiv_br");
            div.appendChild(resize);
            getFirstElementByClassName(div, "stringLinksPopupLoading").style.display = "block";
            document.body.appendChild(div);
            makeResizable(div, resize);
        }
        else {
            after.parentNode.insertBefore(div, after.nextSibling);
        }

       doAddressBar(div);
       doCloseLink(div);
       if (ev) {
           return stopEvent(ev);
       }
       return false;
    }

    function setPopupSize(width, height) {
       if (width !== 0 && height !== 0) {
           setValue("StringLinksPopupWidth", width);
           setValue("StringLinksPopupHeight", height);
       }
    }

    function getPopupArea(linkDef, defaultMargin) {
       var MIN_WIDTH = 100;
       var MIN_HEIGHT = 100;
       var windowOffset = getWindowOffset();
       var windowSize = getWindowSize();
       return {
           x: getValueOrOverride(windowOffset.x + defaultMargin, linkDef.x),
           y: getValueOrOverride(windowOffset.y + defaultMargin, linkDef.y),
           width: getValueOrOverride(limitDimension("StringLinksPopupWidth",  MIN_WIDTH,  windowSize.width -  2 * defaultMargin),
                                     linkDef.width),
           height: getValueOrOverride(limitDimension("StringLinksPopupHeight", MIN_HEIGHT, windowSize.height - 2 * defaultMargin),
                                     linkDef.height)
       };
    }

    function limitDimension(key, min, max) {
       var dim = getValue(key);
       dim = dim ? parseInt(dim) : max;
       if (dim > max) {
           dim = max;
       }
       if (dim < min) {
           dim = min;
       }
       return dim;
    }

    function getValueOrOverride(value, override) {
        if (typeof override !== 'undefined') {
            return override;
        }
        return value;
    }

    function doCloseLink(container) {
        var closeLink = getFirstElementByClassName(container, "stringLinksClose");
        closeLink.addEventListener("mousedown", function() {
            container.parentNode.removeChild(container);
            return false;
        }, false);
    }

    function doAddressBar(container) {
        var addressInput = getFirstElementByClassName(container, "stringLinksAddressBar");
        var newTabLink = getFirstElementByClassName(container, "stringLinksNewTab");
        var iframe = container.getElementsByTagName("iframe")[0];
        function focusSelectAddressInput() { addressInput.focus(); addressInput.select(); };
        addressInput.addEventListener("mousedown", focusSelectAddressInput, false);
        addressInput.addEventListener("keypress", function(ev) { checkIfAddressEntered.call(this, ev, container);}, false);
        iframe.addEventListener("load", function() {
            try {
                getFirstElementByClassName(container, "stringLinksPopupLoading").style.display = "none";
                resizePageContainer(container);
                if (typeof this.contentWindow.location.href !== 'undefined') {
                    addressInput.value = this.contentWindow.location.href;
                    newTabLink.href = addressInput.value;
                }
            } catch(e) {}}, false);
        newTabLink.addEventListener("click", function() {
            document.body.removeChild(container);
            return true;
        }, true);
    }

    function resizePageContainer(container) {
        var header = getFirstElementByClassName(container, "stringLinksHeader");
        var pageContainer = getFirstElementByClassName(container, "pageContainer");
        pageContainer.style.width = container.clientWidth + "px";
        pageContainer.style.height = (container.clientHeight - header.clientHeight) + "px";
    }

    function checkIfAddressEntered(ev, container) {
        if (ev.keyCode == 13) {
            var url = this.value;
            if (! /^[a-z][a-z]*:[/][/]/.test(url)) {
                url = 'http://' + url;
                this.value = url;
            }
            getFirstElementByClassName(container, "stringLinksPopupLoading").style.display = "block";
            getFirstElementByTagName(container, "iframe").src = url;
        }
    }

    function popupMouseDown(ev, popup) {
       activePopup = popup;
       setDisplayOfMovingOverlays("block");
       return false;
    }
    function popupMouseUp(ev, popup) {
        if (activePopup != null) {
           setDisplayOfMovingOverlays("none");
           resizePageContainer(activePopup);
           setPopupSize(activePopup.clientWidth, activePopup.clientHeight);
           activePopup = null;
        }
    }

    function setDisplayOfMovingOverlays(displayValue) {
        var movings = document.getElementsByClassName("stringLinksPopupMoving");
        for (var i = 0; i < movings.length; i++) {
            movings[i].style.display = displayValue;
        }
    }

    resizeIndex = 600;
    function makeResizable(popup, resizeHandle) {
       ByRei_dynDiv.add(popup, resizeIndex++);
       ByRei_dynDiv.add(resizeHandle, resizeIndex++);
       popup.addEventListener("mousedown", function(ev) { return popupMouseDown(ev, popup);}, false);
       popup.addEventListener("mouseup", popupMouseUp, false);
       resizeHandle.addEventListener("mousedown", function(ev) { return popupMouseDown(ev, popup); }, false);
       resizeHandle.addEventListener("mouseup", popupMouseUp, false);
    }

    function openHidden(ev) {
       var div = document.getElementById('stringLinksHiddenOpener');
       if (!div) {
           div = document.createElement('div');
           div.setAttribute("id", "stringLinksHiddenOpener");
           div.style.visibility = 'hidden';
           document.body.appendChild(div);
       }
       div.innerHTML = '<iframe src="' + this.href + '"></iframe>';
       return stopEvent(ev);
    }

    function stopEvent(ev) {
       ev.preventDefault();
       ev.returnValue = false;
       ev.stopPropagation();
       return false;
    }

    function insertLink(entryNum, link, string, insertAfter) {
       var linkContainer = getLinkContainer(entryNum, link, string, true);
       if (linkContainer == null) {
           return null;
       }

       // Add link after text node ... but if text is directly inside a link
       // then insert if after the link node instead (to prevent image link being
       // wrapped in a link itself)
       if (insertAfter.parentNode.tagName == 'A') {
          insertAfter = insertAfter.parentNode;
       }
       insertAfter.parentNode.insertBefore(linkContainer, insertAfter.nextSibling);
       linkContainer.addEventListener("contextmenu", function(ev) {
                   return displayContextMenu(ev, entryNum, string);
               }, false);
       return linkContainer;
    }

    function displayContextMenu(ev, entryNum, string) {
       var doContextMenu = !!ev.ctrlKey === ctrlRightClick;
       if (doContextMenu) {
         stringLinksShowContextMenu(ev, entryNum, string, ev.clientX+window.scrollX, ev.clientY+window.scrollY, 0);
         return stopEvent(ev);
       }
       return true;
    }

    var ContextMenu = {

       "init": function() {
          // Setup div with ul and wiki help link
          this.ul = document.createElement('ul');
          this.ul.setAttribute("class", "stringLinksCMenu");
          this.container = document.createElement('div');
          this.container.setAttribute("class", "stringLinksCMenu");
          var helpDiv = document.createElement('div');
          helpDiv.setAttribute("class", "stringLinksCMenuHelp");
          helpDiv.innerHTML = '<a title="View StringLinks wiki" href="https://w.amazon.com/?StringLinks" target="_blank"><img border="0" width="16" height="16" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACz0lEQVR4nE2S7U9SYRjGz//Q1rc+9qlv1XLLVtk0dbMydZXTaeq0Is2V2mal6Zy6jBcDCTEElIGZ6ZaZKfgChVaimBZwOIfDQeRNhDzEUd4PPUTO7j0fnnu7rmf3fT0/KP63YpFwhPRuf5WYBsrg7nQ9PVXPOAv35Fje3CfgOSoWje8XlFDHYv6NVYR3RUc/Y3x5CRUWYgOl4KCCazAnU/csBRusCPuc/wwURfk31/XMCzA7yywp33z3yDlDdyl7XPMcx3SndaweExXrWWkGTnbIt5UwRIO7Rn4+zMmyDNc4Z1le7VsfPOs3L/qxBUIv9yxJ7VPtZkmFnnkel9HALJBndUzPOHe3TX6oOg7OqZbQis55ojmabBtE7h9qxcnGneN1tm+dGaRVC1mGaxF+nm3iaWrzDlDkskKRXa98lUwaRj9vkxua6h7zpJAJsy86prsgmJeHDdwEE7NeG4Hi8D3K6vKLVQFwAW2VIBB0m7I7vPaP7Qg/H5NUQTA7E5fdci/2oz/Xkq9y5YEiXuTJSAjcjzygZpY9TSIMrGcSFaGCGxAIG5fddi8KSetyLisIRKfbojRx+DtG7m8V+bKgcc51m0TFqKAQQgTXscHyLRUXxCKUe5KiSe1eNPg7pTWx+rHGMKGftk91oH0F+FA1ZB1vAkvbJ9t21sZtJhiMfvRhLEgS0T2ia3wPGOr7HR6NzDrWAKJ3KbkQgagMrDR86I5LxSUMisvPfTUiEvxrmHDAiA0Y5FMqh7wLGywFHATcZigaCeJDNCM3Z2OkFnzw+4lParWWtGhIy5IPUT7mrzsVdFxaZXiRYZtoBVgk0Aj92jT2FgAPiMv2ocU1z3arX7nVfc4ZJiAFk5QBNSosiQbJA/iChMMyWmfoTkd6r2LiElxWaZZWmoRFgEUd4yx4G2RwQGuiKAoQTlpW7AqGWUpDxSXABiBwKXkBNxL/r/4AkFclJQMtWr8AAAAASUVORK5CYII%3D"></a>';
          this.container.appendChild(helpDiv);
          this.container.appendChild(this.ul);

          // Append to doc and hide until 'show' is called
          document.body.appendChild(this.container);
          this.hide();
       },

       "add": function(string, title, url, tooltip, linkContainer, linkEntry) {
          var link, ul, li;
          li = document.createElement('li');
          if (!title) {
             li.appendChild(document.createElement("hr"));
          }
          else if (!url) {
             li.setAttribute("class", "title");
             if (title.match("^<")=="<") {
                li.innerHTML = title;
             }
             else {
                var titleText = document.createTextNode(title);
                li.appendChild(titleText);
             }
          }
          else  {
             url = (linkEntry.open == COPY) ? "javascript:void(0)" : url;
             // Checkbox for enabling/disabling elements
             var checkBox = document.createElement("input");
             checkBox.type = "checkbox";
             checkBox.checked = linkEntry.enabled;
             checkBox.addEventListener("click", function(ev) {
                ev.stopPropagation();
                ContextMenu.preventHide = true;
                linkEntry.enabled = this.checked;
                storeSettings();
             }, true);

             var div = document.createElement('div');
             var linkText = document.createTextNode(title);
             var spacer = document.createElement("span"); spacer.innerHTML = "&nbsp;&nbsp;&nbsp;";
             var link2 = document.createElement('a');

             link = document.createElement('a');
             link.setAttribute("class", "sel");
             link.href = url;
             link.title = tooltip;
             link.target = "_blank";
             link2.setAttribute("class", "box");
             link2.href = url;
             link2.title = tooltip;
             link2.target = "_blank";
             link2.appendChild(linkContainer);
             link.appendChild(linkText);
             if (linkEntry.open == COPY) {
                 function linkCopyValue(ev) {
                    stopEvent(ev);
                    copyValueToClipboard(string);
                    ContextMenu.hide();
                 }
                 link.addEventListener("click", linkCopyValue, true);
                 link2.addEventListener("click", linkCopyValue, true);
             }

             div.appendChild(checkBox);
             div.appendChild(link);
             div.appendChild(link2);
             li.appendChild(div);
          }
          this.ul.appendChild(li);
       },

       "clear": function() {
          this.ul.innerHTML = "";
       },

       "show": function(x, y) {
          this.container.style.visibility = "hidden"
          this.container.style.display = "";
          this.container.style.left = x + "px";
          this.container.style.top = y + "px";
          this.container.style.visibility = "visible";
       },

       "hide": function() {
          if (this.preventHide) {
             this.preventHide = false;
             return;
          }
          this.container.style.visibility = "hidden";
          this.container.style.display = "none";
          this.container.style.left = 0;
          this.container.style.top = 0;
       }
    };

    function setIncognitoMode(val) {
        setValue(INCOGNITO_MODE, val);
    }

    function setRightClickMode(val) {
        setValue(RIGHT_CLICK_MODE, val);
        evaluateRightClickMode();
    }

    function evaluateRightClickMode() {
       var rightClickMode = getValue(RIGHT_CLICK_MODE, "");
       ctrlRightClick = (rightClickMode === "ctrl");
    }

    function openDefaultPopup(e) {
       openPopup.call({href: "about:blank", title: ""}, e);
    }
    window.stringLinksHideContextMenu = function(e) {
        var rightClick = (e.which == 3) || (e.button == 2)
        if (!rightClick) {
            window.setTimeout(function() { ContextMenu.hide(); }, 60);
        }
        if (e.ctrlKey && e.shiftKey) {
           return openDefaultPopup(e);
        }
    }
    window.stringLinksReallyHideContextMenu = function(e){
        ContextMenu.hide();
        return true;
    }

    window.stringLinksShowContextMenu = function(e, entryNum, string, x, y, isSame) {
       var entry = SUBSTITUTIONS.entries[entryNum];
       var links = getLinksForEntry(entry, string);

       var categories = [];
       ContextMenu.clear();
       ContextMenu.add(string, "<center>" + string + "</center>");
       for (var i = 0; i < links.length; i++) {
          var link = links[i];
          if (! categories[link.category]) {
             categories[link.category] = 1;
             ContextMenu.add();
          }
          var url = getLinkUrlForString(link, string);
          if (url != null) {
              var linkContainer = getLinkContainer(entryNum, link, string, false);
              ContextMenu.add(string, link.title, getLinkUrlForString(link, getStringInLink(link, string)), link.title + ": " + string, linkContainer, link);
          }
       }
       ContextMenu.add();
       ContextMenu.add(string, "<center>Use Ctrl-Right-Click to see original menu</center>");
       ContextMenu.show(x, y);
    }

    function storeSettings() {
       // Retrieve enabled substitutions. They are stored in a SQLite database local to GreaseMonkey for this script.
       // They are a comma-separated list of link ids stored under the value "< entry.id>Links"
       for (var r = 0; r < SUBSTITUTIONS.entries.length; r++) {
          var entry = SUBSTITUTIONS.entries[r];
          if (!entry.id)
             continue;

          var configId = entry.id + "Links";
          var linkIdsForThisEntry = [];

          for (var linkNum = entry.links.length - 1; linkNum >= 0; linkNum--) {
             var link = entry.links[linkNum];
             if (link.enabled) {
                linkIdsForThisEntry.push(link.id);
             }
          }
          setValue(configId, linkIdsForThisEntry.length ? linkIdsForThisEntry.join(",") : "none");
       }
    }

    function getWindowSize() {
        var myWidth = 0, myHeight = 0;
        if (typeof( window.innerWidth ) == 'number' ) {
            //Non-IE
            myWidth = window.innerWidth;
            myHeight = window.innerHeight;
        } else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {
            //IE 6+ in 'standards compliant mode'
            myWidth = document.documentElement.clientWidth;
            myHeight = document.documentElement.clientHeight;
        } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
            //IE 4 compatible
            myWidth = document.body.clientWidth;
            myHeight = document.body.clientHeight;
        }
        return { width: myWidth, height: myHeight};
    }

    function getWindowOffset() {
      return {
          x: filterAreaResults(window.pageXOffset ? window.pageXOffset : 0,
                  document.documentElement ? document.documentElement.scrollLeft : 0,
                  document.body ? document.body.scrollLeft : 0),
          y: filterAreaResults(window.pageYOffset ? window.pageYOffset : 0,
                  document.documentElement ? document.documentElement.scrollTop : 0,
                  document.body ? document.body.scrollTop : 0)
      }
    };

    /*
    * Utility function for getting the correct number in the DOM for x and y positions.
    * It is given numbers that come from the window, document and documeny body and
    * the algorithm figures out the correct one to use.
    */
    function filterAreaResults(n_win, n_docel, n_body) {
        var n_result = n_win ? n_win : 0;
        if (n_docel && (!n_result || (n_result > n_docel))) {
            n_result = n_docel;
        }
        return n_body && (!n_result || (n_result > n_body)) ? n_body : n_result;
    }

    function isInIFrame() {
        return (window.location != window.parent.location) ? true : false;
    }

    // Initialize and decorate strings
    initialize();

    }
    function setGM(isGM) {
        var NAMESPACE = "StringLinks";
        log = function(msg) { try { window.console.log(msg); } catch(e) {} };
        if (window.opera) log = opera.postError;
        setValue = isGM ? StringLinksGM.setValue : function (name, value) { return localStorage.setItem(NAMESPACE + "." + name, value) };
        getValue = isGM ? StringLinksGM.getValue : function(name, def) { var s = localStorage.getItem(NAMESPACE + "." + name); return s == null ? def : s };
        addStyle = isGM ? StringLinksGM.addStyle : function(styles) {
            var heads = document.getElementsByTagName("head");
            if (heads.length > 0) {
                var node = document.createElement("style");
                node.type = "text/css";
                node.appendChild(document.createTextNode(styles));
                heads[0].appendChild(node);
            }
        };
        copyValueToClipboard = isGM ? StringLinksGM.copyValueToClipboard : function(value) {
            alert("Copy not supported by Chrome without TamperMonkey extension");
            return false
        };

    }
    function getFirstElementByTagName(container, className) {
        return getFirstElementByFunc(container.getElementsByTagName, container, className);
    }
    function getFirstElementByClassName(container, className) {
        return getFirstElementByFunc(container.getElementsByClassName, container, className);
    }
    function getFirstElementByFunc(func, container, item) {
        var elems = func.call(container, item);
        if (elems && elems.length > 0) {
            return elems[0];
        }
        return undefined;
    }

    setGM(isGM);

/*
 * ByRei dynDiv 1.0 RC1 - dynamic Div Script
 *
 * Copyright (c) 2008 Markus Bordihn (markusbordihn.de)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * $Date: 2013/02/21 $
 * $Rev: 1.0 RC1 $
 */

/*global window*/
/*jslint bitwise: true, browser: true, eqeqeq: true, immed: true, newcap: true, regexp: true, undef: true */

var ByRei_dynDiv = {

 info: {
  Name: "ByRei dynDiv",
  Version:  "1.0 RC1",
  Author: "Markus Bordihn (http://markusbordihn.de)",
  Description: "Simple dynamic DIV's"
 },

 api: {
  drag: null,
  drop: null,
  elem: null,
  alter: null,
  obj: null
 },

 dropArea: [],

 config: {
  prefix: "dynDiv_",
  cookie: {
   expire: "2678400" // 31 * 24 * 60 * 60 = 31 days
  },
  regExp: {
   px: /(\d+)px/,
   minmax: /dynDiv_minmaxDiv|dynDiv_moveParentDiv/
  }
 },

 cache: {
  obj: null,
  elem: null,
  modus: null,
  zIndex: null,
  width: null,
  height: null,
  pos: {
   left: null,
   top: null
  },
  init: {
   width: null,
   height: null,
   pos: {
    left: null,
    top: null
   },
   offset: null
  },
  last: {
   obj: null,
   elem: null,
   mouse: {
    left: null,
    top: null
   }
  },
  browser: {
   support: {
    page: false,
    client: false
   }
  },
  unloadHandler: null,
  ie: (window.detachEvent) ? true : false
 },

 limit: {
  min: {
   left: null,
   top: null,
   width: null,
   height: null
  },
  max: {
   left: null,
   top: null,
   width: null,
   height: null
  }
 },

 divList: [],

/*
  divList Struction
  ================================================================================
  0.  Object:[Object]        - Movable Object
  1.  Limiter:[Object]       - Object to which the dynDIV is limited
  2.  Status:[Boolean]       - Active or Inactive
  3.  zIndex:[Number]        - Init. zIndex for the dynDIV
  4.  left:[Number]          - Init. Position left
  5.  top:[Number]           - Init. Position top
  6.  dropLimit:[Text]       - Contain the dropArea which the dynDIV is limited
  7.  dropMode:[Text]        - Set up the dropMode for the dropArea (default,center,fit)
  8.  dropLog:[Boolean]      - Is true when the dynDIV was dropped into the dropArea
  9.  hideAction:[Text]      - Hide other DIVs for move or resize
  10. showResize:[Text]      - Show resize DIVs only on active or double click
  11. keepAspect:[Number]    - Keep the Aspect Ration of the DIV
  12. saveSettings:[Text]    - Save the Position and/or the Dimension of the Element in a Cookie
  13. width:[Number]         - Init Width in px
  14. height:[Number]        - Init Height in px
  ================================================================================
*/

 /*
  This include all get Methodes
 */
 get: {
  /* Warper for prefix request */
  prefix : {
   value: function (obj,value,ncs) {
    return ByRei_dynDiv.get.value(obj, ByRei_dynDiv.config.prefix + value, ncs);
   }
  },

  /* Check an Array for certain values and return the result */
  value: function (obj,value,ncs) {
   var
    i,
    result='',
    il = obj.length;
   if (obj && value) {
       for (i=0;i<il;i++) {
            if (ncs && obj[i].indexOf(value) >= 0) {
                result=obj[i].split(value)[1];
                break;
            } else if (obj[i] === value) {
                result=obj[i];
                break;
            }
       }
   }
   return result;
  },
  /* Set the standart variables for the selected Object */
  pos:  function(obj) {
   if (obj) {
    ByRei_dynDiv.cache.init = {
     width  : obj.clientWidth,
     height : obj.clientHeight,
     pos : {
      left : ByRei_dynDiv.cache.pos.left,
      top  : ByRei_dynDiv.cache.pos.top
     },
     offset : ByRei_dynDiv.get.offset.absolute(obj)
    };
    ByRei_dynDiv.db(2,true);
    ByRei_dynDiv.db(4,ByRei_dynDiv.get.offset.relative(obj).left);
    ByRei_dynDiv.db(5,ByRei_dynDiv.get.offset.relative(obj).top);
   }
  },
  px: function(obj) {
   var result = "";
   if (obj) {
       if (obj.match(ByRei_dynDiv.config.regExp.px)) {
           if (typeof obj.match(ByRei_dynDiv.config.regExp.px)[1] !== 'undefined') {
               result = obj.match(ByRei_dynDiv.config.regExp.px)[1];
           }
       }
   }
   return result;
  },
  /* Try to find the current mouse Position */
  mouse: function(evt) {
   if (evt) {
      if (!ByRei_dynDiv.cache.browser.support.page && !ByRei_dynDiv.cache.browser.support.client) {
          ByRei_dynDiv.cache.browser.support.page = (evt.pageX || evt.pageY) ? true : false;
          ByRei_dynDiv.cache.browser.support.client = (evt.clientX || evt.clientY) ? true : false;
      }
      if (ByRei_dynDiv.cache.browser.support.page) {
          ByRei_dynDiv.cache.pos.left = evt.pageX;
          ByRei_dynDiv.cache.pos.top = evt.pageY;
      } else if (ByRei_dynDiv.cache.browser.support.client) {
          ByRei_dynDiv.cache.pos.left = evt.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
          ByRei_dynDiv.cache.pos.top = evt.clientY + document.body.scrollTop + document.documentElement.scrollTop;
      }
   }
  },
  /* Offset Calcucation */
  offset: {
   /* Calculate the absolute offset for a object */
   absolute: function(obj) {
    var
     left = 0, top = 0;
    if (obj) {
        left = ByRei_dynDiv.get.offset.relative(obj).left;
        top = ByRei_dynDiv.get.offset.relative(obj).top;
        while (obj.offsetParent) {
               left += ByRei_dynDiv.get.offset.relative(obj.offsetParent).left;
               top += ByRei_dynDiv.get.offset.relative(obj.offsetParent).top;
               obj = obj.offsetParent;
        }
    }
    return {left: left, top: top};
   },
   /* Calculate the relative offset for a object (with browser bug checking) */
   relative: function(obj) {
    var result = false;
    if (obj) {
        var
         borderLeft = 0,
         borderTop = 0,
         marginLeft = ByRei_dynDiv.get.px(ByRei_dynDiv._style(obj,'marginLeft')),
         marginTop = ByRei_dynDiv.get.px(ByRei_dynDiv._style(obj,'marginTop')),
         left = ByRei_dynDiv.get.px(ByRei_dynDiv._style(obj,'left')),
         top = ByRei_dynDiv.get.px(ByRei_dynDiv._style(obj,'top')),
         offsetLeft = obj.offsetLeft,
         offsetTop = obj.offsetTop;

        if (left !== "" && top !== "" && (offsetLeft > left + marginLeft || offsetTop > top + marginTop)) {
            borderLeft = ByRei_dynDiv.get.px(ByRei_dynDiv._style(obj.parentNode,'borderLeft'));
            borderTop = ByRei_dynDiv.get.px(ByRei_dynDiv._style(obj.parentNode,'borderTop'));
        }

        result = {
         left: (borderLeft > 0) ? offsetLeft - borderLeft : offsetLeft,
         top: (borderTop > 0) ? offsetTop - borderTop : offsetTop
        };
    }
    return result;
   }
  },
  /* Try to found the real parent of an object with the help of RegExp */
  parent: function(obj,value,mode) {
   if (obj) {
       for (var i=0;i<5;i++) {
            if (value.test(obj.className)) {
                if (mode) {
                    obj = obj.parentNode;
                } else {
                    break;
                }
            } else {
                if (mode) {
                    break;
                } else {
                    obj = obj.parentNode;
                }
            }
       }
       return obj;
   }
  },
  /* Search for things in the db */
  db: {
   id: function(obj) {
    var
     i,
     result = {
      found : false, data  : ""
     },
     il = ByRei_dynDiv.divList.length;

    if (obj) {
        for (i=0;i<il;i++) {
             if (obj === 'zIndex') {
                 if (ByRei_dynDiv.divList[i][3] !== 'auto') {
                     if (ByRei_dynDiv.divList[i][3] > result.data) {
                         result.found = true;
                         result.data = ByRei_dynDiv.divList[i][3];
                      }
                 }
             }
             else if (ByRei_dynDiv.divList[i][0] === obj) {
                      result.found = true;
                      result.data = i;
                      break;
             }
        }
    }
    return result;
   }

  },
  /* Check Hit from between two Objects */
  hit: function(elem1, elem2, modus) {
   var result=false;
   if (elem1 && elem2) {
    var
     obj1 = {
      offset : ByRei_dynDiv.get.offset.absolute(elem1),
      width  : elem1.clientWidth,
      height : elem1.clientHeight
     },
     obj2 = {
      offset : ByRei_dynDiv.get.offset.absolute(elem2),
      width  : elem2.clientWidth,
      height : elem2.clientHeight
     },
     cache = {
      o1t_o1h : obj1.offset.top + obj1.height,
      o2t_o2h : obj2.offset.top + obj2.height,
      o1l_o1w : obj1.offset.left + obj1.width,
      o2l_o2w : obj2.offset.left + obj2.width
     };

    // Check Hit
    switch (modus) {
     case "fit": case "center":
      if (((obj1.offset.left > obj2.offset.left && obj1.offset.left < cache.o2l_o2w) && ((obj1.offset.top > obj2.offset.top && obj1.offset.top < cache.o2t_o2h) || (cache.o1t_o1h > obj2.offset.top && cache.o1t_o1h < cache.o2t_o2h))) || ((cache.o1l_o1w > obj2.offset.left && cache.o1l_o1w < cache.o2l_o2w) && ((obj1.offset.top > obj2.offset.top && obj1.offset.top < cache.o2t_o2h) || (cache.o1t_o1h > obj2.offset.top && cache.o1t_o1h < cache.o2t_o2h)))) {
          result=true;
      }
     break;
     default:
      if ((obj1.offset.left > obj2.offset.left && obj1.offset.left < cache.o2l_o2w && cache.o1l_o1w < cache.o2l_o2w) && (obj1.offset.top > obj2.offset.top && obj1.offset.top < cache.o2t_o2h && cache.o1t_o1h < cache.o2t_o2h)) {
          result=true;
      }
     break;
    }
   }
   return result;
  }

 },

 /*
  This include all on(action) Methodes
 */
 on: {
  /* Mouse Move Events */
  move: function(evt) {
   if(ByRei_dynDiv.cache.obj) {
      ByRei_dynDiv.get.mouse(evt); // Get Mouse Position
      if (ByRei_dynDiv.get.db.id('zIndex').found) {
          ByRei_dynDiv._style(ByRei_dynDiv.cache.obj,'zIndex', ByRei_dynDiv.get.db.id('zIndex').data + 1);
      }
      if (ByRei_dynDiv.cache.modus) {
          if (ByRei_dynDiv.api.alter) {ByRei_dynDiv.api.alter();} // API move Event
          switch (ByRei_dynDiv.cache.modus) {
            case "br": case "tr": case "tl": case "bl": ByRei_dynDiv.resize(); break;
            case "move":  case "moveparent" : ByRei_dynDiv.move(); break;
            default: break;
          }
      }
      if (ByRei_dynDiv.cache.ie) {evt.returnValue = false;}
   }
  },
  /* Set Event Handler only when an Object is active */
  action: function() {
   if (!ByRei_dynDiv.cache.obj) {
       ByRei_dynDiv.set_eventListener(document, 'mousemove' , ByRei_dynDiv.on.move); // Add Event for MouseMove (scale, move, hide, show)
       ByRei_dynDiv.set_eventListener(document, 'mouseup', ByRei_dynDiv.on.stop); // Stop all Events on MouseUP
   }
  },
  /* Events when noAction will performance (mouse_down)*/
  stop: function() {
   if (ByRei_dynDiv.db(0)) { // DB Functions
       if (ByRei_dynDiv.db(6)) { // Drop Area Support
           var
            i,
            dropArea = {
            obj: false
           },
           il = ByRei_dynDiv.dropArea.length;

           for (i=0;i<il;i++) {
                if (ByRei_dynDiv.dropArea[i][1] === ByRei_dynDiv.db(6)) {
                    if (ByRei_dynDiv.get.hit(ByRei_dynDiv.cache.obj, ByRei_dynDiv.dropArea[i][0], ByRei_dynDiv.db(7))) {
                        dropArea.obj = ByRei_dynDiv.dropArea[i][0];
                    }
                }
           }

           if (!dropArea.obj) {
               ByRei_dynDiv.set.left(ByRei_dynDiv.cache.obj,ByRei_dynDiv.db(4));
               ByRei_dynDiv.set.top(ByRei_dynDiv.cache.obj,ByRei_dynDiv.db(5));
           } else {
               dropArea.offset = ByRei_dynDiv.get.offset.absolute(dropArea.obj);
               switch (ByRei_dynDiv.db(7)) {
                 case "fit" :
                  ByRei_dynDiv.set.left(ByRei_dynDiv.cache.obj, ByRei_dynDiv.db(4) + (dropArea.offset.left - ByRei_dynDiv.cache.init.offset.left));
                  ByRei_dynDiv.set.top(ByRei_dynDiv.cache.obj,  ByRei_dynDiv.db(5) + (dropArea.offset.top - ByRei_dynDiv.cache.init.offset.top));
                 break;
                 case "center" :
                  ByRei_dynDiv.set.left(ByRei_dynDiv.cache.obj, ByRei_dynDiv.db(4) + (dropArea.offset.left - ByRei_dynDiv.cache.init.offset.left) + ((dropArea.obj.clientWidth/2) - (ByRei_dynDiv.cache.obj.clientWidth/2)));
                  ByRei_dynDiv.set.top(ByRei_dynDiv.cache.obj,  ByRei_dynDiv.db(5) + (dropArea.offset.top - ByRei_dynDiv.cache.init.offset.top) + ((dropArea.obj.clientHeight/2) - (ByRei_dynDiv.cache.obj.clientHeight/2)));
                 break;
               }
               ByRei_dynDiv.db(8, true);
           }
       }
   }

   // Normal Event Handling
   ByRei_dynDiv.db(2,false); // Active to Inactive
   ByRei_dynDiv.del_eventListener(document, 'mousemove' , ByRei_dynDiv.on.move); // Remove Event Listener Mouse Move
   ByRei_dynDiv.del_eventListener(document, 'mouseup', ByRei_dynDiv.on.stop);     // Remove Event Listener Mouse Up
   ByRei_dynDiv._style(ByRei_dynDiv.cache.obj,'zIndex', ByRei_dynDiv.cache.zIndex); // Reset zIndex to initial value
   if (ByRei_dynDiv.cache.last.obj !== ByRei_dynDiv.cache.obj) {ByRei_dynDiv.cache.last.obj = ByRei_dynDiv.cache.obj;} // Set Cache last Object
   if (ByRei_dynDiv.cache.last.elem !== ByRei_dynDiv.cache.elem) {ByRei_dynDiv.cache.last.elem = ByRei_dynDiv.cache.elem;} // Set Cache last Element
   if (ByRei_dynDiv.db(9)) {ByRei_dynDiv.set.visible(true);} // Show hiden dynDIVs
   if (ByRei_dynDiv.db(10) === 'focus') {ByRei_dynDiv.set_eventListener(document,'mousedown', ByRei_dynDiv.on.focus);} // Hide Resize on click on other Elements

   // Save Position and Size in DB
   ByRei_dynDiv.db(4,ByRei_dynDiv.get.offset.relative(ByRei_dynDiv.cache.obj).left);
   ByRei_dynDiv.db(5,ByRei_dynDiv.get.offset.relative(ByRei_dynDiv.cache.obj).top);
   ByRei_dynDiv.db(13,ByRei_dynDiv.cache.obj.clientWidth);
   ByRei_dynDiv.db(14,ByRei_dynDiv.cache.obj.clientHeight);

   if (ByRei_dynDiv.api.drop) {ByRei_dynDiv.api.drop();} // API drop Event

   // Reset to default Values
   ByRei_dynDiv.limit.min.left = ByRei_dynDiv.limit.min.top = ByRei_dynDiv.limit.min.width = ByRei_dynDiv.limit.min.height =
   ByRei_dynDiv.limit.min.left = ByRei_dynDiv.limit.min.top = ByRei_dynDiv.limit.min.width = ByRei_dynDiv.limit.min.height =
   ByRei_dynDiv.cache.obj = ByRei_dynDiv.cache.modus = ByRei_dynDiv.cache.zIndex = ByRei_dynDiv.cache.elem = false;
  },
  /* Focus Handler for the webpage */
  focus: function() {
   if (typeof ByRei_dynDiv.divList[ByRei_dynDiv.cache.last.elem] !== 'undefined') {
       if (ByRei_dynDiv.divList[ByRei_dynDiv.cache.last.elem][10] === 'focus') {
           ByRei_dynDiv.on.resize(ByRei_dynDiv.cache.last.obj,false);
       }
       ByRei_dynDiv.del_eventListener(document, 'mousedown', ByRei_dynDiv.on.focus); // Remove Event
   }
  },
  /* Unload Handler for the webpage */
  unload: function() {
   if (ByRei_dynDiv.divList) {
       ByRei_dynDiv.settings.save(); // Save Position and Height of all marked DIVs
   }
  },
  /* Init min max Div function */
  minmax: function(evt) {
   if (evt) {
       var
        evt_src = (evt.target) ? evt.target : evt.srcElement,
        minmax_src = ByRei_dynDiv.get.parent(evt_src,ByRei_dynDiv.config.regExp.minmax,0),
        minmaxHeight = (ByRei_dynDiv.get.prefix.value(minmax_src.className.split(' '),"minmax_Height-",1)||20);
       evt_src = ByRei_dynDiv.get.parent(evt_src,ByRei_dynDiv.config.regExp.minmax,1);
       ByRei_dynDiv._style(evt_src,'clip', (new RegExp (minmaxHeight + "\\w+,?\\s?auto","i").test(ByRei_dynDiv._style(evt_src,'clip'))) ?  'rect(auto auto auto auto)' : 'rect(auto auto ' +  (minmaxHeight) +'px auto)');
   }
  },
  /* Resize Handler */
  resize: function(evt,value) {
   var
    i,
    evt_src = (evt.target || evt.srcElement) ? (evt.target ? evt.target : evt.srcElement) : (evt),
    classNames = evt_src.className.split(' '),
    resize_list = (ByRei_dynDiv.get.prefix.value(classNames,"moveParentDiv") && evt_src.parentNode) ? evt_src.parentNode.getElementsByTagName('div')  : evt_src.getElementsByTagName('div'),
    il = resize_list.length;

    for (i=0;i<il;i++) {
         if (ByRei_dynDiv.get.prefix.value(resize_list[i].className.split(' '),"resizeDiv_",1)) {
             ByRei_dynDiv._style(resize_list[i],'visibility', (value) ? 'visible' : 'hidden');
        }
    }
  }
 },

 /*
  This include all init functions
 */
 init: {
  /* Init Events for all div with dynDiv_ as className */
  main: function() {
   var
    i = 0,
    div_list = document.getElementsByTagName('div'),
    il = div_list.length;
   for (var obj=0;obj<il;obj++) {
        if (ByRei_dynDiv.get.prefix.value(div_list[obj].className.split(' '),"",1)) {
            if (ByRei_dynDiv.get.prefix.value(div_list[obj].className.split(' '),"resizeDiv_",1) && ByRei_dynDiv.get.prefix.value(div_list[obj].parentNode.className.split(' '),"move",1) === '') {
                ByRei_dynDiv.add(div_list[obj].parentNode,i++,1);
            }
            ByRei_dynDiv.add(div_list[obj],i++);
        }
   }
  },
  /* Init Action on MouseMove */
  action: function(evt, m_modus) {
  if (evt) {
      if (evt.preventDefault) {evt.preventDefault();}
      if (ByRei_dynDiv.cache.ie) {evt.cancelBubble=true;}
      if (evt.stopPropagation) {evt.stopPropagation();}
      var evt_src = evt.target ? evt.target : evt.srcElement;

      // Avoid Issues with minmax
      if (evt_src.className.indexOf('dynDiv_minmaxDiv') === -1) {
          ByRei_dynDiv.get.mouse(evt);
          ByRei_dynDiv.on.action();
          switch (m_modus) {
           case "move":
            ByRei_dynDiv.cache.obj = ByRei_dynDiv.api.obj = ByRei_dynDiv.get.parent(evt_src,/dynDiv_moveDiv/);
           break;
           case "moveparent":
            ByRei_dynDiv.cache.obj = ByRei_dynDiv.api.obj = ByRei_dynDiv.get.parent(evt_src,/dynDiv_moveParentDiv/).parentNode;
           break;
           case "tl" : case "tr" : case "bl" : case "br" :
            ByRei_dynDiv.cache.obj = ByRei_dynDiv.api.obj = evt_src.parentNode;
           break;
           default:
            ByRei_dynDiv.cache.obj = ByRei_dynDiv.api.obj = evt_src;
           break;
          }

          ByRei_dynDiv.cache.elem = ByRei_dynDiv.api.elem = ByRei_dynDiv.get.db.id(ByRei_dynDiv.cache.obj).data; // Cache Element
          ByRei_dynDiv.cache.zIndex = ByRei_dynDiv._style(ByRei_dynDiv.cache.obj,'zIndex'); // Cache zIndex
          ByRei_dynDiv.get.pos(ByRei_dynDiv.cache.obj); // Get Position of Element
          ByRei_dynDiv.cache.modus = m_modus; // Cache Modus

             if (ByRei_dynDiv.db(1) && ByRei_dynDiv.cache.obj) {
                 var
               obj = {offset :  ByRei_dynDiv.get.offset.absolute(ByRei_dynDiv.cache.obj)}, limit = {offset : ByRei_dynDiv.get.offset.absolute(ByRei_dynDiv.db(1))};

               ByRei_dynDiv.limit.min.left = limit.offset.left - obj.offset.left;
                 ByRei_dynDiv.limit.max.left = (ByRei_dynDiv.db(1).clientWidth + limit.offset.left) - (ByRei_dynDiv.cache.obj.offsetWidth + obj.offset.left);
                 ByRei_dynDiv.limit.min.top = limit.offset.top - obj.offset.top;
                 ByRei_dynDiv.limit.max.top = (ByRei_dynDiv.db(1).clientHeight + limit.offset.top) - (ByRei_dynDiv.cache.obj.offsetHeight + obj.offset.top);
             }
          if (ByRei_dynDiv.api.drag) {ByRei_dynDiv.api.drag();} // API drag Event

          switch(m_modus){
           case "move" : case "moveparent" :
            if (ByRei_dynDiv.db(9) === 'move' || ByRei_dynDiv.db(9) === 'move_resize') {ByRei_dynDiv.set.visible(false);}
           break;
           case "tl" : case "tr" : case "bl" : case "br" :
            if (ByRei_dynDiv.db(9) === 'resize' || ByRei_dynDiv.db(9) === 'move_resize') {ByRei_dynDiv.set.visible(false);}
           break;
          }

          if (ByRei_dynDiv.cache.elem !== ByRei_dynDiv.cache.last.elem && (ByRei_dynDiv.cache.last.elem || ByRei_dynDiv.cache.last.elem === 0)) {
              if (ByRei_dynDiv.divList[ByRei_dynDiv.cache.last.elem][10]) {
                  ByRei_dynDiv.on.resize(ByRei_dynDiv.cache.last.obj,false);
              }
          }
          if (ByRei_dynDiv.db(10) === 'active' || ByRei_dynDiv.db(10) === 'focus') {
              ByRei_dynDiv.on.resize(ByRei_dynDiv.cache.obj,true);
          }
      }
   }
  }
 },

 /*
  This include the Settings possibilitys
 */
 settings: {
  /* Save Settings */
  save: function() {
   if (ByRei_dynDiv.divList) {
       var
       i,
       il = ByRei_dynDiv.divList.length;
       for (i=0;i<il;i++) {
            if (ByRei_dynDiv.divList[i][12] !== false && ByRei_dynDiv.divList[i][0].id) {
                var
                 left='',
                 top='',
                 width='',
                 height='';

                switch(ByRei_dynDiv.divList[i][12]) {
                 case "position":
                  left = ByRei_dynDiv.divList[i][4];
                  top = ByRei_dynDiv.divList[i][5];
                 break;
                 case "size":
                  width = ByRei_dynDiv.divList[i][13];
                  height = ByRei_dynDiv.divList[i][14];
                 break;
                 case "position_size" :
                  left = ByRei_dynDiv.divList[i][4];
                  top = ByRei_dynDiv.divList[i][5];
                  width = ByRei_dynDiv.divList[i][13];
                  height = ByRei_dynDiv.divList[i][14];
                 break;
                }

                if ((Number(left) !== 'NaN' && Number(top) !== 'NaN') || (width > 0 && height > 0)) {
                    if (navigator.cookieEnabled) {
                        var expireTime = new Date();
                        expireTime.setSeconds((new Date()).setTime(expireTime.getSeconds()) + Number(ByRei_dynDiv.config.cookie.expire));
                        document.cookie = "ByRei_dynDiv_" + ByRei_dynDiv.divList[i][0].id + "=" + left + '_' + top + '_' + width + '_' + height +  "; expires=" + expireTime.toGMTString();
                    }
                }
            }
       }
   }
  },
  /* Load Settings */
  load: function(id) {
   var result = false;
   if (navigator.cookieEnabled && id) {
       var savedata = document.cookie;
       if (/; /.test(savedata)) {savedata = savedata.split("; ");}
       else if (/, /.test(savedata)) {savedata = savedata.split(", ");}
       if (savedata) {
           var i, il = savedata.length;
           for (i=0;i<il;i++) {
                if (savedata[i]) {
                    if ((/ByRei_dynDiv/).test(savedata[i])) {
                        var data = (/ByRei_dynDiv_(\w+)=(\d*)\_(\d*)\_(\d*)\_(\d*)/).exec(savedata[i]);
                        if (typeof data !== 'undefined' && data !== null) {
                            if (typeof data[1] !== 'undefined') {
                                if (data[1] === id) {
                                    result = {left: data[2], top: data[3], width: data[4], height: data[5]};
                                    break;
                                }
                            }
                        }
                    }
                }
           }
       }
   }
   return result;
  }
 },

 /*
  All set Functions
 */
 set: {
  /* Set visible / invisible */
  visible: function(value) {
   var
    i,
    il = ByRei_dynDiv.divList.length;
   for (i=0;i<il;i++) {
        if (ByRei_dynDiv.divList[i] !== ByRei_dynDiv.divList[ByRei_dynDiv.cache.elem]) {
            ByRei_dynDiv._style(ByRei_dynDiv.divList[i][0],'visibility',(value) ? 'visible' : 'hidden');
        }
   }
  },
  /* Simple Warper to avoid to include "px" on every value */
  /* More warper for left, top, width, height */
  left: function(obj,value) {
   ByRei_dynDiv._style(obj,'left',value + "px");
  },
  top: function(obj,value) {
   ByRei_dynDiv._style(obj,'top',value + "px");
  },
  width: function(obj,value) {
   ByRei_dynDiv._style(obj,'width',value + "px");
  },
  height: function(obj,value) {
   ByRei_dynDiv._style(obj,'height',value + "px");
  }
 },

 /*
  Resize DIV
 */
 resize: function() {
  if (ByRei_dynDiv.cache.obj && ByRei_dynDiv.cache.modus) {
      var
       default_padding = 20,
       new_size_x = 0,
       new_size_y = 0,
       new_left = ByRei_dynDiv.db(4),
       new_top = ByRei_dynDiv.db(5),
       keepAspect = ByRei_dynDiv.db(11),
       reachLimit = false,
       mouse_diff_left = (ByRei_dynDiv.cache.pos.left - ByRei_dynDiv.cache.init.pos.left || 0),
       mouse_diff_top = (ByRei_dynDiv.cache.pos.top - ByRei_dynDiv.cache.init.pos.top || 0);

      // Try to keep Aspect Ratio
      /* Maus so abfragen das Mouse nicht grers als Offset von Object sein kann ! */
      if (keepAspect) {
          switch(ByRei_dynDiv.cache.modus) {
           case "br" : case "tl" :
            mouse_diff_left = mouse_diff_top * keepAspect;
           break;
           case "bl" : case "tr" :
            mouse_diff_left = mouse_diff_top * keepAspect * -1;
           break;
          }
          if (ByRei_dynDiv.cache.last.mouse.left === ByRei_dynDiv.cache.pos.left || ByRei_dynDiv.cache.last.mouse.top === ByRei_dynDiv.cache.pos.top) {
              reachLimit = true;
          }
          ByRei_dynDiv.cache.last.mouse.left = ByRei_dynDiv.cache.pos.left;
          ByRei_dynDiv.cache.last.mouse.top = ByRei_dynDiv.cache.pos.top;
      }

      // Scaling DIV depend on the Modus
      switch(ByRei_dynDiv.cache.modus) {
       case "br": case "tr": new_size_x = ByRei_dynDiv.cache.init.width + mouse_diff_left; break;
       case "tl": case "bl": new_size_x = ByRei_dynDiv.cache.init.width - mouse_diff_left; break;
      }

      switch(ByRei_dynDiv.cache.modus) {
       case "br": case "bl": new_size_y = ByRei_dynDiv.cache.init.height + mouse_diff_top; break;
       case "tr": case "tl": new_size_y = ByRei_dynDiv.cache.init.height - mouse_diff_top; break;
      }

      switch(ByRei_dynDiv.cache.modus) {
       case "tl": new_top  = ByRei_dynDiv.db(5) + mouse_diff_top; new_left = ByRei_dynDiv.db(4) + mouse_diff_left; break;
       case "tr": new_top  = ByRei_dynDiv.db(5) + mouse_diff_top; break;
       case "bl": new_left = ByRei_dynDiv.db(4) + mouse_diff_left; break;
      }

      /* Check if Limit is reached (normal, keep aspect) */
      if (ByRei_dynDiv.db(1)) {
          var
           pos_left = ByRei_dynDiv.cache.pos.left - ByRei_dynDiv.cache.init.pos.left,
           pos_top = ByRei_dynDiv.cache.pos.top - ByRei_dynDiv.cache.init.pos.top;

          switch(ByRei_dynDiv.cache.modus) {
           case "tl": case "bl":
            if (pos_left < ByRei_dynDiv.limit.min.left) {
                if (!keepAspect) {
                    new_size_x = ByRei_dynDiv.cache.init.width - ByRei_dynDiv.limit.min.left;
                    new_left = ByRei_dynDiv.db(4) + ByRei_dynDiv.limit.min.left;
                }
                reachLimit = true;
            }
           break;
           case "tr": case "br":
            if (pos_left > ByRei_dynDiv.limit.max.left) {
                if (!keepAspect) {
                    new_size_x = ByRei_dynDiv.cache.init.width + ByRei_dynDiv.limit.max.left;
                }
                reachLimit = true;
            }
           break;
          }

          switch(ByRei_dynDiv.cache.modus) {
           case "tl": case "tr":
            if (pos_top < ByRei_dynDiv.limit.min.top)  {
                if (!keepAspect) {
                    new_size_y = ByRei_dynDiv.cache.init.height - ByRei_dynDiv.limit.min.top;
                    new_top  = ByRei_dynDiv.db(5) + ByRei_dynDiv.limit.min.top;
                }
                reachLimit = true;
            }
           break;
           case "bl": case "br":
            if (pos_top > ByRei_dynDiv.limit.max.top)  {
                if (!keepAspect) {
                    new_size_y = ByRei_dynDiv.cache.init.height + ByRei_dynDiv.limit.max.top;
                }
                reachLimit = true;
            }
           break;
          }
      }

      // Check for min. Size (20x20)
      if (keepAspect) {
          if (!reachLimit && new_size_x > default_padding && new_size_y > default_padding) {
              ByRei_dynDiv.set.width(ByRei_dynDiv.cache.obj,new_size_x);
              ByRei_dynDiv.set.height(ByRei_dynDiv.cache.obj,new_size_y);
              ByRei_dynDiv.set.left(ByRei_dynDiv.cache.obj,new_left);
              ByRei_dynDiv.set.top(ByRei_dynDiv.cache.obj,new_top);
          }
      } else {
          if (new_size_x > default_padding) {
              ByRei_dynDiv.set.width(ByRei_dynDiv.cache.obj,new_size_x);
              ByRei_dynDiv.set.left(ByRei_dynDiv.cache.obj,new_left);
          }
          if (new_size_y > default_padding) {
              ByRei_dynDiv.set.height(ByRei_dynDiv.cache.obj,new_size_y);
              ByRei_dynDiv.set.top(ByRei_dynDiv.cache.obj,new_top);
          }
      }
  }
 },

 /*
  Move DIV
 */
 move: function() {
  if (ByRei_dynDiv.cache.obj) {
      var
       new_left = ByRei_dynDiv.cache.pos.left - (ByRei_dynDiv.cache.init.pos.left - ByRei_dynDiv.db(4)),
       new_top  = ByRei_dynDiv.cache.pos.top - (ByRei_dynDiv.cache.init.pos.top - ByRei_dynDiv.db(5));

      // Check for Div Limit
      if (ByRei_dynDiv.db(1)) {
          var
           pos_x  = ByRei_dynDiv.cache.pos.left - ByRei_dynDiv.cache.init.pos.left,
           pos_y  = ByRei_dynDiv.cache.pos.top - ByRei_dynDiv.cache.init.pos.top;

          if (pos_x < ByRei_dynDiv.limit.min.left) {new_left = ByRei_dynDiv.db(4) + ByRei_dynDiv.limit.min.left;}
          else if (pos_x > ByRei_dynDiv.limit.max.left) {new_left = ByRei_dynDiv.db(4) + ByRei_dynDiv.limit.max.left;}

          if (pos_y < ByRei_dynDiv.limit.min.top)  {new_top  = ByRei_dynDiv.db(5) + ByRei_dynDiv.limit.min.top;}
          else if (pos_y > ByRei_dynDiv.limit.max.top)  {new_top  = ByRei_dynDiv.db(5) + ByRei_dynDiv.limit.max.top;}
      }

      if (!isNaN(new_left)) {ByRei_dynDiv.set.left(ByRei_dynDiv.cache.obj,new_left);}
      if (!isNaN(new_top))  {ByRei_dynDiv.set.top(ByRei_dynDiv.cache.obj,new_top);}
  }
 },

 /*
  Small DB System
 */
 db: function(i,value) { // db(1) return value / db(1,1) set value
  var result=false;
  if (ByRei_dynDiv.cache.elem >= 0) {
      if (ByRei_dynDiv.divList[ByRei_dynDiv.cache.elem]) {
          if (typeof ByRei_dynDiv.divList[ByRei_dynDiv.cache.elem][i] !== 'undefined') {
              if (typeof value !== 'undefined') {
                  ByRei_dynDiv.divList[ByRei_dynDiv.cache.elem][i] = value;
                  result = true;
              } else {
                  result = ByRei_dynDiv.divList[ByRei_dynDiv.cache.elem][i];
              }
          }
      }
  }
  return result;
 },

 /*
  Add Object to dynDiv and add dynDiv Events and Effects
 */
 add: function(elem,i,mode) {
  if (elem) {
      var
       zIndex = 'auto',
       classNames = elem.className.split(' '),
       func_z_index = function(obj,i) {return (ByRei_dynDiv._style(obj,'zIndex')||ByRei_dynDiv._style(obj,'zIndex', i));};

      if (ByRei_dynDiv.get.prefix.value(classNames,"",1) || mode) {
          var
           limiter = null,
           droplimiter = false,
           dropmode = false,
           hideaction = false,
           showresize = false,
           keepAspect = false,
           saveSettings = false,
           parent = elem,
           modus = ByRei_dynDiv.get.prefix.value(classNames,"",1),
           l_parent = parent.parentNode;

          // Set Event Handler for Moveing and Resizing and other handlers
          if (modus) {
              switch (modus) {
               case "moveDiv":
                ByRei_dynDiv._style(parent,'cursor','move');
                ByRei_dynDiv.set_eventListener(parent,'mousedown', function(e) {ByRei_dynDiv.init.action(e,'move');});
                zIndex = func_z_index(parent,i);
               break;
               case "moveParentDiv":
                ByRei_dynDiv._style(parent,'cursor','move');
                ByRei_dynDiv.set_eventListener(parent,'mousedown',  function(e) {ByRei_dynDiv.init.action(e,'moveparent');});
                parent = parent.parentNode;
                zIndex = func_z_index(parent,i);
               break;
               case "resizeDiv_tl":
                ByRei_dynDiv._style(parent,'cursor','nw-resize');
                ByRei_dynDiv.set_eventListener(parent,'mousedown', function(e) {ByRei_dynDiv.init.action(e,'tl');});
               break;
               case "resizeDiv_tr":
                ByRei_dynDiv._style(parent,'cursor','ne-resize');
                ByRei_dynDiv.set_eventListener(parent,'mousedown', function(e) {ByRei_dynDiv.init.action(e,'tr');});
               break;
               case "resizeDiv_bl":
                ByRei_dynDiv._style(parent,'cursor','sw-resize');
                ByRei_dynDiv.set_eventListener(parent,'mousedown', function(e) {ByRei_dynDiv.init.action(e,'bl');});
               break;
               case "resizeDiv_br":
                ByRei_dynDiv._style(parent,'cursor','se-resize');
                ByRei_dynDiv.set_eventListener(parent,'mousedown', function(e) {ByRei_dynDiv.init.action(e,'br');});
               break;
               case "minmaxDiv":
                 ByRei_dynDiv._style(parent,'cursor','pointer');
                 ByRei_dynDiv.set_eventListener(parent,'mousedown', function(e) {ByRei_dynDiv.on.minmax(e);});
               break;
               case "dropArea":
                 ByRei_dynDiv.dropArea.push([parent,'global']);
               break;
              }
          }

          // Drop Areas specific with name (dynDiv_dropArea-[name])
          if (ByRei_dynDiv.get.prefix.value(classNames,"dropArea-",1)) {
              ByRei_dynDiv.dropArea.push([parent,ByRei_dynDiv.get.prefix.value(classNames,"dropArea-",1)]);
          }

          // Limit Movements
          while (l_parent) {
                 if (l_parent.className) {
                     if (ByRei_dynDiv.get.prefix.value(l_parent.className.split(' '),"setLimit")) {
                         if (parent !== l_parent) {limiter = l_parent;}
                         break;
                     }
                 }
                 l_parent = l_parent.parentNode;
          }

          // Body Limit
          if (!limiter) {
              if (ByRei_dynDiv.get.prefix.value(classNames,"bodyLimit") || ByRei_dynDiv.get.prefix.value(parent.parentNode.className.split(' '),"bodyLimit")) {
                  limiter = document.body;
              }
          }

          // Drop Limit
          if (ByRei_dynDiv.get.prefix.value(classNames,"dropLimit")) {
              droplimiter = 'global';
          } else if (ByRei_dynDiv.get.prefix.value(classNames,"dropLimit-",1)) {
              droplimiter = ByRei_dynDiv.get.prefix.value(classNames,"dropLimit-",1);
          }

          // Drop Mode (fit, center)
          if (ByRei_dynDiv.get.prefix.value(classNames,"dropMode-",1)) {
              dropmode = ByRei_dynDiv.get.prefix.value(classNames,"dropMode-",1);
          }

          // Hide Action (false, move, resize)
          if (ByRei_dynDiv.get.prefix.value(classNames,"hideMove") && ByRei_dynDiv.get.prefix.value(classNames,"hideResize")) {
              hideaction = 'move_resize';
          } else {
              if (ByRei_dynDiv.get.prefix.value(classNames,"hideMove")) {
                  hideaction = 'move';
              } else if (ByRei_dynDiv.get.prefix.value(classNames,"hideResize")) {
                  hideaction = 'resize';
              }
          }

          // Keep Aspect Ration (true,false)
          if (ByRei_dynDiv.get.prefix.value(classNames,"keepAspect")) {
              if (parent.clientWidth && parent.clientHeight) {
                  keepAspect = Math.abs(parent.clientWidth/parent.clientHeight);
              }
          }

          // Show Resize (active, focus, doubleclick)
          if (ByRei_dynDiv.get.prefix.value(classNames,"showResize-",1)) {
              showresize = ByRei_dynDiv.get.prefix.value(classNames,"showResize-",1);
              ByRei_dynDiv.on.resize(parent,false);
              if (showresize === 'dbclick') {ByRei_dynDiv.set_eventListener(parent,'dblclick', function(e) {ByRei_dynDiv.on.resize(e, true);});}
          }

          // Save Position and/or Size
          switch (ByRei_dynDiv.get.prefix.value(classNames,"saveSettings-",1)) {
             case "position":      saveSettings = "position";      break;
             case "size":          saveSettings = "size";          break;
             case "position_size": saveSettings = "position_size"; break;
          }
          if (saveSettings && !ByRei_dynDiv.cache.unloadHandler) {
              ByRei_dynDiv.cache.unloadHandler = ByRei_dynDiv.set_eventListener(window,'unload', ByRei_dynDiv.on.unload);
          }

          // Load Position and/or Size
          if (ByRei_dynDiv.get.prefix.value(classNames,"loadSettings")) {
              var data = ByRei_dynDiv.settings.load(parent.id);
              if (data) {
                  if (Number(data.left) !== 'NaN' && Number(data.top) !== 'NaN') {
                      ByRei_dynDiv.set.left(parent, data.left);
                      ByRei_dynDiv.set.top(parent, data.top);
                  }
                  if (data.width > 0 && data.height > 0) {
                      ByRei_dynDiv.set.width(parent, data.width);
                      ByRei_dynDiv.set.height(parent, data.height);
                  }
              }
          }

          // Write main DIVs in the DIV List
          if (ByRei_dynDiv.get.prefix.value(classNames,"moveParentDiv") || ByRei_dynDiv.get.prefix.value(classNames,"moveDiv") || mode) {
              if (!ByRei_dynDiv.get.db.id(parent).found) {
                  ByRei_dynDiv.divList.push([parent,limiter,false,zIndex,ByRei_dynDiv.get.offset.relative(parent).left,ByRei_dynDiv.get.offset.relative(parent).top,droplimiter,dropmode,false,hideaction,showresize,keepAspect,saveSettings,parent.clientWidth,parent.clientHeight]);
                  }
          }
      }
  }
 },

 /* Small alternative Style Selector to avoid JS Errors and make things easier */
 _style: function(obj,o_style,value) {
  if (obj && o_style) {
     if (obj.style) {
         if (typeof obj.style[o_style] !== 'undefined') {
            if (value) {
                try {return (obj.style[o_style] = value);} catch(e) {return false;}
            } else {
                return (obj.style[o_style] === '') ? ((obj.currentStyle) ? obj.currentStyle[o_style] : ((window.getComputedStyle) ? window.getComputedStyle(obj,'').getPropertyValue(o_style) : false)) : obj.style[o_style];
            }
         }
     }
  }
 },

 /* Remove Event Listener */
 del_eventListener: function(obj,event,func) {
  if (obj && event && func) {
   if (ByRei_dynDiv.cache.ie) {obj.detachEvent("on"+event, func);} else {obj.removeEventListener(event, func, false);}
  }
 },

 /* Add Event Listener */
 set_eventListener: function(obj,event,func) {
  if (obj && event && func) {
   if (ByRei_dynDiv.cache.ie) {return obj.attachEvent("on"+event, func);} else {return obj.addEventListener(event, func, false);}
  }
 }

};

    MonitoringTeamStringLinks();
})(true);<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://monitorportal.dca.amazon.com/hosts/overview?&amp;name={STRING}" title="Open URL: https://monitorportal.dca.amazon.com/hosts/overview?&amp;name={STRING} (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://monitorportal.dca.amazon.com/hosts/overview?&amp;name={STRING}" title="Open URL in Popup: https://monitorportal.dca.amazon.com/hosts/overview?&amp;name={STRING} (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script><style id="ld19z5xo.96">        span.stringLinks {            -webkit-user-select: none;            -khtml-user-select: none;            -moz-user-select: none;            -o-user-select: none;            -ms-user-select: none;            user-select: none;            padding: 1px 0px 1px 0px;            margin: 1px 2px 1px 2px;            border: 1px solid black;            font-family: Verdana,Geneva,sans-serif;            font-size:7pt;            font-weight:bold;        }        span.stringLinksInner a::selection {             background: transparent;        }        span.stringLinksInner a::-moz-selection {             background: transparent;        }        @media print {            span.stringLinks {                display: none;            }        }        #stringLinks span.stringLinksInner a, #stringLinks span.stringLinksInner a:hover,        #stringLinks span.stringLinksInner a:focus, #stringLinks span.stringLinksInner a:active  {            font-size: 7pt;            font-weight: bold;            background-color: inherit;            padding: 0;        }        #stringLinks span.stringLinksInner {            padding: 0px 3px 0px 3px;            margin: 0px 0px 0px 0px;            border: 1px solid white;        }                div.stringLinksCMenu {            z-index: 1000;            position: absolute;        }        div.stringLinksCMenuHelp {            z-index: 1001;            position: absolute;            top: 3px;            left: 237px;        }        ul.stringLinksCMenu {            text-align: left;             width: 250px;            left: 0px; top: 0px;            border: 1px solid #A7A6AA;            background: #FFFFFF;            font-size: 12px;             text-decoration: none;            padding: 2px;            margin: 0;            overflow: hidden;            white-space: nowrap;            list-style-type: none;            position: absolute;        }        div.stringLinksPopup div.pageContainer,        div.stringLinksInline div.pageContainer {            width: 100%; height: 100%;            position: relative;        }        div.stringLinksPopupOverlay {            width: 100%; height: 100%;            position: absolute;            z-index: 9999;            display: none;            top: 0px; left: 0px;            background-color: white;            font-size: 20px;            text-align: center;            vertical-align: middle;            float: left;        }        div.stringLinksPopupOverlay span {            vertical-align: middle;            position: absolute;            top: 50%;            margin: -30px 0 0 -60px;        }        div.stringLinksPopupLoading {            background: white url(data:image/png;base64,R0lGODlhGAAYAPYAAP///x0WwPPz+7Gv6WNf00I8yiwmxK6r6Pz8/ZeU4S4oxB0WwOjo+E5JzUxHzezr+Tkzxzcxx+bm9/j4/JOQ4PHx+qOg5aGf5GJd00lDzCIbwScgwkM+ytzb9MPB7TQtxnl02e7t+V5Z0jw2yGdi1LOx6SQdwaek5uPi9tfV8ykiw4F+25GO4Ly6646K35yZ43Nv1/b2/EdBy9HQ8be06qyp53562llU0FdS0D44yVNOz8zK8FxX0YyJ3mxo1Xdz2Li26jIrxeHg9oN/3L687AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJBQAAACwAAAAAGAAYAAAHmoAAgoOEhYaHgxUWBA4aCxwkJwKIhBMJBguZmpkqLBOUDw2bo5kKEogMEKSkLYgIoqubK5QJsZsNCIgCCraZBiiUA72ZJZQABMMgxgAFvRyfxpixGx3LANKxHtbNth8hy8i9IssHwwsXxgLYsSYpxrXDz5QIDubKlAwR5q2UErC2poxNoLBukwoX0IxVuIAhQ6YRBC5MskaxUCAAIfkECQUAAAAsAAAAABgAGAAAB6GAAIKDhIWGh4MVFgQOGhsOGAcxiIQTCQYLmZqZGwkIlA8Nm6OaMgyHDBCkqwsjEoUIoqykNxWFCbOkNoYCCrmaJjWHA7+ZHzOIBMUND5QFvzATlACYsy/TgtWsIpPTz7kyr5TKv8eUB8ULGzSIAtq/CYi46Qswn7AO9As4toUMEfRcHZIgC9wpRBMovNvU6d60ChcwZFigwYGIAwKwaUQUCAAh+QQJBQAAACwAAAAAGAAYAAAHooAAgoOEhYaHgxUWBA4aCzkkJwKIhBMJBguZmpkqLAiUDw2bo5oyEocMEKSrCxCnhAiirKs3hQmzsy+DAgq4pBogKIMDvpvAwoQExQvHhwW+zYiYrNGU06wNHpSCz746O5TKyzwzhwfLmgQphQLX6D4dhLfomgmwDvQLOoYMEegRyApJkIWLQ0BDEyi426Six4RtgipcwJAhUwQCFypA3IgoEAAh+QQJBQAAACwAAAAAGAAYAAAHrYAAgoOEhYaHgxUWBA4aCxwkJzGIhBMJBguZmpkGLAiUDw2bo5oZEocMEKSrCxCnhAiirKsZn4MJs7MJgwIKuawqFYIDv7MnggTFozlDLZMABcpBPjUMhpisJiIJKZQA2KwfP0DPh9HFGjwJQobJypoQK0S2B++kF4IC4PbBt/aaPWA5+CdjQiEGEd5FQHFIgqxcHF4dmkBh3yYVLmx5q3ABQ4ZMBUhYEOCtpLdAACH5BAkFAAAALAAAAAAYABgAAAeegACCg4SFhoeDFRYEDhoaDgQWFYiEEwkGC5mamQYJE5QPDZujmg0PhwwQpKsLEAyFCKKsqw0IhAmzswmDAgq5rAoCggO/sxaCBMWsBIIFyqsRgpjPoybS1KMqzdibBcjcmswAB+CZxwAC09gGwoK43LuDCA7YDp+EDBHPEa+GErK5GkigNIGCulEGKNyjBKDCBQwZMmXAcGESw4uUAgEAIfkECQUAAAAsAAAAABgAGAAAB62AAIKDhIWGh4MVFgQOGgscJCcxiIQTCQYLmZqZBiwIlA8Nm6OaGRKHDBCkqwsQp4QIoqyrGZ+DCbOzCYMCCrmsKhWCA7+zJ4IExaM5Qy2TAAXKQT41DIaYrCYiCSmUANisHz9Az4fRxRo8CUKGycqaECtEtgfvpBeCAuD2wbf2mj1gOfgnY0IhBhHeRUBxSIKsXBxeHZpAYd8mFS5seatwAUOGTAVIWBDgraS3QAAh+QQJBQAAACwAAAAAGAAYAAAHooAAgoOEhYaHgxUWBA4aCzkkJwKIhBMJBguZmpkqLAiUDw2bo5oyEocMEKSrCxCnhAiirKs3hQmzsy+DAgq4pBogKIMDvpvAwoQExQvHhwW+zYiYrNGU06wNHpSCz746O5TKyzwzhwfLmgQphQLX6D4dhLfomgmwDvQLOoYMEegRyApJkIWLQ0BDEyi426Six4RtgipcwJAhUwQCFypA3IgoEAAh+QQJBQAAACwAAAAAGAAYAAAHoYAAgoOEhYaHgxUWBA4aGw4YBzGIhBMJBguZmpkbCQiUDw2bo5oyDIcMEKSrCyMShQiirKQ3FYUJs6Q2hgIKuZomNYcDv5kfM4gExQ0PlAW/MBOUAJizL9OC1awik9PPuTKvlMq/x5QHxQsbNIgC2r8JiLjpCzCfsA70Czi2hQwR9FwdkiAL3ClEEyi829Tp3rQKFzBkWKDBgYgDArBpRBQIADsAAAAAAAAAAAA=) no-repeat scroll center;        }        input.stringLinksAddressBar {            width: 100%;        }        div.stringLinksPopup {            text-align: center;            margin: 0 auto;            position: absolute;            z-index: 502;            border: 1px solid black;            overflow: hidden;            background-color: white;            box-shadow: 3px 3px 4px #000;            border-radius: 8px;        }        div.stringLinksInline {            text-align: center;            border: 1px solid black;            overflow: hidden;            background-color: white;            box-shadow: 3px 3px 4px #000;            border-radius: 8px;        }        div.stringLinksPopup a, div.stringLinksPopup a:hover, div.stringLinksPopup a:visited,        div.stringLinksInline a, div.stringLinksInline a:hover, div.stringLinksInline a:visited {            color: white !important;            background-color: inherit;        }        div.stringLinksPopup iframe,        div.stringLinksInline iframe {            width: 100%;            height: 100%;            position: absolute;            top: 0; left: 0;            border-width: 0px;            background-color: white;        }        div.stringLinksHeader {            background:#5A7EAA url(https://monitorportal.amazon.com/images/header_background.png) repeat-x scroll 0 0;            padding: 4px;            color: #ffffff;            text-align: right;            font-family: arial;            font-size: 14px;        }        div.stringLinksPopup div.stringLinksHeader {        }        ul.stringLinksCMenu li {            float: left;            margin-right: 1px;            position: relative;            width: 250px;        }        ul.stringLinksCMenu .box {            position: absolute;             left: 18px;             top: 1px;             text-decoration: none;             border: none;             padding: 0;         }        ul.stringLinksCMenu li.title {            font-weight: bold;         }                 ul.stringLinksCMenu li div {            display: block;        }                ul.stringLinksCMenu li a.sel {            line-height: 18px;            padding: 0 4px 0 4px;            font-weight: normal;            font-family: Tahoma,Verdana,Arial,Helvetica,sans-serif;             text-decoration: none;             color: blue;             position: relative;             left: 40px;             width: 100%;            display: inline-block;        }        ul.stringLinksCMenu li a.sel:link {            color: black;         }        ul.stringLinksCMenu li a.sel:visited {            color: black;         }                ul.stringLinksCMenu li hr {            width: 99%;            border: 0;            height: 1px;            color: #BBBBBB;             background-color: #BBBBBB;             margin-top: 4px;            margin-bottom: 4px;            visibility: visible;        }        ul.stringLinksCMenu li:hover a.sel { background-color: #0099FF; color: #FFFFFF; }        ul.stringLinksCMenu li:hover ul {display: block; position: absolute; top: 0; left: 246px; width:250px;}        ul.stringLinksCMenu li:hover ul li ul {display: none;}        ul.stringLinksCMenu li:hover ul li a.sel { display: block; background-color: #F6F6F6; color: #000000; }        ul.stringLinksCMenu li:hover ul li a.sel:hover { background-color: #0099FF; color: #FFFFFF; }        ul.stringLinksCMenu li:hover ul.left { left: -250px; }        #stagetabs ul.tabs li a { display: inline; }        #stagetabs ul.tabs li span.stringLinks a { font-size: 7pt; }        #searchresult-main div.searchresult-component.host { width: inherit; }        #searchresult-main div.searchresult-component.hostclass { width: inherit; }        #monitor-amazon-com #graph-control span.stringLinks,         #monitor-amazon-com #graph-control span.stringLinksInner { display: inline-block; }        .dynDiv_moveDiv {             cursor: move;             position: absolute;             overflow: hidden;        }                .dynDiv_resizeDiv_tl,.dynDiv_resizeDiv_tr,.dynDiv_resizeDiv_bl,.dynDiv_resizeDiv_br {             width: 10px;             height: 10px;             background: #FFFFCC url(data:image/png;base64,R0lGODlhCwALALMAAISEhN7e3szMzI2Njebm5pSUlOzs7NbW1v///wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEHAAgALAAAAAALAAsAAAQ0MICAJCVDTIQPHxRlAB6xleDnBcVYbhJRoN4BEMhbD/hL2b1b4cfL8Ui5W9JQMeIEA+YhAgA7) no-repeat scroll center;             border: 1px solid #000;             border-radius: 3px;              -moz-border-radius: 3px;              position: absolute;        }                .dynDiv_resizeDiv_tl {             top: -1px;             left: -1px;        }                .dynDiv_resizeDiv_tr {             top: -1px;             right: -1px;        }                .dynDiv_resizeDiv_bl {             bottom: -1px;             left: -1px;        }                .dynDiv_resizeDiv_br {             bottom: -1px;             right: -1px;        }                .dynDiv_moveParentDiv {             width: 100%;             margin: auto;             height: 16px;             font-size: 15px;             position: absolute;             top: -1px;             left: -1px;             background: #faa;             border: 1px solid #aaa;             border-left: 0;             border-right: 0;             padding: 0;             overflow: hidden;             white-space:nowrap;        }                .dynDiv_minmaxDiv {             position: absolute;             top: 1px;             right: 15px;             width: 15px;             height: 15px;             background: #faa;             font-size: 15px;             padding: 0;             margin: 0;        }        <span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://monitorportal.amazon.com/images/header_background.png" title="Open URL: https://monitorportal.amazon.com/images/header_background.png (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://monitorportal.amazon.com/images/header_background.png" title="Open URL in Popup: https://monitorportal.amazon.com/images/header_background.png (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></style><style id="ld1frqiu.von">                                                                          #asinhelper-bigPopup {                                                                   position:               absolute;                                                    padding:                1em;                                                         background:             white;                                                       border:                 1px solid black;                                             border-radius:          1ex;                                                         z-index:                777;                                                         max-width:              500px;                                                   }                                                                                    #asinhelper-smallPopup {                                                                 position:               absolute;                                                    padding:                2px;                                                         background:             white;                                                       border:                 1px solid gray;                                              border-radius:          1ex;                                                         z-index:                777;                                                     }                                                                                    #asinhelper-smallPopup:hover {                                                           background:             lightgrey;                                               }                                                                                    #asinhelper-marketplaceNamePopup {                                                       position:               absolute;                                                    padding:                5px 5px;                                                     background:             orange;                                                      border:                 1px solid gray;                                              border-radius:          1ex;                                                         z-index:                777;                                                     }                                                                                    .asinhelper-vertical-menu a {                                                            background-color: #eee;                                                              color: black;                                                                        display: block;                                                                      padding: 12px;                                                                       text-decoration: none;                                                           }                                                                                    .asinhelper-vertical-menu a:hover {                                                      background-color: #ccc;                                                          }                                                                                    .close-btn {                                                                             position: absolute;                                                                  top: 0px;                                                                            right: 0px;                                                                          background: transparent;                                                             border: 0px;                                                                     }                                                                                </style></head><!-- sp:end-feature:head-close -->
<!-- sp:feature:start-body -->
<body class="a-aui_72554-c a-aui_accordion_a11y_role_354025-c a-aui_killswitch_csa_logger_372963-c a-aui_launch_2021_ally_fixes_392482-t1 a-aui_pci_risk_banner_210084-c a-aui_preload_261698-c a-aui_rel_noreferrer_noopener_309527-c a-aui_template_weblab_cache_333406-c a-aui_tnr_v2_180836-c a-meter-animate"><span class="mec-aria-reader" aria-live="polite" aria-atomic="true"></span><span class="mec-aria-reader" aria-live="assertive" aria-atomic="true"></span><div id="a-page"><script type="a-state" data-a-state="{&quot;key&quot;:&quot;a-wlab-states&quot;}">{"AUI_TNR_V2_180836":"C","AUI_ACCORDION_A11Y_ROLE_354025":"C","AUI_PRELOAD_261698":"C","AUI_LAUNCH_2021_ALLY_FIXES_392482":"T1","AUI_TEMPLATE_WEBLAB_CACHE_333406":"C","AUI_72554":"C","AUI_KILLSWITCH_CSA_LOGGER_372963":"C","AUI_REL_NOREFERRER_NOOPENER_309527":"C","AUI_PCI_RISK_BANNER_210084":"C"}<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://weblab.amazon.com/exec/search?query=AUI_PRELOAD_261698&amp;allowRedirect=true&amp;a=execSearch" title="Weblab: AUI_PRELOAD_261698 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> WL</a></span></span></script><script>typeof uex === 'function' && uex('ld', 'portal-bb', {wb: 1})</script><!-- sp:end-feature:start-body -->
<!-- sp:feature:csm:body-open -->


<script>
!function(){function n(n,t){var r=i(n);return t&&(r=r("instance",t)),r}var r=[],c=0,i=function(t){return function(){var n=c++;return r.push([t,[].slice.call(arguments,0),n,{time:Date.now()}]),i(n)}};n._s=r,this.csa=n}();;
csa('Config', {"ContentInteractionsSummary.FlushInterval":5000});
if (window.csa) {
    csa("Config", {
        'Application': 'Retail:Prod:www.amazon.in',
        'Events.Namespace': 'csa',
        'ObfuscatedMarketplaceId': 'A21TJRUUN4KGV',
        'Events.SushiEndpoint': 'https://unagi.amazon.in/1/events/com.amazon.csm.csa.prod',
        'CacheDetection.RequestID': "E2WFHK2PD2NF0NVZ86FC",
        'CacheDetection.Callback': window.ue && ue.reset,
        'LCP.elementDedup': 1
    });

    csa("Events")("setEntity", {
        page: {requestId: "E2WFHK2PD2NF0NVZ86FC", meaningful: "interactive"},
        session: {id: "257-6328836-0330509"}
    });
}
!function(r){var i,e,o="splice",u=r.csa,f={},c={},a=r.csa._s,s=0,l=0,g=-1,h={},v={},d={},n=Object.keys,p=function(){};function t(n,t){return u(n,t)}function m(n,t){var r=c[n]||{};k(r,t),c[n]=r,l++,S(U,0)}function w(n,t,r){var i=!0;return t=D(t),r&&r.buffered&&(i=(d[n]||[]).every(function(n){return!1!==t(n)})),i?(h[n]||(h[n]=[]),h[n].push(t),function(){!function(n,t){var r=h[n];r&&r[o](r.indexOf(t),1)}(n,t)}):p}function b(n,t){if(t=D(t),n in v)return t(v[n]),p;return w(n,function(n){return t(n),!1})}function y(n,t){if(u("Errors")("logError",n),f.DEBUG)throw t||n}function E(){return Math.abs(4294967295*Math.random()|0).toString(36)}function D(n,t){return function(){try{return n.apply(this,arguments)}catch(n){y(n.message||n,n)}}}function S(n,t){return r.setTimeout(D(n),t)}function U(){for(var n=0;n<a.length;){var t=a[n],r=t[0]in c;if(!r&&!e)return void(s=t.length);r?(a[o](s=n,1),I(t)):n++}g=l}function I(n){var arguments,t=c[n[0]],r=(arguments=n[1])[0];if(!t||!t[r])return y("Undefined function: "+t+"/"+r);i=n[3],c[n[2]]=t[r].apply(t,arguments.slice(1))||{},i=0}function O(){e=1,U()}function k(t,r){n(r).forEach(function(n){t[n]=r[n]})}b("$beforeunload",O),m("Config",{instance:function(n){k(f,n)}}),u.plugin=D(function(n){n(t)}),t.config=f,t.register=m,t.on=w,t.once=b,t.blank=p,t.emit=function(n,t,r){for(var i=h[n]||[],e=0;e<i.length;)!1===i[e](t)?i[o](e,1):e++;v[n]=t||{},r&&r.buffered&&(d[n]||(d[n]=[]),100<=d[n].length&&d[n].shift(),d[n].push(t||{}))},t.UUID=function(){return[E(),E(),E(),E()].join("-")},t.time=function(n){var t=i?new Date(i.time):new Date;return"ISO"===n?t.toISOString():t.getTime()},t.error=y,t.warn=function(n,t){if(u("Errors")("logWarn",n),f.DEBUG)throw t||n},t.exec=D,t.timeout=S,t.interval=function(n,t){return r.setInterval(D(n),t)},(t.global=r).csa._s.push=function(n){n[0]in c&&(!a.length||e)?(I(n),a.length&&g!==l&&U()):a[o](s++,0,n)},U(),S(function(){S(O,f.SkipMissingPluginsTimeout||5e3)},1)}("undefined"!=typeof window?window:global);csa.plugin(function(o){var f="addEventListener",e="requestAnimationFrame",t=o.exec,r=o.global,u=o.on;o.raf=function(n){if(r[e])return r[e](t(n))},o.on=function(n,e,t,r){if(n&&"function"==typeof n[f]){var i=o.exec(t);return n[f](e,i,r),function(){n.removeEventListener(e,i,r)}}return"string"==typeof n?u(n,e,t,r):o.blank}});csa.plugin(function(o){var t,n,r={},e="localStorage",c="sessionStorage",a="local",i="session",u=o.exec;function s(e,t){var n;try{r[t]=!!(n=o.global[e]),n=n||{}}catch(e){r[t]=!(n={})}return n}function f(){t=t||s(e,a),n=n||s(c,i)}function l(e){return e&&e[i]?n:t}o.store=u(function(e,t,n){f();var o=l(n);return e?t?void(o[e]=t):o[e]:Object.keys(o)}),o.storageSupport=u(function(){return f(),r}),o.deleteStored=u(function(e,t){f();var n=l(t);if("function"==typeof e)for(var o in n)n.hasOwnProperty(o)&&e(o,n[o])&&delete n[o];else delete n[e]})});csa.plugin(function(n){n.types={ovl:function(n){var r=[];if(n)for(var i in n)n.hasOwnProperty(i)&&r.push(n[i]);return r}}});csa.plugin(function(i){function n(e){return function(n){i("Metrics",{producerId:"csa",dimensions:{message:n}})("recordMetric",e,1)}}function e(r){var o,t,l=i("Events",{producerId:r.producerId}),u=["name","type","csm","adb"],c={pageURL:"pageURL",file:"f",line:"l",column:"c"};this.log=function(n){if(!function(n){if(!n)return!0;for(var e in n)return!1;return!0}(n)){var e=r.logOptions||{ent:{page:["pageType","subPageType","requestId"]}};l("log",function(e){return o=i.UUID(),t={messageId:o,schemaId:r.schemaId||"<ns>.Error.3",errorMessage:e.m||null,attribution:e.attribution||null,logLevel:e.logLevel||"FATAL",pageURL:null,file:null,line:null,column:null,stack:e.s||[],context:{}},u.forEach(function(n){e[n]&&(t.context[n]=e[n])}),"INFO"===e.logLevel||Object.keys(c).forEach(function(n){t[n]=e[c[n]]||null}),t}(n),e)}}}i.register("Errors",{instance:function(n){return new e(n||{})},logError:n("jsError"),logWarn:n("jsWarn")})});csa.plugin(function(o){var i,e,n,a,t,r="function",u="willDisappear",c="$app.",f="$document.",p="focus",d="blur",s="active",l="resign",$=o.global,b=o.exec,m=o("Events"),g=$.location,v=$.document||{},h=$.P||{},y=(($.performance||{}).navigation||{}).type,P=o.on,w=o.emit,k=v.hidden,E={};g&&v&&(P($,"beforeunload",D),P($,"pagehide",D),P(v,"visibilitychange",A(f,function(){return v.visibilityState||"unknown"})),P(v,p,A(f+p)),P(v,d,A(f+d)),h.when&&h.when("mash").execute(function(e){e&&(P(e,"appPause",A(c+"pause")),P(e,"appResume",A(c+"resume")),A(c+"deviceready")(),$.cordova&&$.cordova.platformId&&A(c+cordova.platformId)(),P(v,s,A(c+s)),P(v,l,A(c+l)))}),e=$.app||{},n=b(function(){w(c+"willDisappear"),D()}),t=typeof(a=e[u])==r,e[u]=b(function(){n(),t&&a()}),$.app||($.app=e),"complete"===v.readyState?T():P($,"load",T),k?S():x(),o.on("$app.blur",S),o.on("$app.focus",x),o.on("$document.blur",S),o.on("$document.focus",x),o.on("$document.hidden",S),o.on("$document.visible",x),o.register("SPA",{newPage:I}),I({transitionType:{0:"hard",1:"refresh",2:"back-button"}[y]||"unknown"}));function I(n,e){var a=!!i,t=(e=e||{}).keepPageAttributes;a&&(w("$beforePageTransition"),w("$pageTransition")),a&&!t&&m("removeEntity","page"),i=o.UUID(),t?E.id=i:E={schemaId:"<ns>.PageEntity.1",id:i,url:g.href,server:g.hostname,path:g.pathname,referrer:v.referrer,title:v.title},Object.keys(n||{}).forEach(function(e){E[e]=n[e]}),m("setEntity",{page:E}),w("$pageChange",E,{buffered:1}),a&&w("$afterPageTransition")}function T(){w("$load"),w("$ready"),w("$afterload")}function D(){w("$ready"),w("$beforeunload"),w("$unload"),w("$afterunload")}function S(){k||(w("$visible",!1,{buffered:1}),k=!0)}function x(){k&&(w("$visible",!0,{buffered:1}),k=!1)}function A(n,a){return b(function(){var e=typeof a==r?n+a():n;w(e)})}});csa.plugin(function(c){var t="Events",e="UNKNOWN",a="id",u="all",n="messageId",i="timestamp",f="producerId",o="application",r="obfuscatedMarketplaceId",s="entities",d="schemaId",l="version",p="attributes",v="<ns>",g=c.config,h=(c.global.location||{}).host,m=g[t+".Namespace"]||"csa_other",I=g.Application||"Other"+(h?":"+h:""),b=c("Transport"),y={},O=function(t,e){Object.keys(t).forEach(e)};function E(n,i,o){O(i,function(t){var e=o===u||(o||{})[t];t in n||(n[t]={version:1,id:i[t][a]||c.UUID()}),U(n[t],i[t],e)})}function U(e,n,i){O(n,function(t){!function(t,e,n){return"string"!=typeof e&&t!==l?c.error("Attribute is not of type string: "+t):!0===n||1===n||(t===a||!!~(n||[]).indexOf(t))}(t,n[t],i)||(e[t]=n[t])})}function N(o,t,r){O(t,function(t){var e=o[t];if(e[d]){var n={},i={};n[a]=e[a],n[f]=e[f]||r,n[d]=e[d],n[l]=e[l]++,n[p]=i,S(n),U(i,e,1),k(i),b("log",n)}})}function S(t){t[i]=function(t){return"number"==typeof t&&(t=new Date(t).toISOString()),t||c.time("ISO")}(t[i]),t[n]=t[n]||c.UUID(),t[o]=I,t[r]=g.ObfuscatedMarketplaceId||e,t[d]=t[d].replace(v,m)}function k(t){delete t[l],delete t[d],delete t[f]}function w(o){var r={};this.log=function(t,e){var n={},i=(e||{}).ent;return t?"string"!=typeof t[d]?c.error("A valid schema id is required for the event"):(S(t),E(n,y,i),E(n,r,i),E(n,t[s]||{},i),O(n,function(t){k(n[t])}),t[f]=o[f],t[s]=n,void b("log",t,e)):c.error("The event cannot be undefined")},this.setEntity=function(t){E(r,t,u),N(r,t,o[f])}}g["KillSwitch."+t]||c.register(t,{setEntity:function(t){E(y,t,u),N(y,t,"csa")},removeEntity:function(t){delete y[t]},instance:function(t){return new w(t)}})});csa.plugin(function(s){var c,g="Transport",l="post",f="preflight",r="csa.cajun.",i="store",a="deleteStored",u="sendBeacon",t="__merge",e="messageId",n=".FlushInterval",o=0,d=s.config[g+".BufferSize"]||2e3,h=s.config[g+".RetryDelay"]||1500,p={},v=0,y=[],m=s.global,E=m.document,b=s.timeout,k=m.Object.keys,w=s.config[g+n]||5e3,I=w,O=s.config[g+n+".BackoffFactor"]||1,R=s.config[g+n+".BackoffLimit"]||3e4,S=0;function B(n){if(864e5<s.time()-+new Date(n.timestamp))return s.warn("Event is too old: "+n);v<d&&(n[e]in p||(p[n[e]]=n,v++),"function"==typeof n[t]&&n[t](p[n[e]]),!S&&o&&(S=b(T,function(){var n=I;return I=Math.min(n*O,R),n}())))}function T(){y.forEach(function(e){var o=[];k(p).forEach(function(n){var t=p[n];e.accepts(t)&&o.push(t)}),o.length&&(e.chunks?e.chunks(o).forEach(function(n){D(e,n)}):D(e,o))}),p={},S=0}function D(t,e){function o(){s[a](r+n)}var n=s.UUID();s[i](r+n,JSON.stringify(e)),[function(n,t,e){var o=m.navigator||{},r=m.cordova||{};if(!o[u]||!n[l])return 0;n[f]&&r&&"ios"===r.platformId&&!c&&((new Image).src=n[f]().url,c=1);var i=n[l](t);if(!i.type&&o[u](i.url,i.body))return e(),1},function(n,t,e){if(!n[l])return 0;var o=n[l](t),r=o.url,i=o.body,c=o.type,f=new XMLHttpRequest,a=0;function u(n,t,e){f.open("POST",n),f.withCredentials=!0,e&&f.setRequestHeader("Content-Type",e),f.send(t)}return f.onload=function(){f.status<299?e():s.config[g+".XHRRetries"]&&a<3&&b(function(){u(r,i,c)},++a*h)},u(r,i,c),1}].some(function(n){try{return n(t,e,o)}catch(n){}})}k&&(s.once("$afterload",function(){o=1,function(e){(s[i]()||[]).forEach(function(n){if(!n.indexOf(r))try{var t=s[i](n);s[a](n),JSON.parse(t).forEach(e)}catch(n){s.error(n)}})}(B),s.on(E,"visibilitychange",T,!1),T()}),s.once("$afterunload",function(){o=1,T()}),s.on("$afterPageTransition",function(){v=0,I=w}),s.register(g,{log:B,register:function(n){y.push(n)}}))});csa.plugin(function(n){var r=n.config["Events.SushiEndpoint"];n("Transport")("register",{accepts:function(n){return n.schemaId},post:function(n){var t=n.map(function(n){return{data:n}});return{url:r,body:JSON.stringify({events:t})}},preflight:function(){var n,t=/\/\/(.*?)\//.exec(r);return t&&t[1]&&(n="https://"+t[1]+"/ping"),{url:n}},chunks:function(n){for(var t=[];500<n.length;)t.push(n.splice(0,500));return t.push(n),t}})});csa.plugin(function(n){var t,a,o,r,e=n.config,i="PageViews",d=e[i+".ImpressionMinimumTime"]||1e3,s="hidden",c="innerHeight",g="innerWidth",l="renderedTo",f=l+"Viewed",m=l+"Meaningful",u=l+"Impressed",p=1,v=2,h=3,w=4,y=5,P="loaded",I=7,T=8,b=n.global,E=n.on,V=n("Events",{producerId:"csa"}),$=b.document,M={},S={},H=y;function K(e){if(!M[I]){var i;if(M[e]=n.time(),e!==h&&e!==P||(t=t||M[e]),t&&H===w)a=a||M[e],(i={})[m]=t-o,i[f]=a-o,R("PageView.4",i),r=r||n.timeout(j,d);if(e!==y&&e!==p&&e!==v||(clearTimeout(r),r=0),e!==p&&e!==v||R("PageRender.3",{transitionType:e===p?"hard":"soft"}),e===I)(i={})[m]=t-o,i[f]=a-o,i[u]=M[e]-o,R("PageImpressed.2",i)}}function R(e,i){S[e]||(i.schemaId="<ns>."+e,V("log",i,{ent:"all"}),S[e]=1)}function W(){0===b[c]&&0===b[g]?(H=T,n("Events")("setEntity",{page:{viewport:"hidden-iframe"}})):H=$[s]?y:w,K(H)}function j(){K(I),r=0}function k(){var e=o?v:p;M={},S={},a=t=0,o=n.time(),K(e),W()}function q(){var e=$.readyState;"interactive"===e&&K(h),"complete"===e&&K(P)}e["KillSwitch."+i]||($&&void 0!==$[s]?(k(),E($,"visibilitychange",W,!1),E($,"readystatechange",q,!1),E("$afterPageTransition",k),E("$timing:loaded",q),n.once("$load",q)):n.warn("Page visibility not supported"))});csa.plugin(function(c){var s=c.config["Interactions.ParentChainLength"]||15,e="click",r="touches",f="timeStamp",o="length",u="pageX",g="pageY",p="pageXOffset",h="pageYOffset",m=250,v=5,d=200,l=.5,t={capture:!0,passive:!0},X=c.global,Y=c.emit,n=c.on,x=X.Math.abs,a=(X.document||{}).documentElement||{},y={x:0,y:0,t:0,sX:0,sY:0},N={x:0,y:0,t:0,sX:0,sY:0};function b(t){if(t.id)return"//*[@id='"+t.id+"']";var e=function(t){var e,n=1;for(e=t.previousSibling;e;e=e.previousSibling)e.nodeName===t.nodeName&&(n+=1);return n}(t),n=t.nodeName;return 1!==e&&(n+="["+e+"]"),t.parentNode&&(n=b(t.parentNode)+"/"+n),n}function I(t,e,n){var a=c("Content",{target:n}),i={schemaId:"<ns>.ContentInteraction.1",interaction:t,interactionData:e,messageId:c.UUID()};if(n){var r=b(n);r&&(i.attribution=r);var o=function(t){for(var e=t,n=e.tagName,a=!1,i=t?t.href:null,r=0;r<s;r++){if(!e||!e.parentElement){a=!0;break}n=(e=e.parentElement).tagName+"/"+n,i=i||e.href}return a||(n=".../"+n),{pc:n,hr:i}}(n);o.pc&&(i.interactionData.parentChain=o.pc),o.hr&&(i.interactionData.href=o.hr)}a("log",i),Y("$content.interaction",i)}function i(t){I(e,{interactionX:""+t.pageX,interactionY:""+t.pageY},t.target)}function C(t){if(t&&t[r]&&1===t[r][o]){var e=t[r][0];N=y={e:t.target,x:e[u],y:e[g],t:t[f],sX:X[p],sY:X[h]}}}function D(t){if(t&&t[r]&&1===t[r][o]&&y&&N){var e=t[r][0],n=t[f],a=n-N.t,i={e:t.target,x:e[u],y:e[g],t:n,sX:X[p],sY:X[h]};N=i,d<=a&&(y=i)}}function E(t){if(t){var e=x(y.x-N.x),n=x(y.y-N.y),a=x(y.sX-N.sX),i=x(y.sY-N.sY),r=t[f]-y.t;if(m<1e3*e/r&&v<e||m<1e3*n/r&&v<n){var o=n<e;o&&a&&e*l<=a||!o&&i&&n*l<=i||I((o?"horizontal":"vertical")+"-swipe",{interactionX:""+y.x,interactionY:""+y.y,endX:""+N.x,endY:""+N.y},y.e)}}}n(a,e,i,t),n(a,"touchstart",C,t),n(a,"touchmove",D,t),n(a,"touchend",E,t)});csa.plugin(function(t){var n,s,u,e="MutationObserver",i="observe",r="disconnect",o="mutObs",c=t.global,a=c.document,f=a.body||a.documentElement,b=Date.now,l=[],d=[],g=[],m=0,p=0,v=0,h=t.blank,O={buffered:1},w=0;function _(e){t.global.ue_csa_ss_tag||t.emit("$csmTag:"+e,0,O)}b&&c[e]?(_(o+"Yes"),m=0,(s=new c[e](B))[i](f,{childList:!0,subtree:!0}),(u=new c[e](y))[i](f,{attributes:!0,subtree:!0,attributeFilter:["src"],attributeOldValue:!0}),h=t.on(c,"scroll",L,{passive:!0}),t.register("SpeedIndexBuffers",{getBuffers:function(e){e&&(L(),e(m,l,d,g),s&&s[r](),u&&u[r](),h())},registerListener:function(e){n=e}})):_(o+"No");function y(e){l.push({t:b(),m:e})}function B(e){d.push({t:b(),m:e}),w||_(o+"Active"),w=v=1,n&&n()}function L(){v&&(g.push({t:b(),y:p}),p=c.pageYOffset,v=0)}});

var ue_csa_ss_tag = false;
csa.plugin(function(b){var a=b.global,e=a.uet,f=a.uex,c=a.ue,d=a.Object,g={largestContentfulPaint:"lcp",speedIndex:"si",atfSpeedIndex:"atfsi",visuallyLoaded50:"vl50",visuallyLoaded90:"vl90",visuallyLoaded100:"vl100"},k="perfNo perfYes browserQuiteFn browserQuiteUd browserQuiteLd browserQuiteMut mutObsNo mutObsYes mutObsActive startVL endVL".split(" ");b&&e&&f&&d.keys&&c&&(d.keys(g).forEach(function(h){b.on("$timing:"+h,function(a){var b=g[h];if(c.isl){var d="csa:"+b;e(b,d,void 0,a);f("at",d)}else e(b,
void 0,void 0,a)})}),a.ue_csa_ss_tag||k.forEach(function(a){b.on("$csmTag:"+a,function(){c.tag&&c.tag(a);c.isl&&f("at","csa:"+a)},{buffered:1})}))});

<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://www.amazon.in/dppui/www.amazon.in" title="Open URL: www.amazon.in (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://www.amazon.in/dppui/www.amazon.in" title="Open URL in Popup: www.amazon.in (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>
<script>window.ue && ue.count && ue.count('CSMLibrarySize', 14965)</script>
<!-- sp:end-feature:csm:body-open -->
<!-- sp:feature:nav-inline-js -->
<!-- sp:end-feature:nav-inline-js -->
<!-- sp:feature:nav-skeleton -->
<!-- sp:end-feature:nav-skeleton -->
<!-- sp:feature:navbar -->
<!-- sp:end-feature:navbar -->
<!-- sp:feature:host-atf -->

    <script>
        window.P && P.register('sp.load.js');
    </script>
<title dir="ltr">Checkout</title><script>var aPageStart = (new Date()).getTime();</script>
<script type="text/javascript">var ue_t0=ue_t0||+new Date();</script>
<script type="text/javascript">
window.ue_ihb = (window.ue_ihb || window.ueinit || 0) + 1;
if (window.ue_ihb === 1) {

var ue_csm = window,
    ue_hob = +new Date();
(function(d){var e=d.ue=d.ue||{},f=Date.now||function(){return+new Date};e.d=function(b){return f()-(b?0:d.ue_t0)};e.stub=function(b,a){if(!b[a]){var c=[];b[a]=function(){c.push([c.slice.call(arguments),e.d(),d.ue_id])};b[a].replay=function(b){for(var a;a=c.shift();)b(a[0],a[1],a[2])};b[a].isStub=1}};e.exec=function(b,a){return function(){try{return b.apply(this,arguments)}catch(c){ueLogError(c,{attribution:a||"undefined",logLevel:"WARN"})}}}})(ue_csm);


    var ue_err_chan = 'jserr-rw';
(function(d,e){function h(f,b){if(!(a.ec>a.mxe)&&f){a.ter.push(f);b=b||{};var c=f.logLevel||b.logLevel;c&&c!==k&&c!==m&&c!==n&&c!==p||a.ec++;c&&c!=k||a.ecf++;b.pageURL=""+(e.location?e.location.href:"");b.logLevel=c;b.attribution=f.attribution||b.attribution;a.erl.push({ex:f,info:b})}}function l(a,b,c,e,g){d.ueLogError({m:a,f:b,l:c,c:""+e,err:g,fromOnError:1,args:arguments},g?{attribution:g.attribution,logLevel:g.logLevel}:void 0);return!1}var k="FATAL",m="ERROR",n="WARN",p="DOWNGRADED",a={ec:0,ecf:0,
pec:0,ts:0,erl:[],ter:[],mxe:50,startTimer:function(){a.ts++;setInterval(function(){d.ue&&a.pec<a.ec&&d.uex("at");a.pec=a.ec},1E4)}};l.skipTrace=1;h.skipTrace=1;h.isStub=1;d.ueLogError=h;d.ue_err=a;e.onerror=l})(ue_csm,window);


var ue_id = 'E2WFHK2PD2NF0NVZ86FC',
    ue_url = '/uedata/uedata',
    ue_navtiming = 1,
    ue_mid = 'A21TJRUUN4KGV',
    ue_sid = '257-6328836-0330509',
    ue_sn = 'www.amazon.in',
    ue_furl = 'fls-eu.amazon.in',
    ue_surl = 'https://unagi-eu.amazon.com/1/events/com.amazon.csm.nexusclient.prod',
    ue_int = 1,
    ue_fcsn = 1,
    ue_urt = 3,
    ue_rpl_ns = 'cel-rpl',
    ue_ddq = 1,
    ue_fpf = '//fls-eu.amazon.in/1/batch/1/OP/A21TJRUUN4KGV:257-6328836-0330509:E2WFHK2PD2NF0NVZ86FC$uedata=s:',
    ue_sbuimp = 1,
    ue_cel_lclia = 1,
    ue_ibft = 1,
    ue_sswmts = 0,
    ue_jsmtf = 0,
    ue_fnt = 0,
    ue_lpsi = 6000,
    ue_csa_errors = 1,
    ue_no_counters = 0,

    ue_swi = 1;
var ue_viz=function(){(function(b,e,a){function k(c){if(b.ue.viz.length<p&&!l){var a=c.type;c=c.originalEvent;/^focus./.test(a)&&c&&(c.toElement||c.fromElement||c.relatedTarget)||(a=e[m]||("blur"==a||"focusout"==a?"hidden":"visible"),b.ue.viz.push(a+":"+(+new Date-b.ue.t0)),"visible"==a&&(b.ue.isl&&q("at"),l=1))}}for(var l=0,q=b.uex,f,g,m,n=["","webkit","o","ms","moz"],d=0,p=20,h=0;h<n.length&&!d;h++)if(a=n[h],f=(a?a+"H":"h")+"idden",d="boolean"==typeof e[f])g=a+"visibilitychange",m=(a?a+"V":"v")+
"isibilityState";k({});d&&e.addEventListener(g,k,0);b.ue&&d&&(b.ue.pageViz={event:g,propHid:f})})(ue_csm,ue_csm.document,ue_csm.window)};

(function(d,h,N){function H(a){return a&&a.replace&&a.replace(/^\s+|\s+$/g,"")}function u(a){return"undefined"===typeof a}function B(a,b){for(var c in b)b[v](c)&&(a[c]=b[c])}function I(a){try{var b=N.cookie.match(RegExp("(^| )"+a+"=([^;]+)"));if(b)return b[2].trim()}catch(c){}}function O(m,b,c){var q=(x||{}).type;if("device"!==c||2!==q&&1!==q)m&&(d.ue_id=a.id=a.rid=m,w&&(w=w.replace(/((.*?:){2})(\w+)/,function(a,b){return b+m})),D&&(e("id",D,m),D=0)),b&&(w&&(w=w.replace(/(.*?:)(\w|-)+/,function(a,
c){return c+b})),d.ue_sid=b),c&&a.tag("page-source:"+c),d.ue_fpf=w}function P(){var a={};return function(b){b&&(a[b]=1);b=[];for(var c in a)a[v](c)&&b.push(c);return b}}function y(d,b,c,q){q=q||+new E;var f,l;if(b||u(c)){if(d)for(l in f=b?e("t",b)||e("t",b,{}):a.t,f[d]=q,c)c[v](l)&&e(l,b,c[l]);return q}}function e(d,b,c){var e=b&&b!=a.id?a.sc[b]:a;e||(e=a.sc[b]={});"id"===d&&c&&(Q=1);return e[d]=c||e[d]}function R(d,b,c,e,f){c="on"+c;var l=b[c];"function"===typeof l?d&&(a.h[d]=l):l=function(){};b[c]=
function(a){f?(e(a),l(a)):(l(a),e(a))};b[c]&&(b[c].isUeh=1)}function S(m,b,c,q){function p(b,c){var d=[b],g=0,f={},l,h;c?(d.push("m=1"),f[c]=1):f=a.sc;for(h in f)if(f[v](h)){var q=e("wb",h),p=e("t",h)||{},n=e("t0",h)||a.t0,k;if(c||2==q){q=q?g++:"";d.push("sc"+q+"="+h);for(k in p)u(p[k])||null===p[k]||d.push(k+q+"="+(p[k]-n));d.push("t"+q+"="+p[m]);if(e("ctb",h)||e("wb",h))l=1}}!J&&l&&d.push("ctb=1");return d.join("&")}function l(b,c,g,e){if(b){var f=d.ue_err;d.ue_url&&!e&&b&&0<b.length&&(e=new Image,
a.iel.push(e),e.src=b,a.count&&a.count("postbackImageSize",b.length));if(w){var m=h.encodeURIComponent;m&&b&&(e=new Image,b=""+d.ue_fpf+m(b)+":"+(+new E-d.ue_t0),a.iel.push(e),e.src=b)}else a.log&&(a.log(b,"uedata",{n:1}),a.ielf.push(b));f&&!f.ts&&f.startTimer();a.b&&(f=a.b,a.b="",l(f,c,g,1))}}function A(b){var c=x?x.type:F,d=2==c||a.isBFonMshop,c=c&&!d,e=a.bfini;Q||(e&&1<e&&(b+="&bfform=1",c||(a.isBFT=e-1)),d&&(b+="&bfnt=1",a.isBFT=a.isBFT||1),a.ssw&&a.isBFT&&(a.isBFonMshop&&(a.isNRBF=0),u(a.isNRBF)&&
(d=a.ssw(a.oid),d.e||u(d.val)||(a.isNRBF=1<d.val?0:1)),u(a.isNRBF)||(b+="&nrbf="+a.isNRBF)),a.isBFT&&!a.isNRBF&&(b+="&bft="+a.isBFT));return b}if(!a.paused&&(b||u(c))){for(var k in c)c[v](k)&&e(k,b,c[k]);a.isBFonMshop||y("pc",b,c);k="ld"===m&&b&&e("wb",b);var s=e("id",b)||a.id;k||s===a.oid||(D=b,ba(s,(e("t",b)||{}).tc||+e("t0",b),+e("t0",b)));var s=e("id",b)||a.id,t=e("id2",b),g=a.url+"?"+m+"&v="+a.v+"&id="+s,J=e("ctb",b)||e("wb",b),z;J&&(g+="&ctb="+J);t&&(g+="&id2="+t);1<d.ueinit&&(g+="&ic="+d.ueinit);
if(!("ld"!=m&&"ul"!=m||b&&b!=s)){if("ld"==m){try{h[K]&&h[K].isUeh&&(h[K]=null)}catch(I){}if(h.chrome)for(t=0;t<L.length;t++)T(G,L[t]);(t=N.ue_backdetect)&&t.ue_back&&t.ue_back.value++;d._uess&&(z=d._uess());a.isl=1}a._bf&&(g+="&bf="+a._bf());d.ue_navtiming&&f&&(e("ctb",s,"1"),a.isBFonMshop||y("tc",F,F,M));!C||a.isBFonMshop||U||(f&&B(a.t,{na_:f.navigationStart,ul_:f.unloadEventStart,_ul:f.unloadEventEnd,rd_:f.redirectStart,_rd:f.redirectEnd,fe_:f.fetchStart,lk_:f.domainLookupStart,_lk:f.domainLookupEnd,
co_:f.connectStart,_co:f.connectEnd,sc_:f.secureConnectionStart,rq_:f.requestStart,rs_:f.responseStart,_rs:f.responseEnd,dl_:f.domLoading,di_:f.domInteractive,de_:f.domContentLoadedEventStart,_de:f.domContentLoadedEventEnd,_dc:f.domComplete,ld_:f.loadEventStart,_ld:f.loadEventEnd,ntd:("function"!==typeof C.now||u(M)?0:new E(M+C.now())-new E)+a.t0}),x&&B(a.t,{ty:x.type+a.t0,rc:x.redirectCount+a.t0}),U=1);a.isBFonMshop||B(a.t,{hob:d.ue_hob,hoe:d.ue_hoe});a.ifr&&(g+="&ifr=1")}y(m,b,c,q);var r,n;k||b&&
b!==s||ca(b);(c=d.ue_mbl)&&c.cnt&&!k&&(g+=c.cnt());k?e("wb",b,2):"ld"==m&&(a.lid=H(s));for(r in a.sc)if(1==e("wb",r))break;if(k){if(a.s)return;g=p(g,null)}else c=p(g,null),c!=g&&(c=A(c),a.b=c),z&&(g+=z),g=p(g,b||a.id);g=A(g);if(a.b||k)for(r in a.sc)2==e("wb",r)&&delete a.sc[r];z=0;a._rt&&(g+="&rt="+a._rt());c=h.csa;if(!k&&c)for(n in r=e("t",b)||{},c=c("PageTiming"),r)r[v](n)&&c("mark",da[n]||n,r[n]);k||(a.s=0,(n=d.ue_err)&&0<n.ec&&n.pec<n.ec&&(n.pec=n.ec,g+="&ec="+n.ec+"&ecf="+n.ecf),z=e("ctb",b),
"ld"!==m||b||a.markers?a.markers&&a.isl&&!k&&b&&B(a.markers,e("t",b)):(a.markers={},B(a.markers,e("t",b))),e("t",b,{}));a.tag&&a.tag().length&&(g+="&csmtags="+a.tag().join("|"),a.tag=P());n=a.viz||[];(r=n.length)&&(g+="&viz="+n.splice(0,r).join("|"));u(d.ue_pty)||(g+="&pty="+d.ue_pty+"&spty="+d.ue_spty+"&pti="+d.ue_pti);a.tabid&&(g+="&tid="+a.tabid);a.aftb&&(g+="&aftb=1");!a._ui||b&&b!=s||(g+=a._ui());a.a=g;l(g,m,z,k)}}function ca(a){var b=h.ue_csm_markers||{},c;for(c in b)b[v](c)&&y(c,a,F,b[c])}
function A(a,b,c){c=c||h;if(c[V])c[V](a,b,!1);else if(c[W])c[W]("on"+a,b)}function T(a,b,c){c=c||h;if(c[X])c[X](a,b,!1);else if(c[Y])c[Y]("on"+a,b)}function Z(){function a(){d.onUl()}function b(a){return function(){c[a]||(c[a]=1,S(a))}}var c={},e,f;d.onLd=b("ld");d.onLdEnd=b("ld");d.onUl=b("ul");e={stop:b("os")};h.chrome?(A(G,a),L.push(a)):e[G]=d.onUl;for(f in e)e[v](f)&&R(0,h,f,e[f]);d.ue_viz&&ue_viz();A("load",d.onLd);y("ue")}function ba(e,b,c){var f=d.ue_mbl,p=h.csa,l=p&&p("SPA"),p=p&&p("PageTiming");
f&&f.ajax&&f.ajax(b,c);l&&p&&(l("newPage",{requestId:e,transitionType:"soft"}),p("mark","transitionStart",b));a.tag("ajax-transition")}d.ueinit=(d.ueinit||0)+1;var a=d.ue=d.ue||{};a.t0=h.aPageStart||d.ue_t0;a.id=d.ue_id;a.url=d.ue_url;a.rid=d.ue_id;a.a="";a.b="";a.h={};a.s=1;a.t={};a.sc={};a.iel=[];a.ielf=[];a.viz=[];a.v="0.237017.0";a.paused=!1;var v="hasOwnProperty",G="beforeunload",K="on"+G,V="addEventListener",X="removeEventListener",W="attachEvent",Y="detachEvent",da={cf:"criticalFeature",af:"aboveTheFold",
fn:"functional",fp:"firstPaint",fcp:"firstContentfulPaint",bb:"bodyBegin",be:"bodyEnd",ld:"loaded"},E=h.Date,C=h.performance||h.webkitPerformance,f=(C||{}).timing,x=(C||{}).navigation,M=(f||{}).navigationStart,w=d.ue_fpf,Q=0,U=0,L=[],D=0,F;a.oid=H(a.id);a.lid=H(a.id);a._t0=a.t0;a.tag=P();a.ifr=h.top!==h.self||h.frameElement?1:0;a.markers=null;a.attach=A;a.detach=T;if("000-0000000-8675309"===d.ue_sid){var $=I("cdn-rid"),aa=I("session-id");$&&aa&&O($,aa,"cdn")}d.uei=Z;d.ueh=R;d.ues=e;d.uet=y;d.uex=
S;a.reset=O;a.pause=function(d){a.paused=d};Z()})(ue_csm,ue_csm.window,ue_csm.document);


ue.stub(ue,"log");ue.stub(ue,"onunload");ue.stub(ue,"onflush");
(function(b){var a=b.ue;a.cv={};a.cv.scopes={};a.cv.buffer=[];a.count=function(b,f,c){var e={},d=a.cv,g=c&&0===c.c;e.counter=b;e.value=f;e.t=a.d();c&&c.scope&&(d=a.cv.scopes[c.scope]=a.cv.scopes[c.scope]||{},e.scope=c.scope);if(void 0===f)return d[b];d[b]=f;d=0;c&&c.bf&&(d=1);ue_csm.ue_sclog||!a.clog||0!==d||g?a.log&&a.log(e,"csmcount",{c:1,bf:d}):a.clog(e,"csmcount",{bf:d});a.cv.buffer.push({c:b,v:f})};a.count("baselineCounter2",1);a&&a.event&&(a.event({requestId:b.ue_id||"rid",server:b.ue_sn||"sn",
obfuscatedMarketplaceId:b.ue_mid||"mid"},"csm","csm.CSMBaselineEvent.4"),a.count("nexusBaselineCounter",1,{bf:1}))})(ue_csm);



var ue_hoe = +new Date();
}
window.ueinit = window.ue_ihb;
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://www.amazon.in/dppui/www.amazon.in" title="Open URL: www.amazon.in (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://www.amazon.in/dppui/www.amazon.in" title="Open URL in Popup: www.amazon.in (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>

<!-- 4xu -->
<script>window.ue && ue.count && ue.count('CSMLibrarySize', 9765)</script><link rel="stylesheet" href="./BFO Page_files/11ZsAb1tv9L._RC_11B3-fvRFzL.css_.css">
<link rel="stylesheet" href="./BFO Page_files/11t2G06kU0L.css">
<script>
  (window.AmazonUIPageJS ? AmazonUIPageJS : P).load.js('https://images-eu.ssl-images-amazon.com/images/I/31cu23aPw1L.js?AUIClients/AmazonUICalendar');
  (window.AmazonUIPageJS ? AmazonUIPageJS : P).load.js('https://images-eu.ssl-images-amazon.com/images/I/616k0lTB8IL.js?AUIClients/MultiEmailControlAssets_AUIBuild');
  (window.AmazonUIPageJS ? AmazonUIPageJS : P).load.js('https://images-eu.ssl-images-amazon.com/images/I/21r3m5-l8mL.js?AUIClients/MakeLanguageMoreGood_AUIBuild');
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="./BFO Page_files/31cu23aPw1L.js" title="Open URL: https://images-eu.ssl-images-amazon.com/images/I/31cu23aPw1L.js?AUIClients/AmazonUICalendar (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="./BFO Page_files/31cu23aPw1L.js" title="Open URL in Popup: https://images-eu.ssl-images-amazon.com/images/I/31cu23aPw1L.js?AUIClients/AmazonUICalendar (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>
<script>
!(function() {
    if (!Function.prototype.bind) {
        Function.prototype.bind = function a_bind(ctx) {
            var self = this;
            return function() {
                return self.apply(ctx,Array.prototype.slice.call(arguments));
            }
        }
    }

    if (!Array.isArray) {
        Array.isArray = function(arg) {
            return Object.prototype.toString.call(arg) === '[object Array]';
        };
    }

    if (!Array.prototype.forEach) {
        Array.prototype.forEach = function(callback, thisArg) {
            var T, k;
            if (this === null) {
                throw new TypeError(' this is null or not defined');
            }
            var O = Object(this);
            var len = O.length >>> 0;
            if (typeof callback !== "function") {
                throw new TypeError(callback + ' is not a function');
            }
            if (arguments.length > 1) {
                T = thisArg;
            }
            k = 0;
            while (k < len) {
                var kValue;
                if (k in O) {
                    kValue = O[k];
                    callback.call(T, kValue, k, O);
                }
                k++;
            }
        };
    }
    if (!String.prototype.trim) {
        String.prototype.trim = function () {
            return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, '');
        };
    }

    // From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys
    if (!Object.keys) {
      Object.keys = (function() {
        'use strict';
        var hasOwnProperty = Object.prototype.hasOwnProperty,
            hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),
            dontEnums = [
              'toString',
              'toLocaleString',
              'valueOf',
              'hasOwnProperty',
              'isPrototypeOf',
              'propertyIsEnumerable',
              'constructor'
            ],
            dontEnumsLength = dontEnums.length;

        return function(obj) {
          if (typeof obj !== 'function' && (typeof obj !== 'object' || obj === null)) {
            throw new TypeError('Object.keys called on non-object');
          }

          var result = [], prop, i;

          for (prop in obj) {
            if (hasOwnProperty.call(obj, prop)) {
              result.push(prop);
            }
          }

          if (hasDontEnumBug) {
            for (i = 0; i < dontEnumsLength; i++) {
              if (hasOwnProperty.call(obj, dontEnums[i])) {
                result.push(dontEnums[i]);
              }
            }
          }
          return result;
        };
      }());
    }
})();
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys" title="Open URL: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys" title="Open URL in Popup: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script><script>
    P.when('A', 'jQuery', 'ready').register("PaySelectContextHelper", function(A, jQuery) {
        function updateWalletIdToPaymentPlanContext(data) {
            var paymentContext = jQuery("#paymentContext").data('payment-ctx');
            var walletIdList = paymentContext.walletIdList;
            if (walletIdList == null) {
                walletIdList = [];
            }
            walletIdList.push(data.walletId);
            paymentContext.walletIdList = walletIdList;
            jQuery("#paymentContext").data("payment-ctx", paymentContext);
        };

        return {
            updateWalletIdToPaymentPlanContext : updateWalletIdToPaymentPlanContext
        };
    });
</script><script type="text/javascript">
        P.when('jQuery','ready').execute(function(jQuery){
    jQuery.ajaxPrefilter(function(options, originalOptions, jqXHR){
        if (options['type'].toLowerCase() === "post") {
            var csrfToken = jQuery('meta[name="csrf-token"]').attr('content');
            var csrfTokenV2 = jQuery('meta[name="csrf-token-v2"]').attr('content');

            //As of now optimus-csrf-token does not exist.
            const optimusCsrfToken = jQuery('meta[name="optimus-csrf-token"]').attr('content');
            if(options.url.includes('/unified-payment/') && optimusCsrfToken) {
                console.log("setting CSRF header for optimus call");
                jqXHR.setRequestHeader('x-amzn-csrf', optimusCsrfToken);
            } else {
                if (csrfToken) {
                    console.log("setting CSRF header");
                    jqXHR.setRequestHeader('x-amzn-csrf', csrfToken);
                }
                if (csrfTokenV2) {
                    console.log("setting CSRF V2 header");
                    jqXHR.setRequestHeader('x-amzn-csrf-v2', csrfTokenV2);
                }
            }
        }
    });
});
P.when('jQuery', 'errorHandler', 'ready').execute(function(jQuery, errorHandler){
    jQuery.ajaxSetup({
        error: function(x, status, error) {
            if (x.status == 401) {
                errorHandler.showError(errorHandler.CSRF_VALIDATION_ERROR);
            } else if (x.status == 403 && x.getResponseHeader("AuthUrl") != null) {
                errorHandler.redirectToLocation(x.getResponseHeader("AuthUrl"));
            }
        }
    });
});/**
 * @summary: A common file/place to define all the constants used in PSP.
 * @author:  jitendra@
 * @since:   07/04/2017
 * @access:  public
 *
 * @file:    Constants.js
 */
P.declare("DPPUIConstants",   {
    ErrorCodes: {
        NULL_REFERENCE: "NULL-REFERENCE",
        INVALID_TYPE:   "INVALID-TYPE",
        EVENT_MANAGER_UNDEFINED:   "EVENT-MANAGER-UNDEFINED",
        DATA_LAYER_UNDEFINED:   "DATA-LAYER-UNDEFINED"
    },

    SleeveNames: {
        SAVED_CARDS:    "Saved-Cards",
        NET_BANKING:    "Net-Banking",
        ALI_PAY:        "Ali-Pay",
        MCB:            "MCB",
        GIFT_CARDS:     "Gift-Cards",
        PRODUCTS:       "Products-Details",
        PRICE_SUMMARY:  "Price-Summary",
        BALANCES:       "Balances",
        LOC:            "LOC",
        DIGITAL_WALLET: "DigitalWallet",
        IDEAL:          "Ideal",
        UNKNOWN:        "UNKNOWN"
    },

    KEYCODES: {
        ZERO_NUMERIC_KEY:   "48",
        NINE_NUMERIC_KEY:   "57",
        ZERO_NUM_PAD_KEY:   "96",
        NINE_NUM_PAD_KEY:   "105",
        BACKSPACE:          "8",
        DELETE:             "46",
        TAB:                "9",
        ENTER:              "13",
        HOME:               "36",
        END:                "35",
        LEFT_ARROW:         "37",
        RIGHT_ARROW:        "39",
        DOWN_ARROW:         "40",
        UP_ARROW:           "38"
    },

    PaymentMethodType: {
        CARD:                       "Card",
        CARD_REDIRECT:              "CardRedirect",
        NETBANKING:                 "Netbanking",
        AMAZON_PAY:                 "AmazonPay",
        GIFT_CARD:                  "GiftCard",
        AMAZON_POINTS:              "AmazonPoints",
        WE_CHAT:                    "WeChat",
        WE_CHAT_CONTRACT_PAY:       "WeChatContractPay",
        ALI_PAY:                    "AliPay",
        UNIFIED_PAYMENTS_INTERFACE: "UnifiedPaymentsInterface",
        SAVED_UNIFIED_PAYMENTS_INTERFACE : "SavedUnifiedPaymentsInterface",
        BANK_ACCOUNT:               "BankAccount",
        BOLETO:                     "Boleto",
        LINE_OF_CREDIT:             "LineOfCredit",
        DIGITAL_WALLET:             "DigitalWallet",
        PIX:                        "Pix",
        IDEAL:                      "Ideal",
        UNKNOWN:                    "UNKNOWN"
    },

    EventTypes: {
        PAYMENT_WORKFLOW_COMPLETED:         "PaymentWorkflowCompleted",
        PAYMENT_METHODS_SHOWN:              "PaymentMethodsShown",
        PAYMENT_METHOD_SELECTED:            "PaymentMethodSelected",
        PAYMENT_METHOD_DESELECTED:          "PaymentMethodDeselected",
        PAYMENT_METHOD_ADDED:               "PaymentMethodAdded",
        ADD_PAYMENT_METHOD_FORM_SHOWN:      "AddPaymentMethodFormShown",
        ADD_PAYMENT_METHOD_FORM_HIDDEN:     "AddPaymentMethodFormHidden",
        ADD_PAYMENT_METHOD_FORM_SUBMITTED:  "AddPaymentMethodFormSubmitted",
        ADD_PAYMENT_METHOD_INVALID_DETAILS: "AddPaymentMethodInvalidDetails",
        PYO_CARD_STATUS_CHANGED:            "PyoCardStatusChanged",
        PRODUCT_SELECTOR_SHOWN:             "ProductSelectorShown",
        PRODUCT_SELECTED:                   "ProductSelected",
        POPUP_SHOWN:                        "PopupShown",
        UPDATE_PAYMENT_METHODS_LIST:        "UpdatePaymentMethodsList",
        AJAX_FAILURE:                       "AjaxFailure",
        SET_PREFERRED_OPTION_SELECTED:      "SetPreferredOptionSelected",
        SET_PREFERRED_OPTION_DESELECTED:    "SetPreferredOptionDeselected",
        SHOW_NON_PREFERRED_OPTION:          "ShowNonPreferredOption",
        PLACE_ORDER:                        "PlaceOrder",
        PLACE_ORDER_SET_PREFERRED_OPTION_SELECTED:      "PlaceOrderSetPreferredOptionSelected",
        PLACE_ORDER_SET_PREFERRED_OPTION_DESELECTED:    "PlaceOrderSetPreferredOptionDeselected",
        PLACE_ORDER_NEW_PREFERRED_OPTION:   "PlaceOrderNewPreferredOption",
        PLACE_ORDER_IN_CONTRACT_SIGN_PAGE:  "PlaceOrderInContractSignPage",
        SIGN_CONTRACT:                      "SignContract",
        SHOW_CONTRACT_QR_CODE:              "ShowContractQrCode",
        BALANCE_TOPUP_INTENT:               "BalanceTopupIntent",
        BALANCE_TOPUP_BOTTOM_SHEET_SHOWN:   "BalanceTopupBottomSheetShown",
        BALANCE_TOPUP_BOTTOM_SHEET_CLOSED:  "BalanceTopupBottomSheetClosed",
        BALANCE_TOPUP_SKIPPED:              "BalanceTopupSkipped",
        BALANCE_TOPUP_TILE_TOGGLED:         "BalanceTopupTileToggled",
        BALANCE_TOPUP_AMOUNT_ENTERED:       "BalanceTopupAmountEntered",
        BALANCES_REFRESHED:                 "BalancesRefreshed",
        UPI_THIRD_PARTY_HANDLE_VALIDATION:  "UPIThirdPartyHandleValidation",
        UPI_SAVED_HANDLE_PIN_CHOSEN:        "UPISavedHandlePinChosen",
        UPI_SAVED_HANDLE_ERROR:             "UPISavedHandleError",
    },

    Frequency: {
        NONE:       0, //0x0000
        MONTHLY:    1, //0x0001
        YEARLY:     2  //0x0010
    },

    LocalDataKey: {
        CONTRACT_SIGN_DATA_KEY: "amz-psp-contract-sign-data" //This data is carried over from psp page to contract sign page.
    },

    Contract : {
        QR_TYPE: "CONTRACT"
    },

    AddressTypes : {
        BILLING_ADDRESS : "BILLING_ADDRESS",
        SHIPPING_ADDRESS : "SHIPPING_ADDRESS"
    }
});
/**
 * @summary: A common file/place to define all the Globally used Treatment in PSP.
 * @purpose: Singleton for setting globalTreatments
 */

P.declare("DPPUITreatments",   {
    _treatmentMap : {},

    getTreatment : function(name) {
        if(this._treatmentMap.hasOwnProperty(name)){
            return this._treatmentMap[name];
        }
        return null;
    },

    setTreatment : function(name, value) {
        if(!this._treatmentMap[name]){
            this._treatmentMap[name] = value;
        }
    }
});<!-- This is a dummy file for including js via viewresolver -->
/**
 * @summary: A Javascript Class to support communication mechanism among several modules/components.
 * @purpose:  Global lightweight class that supports event broadcast, subscribe and unsubscribe
 * @author:  jitendra@
 * @since:   07/29/2017
 * @access:  public
 *
 * @class:   EventManagerClass
 * @file:    EventManager.js
 *
 * @depends-on:
 *  A - to create a class
 */

P.when('A', 'ready').execute(function(A){

    // Create a new class
    var EventManagerClass = A.createClass({
        eventManagerMap:null,   // map to manage event subscribers
        useMainExecution:false, // configuration to block main execution or not

        /**@summary: constructor
         * @actual-scope:   public
         * @expected-scope: public
         * @method: init
         * @param:  void
         * @returns: void
         */
        init: function() {
            this.eventManagerMap = {};
            this.useMainExecution = false;
        },

        /**@summary: Subscribes an eventHandler to an event
         * @actual-scope:   public
         * @expected-scope: public
         * @method: subscribe
         * @param:  context Mixed/Object, Any object
         * @param:  String eventName, Name of the event to be subscribed
         * @param:  Function eventHandler, callBack function to be called when eventName is broadcasted
         * @returns: void
         */
        subscribe: function (context, eventName, eventHandler) {
            // Type checks for eventName and eventHandler
            if (typeof eventName === 'string' && eventHandler instanceof Function) {
                // First time event appeared, No Map Entry Exists
                if (!this.eventManagerMap[eventName]) {
                    //Create a map entry with Empty Subscribers
                    this.eventManagerMap[eventName] = [];
                }

                //Push a new subscriber with passed context and eventHandler
                //Intentionally, not checking if the same handler is already subscribed, assume that user may subscribe multiple times.
                this.eventManagerMap[eventName].push({context:context, eventHandler:eventHandler});

            } else if (!(eventHandler instanceof Function)) {
                //eventHandler is not type of Function, throw exception
                throw "Invalid or missing event handler while subscribing an event";
            } else {
                //eventName is not type of String, throw exception
                throw "Invalid or missing event name while subscribing an event";
            }
        },

        /**@summary: Un-subscribes a subscribed eventHandler to an event
         * @actual-scope:   public
         * @expected-scope: public
         * @method: unsubscribe
         * @param:  String eventName, Name of the event to be subscribed
         * @param:  Function eventHandler, callBack function to be called when eventName is broadcasted
         * @returns: void
         */
        unsubscribe: function (eventName, eventHandler) {
            // Type checks for eventName and eventHandler
            if (typeof eventName === 'string' && eventHandler instanceof Function) {
                // Event appeared earlier, Map Entry Exists
                if (this.eventManagerMap[eventName]) {
                    // Get the subscribers list
                    var subscribers = this.eventManagerMap[eventName];
                    // Get the count of the subscribers
                    var nCount = (subscribers instanceof Array) ? subscribers.length : 0;

                    //Iterate through all subscribers
                    for (var x = 0; x < nCount; x++) {
                        //Compare the eventHandler to be unsubscribed
                        if (subscribers[x].eventHandler === eventHandler) {
                            // Found the first subscribed eventHandler, removing it from the list
                            subscribers.splice(x, 1);
                            // Found the first subscribed eventHandler, stop iteration
                            break;
                        }
                    }
                }
            } else if (!(eventHandler instanceof Function)) {
                //eventHandler is not type of Function, throw exception
                throw "Invalid or missing event handler while unsubscribing an event";
            } else {
                //eventName is not type of String, throw exception
                throw "Invalid or missing event name while unsubscribing an event";
            }
        },

        /**@summary: Broadcasts a subscribed event to the subscribed eventHandlers
         * @actual-scope:   public
         * @expected-scope: public
         * @method: broadcast
         * @param:  String eventName, Name of the event to be subscribed as first argumens
         * @param:  Mixed eventData, Event Data to be passed to event handlers
         * @param:  Mixed Mixed, Any number of arguments can be sent, first two are mandatory
         * @returns: void
         */
        broadcast: function () {
            // Fetch the list of all arguments of the method
            var args = arguments;
            //Assuming first argument is eventName
            var eventName = arguments[0];

            // Type checks for eventName
            if (typeof eventName === 'string') {
                // Event appeared earlier, Map Entry Exists
                if (this.eventManagerMap[eventName]) {
                    // Get the subscribers list
                    var subscribers = this.eventManagerMap[eventName];
                    // Get the count of the subscribers
                    var nCount = (subscribers instanceof Array) ? subscribers.length : 0;

                    // Check if main execution block to be used or not
                    if(this.useMainExecution === false) {
                        // Initiate a timer (timeOut) to avoid execution in main execution block
                        setTimeout(function () {
                                //Iterate through all subscribers
                                for (var x = 0; x < nCount; x++) {
                                    // Invoke each subscriber will all parameters as it is
                                    subscribers[x].eventHandler.apply(subscribers[x].context, args);
                                }
                            }, 0);
                    } else {
                        //Iterate through all subscribers and invoke them in the main execution block
                        for (var x = 0; x < nCount; x++) {
                            // Invoke each subscriber will all parameters as it is
                            subscribers[x].eventHandler.apply(subscribers[x].context, args);
                        }
                    }
                }
            } else {
                //eventName is not type of String, throw exception
                throw "Invalid or missing event name while broadcasting an event";
            }
        },

        /**@summary: Execute a subscribed event to the subscribed eventHandlers
         * @actual-scope:   public
         * @expected-scope: public
         * @method: execute
         * @param:  String eventName, Name of the event to be subscribed as first arguments
         * @param:  Mixed eventData, Event Data to be passed to event handlers
         * @param:  Mixed Mixed, Any number of arguments can be sent, first two are mandatory
         * @returns: void
         */
        execute: function () {
            // Fetch the list of all arguments of the method
            var args = arguments;
            //Assuming first argument is eventName
            var eventName = arguments[0];
            // Type checks for eventName
            if (typeof eventName === 'string') {
                // Event appeared earlier, Map Entry Exists
                if (this.eventManagerMap[eventName]) {
                    // Get the subscribers list
                    var subscribers = this.eventManagerMap[eventName];
                    // Get the count of the subscribers
                    var nCount = (subscribers instanceof Array) ? subscribers.length : 0;
                    //Iterate through all subscribers and invoke them in the main execution block
                    for (var x = 0; x < nCount; x++) {
                        // Invoke each subscriber will all parameters as it is
                        subscribers[x].eventHandler.apply(subscribers[x].context, args);
                    }
                }
            } else {
                //eventName is not type of String, throw exception
                throw "Invalid or missing event name while broadcasting an event";
            }
        }
    });

    // Create an instance/object of EventManagerClass
    var eventManager = new EventManagerClass();

    // Declare this object, so that it can be consumed
    P.declare("EventManagerObject", eventManager);
});
/**
 * @summary: A Javascript Class to Post Data from client to server.
 * @purpose:  Capture client side data for PSR
 * @author:  jitendra@
 * @since:   07/29/2017
 * @access:  public
 *
 * @class:   ClientDataSenderClass
 * @file:    ClientDataSender.js
 *
 * @depends-on:
 *  A - to create a class
 *  jQuery - to make ajax call
 *  EventManagerObject - to subscribe events
 *
 * @listens-events
 *      CDSEvents.ADD_EVENT_DATA
 *      CDSEvents.UPDATE_TRANSFORM_MAP
 */

P.declare("CDSEvents", { ADD_EVENT_DATA:"CDS-ADD-EVENT-DATA", UPDATE_TRANSFORM_MAP:"CDS-UPDATE-TRANSFORM-MAP" });

P.when('A', 'jQuery', 'EventManagerObject', 'CDSEvents', 'ready').execute(function(A, jQuery, EventManagerObject, CDSEvents) {

    // Create a new class
    var ClientDataSenderClass = A.createClass({
        firstTime:new Date(),   // Static member firstTime to capture the timeStamp whenever it is executed first time
        timerId:0,              // Timer Id to track the current running timer to post data to server (Default timer)
        pendingBatches:null,    // Array of queues pending for posting data to server
        currentDataArray:null,  // Current queue to collect the data
        initialLoadTime:0,      // Initial timeStamp when an object is created
        serverURL:"",           // Server URL, where data will be posted, must be configured
        timeInterval:5000,      // Time Interval to wait for posting the data if batch size limit is not crossed
        batchSize: 100,         // Max Batch size for posting the data overrules and resets the timeInterval, if batch size limit is crosses
        autoCheckTimerId:0,     // Timer Id to track if any events are added. Useful when page is idle and no events are being reported/captured (NoEventData timer)
        autoCheckInterval:0,    // Time interval to check is events are added after the last checking time
        transformationMap:null, // Data transformation map, to be provided by the owner
        pageName:"",            // Page Name
        lastEventTimeStamp:null,// When last event was provided/aded by the page through subscribed event
        eventNames:{},          // Constants needed within this class
        pageActive:true,
        pageStateTimeStamp:null,
        CUSTOM_EVENT_TRANSFORMATION_MAP_KEY : "CustomEvent",
        clickCount:0,

        /**@summary: constructor
         * @actual-scope:   public
         * @expected-scope: public
         * @method: init
         * @param:  void
         * @returns: void
         */
        init : function () {

            /* initializing default values to all member variables */
            this.timerId = 0;
            this.pendingBatches = [];
            this.currentDataArray = [];
            this.initialLoadTime = new Date();
            this.serverURL = "";
            this.timeInterval = 5000;
            this.batchSize=100;
            this.autoCheckTimerId = 0;
            this.autoCheckInterval = 60000;
            this.transformationMap = {};
            this.subscribeEvents();
            this.eventNames = {
                            CDS_INITIALIZE: "CDSInitialized",
                            WINDOW_BEFORE_UNLOAD: "PageUnloading",
                            WINDOW_UNLOAD: "PageUnloaded",
                            PAGE_IDLE: "PageIdle",
                            BATCH_LIMIT: "SubmitBatchSize",
                            TIME_INTERVAL: "SubmitBatchTime",
                            PAGE_ACTIVATE: "PageActive",
                            PAGE_DEACTIVATE: "PageInactive"
                     };
            this.lastEventTimeStamp = this.initialLoadTime;
            this.pageActive = true;
            this.pageStateTimeStamp = this.initialLoadTime;
            this.clickCount = 0;
        },

        /**@summary: initializes and activates the instance of ClientDataSenderClass
         * @actual-scope:   public
         * @expected-scope: public
         * @method: initialize
         * @param:  Object configData, the object containing the configuration data
         *      @sub-param: String  url,        Url where data is to be posted
         *      @sub-param: integer batchSize,  Maximum number of event-data objects to be sent in a batch (one post request)
         *      @sub-param: integer interval,   Time interval in milli seconds, after which the data will be posted to server
         * @returns: void
         */
         initialize: function (configData) {
            if(!configData) return;
            var serverURL = configData.url.trim();
            if(serverURL && serverURL.length > 0) {
                this.serverURL = serverURL;
                this.batchSize = configData.batchSize ? (configData.batchSize) : this.batchSize;
                this.timeInterval = configData.interval ? (configData.interval) : this.timeInterval;
                this.attachEventHandlers();
                this.updateTransformationMap(this.CUSTOM_EVENT_TRANSFORMATION_MAP_KEY, this.transformCustomEvent);
                this.postData(this.eventNames.CDS_INITIALIZE, new Date());
            }
        },

        /**@summary: Posts the currently accumulated data and stops timer in case bFinalUnload is true
         * @actual-scope:   public
         * @expected-scope: private
         * @method: onWindowUnload
         * @param:  Object  eventData,   Default event data passed on onbeforeunload event
         *      @sub-param: Default event params.
         * @param:  timeStamp Date,   TimeStamp of the event
         * @param:  bFinalUnload bool,   true, only if actual window unload
         * @returns: void
         */
        onWindowUnload: function (eventData, timeStamp, bFinalUnload) {
            if(bFinalUnload) {
                // Post the currently accumulated data and create new current queue
                this.postData(this.eventNames.WINDOW_UNLOAD, timeStamp, false);
                this.timerId = this.resetTimer(this.timerId, false);
                this.autoCheckTimerId = this.resetTimer(this.autoCheckTimerId, false);
            } else {
                // Post the currently accumulated data and create new current queue
                this.postData(this.eventNames.WINDOW_BEFORE_UNLOAD, timeStamp);
            }
        },

        /**@summary: Posts the currently accumulated data and stops timer in case bFinalUnload is true
         * @actual-scope:   public
         * @expected-scope: private
         * @method: onWindowUnload
         * @param:  Object  eventData,   Default event data passed on onbeforeunload event
         *      @sub-param: Default event params.
         * @param:  timeStamp Date,   TimeStamp of the event
         * @param:  bFinalUnload bool,   true, only if actual window unload
         * @returns: void
         */
        onWindowActivate: function (eventData, timeStamp, bActivate) {
            this.pageActive = bActivate;
            if(bActivate) {
                // Post the currently accumulated data and create new current queue
                this.postData(this.eventNames.PAGE_ACTIVATE, timeStamp);
            } else {
                // Post the currently accumulated data and create new current queue
                this.postData(this.eventNames.PAGE_DEACTIVATE, timeStamp);
            }
            this.pageStateTimeStamp = timeStamp;
        },

        /**@summary: Subscribes the required events
         * @actual-scope:   public
         * @expected-scope: private
         * @method: subscribeEvents
         * @param:  void
         * @returns:void
         */
        subscribeEvents: function () {
            EventManagerObject.subscribe(this, CDSEvents.ADD_EVENT_DATA, this.addData);
            EventManagerObject.subscribe(this, CDSEvents.UPDATE_TRANSFORM_MAP, this.updateTransformationMapEntries);
        },

        /**@summary: Attaches the handlers to window unload events and starts required timers
         * @actual-scope:   public
         * @expected-scope: private
         * @method: attachEventHandlers
         * @param:  void
         * @returns:void
         */
        attachEventHandlers: function () {
            // Save reference of the current instance/object of the class
            var self = this;

            // Attaching handler to onbeforeunload event of window
            window.onbeforeunload = function(data) {
                // Calling onWindowUnload of the current instance/object with default data, timestamp and bFinalUnload false
                self.onWindowUnload(data, new Date(), false);
            };

            // Attaching handler to onunload event of window
            window.onunload = function(data) {
                // Calling onWindowUnload of the current instance/object with default data, timestamp and bFinalUnload true
                self.onWindowUnload(data, new Date(), true);
            };

            // Attaching handler to onblur event of window
            window.onblur = function(data){
                // Calling onWindowActivate of the current instance/object with default data, timestamp and bActivate false
                self.onWindowActivate(data, new Date(), false);
            }

            // Attaching handler to onfocus event of window
            window.onfocus = function(data){
                // Calling onWindowActivate of the current instance/object with default data, timestamp and bActivate true
                self.onWindowActivate(data, new Date(), true);
            }

            // Attaching handler to onclick event of document
            document.onclick = function(data) {
                // Increasing the ClickCount
                self.clickCount++;
            }

            // Reset and Start Default timer with postData callback i.e this.postData(this.eventNames.TIME_INTERVAL, new Date());
            this.timerId = this.resetTimer(this.timerId, true, this.timeInterval, this.postData, this, this.eventNames.TIME_INTERVAL);

            // Reset and Start NoEventData timer with checkPageIdle callback i.e this.checkPageIdle(this.eventNames.PAGE_IDLE, new Date());
            this.autoCheckTimerId = this.resetTimer(this.autoCheckTimerId, true, this.autoCheckInterval, this.checkPageIdle, this, this.eventNames.PAGE_IDLE);
        },

        /**@summary: Resets and Starts a timer
         * @actual-scope:   public
         * @expected-scope: private
         * @method: resetTimer
         * @param:  integer timerId,    Timer id of existing running timer
         * @param:  bool    bStart,     Restart the timer
         * @param:  integer interval,   Time interval in milliseconds for the timer to be restarted
         * @param:  Function callBack,  CallBack Function for the timer to be restarted
         * @param:  context Mixed,      Any object, expected object/instance of ClientDataSenderClass
         * @param:  String eventName,   Event name to be passed to the callback method
         * @returns: integer timerId,   New Timer id if bStart is true, else 0
         */
        resetTimer: function(timerId, bStart, interval, callBack, context, eventName) {
            // Stop the timer if running (assume 0 as not running)
            if(timerId != 0) {
                clearInterval(timerId);
                timerId = 0;
            }

            //Start the timer again if bStart is true
            if(bStart) {
                timerId = setInterval(function() {
                    callBack.apply(context, [eventName, new Date()]);
                }, interval);
            }

            //returns the timer id
            return timerId;
        },

        /**@summary: Checks and posts an event Data mentioning NO EventData in case the last event timestamp was posted before the threshold time limit (this.autoCheckInterval)
         * @actual-scope:   public
         * @expected-scope: private
         * @method: checkPageIdle
         * @param:  String eventName, Event Name, pass through to postData (Expected always as this.eventNames.PAGE_IDLE)
         * @param:  Date timeStamp, timeStamp when event occurred
         * @returns: void
         */
        checkPageIdle: function(eventName, timeStamp) {
            // Safe check for timeStamp
            timeStamp = timeStamp? timeStamp:new Date();

            //Check if threshold time (this.autoCheckInterval) is crossed
            if(timeStamp.getTime() - this.lastEventTimeStamp.getTime() > this.autoCheckInterval) {
                //Set the last event added time
                // It is not needed as we need to track total idle time since last event
                //this.lastEventTimeStamp = timeStamp;

                // Post the currently accumulated data and create new current queue
                this.postData(eventName, timeStamp);
            } else {
                // Ignore as threshold limit is not crossed and let the timer continue
            }
        },

        /**@summary: Posts the first pending batch in this.pendingBatches Queue.
         * @actual-scope:   public
         * @expected-scope: private
         * @method: postFirstPendingBatch
         * @param:  void
         * @returns: void
         */
        postFirstPendingBatch:function (bAsync) {
            //Check if pending Batches Queue is defined and it contains a batch
            if(this.pendingBatches != null && this.pendingBatches.length > 0) {

                // Save reference of the current instance/object of the class
                var self = this;

                var data = {events : this.pendingBatches[0]};
                // Prepare the request Data,
                var requestData = {
                    url: this.serverURL, // Sets the URL
                    type: "POST",
                    data: JSON.stringify(data), // Posts the first batch in the queue
                    contentType: 'application/json',
                    async : (typeof bAsync !== 'undefined') ? bAsync : true
                };

                // Make Ajax Call using jQuery
                var ajaxRequest = jQuery.ajax(requestData);

                // Ajax Request Success Handler
                ajaxRequest.done (function(response) {
                    // Call Ajax Request Handler of the current instance/Object with actual response and bSuccess =  true
                    self.handleAjaxResponse(response, true);
                });

                // Ajax Request Failure Handler
                ajaxRequest.fail (function(response) {
                    // Call Ajax Request Handler of the current instance/Object with actual response and bSuccess =  false
                    self.handleAjaxResponse(response, false);
                });
            }
        },

        /**@summary: Handles Response of Ajax Call
         * @actual-scope:   public
         * @expected-scope: private
         * @method: handleAjaxResponse
         * @param:  Mixed/Object responseData, Response data of Ajax Call
         * @param:  bool bSuccess, request Status, successful or failure
         * @returns: void
         */
        handleAjaxResponse: function(responseData, bSuccess) {
            if(bSuccess) {
                //TODO Check if call to server was successful but server responded back as error
                if(responseData.error == null) {

                } else {
                    // Do nothing, let the next post data request come based on the timer or batch size limit cross
                }

                // Remove the currently processed batch, first batch
                this.pendingBatches.splice(0, 1);

                // Post Next First Pending Batch
                this.postFirstPendingBatch();

            } else {
                // Ignore as of now
            }
        },

        /**@summary: Posts the currently accumulated data and creates a new queue for current processing
         * @actual-scope:   public
         * @expected-scope: private
         * @method: postData
         * @param:  String eventName, Event Name
         * @param:  Date timeStamp, timeStamp when event occurred
         * @returns: void
         */
        postData:function (eventName, timeStamp, bAsync) {
            // Get the event data for the passed custom eventName
            var eventData = this.getCustomEventData(eventName, timeStamp);

            // Get the transformed data
            var finalData = this.transformData(eventData);

            // Push the custom event data into current Queue
            this.currentDataArray.push(finalData);

            // Push the current Queue into Pending batches/queue
            this.pendingBatches.push(this.currentDataArray);

            // Reinitialize the current queue
            this.currentDataArray = [];

            // Reset and Start Default timer with postData callback i.e this.postData(this.eventNames.TIME_INTERVAL, new Date());
            this.timerId = this.resetTimer(this.timerId, true, this.timeInterval, this.postData, this, this.eventNames.TIME_INTERVAL);

            console.log("ClientDataSender postData: Event Name: " + eventName, ", Total Batches:" + this.pendingBatches.length + ", InFirst:" + this.pendingBatches[0].length);
            // Post Next First Pending Batch
            this.postFirstPendingBatch(bAsync);
        },

        /**@summary: Listener of DSEvents.ADD_EVENT_DATA, Adds an event data to the current queue
         * @actual-scope:   public
         * @expected-scope: private/public
         * @method: addData
         * @param:  String eventName, Event Name
         * @param:  Mixed/Object eventData, Event Data passed by the external module as part of CDSEvents.ADD_EVENT_DATA event
         * @returns: void
         */
        addData: function (eventName, eventData) {
            // Capture current timeStamp for the passed data
            var timeStamp = new Date();

            // Get the transformed data
            var finalData = this.transformData(eventData);

            //Add the timeStamp to the data
            finalData.timeStamp = timeStamp.getTime();

            //Push the data to current Queue/Array
            this.currentDataArray.push(finalData);

            //Check if Current Queue size crossed the batch size limit
            if (this.batchSize <  this.currentDataArray.length) {
                this.postData(this.eventNames.BATCH_LIMIT);
            }

            //Set the last event added time
            this.lastEventTimeStamp = timeStamp;
        },

        /**@summary: Listener of DSEvents.UPDATE_TRANSFORM_MAP, Updates the data transformation map
         * @actual-scope:   public
         * @expected-scope: private/public
         * @method: updateTransformationMapEntries
         * @param:  String eventName, Event Name
         * @param:  Array eventData, Array of Event Data passed by the external module as part of CDSEvents.UPDATE_TRANSFORM_MAP event
         *      @sub-param:  String key, Key for the data Transformation Map Entry
         *      @sub-param:  Function method, Method for transforming the data if it belongs to the passed key.
         * @returns: void
         */
        updateTransformationMapEntries: function (eventName, eventData) {
            // Safe Check and Type Check
            if(eventData != null && eventData instanceof Array){
                // Get the object count in the passed Array
                var nCount = eventData.length;

                // Iterate each object
                for (var x = 0; x < nCount; x++) {
                    // Check is object has both properties 'key' and 'method'
                    if (eventData[x].key != null && eventData[x].method != null) {
                        // Call another method to update the map entry
                        this.updateTransformationMap(eventData[x].key, eventData[x].method)
                    }
                }

            } else {
                throw "CDS: Invalid or missing event data with CDSEvents.UPDATE_TRANSFORM_MAP event";
            }
        },

        /**@summary: Updates the data transformation map for the given key and method
         * @actual-scope:   public
         * @expected-scope: private/public
         * @method: updateTransformationMap
         * @param:  String transformKey, Key for the data Transformation Map Entry
         * @param:  Function transformMethod, Method for transforming the data
         * @returns: void
         */
        updateTransformationMap: function(transformKey, transformMethod) {
            //Check transformMethod and its type
            if(transformMethod && transformMethod instanceof Function) {
                // Safe Check
                if(this.transformationMap != null) {
                    // Check if transform method is not available for the provided key
                    if(this.transformationMap[transformKey] == null) {
                        // Save the transform method for the provided key
                        this.transformationMap[transformKey] = transformMethod;
                    } else {
                        // Throw exception that transform method is already exists for the provided key
                        throw "CDS: transform method already exists for key:" + transformKey;
                    }
                }
            } else {
                // Throw exception that transform method invalid ot missing
                throw "CDS: Invalid or missing transform method in CDSEvents.UPDATE_TRANSFORM_MAP event data";
            }
        },

        /**@summary: Transforms the data if transformation map contains key and transformation method
         * @actual-scope:   public
         * @expected-scope: private
         * @method: transformData
         * @param:  Mixed/Object eventData,
         *      @sub-param:  String key, Key for the data Transformation Map Entry
         *      @sub-param:  Mixed/Object multiple properties
         * @returns: Mixed/Object transformedData, transformed data object
         */
        transformData: function (eventData) {
            // Set the default value as same passed data
            var transformedData = eventData;
            // Check if map, key and respective method are defined
            if(this.transformationMap != null && eventData.key != null && this.transformationMap[eventData.key] != null) {
                //Double check the type of the transformMethod
                if(this.transformationMap[eventData.key] instanceof Function) {
                    // Get the transformed data by calling the transform method with current event data
                    transformedData = this.transformationMap[eventData.key].apply(null, [eventData]);
                }
            }
            //return the transformed/same data
            return transformedData;
        },

        transformCustomEvent : function (eventData) {
            var transformedData = {};
            transformedData.eventName = eventData.eventName;
            transformedData.timeStamp = eventData.timeStamp;
            transformedData.additionalData = JSON.stringify({pageActive : eventData.pageActive, startTime : eventData.startTime,  totalTime : eventData.totalTime});
            transformedData.value = eventData.clickCount;
            return transformedData;
        },

        /**@summary: Generates data for the custom events of ClientDataSenderClass
         * @actual-scope:   public
         * @expected-scope: private
         * @method: getCustomEventData
         * @param:  String eventName, Event Name
         * @param:  Date timeStamp, timeStamp when event occurred
         * @returns: Mixed/Object customData, Custom event data object
         */
        getCustomEventData: function (eventName, timeStamp) {
            // Safe check for timeStamp
            timeStamp = timeStamp? timeStamp:new Date();

            // Initialize the data with default values
            var customData = {eventName: eventName, timeStamp: timeStamp.getTime(), pageActive: this.pageActive, key : this.CUSTOM_EVENT_TRANSFORMATION_MAP_KEY, clickCount: this.clickCount};
            this.clickCount = 0;

            switch (eventName) {
                case this.eventNames.WINDOW_BEFORE_UNLOAD:
                    // Calculate the total time spend on the page
                    customData.totalTime = timeStamp.getTime() - this.firstTime.getTime();
                    break;
                case this.eventNames.WINDOW_UNLOAD:
                    // Calculate the total time spend on the page
                    customData.totalTime = timeStamp.getTime() - this.firstTime.getTime();
                    break;
                case this.eventNames.PAGE_IDLE:
                    // Calculate the total idle time since last reported action
                    customData.totalTime = timeStamp.getTime() - this.lastEventTimeStamp.getTime();
                    break;
                case this.eventNames.PAGE_ACTIVATE:
                    customData.startTime = this.pageStateTimeStamp.getTime();
                    // Calculate the total inactive time since last deactivate action
                    customData.totalTime = timeStamp.getTime() - this.pageStateTimeStamp.getTime();
                    break;
                case this.eventNames.PAGE_DEACTIVATE:
                    customData.startTime = this.pageStateTimeStamp.getTime();
                    // Calculate the total active time since last activate action
                    customData.totalTime = timeStamp.getTime() - this.pageStateTimeStamp.getTime();
                    break;
                case this.eventNames.BATCH_LIMIT:
                    break;
                case this.eventNames.TIME_INTERVAL:
                    break;
                default:
                    break;
            }
            return customData;
        }
    });

    // Create an instance/object of ClientDataSenderClass
    var clientDataSender = new ClientDataSenderClass();

    // Declare this object, so that it can be consumed
    P.declare("ClientDataSenderObject", clientDataSender);
});
/**
 * Data store Event names.
 */
P.declare("DataStoreEventNames", {
    BANK_PAGE_LOAD_EVENT: "BankPageLoadEvent",
    THIRD_PARTY_REDIRECT_UNLOADED_EVENT: "ThirdPartyRedirectUnloadedEvent"
});

/**
 * Event attributes for data store events.
 */
P.declare("EventActionAttributeKeys", {
    AUTHENTICATION_SOURCE_ID: "AuthenticationSourceId",
    ORDER_ID: "OrderId",
    SUBSCRIPTION_ID: "SubscriptionId",
});

/**
 * Status of the data store events.
 */
P.declare("DataStoreEventStatus", {
    SUCCESS: "Success",
    FAILURE: "Failure",
    UNKNOWN: "Unknown"
});P.when('A', 'jQuery', 'ClientDataSenderObject', 'EventManagerObject', 'CDSEvents', 'DataStoreEventStatus', 'ready').execute(function(A, jQuery, ClientDataSenderObject, EventManagerObject, CDSEvents, DataStoreEventStatus) {

    // Create a new class
    var DataStoreEventLogger = A.createClass({

        /**
         * Initializes the client data sender for sending event to server.
         */
        initializeClientDataSender: function () {
            var eventLoggingConfig = jQuery("#eventLoggingConfig");
            if (eventLoggingConfig != null) {
                var configData = {
                    url: eventLoggingConfig.data("url"),
                    batchSize: eventLoggingConfig.data("batch-size"),
                    interval: eventLoggingConfig.data("interval")
                };
                ClientDataSenderObject.initialize(configData);
            }
        },

        /**
         * Broadcasts and schedules a data store event request.
         * @param eventDataList list of data store events
         */
        logDataStoreEvent: function (eventDataList) {
            if (eventDataList instanceof Array) {
                for (var eventData in eventDataList) {
                    EventManagerObject.broadcast(CDSEvents.ADD_EVENT_DATA, eventDataList[eventData]);
                }
            }
        },

        /**
         * Builds and returns the data store event data array.
         * @param eventName name of the event
         * @param eventStatus status of the event
         * @param actionParentType action parent type of the event
         * @param actionParentValue action parent value of the event
         * @param actionValueMap map of action values of the event
         * @returns {Array} Array of event data
         */
        buildEventData: function (eventName, eventStatus, actionParentType, actionParentValue, actionValueMap) {
            var actionTypes = [];
            var eventData = [];
            if (actionValueMap !== undefined) {
                actionTypes = Object.keys(actionValueMap);
            }
            if (actionTypes.length > 0) {
                for (var actionType in actionTypes) {
                    eventData.push({eventName : eventName, dataStoreEventRequest : true, result: eventStatus,
                        eventAction : {actionParentType: actionParentType, actionParentValue: actionParentValue,
                            actionType: actionTypes[actionType], actionValue: actionValueMap[actionTypes[actionType]]}})
                }
            } else {
                eventData.push({eventName : eventName, dataStoreEventRequest : true, result: eventStatus,
                    eventAction : {actionParentType: actionParentType, actionParentValue: actionParentValue}})
            }
            return eventData;
        },

        /**
         * Transforms the event status argument to predefined data store event status.
         * @param eventStatus Status of the event
         * @return {string} transformed event status
         */
        transformEventStatus: function (eventStatus) {
            if (eventStatus === DataStoreEventStatus.SUCCESS || eventStatus === DataStoreEventStatus.FAILURE) {
                return eventStatus;
            }
            return DataStoreEventStatus.UNKNOWN;
        }

    });

    // Create an instance/object of DataStoreEventLogger
    var dataStoreEventLogger = new DataStoreEventLogger();

    // Declare this object, so that it can be consumed
    P.declare("DataStoreEventLogger", dataStoreEventLogger);
});/**
 * Data store for PaySelect event names.
 */
P.declare("PaySelectEventNames", {
    IMB_DISPLAY_LOAD_EVENT: "IMBDisplayed",
    IMB_DISPLAY_UNLOAD_EVENT:  "IMBRemoved",
    INLINE_MESSAGING_DISPLAY: "InlineMessagingDisplayed",
    TOGGLE_PAYMENT_INSTRUMENT_EVENT: "TogglePaymentInstrument",
    TOGGLE_PAYMENT_INSTRUMENT_COUNT_EVENT: "TogglePaymentInstrumentCount",
    START_ADD_CARD_EVENT: "StartAddCard",
    START_ADD_INSTRUMENT_EVENT: "StartAddInstrumentEvent",
    ADD_NEW_CARD_EVENT: "AddNewCard",
    CANCEL_ADD_CARD_EVENT: "CancelAddCard",
    ADD_CARD_IMB_DISPLAY_LOAD_EVENT: "AddCardIMBDisplayed",
    STORAGE_CONSENT_SELECTION_REQUIRED_ERROR: "StorageConsentSelectionRequiredError",
    STORAGE_CONSENT_LEARN_MORE_CLICKED: "StorageConsentLearnMoreLinkClicked"
});

/**
 * PaySelect event attributes for data store events.
 */
P.declare("PaySelectEventActionAttributeKeys", {
    PAYMENT_INSTRUMENT_ID: "PaymentInstrumentId",
    PAYMENT_INSTRUMENT_CATEGORY_TYPE: "PaymentInstrumentCategoryType",
    RESTRICTION_LEVEL: "RestrictionLevel",
    IMB_TYPE: "ImbType",
    PAYMENT_TRANSACTION_ID: "PaymentTransactionId"
});
P.when('A', 'EventManagerObject', 'DPPUIConstants', 'ready').execute(function(A, objEventManager, DPPUIConstants) {
    var Handler = A.createClass({
        _callbackMap : {},
        _dataSourceMap : {},
        _handlerMethodMap : {},

        registerHandlerMethod : function(event, handlerMethod) {
            if(!this._handlerMethodMap[event]){
                this._handlerMethodMap[event] = handlerMethod.bind(this);
                return true;
            }
            return false;
        },

        deregisterHandlerMethod : function(event) {
            if(this._handlerMethodMap[event]) {
                delete this._handlerMethodMap[event];
                return true;
            }
            return false;
        },

        registerCallback : function(event, callback) {
            if(!this._callbackMap[event]) {
                this._callbackMap[event] = [];
            }
            var callbacks = this._callbackMap[event];
            if(callbacks && callbacks instanceof Array) {
                for (i=0;i<callbacks.length;i++) {
                    if(callbacks[i] == callback) {
                        return false;
                    }
                }
            }
            this._callbackMap[event].push(callback);
            return true;
        },

        deregisterCallback : function(event, callback) {
            var callbacks = this._callbackMap[event];
            if(callbacks && callbacks instanceof Array) {
                for (i=0;i<callbacks.length;i++) {
                    if(callbacks[i] == callback) {
                        callbacks.splice(i,1);
                        return true;
                    }
                }
            }
            return false;
        },

        registerDataSource : function(name, dataSource) {
            if(!this._dataSourceMap[name]){
                this._dataSourceMap[name] = dataSource;
                return true;
            }
            return false;
        },

        deregisterDataSource : function(name) {
            if(this._dataSourceMap[name]) {
                delete this._dataSourceMap[name];
                return true;
            }
            return false;
        },

        trigger  : function(event, data) {
            if(this._handlerMethodMap[event]) {
                this._handlerMethodMap[event](data);
                return true;
            }
            return false;
        },

        process : function(event, data) {
            var callbacks = this._callbackMap[event];
            if (callbacks && callbacks instanceof Array) {
                callbacks.forEach(function(callback) {
                    callback(data, event);
                });
                if(callbacks.length > 0) {
                    return true;
                }
            }
            return false;
        },

        fetch : function(datasource, data) {
            if(this._dataSourceMap[datasource]){
                return this._dataSourceMap[datasource](data);
            } else {
                return undefined;
            }
        },

        /**@summary: Abstracts the event subscription using common object of EventManager
         * @actual-scope:   public
         * @expected-scope: public
         * @method: subscribe
         * @param:  context Mixed/Object, Any object
         * @param:  String eventName, Name of the event to be subscribed
         * @param:  Function eventHandler, callBack function to be called when eventName is broadcasted
         * @returns: void
         */
        subscribe: function(eventName, eventHandler) {
            if (objEventManager) {
                objEventManager.subscribe(this, eventName, eventHandler);
            } else {
                this.reportError(DPPUIConstants.ErrorCodes.NULL_REFERENCE, "Event Manager Object is not defined");
            }
        },

        /**@summary: Abstracts the event unsubscription using common object of EventManager
         * @actual-scope:   public
         * @expected-scope: public
         * @method: unsubscribe
         * @param:  String eventName, Name of the event to be subscribed
         * @param:  Function eventHandler, callBack function to be called when eventName is broadcasted
         * @returns: void
         */
        unsubscribe: function(eventName, eventHandler) {
            if (objEventManager) {
                objEventManager.unsubscribe(eventName, eventHandler);
            } else {
                this.reportError(DPPUIConstants.ErrorCodes.NULL_REFERENCE, "Event Manager Object is not defined");
            }
        },

        /**@summary: Abstracts the event nroadcasting using common object of EventManager
         * @actual-scope:   public
         * @expected-scope: public
         * @method: broadcast
         * @param:  String eventName, Name of the event to be subscribed as first argumens
         * @param:  Mixed eventData, Event Data to be passed to event handlers
         * @returns: void
         */
        broadcast: function(eventName, eventData) {
            if (objEventManager) {
                objEventManager.broadcast(eventName, eventData);
            } else {
                this.reportError(DPPUIConstants.ErrorCodes.NULL_REFERENCE, "Event Manager Object is not defined");
            }
        },

        /**@summary: A method to identify the sleeve name, to be overridden by each derived calss
         * @actual-scope:   public
         * @expected-scope: private
         * @method: reportError
         * @returns: String, Sleeve Name/Identifier
         */
        getIdentifier: function() {
            return DPPUIConstants.SleeveNames.UNKNOWN;
        },

        /**@summary: Common method to Report any error occured while executing any logic
         * @actual-scope:   public
         * @expected-scope: public
         * @method: reportError
         * @param:  String errorCode, Error code for the error occured while executing any logic
         * @param:  String errorDesc, Custom description of the error
         * @returns: void
         */
        reportError: function(errorCode, errorDesc) {
            var identifier = this.getIdentifier();
            //TODO: Write appropriate way of logging error, currently using console.log only
            console.log("[ERROR] classIdentifier: " + identifier + ", errorCode: " + errorCode + ", errorDesc: " + errorDesc);
        },

        /**@summary: Abstracts the event subscription using common object of EventManager
         * @actual-scope:   public
         * @expected-scope: public
         * @method: execute
         * @param:  context Mixed/Object, Any object
         * @param:  String eventName, Name of the event to be subscribed
         * @param:  Function eventHandler, callBack function to be called when eventName is executed
         * @returns: void
         */
        execute : function(eventName, eventHandler) {
            if (objEventManager) {
                objEventManager.execute(eventName, eventHandler);
            } else {
                this.reportError(DPPUIConstants.ErrorCodes.NULL_REFERENCE, "Event Manager Object is not defined");
            }
        }
    });

    P.declare("Handler", Handler);
});
P.when('jQuery', 'Handler', 'ready').execute(function(jQuery, Handler) {
    var CpfFormHandler = Handler.extend({
        init : function() {
            this.cpfContainer = jQuery("#cpfView");
        }
    });
    var cpfFormHandler = new CpfFormHandler();
    P.declare("cpfFormHandler", cpfFormHandler);
});// TODO : Remove unnecessary jQuery encapsulation (ie, jQuery(jQueryObject)) through out the file.
function cardFieldEvents(form) {
    P.when('A','validateForm','FormControlUtil', 'addCardHandler', 'addCardSleeveHandler', 'DPPUITreatments', 'DPPUIConstants', 'ready').execute(function(A, validateForm, FormControlUtil, addCardHandler, addCardSleeveHandler, DPPUITreatments, DPPUIConstants) {
        var jQuery = A.$;


        function cardNumberValidation(event) {
            var cardNumberFormControl = form.find(this);
            var validateCardImage = form.find("img[id*='validatedCardImage']");

            hideUnsupportedCardError(form);

            if (validateForm.validate(cardNumberFormControl, form)) {
                var addCardButton = form.find("#add-card-btn");
                var cardNumberField = FormControlUtil.getField(cardNumberFormControl, form);
                var ajaxData = {
                    'addCreditCardNumber' : FormControlUtil.getFieldValue(cardNumberFormControl, form)
                }

                jQuery.ajax({
                    url: jQuery(cardNumberFormControl).data('validate-card-url'),
                    data: ajaxData,
                    /**
                     * This sync validation and add new card call
                     * TODO: Disable continue btn till validation is done.
                    **/
                    async: false,
                    cache: false,
                    type: 'POST',
                    contentType: 'application/x-www-form-urlencoded',
                    success: function(result) {
                        if(!result) return;
                         if (result.cardSupported) {
                             hideUnsupportedCardError(form);
                             showOrHideInvalidCardNumberError(form);
                             enableAddCardButton(addCardButton);
                             (result.issuer) && jQuery(cardNumberFormControl).attr('data-card-issuer', result.issuer);
                             (result.cardImage && result.cardImage.imageUrl) && validateCardImage.attr('src', result.cardImage.imageUrl)
                             && validateCardImage.removeClass("aok-hidden");
                         } else {
                             disableAddCardButton(addCardButton);
                             showCardNumberError(result);
                             validateCardImage.attr('src', '');
                             validateCardImage.addClass("aok-hidden");
                         }
                         toggleFormFields(result.securityCodeRequired, result.postalCodeRequired, result.mobileNumberRequired, result.expirationDateRequired, result.showConsentCheckbox, result.unsupportedCardTypeForConsentCollection, form);
                         enablePYOButton(event);
                         addCardSleeveHandler.showAddCardIMB(result.restricted);
                         P.when("a-button", "ready").execute(function (getButtonCollection) {
                             var restrictionLevel = jQuery("#addCardIMBContext").data('restriction-level');
                             if (typeof restrictionLevel !== "undefined" && restrictionLevel === "turnOff") {
                                 var button = getButtonCollection('.add-card-btn-container');
                                 if (result.restricted) {
                                     button.disable();
                                 } else {
                                     button.enable();
                                 }
                             }
                         });
                     }
                });
            } else {
                enablePYOButton(event);
                validateCardImage.attr('src', '');
                validateCardImage.addClass("aok-hidden");
            }
        }

        function enablePYOButton(event) {
            var isPYOAddCardEnabled = DPPUITreatments.getTreatment('PYOEnableTreatment');
            if (isPYOAddCardEnabled) {
                var verificationField;
                var verificationCodeError = form.find(".verificationCodeError").attr("id");
                if (typeof verificationCodeError !== "undefined") {
                    if (verificationCodeError === 'cvvError') {
                        verificationField = form.find("input[id*='cvv']");
                        verificationCodeRegExp = new RegExp('^[0-9]{3,8}$');
                    } else if (verificationCodeError === 'postalCodeError') {
                        verificationField = form.find("input[id*='billingAddressPostalCode']");
                        verificationCodeRegExp = new RegExp('^[a-zA-Z0-9]{3,8}$');
                    } else if (verificationCodeError === 'cardHolderNameValidationError') {
                    	verificationField = form.find("input[id*='cardHolderName']");
                    	verificationCodeRegExp = new RegExp('.*\\S.*');
                    }
                    // TODO : validateForm.validate should validate and show alert on bases of parameter passed.@myashasv
                    if (verificationCodeRegExp.test(verificationField.val()) && validateFormFields(verificationField) && form.find(".cardNotSupportedError").hasClass('aok-hidden')) {
                        addCardHandler.process("Action:enable");
                        addCardHandler.broadcast(DPPUIConstants.EventTypes.PYO_CARD_STATUS_CHANGED, {enabled: true});
                        P.when("FloatingPYOHelper", "ready").execute(function (floatingPYOHelper) {
                            floatingPYOHelper.showOrHideFloatingButton();
                        });
                    } else {
                        addCardHandler.broadcast(DPPUIConstants.EventTypes.PYO_CARD_STATUS_CHANGED, {enabled: false});
                        addCardHandler.process("Action:disable",{showPopoverText : false});
                    }
                }
            }
        }

        function validateFormFields(verificationField) {
            var cardNumber = form.find('.cardNumber');
            var cardHolderName = form.find('.cardHolderName');
            return (validateForm.validate(cardNumber, form) && validateForm.validate(cardHolderName, form) && validateForm.validate(verificationField, form));
        }

        A.declarative('expirationMonthChanged', 'change', function(event) {
            var expirationMonthField = event.$target.get(0);
            var form = jQuery(expirationMonthField).closest('.add-new-card-form');
            validateExpirationDate(form);
        });

        A.declarative('expirationYearChanged', 'change', function(event) {
            var expirationYearField = event.$target.get(0);
            var form = jQuery(expirationYearField).closest('.add-new-card-form');
            validateExpirationDate(form);
        });

        function validateField(event) {
            var field = form.find(this);
            if (validateForm.validate(field, form)){
                enablePYOButton(event, form);
            } else {
                addCardHandler.process("Action:disable",{showPopoverText : false});
            }
        }

        function showCardNumberError(result) {
            if(!result) return;
            if(result.issuer != null && !result.cardSupported) {
                showOrHideInvalidCardNumberError(form);
                showUnsupportedCardError(form);
            } else {
                hideUnsupportedCardError(form);
                showOrHideInvalidCardNumberError(form,true);
            }
        }

        //TODO: Outer and inner divs should have different names for better readability.
        // changing from focusout to change to avoid multiple hits - partha
        form.find(".cardNumber").change(cardNumberValidation);
        if (form.find("input[type=radio][name='ConsentRadioButton']").length > 0) {
            form.find("input[type=radio][name='ConsentRadioButton']").change(validateStorageConsent);
        }
        form.find(".cardNumber").focusout(showCardNumberRequiredMessage);
        form.find(".cardHolderName").focusout(validateField);
        form.find(".cvv .cvv").focusout(validateField);
        form.find(".postal-code .postal-code").focusout(validateField);
        form.find(".mobile-number .mobile-number").focusout(validateField);
        //TODO: Add single Event validation be focusout or bind depending on Business Logic.
        form.find(".cvv .cvv").bind("input",enablePYOButton);
        form.find(".postal-code .postal-code").bind("input",enablePYOButton);
        form.find(".cardHolderName").bind("input",enablePYOButton);

        //This function will enable Add card button when the card number field is focused. Fix for https://t.corp.amazon.com/D9004660
        function setEnableAddCardButton(event) {
            var addCardButton = form.find("#add-card-btn");
            enableAddCardButton(addCardButton);
        }

        //This function will validate only when the card number field is empty. Fix for https://tt.amazon.com/0143592248
        function showCardNumberRequiredMessage(event) {
            var cardNumber = FormControlUtil.getFieldValue(form.find(this), form).trim();
            if (cardNumber.length == 0) {
                validateForm.validate(form.find(".cardNumber"), form);
            }
        }

        function showUnsupportedCardError(form) {
            form.find(".cardNotSupportedError").removeClass("aok-hidden");
            // Only showing card not supported error.
            form.find('#cardNumberError').addClass("aok-hidden");
        }

        function hideUnsupportedCardError(form) {
            form.find(".cardNotSupportedError").addClass("aok-hidden");
        }

        function showOrHideInvalidCardNumberError(form,status) {
            P.when('a-alert').execute(function (getAlertCollection) {
                var cardNumberErrorAlert = getAlertCollection(form.find('#cardNumberError'));
                if (status) {
                    var fieldValidators = jQuery(form).find(".cardNumber").data('field-validators');
                    var errorMessage = invalidCardErrorMessage(fieldValidators);
                    (errorMessage) ? cardNumberErrorAlert.hide().text(errorMessage).show() : showUnsupportedCardError(form);
                } else {
                    cardNumberErrorAlert.hide()
                }
            });
        }

        function invalidCardErrorMessage(fieldValidators) {
            for (var validation in fieldValidators) {
                if (fieldValidators[validation].type == "luhncheck") {
                    return fieldValidators[validation].message;
                }
            }
        }

        function enableAddCardButton(button) {
            jQuery(button).attr('disabled', false);
        }

        function disableAddCardButton(button) {
            jQuery(button).attr('disabled', true);
        }

        function hideExpirationDateFields(form) {
            jQuery(form.find(".expiryDate")).addClass('aok-hidden');
            var notRequiredLabel = form.find("#expiry-date-not-required-label");
            if (notRequiredLabel && notRequiredLabel.length != 0) {
                jQuery(form.find("#expiration-year-label")).removeClass('aok-hidden');
                jQuery(notRequiredLabel).removeClass('aok-hidden');
            } else {
                jQuery(form.find("#expiration-year-label")).addClass('aok-hidden');
            }
        }

        function showExpirationDateFields(form) {
            jQuery(form.find(".expiryDate")).removeClass('aok-hidden');
            jQuery(form.find("#expiration-year-label")).removeClass('aok-hidden');
            var notRequiredLabel = form.find("#expiry-date-not-required-label");
            if (notRequiredLabel && notRequiredLabel.length != 0) {
                jQuery(notRequiredLabel).addClass('aok-hidden');
            }
        }

        function toggleFormFields(securityCodeRequired, postalCodeRequired, mobileNumberRequired, expirationDateRequired, showConsentCheckbox, unsupportedCardTypeForConsentCollection, form) {
            var mobileNumber = form.find(".mobile-number");
            jQuery(form.find(".postal-code")).addClass("aok-hidden");
            jQuery(form.find(".cvv")).addClass("aok-hidden");
            mobileNumber.addClass("aok-hidden");
            jQuery(form.find(".verificationCodeError")).addClass("aok-hidden");
            showExpirationDateFields(form)
            if(jQuery("#coftContext").data('coft-consent-collection-launched')) {
                form.find("#consent-collection-section").addClass('aok-hidden');
                form.find("#disable-consent-collection-section").addClass('aok-hidden');
            }

            if(securityCodeRequired) {
                jQuery(form.find(".cvv")).removeClass("aok-hidden");
                jQuery(form.find(".verificationCodeError")).attr("id", "cvvError");
            } else if(postalCodeRequired) {
                jQuery(form.find(".postal-code")).removeClass("aok-hidden");
                jQuery(form.find(".verificationCodeError")).attr("id", "postalCodeError");
            } else {
                (form.data('pyo-add-card')) && addCardHandler.process("Action:disable",{showPopoverText : false});
                jQuery(form.find(".verificationCodeError")).attr("id", "cardHolderNameValidationError");
            }
            mobileNumberRequired && mobileNumber.removeClass("aok-hidden");
            if(!expirationDateRequired) {
                hideExpirationDateFields(form);
            }
            if(showConsentCheckbox && form.data('pyo-add-card')) {
                jQuery(form.find("#coftContext")).attr("data-hide-consent-checkbox", false);
                jQuery(form.find("#consent-collection-section")).removeClass('aok-hidden');
            }
            if(jQuery("#coftContext").data('coft-consent-collection-launched') && !showConsentCheckbox && form.data('pyo-add-card')) {
                jQuery(form.find("#coftContext")).attr("data-hide-consent-checkbox", true);
                if(unsupportedCardTypeForConsentCollection) {
                 jQuery(form.find("#disable-consent-collection-section")).removeClass('aok-hidden');
                }
            }
        }

        function validateExpirationDate(form) {
            var expirationDateFields = jQuery(form).find(".expiryDate");
            validateForm.validate(expirationDateFields, form);
        }

        function validateStorageConsent() {
            if (form.find("input[name='ConsentRadioButton']:checked").val() != undefined) {
                form.find('#storageConsentError').addClass("aok-hidden");
            }
        }
    });
}

P.when('A', 'jQuery', 'Handler', 'paymentMethodsHandler', 'addCardHandler', 'billingAddressHandler', 'CSM', 'CDSEvents', 'DPPUIConstants', 'DataStoreEventLogger', 'PaySelectEventNames', 'PaySelectEventActionAttributeKeys', 'DataStoreEventStatus',  'ready').execute(function(A, jQuery, Handler, paymentMethodsHandler, addCardHandler, billingAddressHandler, CSM, CDSEvents, DPPUIConstants, DataStoreEventLogger, PaySelectEventNames, PaySelectEventActionAttributeKeys, DataStoreEventStatus) {
    var AddCardSleeveHandler = Handler.extend({
         init : function(type) {
            this.type= type;
            this.targetId = "";
            this.cardAdditionHandler = this.onCardAddition.bind(this);
            this.addCardStateChangeHandler = this.onAddCardStateChange.bind(this);
            this.cancelAddCardFormHandler = this.onAddCardCancel.bind(this);
            this.cardIneligibleHandler = this.onCardIneligible.bind(this);
            var _self= this;
            paymentMethodsHandler.registerCallback("ToggleAdd"+ this.type +"CardForm", this.toggleAddCardForm.bind(this));
            if(this.type == "debit") {
                this.targetId = "Debit";
            }
            var addCardForm = jQuery("."+ this.type + "-card").find("[id^='add'][id$='card-form']");
            (addCardForm) && cardFieldEvents(addCardForm);
            A.declarative('ShowAdd' + this.type + 'CardForm', 'click', function(event) {
                CSM.log('ShowAdd' + _self.type + 'CardForm', 1);
                _self.broadcast(CDSEvents.ADD_EVENT_DATA,
                    { eventName : DPPUIConstants.EventTypes.PAYMENT_METHOD_SELECTED,
                    result : DPPUIConstants.PaymentMethodType.CARD,
                    targetId : "New" + _self.targetId + "Card",
                    differentiator : paymentMethodsHandler.fetch("PaymentMethod:GetEventDifferentiator")});
                var addCardRadio = jQuery("input[id=add-new-" + _self.type + "-card-radio-button]");
                if (addCardRadio) {
                    addCardRadio.attr('checked', true).trigger('change');
                }
            });
        },

        getType : function(){
            if(this.type == "generic"){
                return "";
            }
        },

        showAddCardForm : function() {
            var addCardForm = jQuery("."+ this.type + "-card").find("#add-card-form");
            if(addCardForm.data('hide-add-card-form-container')) {
                return;
            }
            var link = jQuery("."+ this.type + "-card").find("#add-new-card");
            /* RW : Hide Add card link */
            jQuery(link).addClass('aok-hidden');

            /* AW: Update Add Card Form heading */
            var header = jQuery('#addNewCardHeader').val();
            jQuery('#addCardHeader').text(header);

            /* Add card form shown only if there is no restriction placed. (Such as disabling add-card form for TLS Compliance)*/
            addCardHandler.trigger('AddCard:Show', addCardForm);

            /* Register callback */
            addCardHandler.registerCallback("AddCard:CardAdded", this.cardAdditionHandler);
            addCardHandler.registerCallback("AddCard:StateChanged", this.addCardStateChangeHandler);
            addCardHandler.registerCallback("AddCard:Cancelled", this.cancelAddCardFormHandler);
            addCardHandler.registerCallback("AddCard:CardIneligible", this.cardIneligibleHandler);
            addCardHandler.emitAddCardEventDataMetrics(PaySelectEventNames.START_ADD_CARD_EVENT);
            this.showAddCardIMB();
        },

        onAddCardCancel : function(type) {
            this.hideAddCardForm();
            if(type === 'billing-address') {
                paymentMethodsHandler.trigger("PaymentMethod:CardAdded");
            }
        },

        hideAddCardForm : function() {

            var link = jQuery("."+ this.type + "-card").find("#add-new-card");
            /* RW: Show Add card link */
            jQuery(link).removeClass('aok-hidden');

            /* AW: Update Add Card Form heading */
            var header = jQuery('#addNewCardHeader').val();
            jQuery('#addCardHeader').text(header);

            var addCardForm = jQuery("."+ this.type + "-card").find("#add-card-form");
            addCardHandler.trigger('AddCard:Hide', addCardForm);

            addCardHandler.deregisterCallback("AddCard:CardAdded", this.cardAdditionHandler);
            addCardHandler.deregisterCallback("AddCard:StateChanged", this.addCardStateChangeHandler);
            addCardHandler.deregisterCallback("AddCard:Cancelled", this.cancelAddCardFormHandler);
            addCardHandler.deregisterCallback("AddCard:CardIneligible", this.cardIneligibleHandler);
            this.HideAddCardIMB();
        },

        emitIMBLoadEvent : function(actionParentType) {
            if (DataStoreEventLogger != undefined) {
                var eventData = DataStoreEventLogger.buildEventData(PaySelectEventNames.ADD_CARD_IMB_DISPLAY_LOAD_EVENT, DataStoreEventStatus.SUCCESS,
                    PaySelectEventActionAttributeKeys.IMB_TYPE, actionParentType, undefined);
                DataStoreEventLogger.logDataStoreEvent(eventData);
            }
        },

        showAddCardIMB: function(isRestricted) {
            jQuery("#payment-option-signaling-info-box").addClass("aok-hidden");
            jQuery("#payment-option-restriction-info-box").addClass("aok-hidden");
            jQuery("#add-card-generic-info-box").addClass("aok-hidden");
            jQuery("#add-card-blocking-info-box").addClass("aok-hidden");

            var restrictionLevel = jQuery("#addCardIMBContext").data('restriction-level');
            if(typeof restrictionLevel !== "undefined" && restrictionLevel === "turnOff") {
                if (isRestricted) {
                    jQuery("#add-card-blocking-info-box").removeClass("aok-hidden");
                    this.emitIMBLoadEvent("TurnOffBlockingIMB");
                } else {
                    jQuery("#add-card-generic-info-box").removeClass("aok-hidden");
                    this.emitIMBLoadEvent("TurnOffWarningIMB");
                }
            } else if(typeof restrictionLevel !== "undefined" && restrictionLevel) {
                jQuery("#add-card-generic-info-box").removeClass("aok-hidden");
                this.emitIMBLoadEvent("SignallingIMB");
            }
        },

        HideAddCardIMB: function() {
            jQuery("#payment-option-signaling-info-box").addClass("aok-hidden");
            jQuery("#payment-option-restriction-info-box").addClass("aok-hidden");
            jQuery("#add-card-generic-info-box").addClass("aok-hidden");
            jQuery("#add-card-blocking-info-box").addClass("aok-hidden");

            var restrictionLevel = jQuery("#imbContext").data('restriction-level');
            if(typeof restrictionLevel !== "undefined" && restrictionLevel === "signalling") {
                jQuery("#payment-option-signaling-info-box").removeClass("aok-hidden");
            }
        },

        toggleAddCardForm : function() {
            this.hideNotifications();
            var addCardRadio = jQuery("input[id=add-new-" + this.type + "-card-radio-button]");
            if(addCardRadio.length == 1) { /* Toggle show/hide add card form */
                var eligibilityCriteria = paymentMethodsHandler.fetch("PaymentMethod:GetEligibilityCriteria");

                if (!addCardRadio[0].checked || this.haveFreeOrderEligibility(eligibilityCriteria)) {
                    this.hideAddCardForm();
                } else {
                    this.broadcast(CDSEvents.ADD_EVENT_DATA,
                            { eventName : DPPUIConstants.EventTypes.PAYMENT_METHOD_SELECTED,
                              result : DPPUIConstants.PaymentMethodType.CARD,
                              targetId : "New" + this.targetId + "Card",
                              differentiator : paymentMethodsHandler.fetch("PaymentMethod:GetEventDifferentiator")});
                    this.showAddCardForm();
                }
            }
        },

        haveFreeOrderEligibility : function(eligibilityCriteria) {
            return (typeof eligibilityCriteria != 'undefined' && typeof eligibilityCriteria.eligibleForFreeOrder != 'undefined' && eligibilityCriteria.eligibleForFreeOrder == true);
        },

        onCardAddition : function(data) {
            this.hideAddCardForm();
            paymentMethodsHandler.trigger("PaymentMethod:CardAdded", data);
        },

        onAddCardStateChange : function(state) {
            if (state === 'billing-address') {
                var chooseAddressHeader = jQuery('#chooseAddressHeader').val();
                jQuery('#addCardHeader').text(chooseAddressHeader);
                var link = jQuery("."+ this.type + "-card-container").find("#add-new-card");
                jQuery(link).addClass('aok-hidden');
            }
        },

        onCardIneligible : function(data) {
            paymentMethodsHandler.trigger("PaymentMethod:CardAdded", data);
        },

        hideNotifications : function() {
            /* Hiding instrument ineligible alert notification */
            addCardHandler.InstrumentIneligibleNotificationState(false);
        },

    });

    var addCardSleeveHandler = new AddCardSleeveHandler("generic");

    var addDebitCardSleeveHandler = new AddCardSleeveHandler("debit");

    P.declare('addCardSleeveHandler', new AddCardSleeveHandler("generic"));

});

P.when('A','jQuery','Handler','errors','billingAddressHandler','errorHandler','paymentMethodsHandler', 'validateForm', 'DPPUIConstants', 'DPPUITreatments', 'DataStoreEventLogger', 'DataStoreEventStatus', 'PaySelectContextHelper', 'PaySelectEventNames', 'PaySelectEventActionAttributeKeys', 'ready').execute(function(A,jQuery,Handler, errors, billingAddressHandler, errorHandler, paymentMethodsHandler, validateForm, DPPUIConstants, DPPUITreatments, DataStoreEventLogger, DataStoreEventStatus, paySelectContextHelper, PaySelectEventNames, PaySelectEventActionAttributeKeys) {

    AddCardHandler = Handler.extend({
        init : function() {
            this.billingAddressUpdateHandler = this.handleRegistrationCompleted.bind(this);
            this.onBillingAddressUpdateCancel = this.onBillingAddressUpdateCancel.bind(this);

            this.registerHandlerMethod("AddCard:Show", this.showAddCardForm.bind(this));
            this.registerHandlerMethod("AddCard:Hide", this.hideAddCardForm.bind(this));
            this.registerHandlerMethod("AddCard:Clear", this.clearAddCardForm.bind(this));

            //Add card Event and data handling
            this.subscribe(DPPUIConstants.EventTypes.PYO_CARD_STATUS_CHANGED, this.pyoCardPreferenceMessage.bind(this));
            this.subscribe(DPPUIConstants.EventTypes.PAYMENT_METHOD_ADDED, this.onAddCard);
            this.registerDataSource("AddCardActionData", this.getAddCardActionData.bind(this));
            this.addCardFormData = {};
        },

        showAddCardForm : function(form) {
            this.addCardFormData.addCardForm = form;
            this.addCardFormData.addCardFormContainer = jQuery(form).closest(".add-card-container");
            if(form.data('pyo-add-card') && DPPUITreatments.getTreatment('PYOEnableTreatment') == null) {
                DPPUITreatments.setTreatment('PYOEnableTreatment',form.data('pyo-add-card'));
            }
            if (jQuery(form).hasClass('aok-hidden')) {
                this.emitAddCardEventDataMetricsForProjectSeven(PaySelectEventNames.START_ADD_INSTRUMENT_EVENT, null, "Click", DataStoreEventStatus.SUCCESS);
            }
            jQuery(form).removeClass('aok-hidden');
            this.clearAddCardForm(form);
            P.when("a-dropdown", 'ready').execute(function (dropdown) {
                var today = new Date();
                var currentMonth = today.getMonth()+1; // January is 0.
                var currentYear = today.getFullYear();
                var expirationMonthDropdown = dropdown.getSelect(form.find("select[id*='expirationMonth']"));
                var expirationYearDropdown = dropdown.getSelect(form.find("select[id*='expirationYear']"));
                if (expirationMonthDropdown && expirationYearDropdown) {
                    expirationMonthDropdown.val(currentMonth);
                    expirationYearDropdown.val(currentYear);
                }
            });
        },

        clearAddCardForm : function(form) {
            billingAddressHandler.deregisterCallback("BillingAddress:Associated", this.billingAddressUpdateHandler);
            billingAddressHandler.deregisterCallback("BillingAddress:Aborted", this.onBillingAddressUpdateCancel);
            if (form) {
                var addressFormPlaceholder = jQuery(form).siblings(".address-form-placeholder");
                addressFormPlaceholder.empty().addClass('aok-hidden');
                var preferenceMessage = form.find(".preference-message");
                /* Clear content from form and hide all the error messages. */
                var formControlType = this.addCardFormData.addCardFormContainer && ("." + this.addCardFormData.addCardFormContainer.data('id'));
                var formControls = form.find(formControlType);

                P.when('A', 'a-dropdown').execute(function(A, dropDown) {
                    jQuery.each(formControls, function(key, formControl) {
                        if (!jQuery(formControl).data('nativeId')) {
                        /* Clearing content from form in AW*/
                        /*TODO: Change to a very generic way for clearing contents*/
                            if(formControl.tagName == "DIV") {
                                jQuery(formControl.getElementsByTagName("input")).val("");
                           } else {
                                jQuery(formControl).val("");
                            }
                        }
                        errors.hideError(jQuery(formControl), form);
                    });
                });
                form.find("img[id*='validatedCardImage']").attr('src', '');
                form.find("img[id*='validatedCardImage']").addClass('aok-hidden');
                form.find(".cvv").addClass('aok-hidden');
                form.find(".postal-code").addClass('aok-hidden');
                form.find(".mobile-number").addClass('aok-hidden');
                form.find('.cardNotSupportedError').addClass("aok-hidden");
                form.find(".expiryDate").removeClass('aok-hidden');
                if(jQuery("#coftContext").data('coft-consent-collection-launched')) {
                    form.find("#consent-collection-section").addClass('aok-hidden');
                    form.find("#disable-consent-collection-section").addClass('aok-hidden');
                }
                var cardStorageConsentSection = form.find(".cardStorageConsent");
                if (cardStorageConsentSection.length > 0) {
                    var storageConsentRadioButton = cardStorageConsentSection.find("input[name='ConsentRadioButton");
                    storageConsentRadioButton.attr("checked", false);
                    form.find("#storageConsentError").addClass('aok-hidden');
                }
                if (preferenceMessage && preferenceMessage.length != 0) {
                    preferenceMessage.addClass('aok-hidden')
                }
                form.find("#expiration-year-label").removeClass('aok-hidden');
                var notRequiredLabel = form.find("#expiry-date-not-required-label");
                if (notRequiredLabel && notRequiredLabel.length != 0) {
                    jQuery(notRequiredLabel).addClass('aok-hidden');
                }
                /* Re-enables Add your button*/
                form.find("#add-card-btn-container").removeClass("a-button-disabled");
                this.broadcast("AddPaymentOptionForm:Cleared", {form: this.addCardFormData.addCardFormContainer});
            }
        },

        hideAddCardForm : function(form) {
            if (form) {
                this.clearAddCardForm(form);
                if (this.addCardFormData.addCardForm && this.addCardFormData.addCardForm.selector == form.selector) {
                    this.addCardFormData={};
                    P.when('CSM', 'ready').execute(function(CSM) {
                        CSM.log("HideAddCardForm", 1);
                    });
                }
                this.clearResaveCardDetails();
                jQuery(form).addClass('aok-hidden');
            }
        },

        showPreferenceEligibleMessage : function(form, preferenceData) {
            this.hidePreferenceEligibleMessage(form);
            var preferenceMessage = form.find(".preference-message");
            if(preferenceMessage.length != 0) {
                var preferenceText = preferenceMessage.find(".preference-text");
                if (preferenceData.preferenceMessage) {
                    preferenceText.text(preferenceData.preferenceMessage);
                    preferenceMessage.removeClass("aok-hidden");
                }
            }
        },

        pyoCardPreferenceMessage: function(eventname, data) {
            if (this.addCardFormData.addCardFormContainer && this.addCardFormData.addCardFormContainer.length != 0) {
                var addCardContainer = this.addCardFormData.addCardFormContainer;
                if (data.enabled) {
                    this.showPreferenceEligibleMessage(addCardContainer, {"preferenceMessage" : this.fetch("Action:GetPreferenceMessage")});
                } else {
                    this.hidePreferenceEligibleMessage(addCardContainer);
                }
            }
        },

        hidePreferenceEligibleMessage : function(form) {
            var preferenceMessage = form.find(".preference-message");
            preferenceMessage.addClass("aok-hidden");
        },

        InstrumentIneligibleNotificationState : function(show) {
            var warning = jQuery("#instrument-ineligible-message");
            if(warning.length != 0){
                (show) ? warning.removeClass('aok-hidden') : warning.addClass('aok-hidden');
            }
        },

        handleRegistrationResponse : function(response, form) {
            switch (response.status) {
                case "BILLING_ADDRESS_REQUIRED":
                    this.handleBillingAddressRequired(response, form)
                    break;

                case "REGISTRATION_COMPLETED":
                    this.handleRegistrationCompleted(response);
                    break;

                case "REGISTRATION_ERROR":
                    this.process("AddCard:FormValuesInEligible", response);
                    errors.showRegistrationErrors(response.errorFieldList, form);
                    break;

                case "INSTRUMENT_INELIGIBLE":
                    this.handleInstrumentIneligible(response);
                    break;

                default:
                    //TODO:handle other cases
                    break;
            }
        },

        handleBillingAddressRequired : function(response, form) {
            this.broadcast("PaymentOptionAdded:BillingAddressRequired", 
                {form: this.addCardFormData.addCardFormContainer , paymentOption: response.paymentOption, cardsHeaders : response.cardsHeaders});
            var addressFormPlaceHolder = jQuery(form).siblings(".address-form-placeholder");
            addressFormPlaceHolder.html(response.content);
            addressFormPlaceHolder.removeClass('aok-hidden');
            billingAddressHandler.registerCallback("BillingAddress:Associated", this.billingAddressUpdateHandler);
            billingAddressHandler.registerCallback("BillingAddress:Aborted", this.onBillingAddressUpdateCancel);
            billingAddressHandler.trigger("BillingAddress:FormAdded", addressFormPlaceHolder);
            jQuery("body, html").animate({ 
                scrollTop: form.offset().top 
              }, 300); // time slice - 300 milliseconds, within which the scrolling executes.
            jQuery(form).addClass('aok-hidden');
            this.process("AddCard:StateChanged", 'billing-address');
        },

        handleRegistrationCompleted : function(response, event) {
            if (event == "BillingAddress:Associated") {
                response.endAction = 'billing-address';
            }
            this.process("AddCard:CardAdded", response);
        },

        handleInstrumentIneligible : function(response) {
            this.InstrumentIneligibleNotificationState(true);
            this.process("AddCard:CardIneligible", response);
        },

        handleUnknownError : function() {
            errorHandler.showError(errorHandler.INTERNAL_ERROR_INFORM);
        },

        handleUnAuthorizedError : function() {
            errorHandler.showError(errorHandler.CSRF_VALIDATION_ERROR);
         },

        onBillingAddressUpdateCancel : function() {
            this.hideAddCardForm();
            this.process('AddCard:Cancelled', 'billing-address');
        },

        onAddCardCancel : function(form) {
            this.hideAddCardForm(form);
            this.process('AddCard:Cancelled', 'card');
        },

        onAddCard : function(eventName, addCardData) {
            var self = this;
            var addCardActionData = addCardData.addCardActionData;
            var containerDiv = addCardActionData.containerDiv;
            var paymentContext = paymentMethodsHandler.fetch("GetPaymentPlanContext");
            var payables = paymentMethodsHandler.fetch("PaymentMethod:GetPayable");
            var cvv = containerDiv.find("input[id*='cvv'] ").val();
            var postalCode = containerDiv.find("input[id*='billingAddressPostalCode']").val();
            var mobileNumber = containerDiv.find("input[id*='mobileNumber']").val();
            var consentCheckbox = containerDiv.find('input[name="ConsentCollectionCheckbox"]');
            var cardStorageConsent;
            if (containerDiv.find('input[name="ConsentRadioButton"]').length > 0) {
                cardStorageConsent = containerDiv.find('input[name="ConsentRadioButton"]:checked').val();
            }
            var consentSelectionStatus = "";
            if ((consentCheckbox != null && consentCheckbox.length > 0 && consentCheckbox.prop('checked')) || cardStorageConsent === "true") {
                consentSelectionStatus = true;
            } else if (cardStorageConsent === "false") {
                consentSelectionStatus = false;
            } else if (consentCheckbox != null && consentCheckbox.length > 0 && DPPUITreatments.getTreatment('PYOEnableTreatment')
                    && !jQuery("#coftContext").data('hide-consent-checkbox')) {
                consentSelectionStatus = false;
            }
            var parameters = {
                   "addCreditCardNumber": containerDiv.find("input[id*='cardNumber']").val().trim(),
                   "cardHolderName": containerDiv.find("input[id*='cardHolderName']").val().trim(),
                   "expirationMonth": containerDiv.find("select[id*=expirationMonth]").find(":selected").text().trim(),
                   "expirationYear": containerDiv.find("select[id*=expirationYear]").find(":selected").text().trim(),
                   "addCreditCardVerificationNumber" : cvv.trim(),
                   "mobileNumber" : mobileNumber && mobileNumber.trim() || "",
                   "paymentContext" : JSON.stringify(paymentContext),
                   "payables" : JSON.stringify(payables),
                   "consentSelectionStatus" : consentSelectionStatus
            };

            var cardType = containerDiv.find("input[id=cardType]").val();
            if (typeof cardType !== "undefined") {
                parameters.cardType = cardType;
                }

            this.setResaveCardParameters(parameters);

            var formControlType = "." + this.addCardFormData.addCardFormContainer.data('id');
            formControls = jQuery(formControlType);

            var isStorageConsentValid =  this.validateStorageConsent(containerDiv);
            if (validateForm.validate(formControls, containerDiv) && isStorageConsentValid) {
                var ajaxRequestData = {
                    url: addCardActionData.url,
                    data: jQuery.param(parameters),
                    type: 'POST',
                    contentType: 'application/x-www-form-urlencoded;charset=UTF-8',
                    cache: false
                };

                var ajax = jQuery.ajax(ajaxRequestData);
                ajax.done(function(response) {
                    if (cardStorageConsent != null) {
                        if (response.paymentOption != null && response.paymentOption.walletId != null) {
                            paySelectContextHelper.updateWalletIdToPaymentPlanContext({"walletId": response.paymentOption.walletId});
                        }
                    }
                    self.handleRegistrationResponse(response, containerDiv);

                    /*
                     * Logic to persist customer Preference in case PYO is enabled
                     */
                    self.persistPreferenceOption(containerDiv);
                    /*
                     * Logic to persist customer Consent for tokenizing card.
                     */
                    self.persistConsentOption(containerDiv);
                    /*
                     * Logic for persisting CVV/PostalCode.
                     */
                    if (cvv) {
                        self.persistCVV(cvv);
                    }

                    if (postalCode) {
                        self.persistPostalCode(postalCode);
                    }

                    /*
                     * Logic for hiding verification code of newly added card.
                     */
                    self.hideVerificationCodeField();
                    /*
                     * Logic for checking if PYO is enabled
                     */
                    self.checkPYOEnabled(addCardData,response);
                    });

                ajax.fail(function(response) {
                    if(response.status == 401) {
                        self.handleUnAuthorizedError();
                    } else if (response.status === 403) {
                        //This empty block is added to avoid control from going in else block and causing unexpected behaviour.
                    } else {
                        self.handleUnknownError();
                    }
                });
            } else {
                if (!isStorageConsentValid && jQuery("#storageConsentError") != undefined) {
                    jQuery("#storageConsentError").removeClass("aok-hidden")
                    this.emitAddCardEventDataMetricsForProjectSeven(PaySelectEventNames.STORAGE_CONSENT_SELECTION_REQUIRED_ERROR, null, "Error", DataStoreEventStatus.FAILURE);
                }
                this.process("AddCard:FormValuesInEligible");
            }
        },

        getAddCardActionData : function() {
            var addCardData = {};
            if (Object.keys(this.addCardFormData).length) {
                addCardData.containerDiv = this.addCardFormData.addCardForm;
                addCardData.url = addCardData.containerDiv.data('register-card-url');
            }
            return addCardData;
        },

        validateStorageConsent : function (containerDiv) {
            if (containerDiv.find(".payment-method-storage-consent").length > 0) {
                containerDiv.find('#storageConsentError').addClass("aok-hidden");
                return containerDiv.find("input[name='ConsentRadioButton']:checked").val() != undefined
            }
            return true;
        },

        checkPYOEnabled : function(addCardData, response) {
            var self = this;
            P.when('confirmOrderHandler', 'cardsSleeveHandler', 'CSM', 'ready').execute(function(confirmOrderHandler, cardsSleeveHandler, CSM) {
                if (addCardData.pyoenabled && response.status == "REGISTRATION_COMPLETED") {
                    var eligibilityCriteria = paymentMethodsHandler.fetch("PaymentMethod:GetEligibilityCriteria");
                    if (cardsSleeveHandler.isCardEligible(response.paymentOption.instrumentId, eligibilityCriteria)) {
                        // Trigger PYO if criteria is full filled.
                        self.hideAddedCardAddressField();
                        CSM.log("PlaceOrderPYOAddCard", 1);
                        confirmOrderHandler.trigger("Action:performed");
                        }else {
                            // otherwise disable PYO button.
                            confirmOrderHandler.process("Action:disable",{showPopoverText : false});
                         }
                    } else if(addCardData.pyoenabled && response.status == "BILLING_ADDRESS_REQUIRED"){
                         // if Billing Address is required disable PYO button.
                         confirmOrderHandler.process("Action:disable",{showPopoverText : false});
                     }
                });
        },

         persistCVV : function(cvv) {
            var savedCardCVVField;
            var preferredInstrumentSleeve = jQuery('#preferredInstrumentSleeve');
            if (preferredInstrumentSleeve.find('.box-selected').length > 0) {
                savedCardCVVField = preferredInstrumentSleeve.find('.box-selected').find("input[id*='cvv']");
            } else {
                savedCardCVVField = jQuery('#existingCardList').find('.box-selected').find("input[id*='cvv']");
            }
            savedCardCVVField.val(cvv);
            savedCardCVVField.keyup();
         },

         persistPostalCode  : function(postalCode) {
            var savedCardPostalCodeField;
            var preferredInstrumentSleeve = jQuery('#preferredInstrumentSleeve');
             if (preferredInstrumentSleeve.find('.box-selected').length > 0) {
                savedCardPostalCodeField = preferredInstrumentSleeve.find('.box-selected').find("input[id*='billingAddressPostalCode']");
            } else {
                savedCardPostalCodeField = jQuery('#existingCardList').find('.box-selected').find("input[id*='billingAddressPostalCode']");
            }
            savedCardPostalCodeField.val(postalCode);
            savedCardPostalCodeField.keyup();
         },

         persistPreferenceOption : function(containerDiv) {
            var preferenceCheckbox = containerDiv.find('input[name="savePreferredInstrumentPreferenceCheckbox"]');
            if(preferenceCheckbox.length > 0 && !preferenceCheckbox.prop('checked')) {
                var addedCardPreferenceCheckbox = jQuery('#existingCardList').find('.box-selected').find("input[name='savePreferredInstrumentPreferenceCheckbox']");
                addedCardPreferenceCheckbox.attr('checked', false);
            }
        },

        persistConsentOption : function(containerDiv) {
            var consentCheckbox = containerDiv.find('input[name="ConsentCollectionCheckbox"]');
            if(consentCheckbox != null && consentCheckbox.length > 0 && consentCheckbox.prop('checked')) {
                var addedCardConsentCheckbox = jQuery('#existingCardList').find('.box-selected').find("input[name='ConsentCollectionCheckbox']");
                if(addedCardConsentCheckbox != null && addedCardConsentCheckbox.length > 0) {
                    addedCardConsentCheckbox.attr('checked', true);
                }
            }
        },

         hideVerificationCodeField : function() {
             var card = jQuery('#existingCardList').find(".box-selected");
             var verificationCodeDiv = card.find('.verification-code');
             verificationCodeDiv.removeClass('showable');
             if (verificationCodeDiv.hasClass('veilable')) {
                 // For RW we don't want its space to be occupied by element next to it.
                 verificationCodeDiv.css('visibility', 'hidden');
             } else {
                 // For AW we want its space to be occupied by the element beneath it.
                 verificationCodeDiv.addClass('aok-hidden');
             }
         },

         hideAddedCardAddressField : function() {
             var card = jQuery('#existingCardList').find(".box-selected");
             var defaultAddressDiv = card.find('.default-address');
             defaultAddressDiv.removeClass('showable');
             defaultAddressDiv.addClass('aok-hidden');
         },

        toggleMobileAddCardHeader : function(shouldHide) {
            if (shouldHide) {
                this._getMobileAddCardHeader().addClass("aok-hidden");
            } else {
                this._getMobileAddCardHeader().removeClass("aok-hidden");
            }
        },

        emitAddCardEventDataMetrics : function(eventName) {
            if (DataStoreEventLogger != undefined) {
                var eventData = DataStoreEventLogger.buildEventData(eventName, DataStoreEventStatus.SUCCESS, eventName, "CLick", undefined);
                DataStoreEventLogger.logDataStoreEvent(eventData);
            }
        },

        emitAddCardEventDataMetricsForProjectSeven : function(eventName, actionValueMap, customerAction, dataStoreEventStatus) {
            if (actionValueMap == null) {
                actionValueMap = {};
            }
            actionValueMap.PaymentMethodType = "Card";
            actionValueMap.CustomerEvent = customerAction;
            var paymentContext = jQuery("#paymentContext").data('payment-ctx');
            var paymentContractOrPlan = paymentContext.paymentContractId != undefined ? paymentContext.paymentContractId : paymentContext.paymentPlanId;
            var paymentTransactionIdentifier = paymentContractOrPlan != undefined || paymentContractOrPlan != "" ? paymentContractOrPlan : "UNKNOWN";

            if (DataStoreEventLogger != undefined) {
                var eventData = DataStoreEventLogger.buildEventData(eventName, dataStoreEventStatus, PaySelectEventActionAttributeKeys.PAYMENT_TRANSACTION_ID, paymentTransactionIdentifier, actionValueMap);
                DataStoreEventLogger.logDataStoreEvent(eventData);
            }
        },

        _getMobileAddCardHeader : function() {
            return jQuery("#add-new-card-aw");
        },

        setResaveCardParameters: function (parameters) {
            // resaveCard Object will be added in the call only if shouldResaveCard is true
            // this is required to determine if a updatepayment trigger is required to delete and re-add the card
            var resaveCard = {};
            var shouldResaveCard = jQuery('meta[name="shouldResaveCard"]');
            var paymentMethodIdToResave = jQuery('meta[name="paymentMethodIdToResave"]');
            resaveCard.shouldResaveCard = shouldResaveCard.attr('content');
            if (resaveCard.shouldResaveCard === "true") {
                resaveCard.paymentMethodId = paymentMethodIdToResave.attr('content');
                if (resaveCard.paymentMethodId === undefined || resaveCard.paymentMethodId === "") {
                    resaveCard.paymentMethodId = null;
                }
                parameters["resaveCard"] = JSON.stringify(resaveCard);

                // Reset the values to avoid duplicate calls (false is default)
                shouldResaveCard.attr('content', "false");
                paymentMethodIdToResave.attr('content', "");
            }
            return parameters;
        },

        clearResaveCardDetails: function () {
            // Reset the values for resaving card
            jQuery('meta[name="shouldResaveCard"]').attr('content', "false");
            jQuery('meta[name="paymentMethodIdToResave"]').attr('content', "");

            // Reset addcard header
            jQuery('#addCardHeader').removeClass('aok-hidden');
            jQuery('#add-card-label').removeClass('aok-hidden');
            jQuery('#resaveCardHeader').addClass('aok-hidden');
        }

    });
    P.declare('addCardHandler', new AddCardHandler());
});

P.when('A', 'addCardHandler', 'DPPUIConstants', 'CSM', 'PaySelectEventNames', 'DataStoreEventStatus', 'ready').execute(function(A, addCardHandler, DPPUIConstants, CSM, PaySelectEventNames, DataStoreEventStatus) {
    A.declarative('AddNewCard', 'click', function(event) {
        var addCardData = addCardHandler.getAddCardActionData();
        //pyoenabled: false to disable placing order after adding card.
        addCardHandler.broadcast(DPPUIConstants.EventTypes.PAYMENT_METHOD_ADDED,{addCardActionData: addCardData,pyoenabled: false});
        addCardHandler.emitAddCardEventDataMetrics(PaySelectEventNames.ADD_NEW_CARD_EVENT);
    });

    A.declarative('CancelAddCard', 'click', function(event) {
        CSM.log('CancelAddCard', 1);
        var buttonClicked  = event.$target;
        var form = buttonClicked.closest('.add-new-card-form');
        addCardHandler.onAddCardCancel(form);
        addCardHandler.emitAddCardEventDataMetrics(PaySelectEventNames.CANCEL_ADD_CARD_EVENT);
    });

    A.on("a:popover:show:storageConsentInfoCard", function (){
        addCardHandler.emitAddCardEventDataMetricsForProjectSeven(PaySelectEventNames.STORAGE_CONSENT_LEARN_MORE_CLICKED, null, "Click", DataStoreEventStatus.SUCCESS)
    })

    A.on("a:sheet:afterShow:storageConsentInfoCard", function (){
        addCardHandler.emitAddCardEventDataMetricsForProjectSeven(PaySelectEventNames.STORAGE_CONSENT_LEARN_MORE_CLICKED, null, "Click", DataStoreEventStatus.SUCCESS)
    })
});
        P.when("A").register("mustache", function(A) {
            
    var Mustache = {};
    /**
     * @preserve
     *
     * The MIT License
     *
     *Copyright (c) 2009 Chris Wanstrath (Ruby)
     *Copyright (c) 2010-2014 Jan Lehnardt (JavaScript)
     *Copyright (c) 2010-2015 The mustache.js community
    
     *Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"),
     *to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,
     *and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
     *
     *The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
     *THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
     *FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
     *DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE
     *OR OTHER DEALINGS IN THE SOFTWARE.
     *
     * */
    function mustacheFactory(mustache) {
    
        var objectToString = Object.prototype.toString;
        var isArray = Array.isArray || function isArrayPolyfill(object) {
            return objectToString.call(object) === '[object Array]';
        };
    
        function isFunction(object) {
            return typeof object === 'function';
        }
    
        function escapeRegExp(string) {
            return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\$&');
        }
    
        /**
         * Null safe way of checking whether or not an object,
         * including its prototype, has a given property
         */
        function hasProperty(obj, propName) {
            return obj != null && typeof obj === 'object' && (propName in obj);
        }
    
        // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577
        // See https://github.com/janl/mustache.js/issues/189
        var regExpTest = RegExp.prototype.test;
    
        function testRegExp(re, string) {
            return regExpTest.call(re, string);
        }
    
        var nonSpaceRe = /\S/;
    
        function isWhitespace(string) {
            return !testRegExp(nonSpaceRe, string);
        }
    
        var entityMap = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;',
            '/': '&#x2F;'
        };
    
        function escapeHtml(string) {
            return String(string).replace(/[&<>"'\/]/g, function fromEntityMap(s) {
                return entityMap[s];
            });
        }
    
        var whiteRe = /\s*/;
        var spaceRe = /\s+/;
        var equalsRe = /\s*=/;
        var curlyRe = /\s*\}/;
        var tagRe = /#|\^|\/|>|\{|&|=|!/;
    
        
        function parseTemplate(template, tags) {
            if (!template)
                return [];
    
            var sections = []; // Stack to hold section tokens
            var tokens = []; // Buffer to hold the tokens
            var spaces = []; // Indices of whitespace tokens on the current line
            var hasTag = false; // Is there a {{tag}} on the current line?
            var nonSpace = false; // Is there a non-space char on the current line?
    
            // Strips all whitespace tokens array for the current line
            // if there was a {{#tag}} on it and otherwise only space.
            function stripSpace() {
                if (hasTag && !nonSpace) {
                    while (spaces.length)
                        delete tokens[spaces.pop()];
                } else {
                    spaces = [];
                }
    
                hasTag = false;
                nonSpace = false;
            }
    
            var openingTagRe, closingTagRe, closingCurlyRe;
    
            function compileTags(tagsToCompile) {
                if (typeof tagsToCompile === 'string')
                    tagsToCompile = tagsToCompile.split(spaceRe, 2);
    
                if (!isArray(tagsToCompile) || tagsToCompile.length !== 2)
                    throw new Error('Invalid tags: ' + tagsToCompile);
    
                openingTagRe = new RegExp(escapeRegExp(tagsToCompile[0]) + '\\s*');
                closingTagRe = new RegExp('\\s*' + escapeRegExp(tagsToCompile[1]));
                closingCurlyRe = new RegExp('\\s*' + escapeRegExp('}' + tagsToCompile[1]));
            }
    
            compileTags(tags || mustache.tags);
    
            var scanner = new Scanner(template);
    
            var start, type, value, chr, token, openSection;
            while (!scanner.eos()) {
                start = scanner.pos;
    
                // Match any text between tags.
                value = scanner.scanUntil(openingTagRe);
    
                if (value) {
                    for (var i = 0, valueLength = value.length; i < valueLength; ++i) {
                        chr = value.charAt(i);
    
                        if (isWhitespace(chr)) {
                            spaces.push(tokens.length);
                        } else {
                            nonSpace = true;
                        }
    
                        tokens.push(['text', chr, start, start + 1]);
                        start += 1;
    
                        // Check for whitespace on the current line.
                        if (chr === '\n')
                            stripSpace();
                    }
                }
    
                // Match the opening tag.
                if (!scanner.scan(openingTagRe))
                    break;
    
                hasTag = true;
    
                // Get the tag type.
                type = scanner.scan(tagRe) || 'name';
                scanner.scan(whiteRe);
    
                // Get the tag value.
                if (type === '=') {
                    value = scanner.scanUntil(equalsRe);
                    scanner.scan(equalsRe);
                    scanner.scanUntil(closingTagRe);
                } else if (type === '{') {
                    value = scanner.scanUntil(closingCurlyRe);
                    scanner.scan(curlyRe);
                    scanner.scanUntil(closingTagRe);
                    type = '&';
                } else {
                    value = scanner.scanUntil(closingTagRe);
                }
    
                // Match the closing tag.
                if (!scanner.scan(closingTagRe))
                    throw new Error('Unclosed tag at ' + scanner.pos);
    
                token = [type, value, start, scanner.pos];
                tokens.push(token);
    
                if (type === '#' || type === '^') {
                    sections.push(token);
                } else if (type === '/') {
                    // Check section nesting.
                    openSection = sections.pop();
    
                    if (!openSection)
                        throw new Error('Unopened section "' + value + '" at ' + start);
    
                    if (openSection[1] !== value)
                        throw new Error('Unclosed section "' + openSection[1] + '" at ' + start);
                } else if (type === 'name' || type === '{' || type === '&') {
                    nonSpace = true;
                } else if (type === '=') {
                    // Set the tags for the next time around.
                    compileTags(value);
                }
            }
    
            // Make sure there are no open sections when we're done.
            openSection = sections.pop();
    
            if (openSection)
                throw new Error('Unclosed section "' + openSection[1] + '" at ' + scanner.pos);
    
            return nestTokens(squashTokens(tokens));
        }
    
        /**
         * Combines the values of consecutive text tokens in the given `tokens` array
         * to a single token.
         */
        function squashTokens(tokens) {
            var squashedTokens = [];
    
            var token, lastToken;
            for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {
                token = tokens[i];
    
                if (token) {
                    if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {
                        lastToken[1] += token[1];
                        lastToken[3] = token[3];
                    } else {
                        squashedTokens.push(token);
                        lastToken = token;
                    }
                }
            }
    
            return squashedTokens;
        }
    
        /**
         * Forms the given array of `tokens` into a nested tree structure where
         * tokens that represent a section have two additional items: 1) an array of
         * all tokens that appear in that section and 2) the index in the original
         * template that represents the end of that section.
         */
        function nestTokens(tokens) {
            var nestedTokens = [];
            var collector = nestedTokens;
            var sections = [];
    
            var token, section;
            for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {
                token = tokens[i];
    
                switch (token[0]) {
                    case '#':
                    case '^':
                        collector.push(token);
                        sections.push(token);
                        collector = token[4] = [];
                        break;
                    case '/':
                        section = sections.pop();
                        section[5] = token[2];
                        collector = sections.length > 0 ? sections[sections.length - 1][4] : nestedTokens;
                        break;
                    default:
                        collector.push(token);
                }
            }
    
            return nestedTokens;
        }
    
        /**
         * A simple string scanner that is used by the template parser to find
         * tokens in template strings.
         */
        function Scanner(string) {
            this.string = string;
            this.tail = string;
            this.pos = 0;
        }
    
        /**
         * Returns `true` if the tail is empty (end of string).
         */
        Scanner.prototype.eos = function eos() {
            return this.tail === '';
        };
    
        /**
         * Tries to match the given regular expression at the current position.
         * Returns the matched text if it can match, the empty string otherwise.
         */
        Scanner.prototype.scan = function scan(re) {
            var match = this.tail.match(re);
    
            if (!match || match.index !== 0)
                return '';
    
            var string = match[0];
    
            this.tail = this.tail.substring(string.length);
            this.pos += string.length;
    
            return string;
        };
    
        /**
         * Skips all text until the given regular expression can be matched. Returns
         * the skipped string, which is the entire tail if no match can be made.
         */
        Scanner.prototype.scanUntil = function scanUntil(re) {
            var index = this.tail.search(re),
                match;
    
            switch (index) {
                case -1:
                    match = this.tail;
                    this.tail = '';
                    break;
                case 0:
                    match = '';
                    break;
                default:
                    match = this.tail.substring(0, index);
                    this.tail = this.tail.substring(index);
            }
    
            this.pos += match.length;
    
            return match;
        };
    
        /**
         * Represents a rendering context by wrapping a view object and
         * maintaining a reference to the parent context.
         */
        function Context(view, parentContext) {
            this.view = view;
            this.cache = {
                '.': this.view
            };
            this.parent = parentContext;
        }
    
        /**
         * Creates a new context using the given view with this context
         * as the parent.
         */
        Context.prototype.push = function push(view) {
            return new Context(view, this);
        };
    
        /**
         * Returns the value of the given name in this context, traversing
         * up the context hierarchy if the value is absent in this context's view.
         */
        Context.prototype.lookup = function lookup(name) {
            var cache = this.cache;
    
            var value;
            if (cache.hasOwnProperty(name)) {
                value = cache[name];
            } else {
                var context = this,
                    names, index, lookupHit = false;
    
                while (context) {
                    if (name.indexOf('.') > 0) {
                        value = context.view;
                        names = name.split('.');
                        index = 0;
    
                        /**
                         * Using the dot notion path in `name`, we descend through the
                         * nested objects.
                         *
                         * To be certain that the lookup has been successful, we have to
                         * check if the last object in the path actually has the property
                         * we are looking for. We store the result in `lookupHit`.
                         *
                         * This is specially necessary for when the value has been set to
                         * `undefined` and we want to avoid looking up parent contexts.
                         **/
                        while (value != null && index < names.length) {
                            if (index === names.length - 1)
                                lookupHit = hasProperty(value, names[index]);
    
                            value = value[names[index++]];
                        }
                    } else {
                        value = context.view[name];
                        lookupHit = hasProperty(context.view, name);
                    }
    
                    if (lookupHit)
                        break;
    
                    context = context.parent;
                }
    
                cache[name] = value;
            }
    
            if (isFunction(value))
                value = value.call(this.view);
    
            return value;
        };
    
        /**
         * A Writer knows how to take a stream of tokens and render them to a
         * string, given a context. It also maintains a cache of templates to
         * avoid the need to parse the same template twice.
         */
        function Writer() {
            this.cache = {};
        }
    
        /**
         * Clears all cached templates in this writer.
         */
        Writer.prototype.clearCache = function clearCache() {
            this.cache = {};
        };
    
        /**
         * Parses and caches the given `template` and returns the array of tokens
         * that is generated from the parse.
         */
        Writer.prototype.parse = function parse(template, tags) {
            var cache = this.cache;
            var tokens = cache[template];
    
            if (tokens == null)
                tokens = cache[template] = parseTemplate(template, tags);
    
            return tokens;
        };
    
        /**
         * High-level method that is used to render the given `template` with
         * the given `view`.
         *
         * The optional `partials` argument may be an object that contains the
         * names and templates of partials that are used in the template. It may
         * also be a function that is used to load partial templates on the fly
         * that takes a single argument: the name of the partial.
         */
        Writer.prototype.render = function render(template, view, partials) {
            var tokens = this.parse(template);
            var context = (view instanceof Context) ? view : new Context(view);
            return this.renderTokens(tokens, context, partials, template);
        };
    
        /**
         * Low-level method that renders the given array of `tokens` using
         * the given `context` and `partials`.
         *
         * Note: The `originalTemplate` is only ever used to extract the portion
         * of the original template that was contained in a higher-order section.
         * If the template doesn't use higher-order sections, this argument may
         * be omitted.
         */
        Writer.prototype.renderTokens = function renderTokens(tokens, context, partials, originalTemplate) {
            var buffer = '';
    
            var token, symbol, value;
            for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {
                value = undefined;
                token = tokens[i];
                symbol = token[0];
    
                if (symbol === '#') value = this.renderSection(token, context, partials, originalTemplate);
                else if (symbol === '^') value = this.renderInverted(token, context, partials, originalTemplate);
                else if (symbol === '>') value = this.renderPartial(token, context, partials, originalTemplate);
                else if (symbol === '&') value = this.unescapedValue(token, context);
                else if (symbol === 'name') value = this.escapedValue(token, context);
                else if (symbol === 'text') value = this.rawValue(token);
    
                if (value !== undefined)
                    buffer += value;
            }
    
            return buffer;
        };
    
        Writer.prototype.renderSection = function renderSection(token, context, partials, originalTemplate) {
            var self = this;
            var buffer = '';
            var value = context.lookup(token[1]);
    
            // This function is used to render an arbitrary template
            // in the current context by higher-order sections.
            function subRender(template) {
                return self.render(template, context, partials);
            }
    
            if (!value) return;
    
            if (isArray(value)) {
                for (var j = 0, valueLength = value.length; j < valueLength; ++j) {
                    buffer += this.renderTokens(token[4], context.push(value[j]), partials, originalTemplate);
                }
            } else if (typeof value === 'object' || typeof value === 'string' || typeof value === 'number') {
                buffer += this.renderTokens(token[4], context.push(value), partials, originalTemplate);
            } else if (isFunction(value)) {
                if (typeof originalTemplate !== 'string')
                    throw new Error('Cannot use higher-order sections without the original template');
    
                // Extract the portion of the original template that the section contains.
                value = value.call(context.view, originalTemplate.slice(token[3], token[5]), subRender);
    
                if (value != null)
                    buffer += value;
            } else {
                buffer += this.renderTokens(token[4], context, partials, originalTemplate);
            }
            return buffer;
        };
    
        Writer.prototype.renderInverted = function renderInverted(token, context, partials, originalTemplate) {
            var value = context.lookup(token[1]);
    
            // Use JavaScript's definition of falsy. Include empty arrays.
            // See https://github.com/janl/mustache.js/issues/186
            if (!value || (isArray(value) && value.length === 0))
                return this.renderTokens(token[4], context, partials, originalTemplate);
        };
    
        Writer.prototype.renderPartial = function renderPartial(token, context, partials) {
            if (!partials) return;
    
            var value = isFunction(partials) ? partials(token[1]) : partials[token[1]];
            if (value != null)
                return this.renderTokens(this.parse(value), context, partials, value);
        };
    
        Writer.prototype.unescapedValue = function unescapedValue(token, context) {
            var value = context.lookup(token[1]);
            if (value != null)
                return value;
        };
    
        Writer.prototype.escapedValue = function escapedValue(token, context) {
            var value = context.lookup(token[1]);
            if (value != null)
                return mustache.escape(value);
        };
    
        Writer.prototype.rawValue = function rawValue(token) {
            return token[1];
        };
    
        mustache.name = 'mustache.js';
        mustache.version = '2.1.2';
        mustache.tags = ['{{', '}}'];
    
        // All high-level mustache.* functions use this writer.
        var defaultWriter = new Writer();
    
        /**
         * Clears all cached templates in the default writer.
         */
        mustache.clearCache = function clearCache() {
            return defaultWriter.clearCache();
        };
    
        /**
         * Parses and caches the given template in the default writer and returns the
         * array of tokens it contains. Doing this ahead of time avoids the need to
         * parse templates on the fly as they are rendered.
         */
        mustache.parse = function parse(template, tags) {
            return defaultWriter.parse(template, tags);
        };
    
        /**
         * Renders the `template` with the given `view` and `partials` using the
         * default writer.
         */
        mustache.render = function render(template, view, partials) {
            return defaultWriter.render(template, view, partials);
        };
    
        // This is here for backwards compatibility with 0.4.x.,
        /*eslint-disable */ // eslint wants camel cased function name
        mustache.to_html = function to_html(template, view, partials, send) {
            /*eslint-enable*/
    
            var result = mustache.render(template, view, partials);
    
            if (isFunction(send)) {
                send(result);
            } else {
                return result;
            }
        };
    
        // Export the escaping function so that the user may override it.
        // See https://github.com/janl/mustache.js/issues/244
        mustache.escape = escapeHtml;
    
        // Export these mainly for testing, but also for advanced usage.
        mustache.Scanner = Scanner;
        mustache.Context = Context;
        mustache.Writer = Writer;
    };
    mustacheFactory(Mustache);
    window.Mustache = Mustache;

            return Mustache;
        });
    <span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://t.corp.amazon.com/D9004660" title="Open URL: https://t.corp.amazon.com/D9004660 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://t.corp.amazon.com/D9004660" title="Open URL in Popup: https://t.corp.amazon.com/D9004660 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>
    <script>
    P.when('A', 'jQuery', 'a-dropdown', 'ready').register("FormControlUtil", function(A, jQuery, dropdown) {
        function getFormControl(formControlId, form) {
            if(form) {
                return form.find("[data-id*='" + formControlId + "']");
            } else {
                return jQuery("[data-id*='" + formControlId + "']");
            }
        };

        function getFormControlId(formControl, form) {
            return jQuery(formControl).data('id');
        };

        function getField(formControl, form) {
            /* AUI Hack : Using data-id to fetch data from the actual element and not outer div */
            var elementId = jQuery(formControl).data('id');
            var nativeId = jQuery(formControl).data('native-id');
            if (nativeId && dropdown.getSelect(nativeId)) {
                elementId = nativeId;
            }
            if (form) {
                return form.find('#' + elementId);
            } else {
                return jQuery('#' + elementId);
            }
        };

        function getFieldValue(formControl, form) {
            var formField = getField(formControl, form);
            return formField.val().trim();
        };

        function getValidator(formControl) {
            return jQuery(formControl).data('field-validators');
        };

        function shouldValidate(formControl) {
            return !jQuery(formControl).hasClass("aok-hidden");
        };

        function getErrorSection(formControl, form) {
            var errorSection = '#' + formControl.data('error-element');
            if(form) {
                errorSection = form.find(errorSection);
            }
            return errorSection;
        };

        return {
            getFormControl : getFormControl,
            getFormControlId : getFormControlId,
            getField : getField,
            getFieldValue : getFieldValue,
            getValidator : getValidator,
            shouldValidate : shouldValidate,
            getErrorSection : getErrorSection
        };
    });
</script><script>
    P.when('jQuery', 'ready').register('validators', function(jQuery) {

         var emailAddressValidatorRgx = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
         var dateValidationRegex = /^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/ ;
         var hasLeadingZerosRegex = /^0+/;
         var amexCvvRegex = /^[0-9]{4}$/;
         var normalCvvRegex = /^[0-9]{3}$/;
          /* Performs a LUHN check validation for the entered credit-card number.
           * Luhn's check is not applicable for SMCC Temporary cards.
           */
         function luhnCheckValidator(cardNumber, formFieldValidator, form) {
             var cardIssuer = jQuery(form).find(".cardNumber").data('card-issuer');
             if (cardIssuer != null && cardIssuer !== 'SmccTemporary') {
                cardNumber = cardNumber.replace(/[\s-]+/g, "");
                if (isNaN(cardNumber)) {
                    return false;
                }
                var sum = 0;
                var shouldMultiply = false;
                for (var i = cardNumber.length - 1; i >= 0; i--) {
                    var n = parseInt(cardNumber.substring(i, i + 1));
                    if (shouldMultiply) {
                        n *= 2;
                        if (n > 9) {
                            n = n - 9;
                        }
                    }
                    sum += n;
                    shouldMultiply = !shouldMultiply;
                }
                return (sum % 10 == 0);
              }
              return true;
         }

         /* Checks if a selected date satisfies constraints to be
            either a future date or a past date */
         function dateRangeValidator(year, formFieldValidator, form) {
             var subType = formFieldValidator.subType;
             var date = new Date();
             var currMonth = date.getMonth() + 1;
             var currYear = date.getFullYear();

             var maxYear;
             if (formFieldValidator.maxYear) {
                maxYear = currYear + parseInt(formFieldValidator.maxYear);
             }

             var monthId = formFieldValidator.monthId;
             var selectedMonth = parseInt(jQuery(form).find("select[id*='" + monthId + "']").find(":selected").text());
             var selectedYear = parseInt(year);

             switch(subType) {
                case "future":
                    if (maxYear) {
                        return ((selectedYear > currYear) && (selectedYear <= maxYear)) || ((selectedMonth >= currMonth) && (selectedYear == currYear));
                    }
                    return (selectedYear > currYear) || ((selectedMonth >= currMonth) && (selectedYear == currYear));

                case "past":
                    return (selectedYear < currYear) || ((selectedMonth < currMonth) && (selectedYear == currYear));

                default:
                    return false;
             }
         }

         /* Mandates that a particular form-control has non-empty value  */
         function requiredValidator(formControlValue, formFieldValidator, form) {
             if (formControlValue && formControlValue.length > 0) {
                return true;
             }
             return false;
         }

         /* Validates that the customer specified value lies between the specified
            minimum and maximum lengths */
         function lengthValidator(formControlValue, formFieldValidator, form) {
             var minLength = (formFieldValidator.minLength || 0);
             var maxLength = (formFieldValidator.maxLength || Number.MAX_VALUE);
             if ((formControlValue.length >= minLength) && (formControlValue.length <= maxLength)) {
                return true;
             }
             return false;
         }

         /* Validates the form-control value against the Regular Expression pattern
            required in the form control validator */
         function regExpValidator(formControlValue, formFieldValidator, form) {
             var expression = new RegExp(formFieldValidator.pattern);
             return expression.test(formControlValue);
         }

         function emailAddressValidator(email) {
            return emailAddressValidatorRgx.test(email);
        }

        function dateValidator(dateString) {

            formFieldValidator = {};
            formFieldValidator.pattern = dateValidationRegex;

            if (!regExpValidator(dateString, formFieldValidator, null)) {
                return false;
            }

            var parts   = dateString.split("/");
            var day     = parseInt(parts[1], 10);
            var month   = parseInt(parts[0], 10);
            var year    = parseInt(parts[2], 10);

            var monthLength = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];

            if(year % 400 == 0 || (year % 100 != 0 && year % 4 == 0)) {
                monthLength[1] = 29;
            }

            return day > 0 && day <= monthLength[month - 1];
        }

        function hasLeadingZerosValidator(inputString) {
            return hasLeadingZerosRegex.test(inputString);
        }

        function isFormElementEmpty(formElement) {
            return formElement == "";
        }

        function cpfValidator(cpfInput) {

            var base, checkDigits, sum, result;

            if(/^\d{11}$/.test(cpfInput) || /^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(cpfInput)) {
                cpfInput = cpfInput.replace(/[^\w\s]|_/g,"");
                // ensure that there are atleast 2 different digits
                if(/(\d)\1{10}/.test(cpfInput)) {
                    return false;
                }
                base = cpfInput.substring(0,9);
                checkDigits = cpfInput.substring(9);
                sum = 0;
                for(var i = 10; i > 1; i--) {
                    sum += base.charAt(10 - i) * i;
                }
                result = sum % 11 < 2 ? 0 : 11 - sum % 11;
                if(result != checkDigits.charAt(0)) {
                    return false;
                }
                base = cpfInput.substring(0,10);
                sum = 0;
                for(var i = 11; i > 1; i--) {
                    sum += base.charAt(11 - i) * i;
                }
                result = sum % 11 < 2 ? 0 : 11 - sum % 11;
                if(result != checkDigits.charAt(1)) {
                    return false;
                }
                return true;
            }
            return false;
        }

        /* This checks if the entered CVV is valid. It checks the card number field for the issuer data attribute, which contains
           the card network.
         */
        function cvvValidator(cvv, formFieldValidator, form) {
          var cardIssuer = jQuery(form).find(".cardNumber").attr('data-card-issuer')
              || jQuery(form).find(".saved-card").attr('data-issuer');
          return cvvValidateWithCardType(cvv, cardIssuer);
        }

        /* Helper function that actually performs the validation. Can be unit-tested */
        function cvvValidateWithCardType(cvv, cardType) {
          if (cardType === "AmericanExpress") {
            return amexCvvRegex.test(cvv);
          } else {
            return normalCvvRegex.test(cvv);
          }
        }

         return {
             luhncheck : luhnCheckValidator,
             date      : dateRangeValidator,
             validateDate : dateValidator,
             required  : requiredValidator,
             length    : lengthValidator,
             regexp    : regExpValidator,
             validateEmail : emailAddressValidator,
             hasLeadingZeros : hasLeadingZerosValidator,
             isFormElementEmpty : isFormElementEmpty,
             isValidCpf : cpfValidator,
             cvv: cvvValidator,
             cvvValidateWithCardType: cvvValidateWithCardType
         }
    });

    P.when('jQuery', 'FormControlUtil', 'ready').register('errors', function(jQuery, FormControlUtil) {

        function hideError(formControl, form) {
            P.when('a-alert').execute(function (getAlertCollection) {
                var errorDiv = getAlertCollection(FormControlUtil.getErrorSection(formControl, form));
                errorDiv.hide();
                formControl.removeClass('a-form-error');
            });
        }

        function showError(formControl, errorMessage, form) {
            P.when('a-alert').execute(function (getAlertCollection) {
                var errorDiv = getAlertCollection(FormControlUtil.getErrorSection(formControl, form));
                errorDiv.text(errorMessage);
                errorDiv.show();
                formControl.addClass('a-form-error');
            });
        }

        function showRegistrationErrors(errorFieldList, form) {
            jQuery.each(errorFieldList, function(key, errorField) {
                var formControl = FormControlUtil.getFormControl(errorField.formControlId, form);
                var errorMessage = '';
                jQuery.each(errorField.errors, function(key, error) {
                    errorMessage += error.message + ', ';
                });
                showError(formControl, errorMessage.slice(0, -2), form);
            });
        }

        function showMessageInTarget(form, targetFormControlId, message) {
            if (form) {
                P.when('a-alert').execute(function (getAlertCollection) {
                    var errorDiv = getAlertCollection(form.find("#" + targetFormControlId));
                    (errorDiv) && errorDiv.text(message).show();
                });
            }
        }

        function hideMessageFromTarget(form, targetFormControlId) {
            if (form) {
                P.when('a-alert').execute(function (getAlertCollection) {
                    var errorDiv = getAlertCollection(form.find("#" + targetFormControlId));
                    (errorDiv) && errorDiv.text("").hide();
                });
            }
        }

        return {
            hideError : hideError,
            showError : showError,
            showRegistrationErrors : showRegistrationErrors,
            showMessageInTarget : showMessageInTarget,
            hideMessageFromTarget : hideMessageFromTarget
        }
    });

    P.when('jQuery','FormControlUtil', 'ready').register('formFieldConstraints', function(jQuery, FormControlUtil) {

        function applyMaxLength(formControl, maxLength) {
            if (maxLength && !formControl.attr("maxlength")) {
                formControl.attr("maxlength", maxLength);
            }
        }

        function applyLength(formControl, formFieldValidator, form) {
            var maxLength = formFieldValidator.maxLength;
            var element  = FormControlUtil.getField(formControl, form);
            applyMaxLength(element, maxLength);
        }

        return {
            length : applyLength
        }
    });

    P.when('jQuery', 'formFieldConstraints', 'validators', 'errors', 'FormControlUtil', 'ready').register('validateForm', function(jQuery, formFieldConstraints, validators, errors, FormControlUtil) {
        return {
            applyFormFieldConstraints : function initValidators(formControls, form) {
                jQuery.each(formControls, function(key, formControl) {
                    var formFieldValidators = FormControlUtil.getValidator(jQuery(formControl));
                    if (formFieldValidators) {

                        jQuery.each(formFieldValidators, function(key, validator) {
                            var validatorType = validator.type;
                            var validationFunction = formFieldConstraints[validatorType];
                            if(validationFunction && typeof validationFunction == "function") {
                                validationFunction(formControl, validator, form);
                            }
                        });
                    }
                });
            },

            validate : function validate(formControls, form) {
                jQuery.each(formControls, function(key, formControl) {
                    errors.hideError(jQuery(formControl), form);
                });

                var validationStatus = true;
                jQuery.each(formControls, function(key, formControl) {
                    var formFieldValidators = FormControlUtil.getValidator(formControl);
                    if (formFieldValidators && FormControlUtil.shouldValidate(formControl)) {
                        jQuery.each(formFieldValidators, function(key, validator) {
                            var value = FormControlUtil.getFieldValue(jQuery(formControl), form);
                            var validatorType = validator.type;
                            if (typeof validators[validatorType] == "function") {
                                var validationResult = validators[validatorType](value, validator, form);
                                if (!validationResult) {
                                    errors.showError(jQuery(formControl), validator.message, form);
                                    validationStatus = false;
                                    return false;
                                }
                            }
                        });
                    }
                });

                return validationStatus;
            }
        }
    });
</script>
<script>
var currencyUtil = ( function() {
    function getBooleanValue(value) {
        return value ? true : false;
    }

    function formatInteger(value, formatOption) {
        var numberDelimiter = formatOption.numberDelimiter;
        var useIndianNumberSystem = getBooleanValue(formatOption.useIndianNumberSystem);
        if (useIndianNumberSystem) {
            return value.replace(/(\d)(?=(\d\d)+\d$)/g, "$1"+numberDelimiter);
        } else {
            return value.replace(/(\d)(?=(\d\d\d)+$)/g, "$1"+numberDelimiter);
        }
    }

    function formatDecimalNumber(value, formatOption) {
        var out = [];
        var fixedDecimalPrecision = formatOption.fixedDecimalPrecision;

        var valueString = value.toFixed(fixedDecimalPrecision);
        var valueStringSplit = valueString.split(".");
        out.push(formatInteger(valueStringSplit[0], formatOption));

        if (fixedDecimalPrecision > 0) {
            out.push(formatOption.radix);
            out.push(valueStringSplit[1]);
        }

        return out.join("");
    }

    function validateFormatInput(value, parsedAmountValue, formatOption) {
        if (value == null || value === "" || isNaN(parsedAmountValue)) {
            throw new Error("The amount value is invalid. It must be represented as a decimal number in string format.");
        }

        if (!formatOption) {
           throw new Error("The formatOption is invalid");
        }
    }

    function format(value, formatOption) {
        var parsedAmountValue = Number(value);
        validateFormatInput(value, parsedAmountValue, formatOption);

        var formattedAbsoluteValue = formatDecimalNumber(Math.abs(parsedAmountValue), formatOption);

        var out = [];
        if (parsedAmountValue < 0) {
            out.push("-");
        }

        var symbolAfterNumber = getBooleanValue(formatOption.symbolAfterNumber);
        var symbol = formatOption.symbol;

        if (symbolAfterNumber) {
            out.push(formattedAbsoluteValue);
            out.push(" ");
            out.push(symbol);
        } else {
            out.push(symbol);
            out.push(formattedAbsoluteValue);
        }

        return out.join("");
    }

    // ISO 4217 domain for price and currency formatting used
    function formatISO(value, unit, formatOption) {
        var parsedAmountValue = Number(value);
        validateFormatInput(value, parsedAmountValue, formatOption);

        var formattedAbsoluteValue = formatDecimalNumber(Math.abs(parsedAmountValue), formatOption);

        var out = [];
        if (parsedAmountValue < 0) {
            out.push("-");
        }

        var symbolAfterNumber = getBooleanValue(formatOption.symbolAfterNumber);
        var symbol = formatOption.symbol;

        if (symbolAfterNumber) {
            out.push(formattedAbsoluteValue);
            out.push(" ");
            out.push(unit);
        } else {
            out.push(unit);
            out.push(" ");
            out.push(formattedAbsoluteValue);
        }

        return out.join("");
    }

    return { format : format,
             formatISO : formatISO,
             formatDecimalNumber: formatDecimalNumber,
      		 formatInteger: formatInteger
     };
})();

var CurrencyManager = function(jQuery) {
    function update(element) {
        var value = element.data("value");
        var unit = element.data("unit");
        var formatOptions = jQuery("#currencyData").data("currency-format-map");
        if (formatOptions[unit]) {
            element.html(currencyUtil.format(value, formatOptions[unit]));
        } else {
            throw new Error("Unable to get format option for unit = " + unit);
        }
    }

    function updateAll(elements) {
        elements.each(function(){
            update(jQuery(this));
        });
    }

    function updateValue(element, value) {
        element.data("value", value);
        update(element);
    }

    function updateCurrencyUnit(element, unit) {
        element.data("unit", unit);
        update(element);
    }

    function format(value, unit) {
    	var formatOptions = jQuery("#currencyData").data("currency-format-map");
    	if (formatOptions[unit]) {
    	    if(jQuery('#currencyOfPreferenceEnabled').data("value") == true) {
                return currencyUtil.formatISO(value, unit, formatOptions[unit]);
            }
            return currencyUtil.format(value, formatOptions[unit]);
        }
        throw new Error("Unable to get format option for unit = " + unit);
    }

    function currencyConverter(value, unit) {
        var currencyOfPreferencePrice ;
        if(jQuery('#currencyOfPreferenceEnabled').data("value") == true) {
            currencyOfPreferencePrice = {};
            var exchangeRateValue = jQuery('#currencyOfPreferenceValue').data("value");
            var currencyOfPreferenceUnit = jQuery('#currencyOfPreferenceUnit').data("value");
            var currencyOfPreferenceValue = value * exchangeRateValue;
            var formatOptions = jQuery("#currencyData").data("currency-format-map");
            var formatOptionOfPrefferedCurrency = formatOptions[currencyOfPreferenceUnit];
            // Rounding off after conversion
            if (formatOptionOfPrefferedCurrency) {
                var fixedDecimalPrecision = formatOptionOfPrefferedCurrency.fixedDecimalPrecision;
                currencyOfPreferenceValue = currencyOfPreferenceValue.toFixed(fixedDecimalPrecision)
            }
            currencyOfPreferencePrice.value = currencyOfPreferenceValue;
            currencyOfPreferencePrice.unit = currencyOfPreferenceUnit;
        }
        return currencyOfPreferencePrice;
    }

    return {
    	format : format,
        update : update,
        updateAll : updateAll,
        updateValue : updateValue,
        updateCurrencyUnit : updateCurrencyUnit,
        currencyConverter : currencyConverter,
    };
};
</script><script>
P.when('jQuery', 'ready').register("CSM", function(jQuery) {
    var selected = ":Selected";
    var deselected = ":Deselected";

    function log(event, count) {
        var ue = window.ue;
        count = count != null && Number(count) != NaN ? count : 1;
        //CSM Event cannot contain whitespaces - removing whitespaces.
        event = event.replace(/\s/g,"");
        if (ue && ue.count){
            ue.count(event, count);
        }
    };

    function logCount(metric, isCumulative, count) {
        if (isCumulative === undefined) {
            isCumulative = false;   
        }
        if (count === undefined) {
            count = 1;
        }
        var ue = window.ue;
        if (ue && ue.count ){
            if (isCumulative) {
                log(metric, count + (ue.count(metric) || 0));
            }
            else {
                log(metric, count);
            }
        }       
    };

    function instrumentSelection(element) {
        var instrument = jQuery(element).closest("[data-code]");
        var instrumentType = jQuery(instrument).data("code");
        var state = element.checked ? selected : deselected;
        var violations = getViolations(element);
        var event = instrumentType;
        jQuery.each(violations, function(i, violation) {
            event = event + ":" + violation;
        });
        event = event + state;
        log(event, 1);
    };

    function getViolations(element) {
        var violations = [];
        var list = jQuery(jQuery(element).closest(".paymentInstrument")).find(".violation");

        jQuery.each(list, function(i, entry) {
            var violation = jQuery(entry).data("violation");
            if (violation != null) {
                violations.push(violation);
            }
        });
        return violations;
    };

    return {
        log : log,
        logCount : logCount,
        instrumentSelection : instrumentSelection
    };
});
</script>
<script>
    P.when('A', 'jQuery', 'Handler', 'paymentMethodsHandler', 'validators', 'CSM', 'ready').execute(function(A,jQuery, Handler, paymentMethodsHandler, validators, CSM) {
        var BankAccountsSleeveHandler = Handler.extend({
            init : function() {
                this.registerDataSource("BankAccounts:getSelectedBankAccounts", this.getSelectedBankAccounts.bind(this));
            },
            getSelectedBankAccounts : function(data) {
                var selectedBankAccounts = [];
                var bankAccountType = "BankAccount";
                var element = jQuery('.paymentData');
                if(element.length == 0) {
                    return selectedBankAccounts;
                }
                var paymentMethodCode = element.data("code");
                if (paymentMethodCode === bankAccountType) {
                    var active = element.data("active");
                    if (active & active.length == 0) {
                        CSM.log("NoActivePaymentMethodAvailable", 1);
                    }
                    var violation = element.data("violation");
                    if (violation.length == 0) {
                        var isAuthorizationRequired = element.data("authorization-required");
                        var instrumentId = element.data("id");
                        var displayText = element.data("display-text");
                        var preferenceEligible = element.data("preference-eligible");
                        var eligibleBackingMethods = element.data("eligible-backing-methods");
                        var traits = new PaymentMethodTraits(preferenceEligible, isAuthorizationRequired, true);
                        var additionalData = [];
                        var selectedBankAccount = new PaymentMethodDetails(element, 1, instrumentId, paymentMethodCode, bankAccountType, null,
                        traits, displayText, null, null, eligibleBackingMethods, additionalData);
                        selectedBankAccounts.push(selectedBankAccount);
                    }
                }
                return selectedBankAccounts;
            }
        });
        P.declare("bankAccountsSleeveHandler", new BankAccountsSleeveHandler());
    });

</script><script>
    P.when('A', 'jQuery', 'Handler', 'paymentMethodsHandler', 'validators', 'CSM', 'ready').execute(function(A,jQuery, Handler, paymentMethodsHandler, validators, CSM) {
        var CardsSleeveHandler = Handler.extend({
            init : function() {
                this.registerDataSource("Cards:getSelectedCard", this.getSelectedCard.bind(this));
            },
            getSelectedCard : function(data) {
                var selectedCards = [];
                var cardType = "Card";
                var element = jQuery('.paymentData');
                if(element.length == 0) {
                    return selectedCards;
                }
                var paymentMethodCode = element.data("code");
                if (paymentMethodCode === cardType) {
                    var active = element.data("active");
                    if (active & active.length == 0) {
                        CSM.log("NoActivePaymentMethodAvailable", 1);
                    }
                    var violation = element.data("violation");
                    if (violation.length == 0) {
                        var isAuthorizationRequired = element.data("authorization-required");
                        var instrumentId = element.data("id");
                        var displayText = element.data("display-text");
                        var preferenceEligible = element.data("preference-eligible");
                        var eligibleBackingMethods = element.data("eligible-backing-methods");
                        var traits = new PaymentMethodTraits(preferenceEligible, isAuthorizationRequired, true);
                        var additionalData = [];
                        var selectedCard = new PaymentMethodDetails(element, 1, instrumentId, paymentMethodCode, cardType, null,
                        traits, displayText, null, null, eligibleBackingMethods, additionalData);
                        selectedCards.push(selectedCard);
                    }
                }
                return selectedCards;
            }
        });
        P.declare("cardsSleeveHandler", new CardsSleeveHandler());
    });

</script><script>
  P.when('A', 'jQuery', 'Handler', 'addressHandler', 'paySelectHandler', 'errorHandler','paymentMethodsHandler', 'ready').execute(function(A, jQuery, Handler, addressHandler, paySelectHandler, errorHandler, paymentMethodsHandler) {
    var BillingAddressHandler = Handler.extend({
        addressType : "BillingAddress",

        init : function() {
            this.registerHandlerMethod("BillingAddress:FormAdded", this.initBillingAddressForm.bind(this));
            this.registerHandlerMethod("BillingAddressForm:Hide", this.hideBillingAddressForm.bind(this));

            addressHandler.registerDataSource(this.addressType + ":GetAddressAjaxData",  this.getUpdateInstrumentAddressAjaxData.bind(this));
            addressHandler.registerDataSource(this.addressType + ":GetAddAddressAjaxData",  this.getAddAddressAjaxData.bind(this));
            addressHandler.registerDataSource(this.addressType + ":ShouldJustAddAddressInAddressBook",  this.canAddAddress.bind(this));
            addressHandler.registerCallback(this.addressType + ":Added", this.onAddAddress.bind(this));
            addressHandler.registerCallback(this.addressType + ":Updated", this.onInstrumentAddressUpdate.bind(this));
            addressHandler.registerCallback(this.addressType + ":UpdateFailed", this.onInstrumentAddressUpdateFailure.bind(this));
            addressHandler.registerCallback(this.addressType + ":Cancelled", this.onAddressFormCancel.bind(this));
        },

        initBillingAddressForm : function(form){
            var billingAddressSection = form.find(".billing-address-form");
            var billingAddressData = billingAddressSection.find(".billing-address-data");
            addressHandler.trigger("Address:FormAdded", {
                "isAddressMandatory" : billingAddressData.data("is-address-mandatory"),
                "addressType" : this.addressType,
                "form" : billingAddressSection
            });
        },

        getAddressAjaxData : function(addressSection) {
            var billingAddressSection = addressSection.closest('.billing-address-form');
            var billingAddressData = billingAddressSection.find(".billing-address-data");
            var payables = paymentMethodsHandler.fetch("PaymentMethod:GetPayable");
            return {
                "data" : {
                    "paymentInstrumentId": billingAddressData.data("payment-instrument-id"),
                    "paymentInstrumentType": billingAddressData.data("payment-instrument-type"),
                    "paymentContext" : jQuery("#paymentContext").data('payment-ctx'),
                    "payables" : payables
                }
            }
        },

        getUpdateInstrumentAddressAjaxData : function(addressSection) {
            var billingAddressSection = addressSection.closest('.billing-address-form');
            var billingAddressData = billingAddressSection.find(".billing-address-data");
            var updateAddressAjaxData = this.getAddressAjaxData(addressSection);
            updateAddressAjaxData.url = billingAddressData.data("update-instrument-url");
            return updateAddressAjaxData;
        },

        getAddAddressAjaxData : function(addressSection) {
            var billingAddressSection = addressSection.closest('.billing-address-form');
            var billingAddressData = billingAddressSection.find(".billing-address-data");
            var addAddressAjaxData = this.getAddressAjaxData(addressSection);
            delete addAddressAjaxData.data.paymentContext;
            delete addAddressAjaxData.data.payables;
            addAddressAjaxData.url = billingAddressData.data("add-address-url");
            return addAddressAjaxData;
        },

        onInstrumentAddressUpdate : function(updateAddressResponse) {
            var response = updateAddressResponse.response;
            var errorFieldList = response.errorFieldList;
            if (response.blockOriginalAddress) {
                addressHandler.trigger("Address:RegistrationGenericError", {
                    "targetFormControlId" : "formGenericError",
                    "section" : updateAddressResponse.section,
                    "message" : response.message,
                    "show"    : true
                 });
            }
            else if (errorFieldList && errorFieldList.length > 0) {
                 addressHandler.trigger("Address:RegistrationError", {
                    "errorFieldList" : errorFieldList,
                    "section" : updateAddressResponse.section
                 });
            } else if (response.hasExceptionOccured) {
                 // No errors but still exception thrown then show generic error message
                 addressHandler.trigger("Address:RegistrationGenericError", {
                    "targetFormControlId" : "formGenericError",
                    "section" : updateAddressResponse.section,
                    "message" : response.message,
                    "show"    : true
                 });
            } else { 
                this.process("BillingAddress:Associated", response);
                paySelectHandler.trigger("BillingAddress:Added");
                // TODO: Have to trigger this change depending on the response as wether shipping address is also added or not.
            }
        },

        onAddAddress : function(addAddressResponse) {
            var response = addAddressResponse.response;
            var section = addAddressResponse.section;
            var errorFieldList = response.errorFieldList;
            if (errorFieldList && errorFieldList.length > 0) {
                 addressHandler.trigger("Address:RegistrationError", {
                    "errorFieldList" : errorFieldList,
                    "section" : section
                 });
            } else if (response.hasExceptionOccured) {
                 // No errors but still exception thrown then show generic error message
                 addressHandler.trigger("Address:RegistrationGenericError", {
                    "targetFormControlId" : "formGenericError",
                    "section" : section,
                    "message" : response.message,
                    "show"    : true
                });
            } else {
                this.execute("AddAddress:Success", response);
                if (response.addressId) {
                    this.execute("ChooseAddress", jQuery("*[data-address-id='" + response.addressId + "']"));
                }
            }
        },

        canAddAddress : function(billingAddressSection) {
            var section = billingAddressSection.closest('.address-form');
            var billingAddressData = section.closest('.billing-address-form').find('.billing-address-data');
            return (billingAddressData.data('add-address-url') && !billingAddressData.data('update-instrument-url'));
        },

        onInstrumentAddressUpdateFailure : function() {
            errorHandler.showError(errorHandler.INTERNAL_ERROR_INFORM);
        },

        onAddressFormCancel : function() {
            this.process("BillingAddress:Aborted");
        },

        hideBillingAddressForm : function(form) {
            jQuery(form).addClass("aok-hidden");
        }

    });

    var billingAddressHandler = new BillingAddressHandler();
    P.declare("billingAddressHandler", billingAddressHandler);
  });

</script>
<script>
P.when('A', 'Handler', 'PaySelectHelper', 'jQuery', 'ClientDataSenderObject','CDSEvents', 'DPPUIConstants', 'ready').execute(function(A, Handler, PaySelectHelper, jQuery, ClientDataSenderObject, CDSEvents, DPPUIConstants){
    var PaySelectHandler = Handler.extend({
        init : function() {
            this.registerHandlerMethod("PaymentMethod:changed", this.onPaymentMethodChange.bind(this));
            this.registerHandlerMethod("Product:changed", this.onProductChange.bind(this));
            this.registerHandlerMethod("BillingAddress:Added", this.onBillingAddressAdded.bind(this));
            this.registerHandlerMethod("ProductPrice:updated", this.onProductPriceUpdate.bind(this));
            this.registerDataSource("PaySelect:GetEventDifferentiator", this.getEventDifferentiator.bind(this));
            this.registerDataSource("GetEligibilityCriteria", this.generateEligibilityCriteria.bind(this));
            this.registerDataSource("PaySelect:GetPayable", this.getPayable.bind(this));
            this.registerDataSource("PaySelect:GetOrderTotal", this.getOrderTotal.bind(this));
            this.registerDataSource("PaySelect:GetProductsPrice", this.getProductsPrice.bind(this));
            this.registerDataSource("GetAction", this.getAction.bind(this));
            this.initialize();
            var self = this;
            A.declarative('a-popover', 'click', function(event){
                var popoverName = event.data.name;
                if (popoverName) {
                    self.broadcast(CDSEvents.ADD_EVENT_DATA,
                            { eventName : DPPUIConstants.EventTypes.POPUP_SHOWN,
                              result : popoverName
                        });
                }
            });
            A.declarative('a-modal', 'click', function(event){
                var modalName = event.data.name;
                if (modalName) {
                    self.broadcast(CDSEvents.ADD_EVENT_DATA,
                            { eventName : DPPUIConstants.EventTypes.POPUP_SHOWN,
                              result : modalName
                        });
                }
            });
        },

        initialize : function() {
            var eventLoggingConfig = jQuery("#eventLoggingConfig");
            if(eventLoggingConfig != null) {
                var configData = { url : eventLoggingConfig.data("url"),
                                   batchSize : eventLoggingConfig.data("batch-size"),
                                   interval : eventLoggingConfig.data("interval") };
                ClientDataSenderObject.initialize(configData);
            }
        },

        onPaymentMethodChange : function() {
            var selectedPaymentOptions = paySelectHandler.fetch("GetSelectedPaymentOptions");
            this.process("PaySelect:paymentMethodChanged", selectedPaymentOptions);
            this.process("PreferenceMessageHandler:Update", selectedPaymentOptions);
        },

        onProductChange : function() {
            var selectedProducts = this.fetch("GetSelectedProductDetails");
            var eligibilityCriteria = this.generateEligibilityCriteria();
            this.process("PaymentMethod:ResetPaymentOptions", eligibilityCriteria);
            this.process("PaySelect:productChanged", selectedProducts);
        },

        onProductPriceUpdate : function() {
            this.process("PaySelect:productPriceUpdated");
        },

        onBillingAddressAdded : function() {
            this.process("PaySelect:ChangeDisplayLabel");
        },

        isChargeTypeRecurring : function(selectedProducts) {
            for (var index in selectedProducts) {
                if (selectedProducts[index].chargeType == "RECURRING") {
                    return true;
                }
            }
            return false;
        },

        getEligibleDuration : function(selectedProducts) {
            for (var index in selectedProducts) {
                if (selectedProducts[index].duration != undefined) {
                    return selectedProducts[index].duration;
                }
            }
            return undefined;
        },

        generateEligibilityCriteria : function() {
            var selectedProducts = this.fetch("GetSelectedProductDetails");
            if (typeof selectedProducts != 'undefined') {
                var eligibilityCriteria = {};
                eligibilityCriteria.eligibleDuration = this.getEligibleDuration(selectedProducts);
                if (this.isChargeTypeRecurring(selectedProducts)) {
                    eligibilityCriteria.preferenceEligible = true;
                }
                if (PaySelectHelper.isDeductionSufficientInOrderSummary(selectedProducts)) {
                    eligibilityCriteria.eligibleForFreeOrder = true;
                }
                if (this.isBalanceTopupOrder(selectedProducts)) {
                    eligibilityCriteria.balanceTopupEligible = true;
                }
            }
            return eligibilityCriteria;
        },

        isBalanceTopupOrder : function(selectedProducts) {
            for (var index in selectedProducts) {
                if (selectedProducts[index].productType == "BALANCE_TOPUP") {
                    return true;
                }
            }
            return false;
        },

        getProductsPrice : function() {
           var selectedProducts = this.fetch("GetSelectedProductDetails");
           return PaySelectHelper.getTotalProductsPrice(selectedProducts);
        },

        getOrderTotal : function() {
            var selectedProducts = this.fetch("GetSelectedProductDetails");
            return PaySelectHelper.getOrderTotal(selectedProducts);
        },

        getPayable : function() {
            var selectedProducts = this.fetch("GetSelectedProductDetails");
            var selectedPaymentOptions = this.fetch("GetSelectedPaymentOptions");
            return PaySelectHelper.getPayable(selectedProducts, selectedPaymentOptions);
        },

        // Currently used only for differentiating Topup & Pay.
        getEventDifferentiator : function() {
            var selectedProducts = this.fetch("GetSelectedProductDetails");
            for (var index in selectedProducts) {
                if (selectedProducts[index].productType == "BALANCE_TOPUP") {
                    return "TopupAndPay";
                }
            }
            return null;
        },

        getAction : function (data) {
            return this.fetch("PaymentOptions:GetAction", data);
        }
    });

    var paySelectHandler = new PaySelectHandler();
    P.declare("paySelectHandler", paySelectHandler);
});

P.when('jQuery', 'ready').execute(function(jQuery){
    var currencyManager = new CurrencyManager(jQuery);
    P.declare("currencyManager", currencyManager);
    currencyManager.updateAll(jQuery('.currency'));
});

P.when('A', 'jQuery', 'errorHandler', 'ready').execute(function(A, jQuery, errorHandler) {
    var optionsElem = jQuery("#paymentOptionsContent");
    if (optionsElem.length) {
        var paymentOptions = optionsElem.data('payment-options');
        if (!paymentOptions) {
            errorHandler.showError(errorHandler.INTERNAL_ERROR_REDIRECT);
        }
    }
});

P.when('A', 'jQuery', 'errorHandler', 'ready').execute(function(A, jQuery, errorHandler) {
     var productsSelectorContainer = jQuery("#product-selector");
     if (productsSelectorContainer.length) {
         var isProductDetailsPresent = productsSelectorContainer.data('is-product-details-present');
         if (isProductDetailsPresent!=null && !isProductDetailsPresent) {
            // If isProductDetailsPresent is present and is not a falsy value.
             errorHandler.showError(errorHandler.INTERNAL_ERROR_REDIRECT);
         }
     }
});

function ActionDescriptor(element, handler, roles, selectedPaymentOptions) {
    this.element = element;
    this.handler = handler;
    this.roles = roles;
    this.selectedPaymentOptions = selectedPaymentOptions;
}
</script><meta content="c1a2821c-96f5-11ed-a8b4-3381b68c66b3" name="event-correlation-token">
<script type="text/javascript">
    P.when('jQuery','ready').execute(function(jQuery){
    jQuery.ajaxPrefilter(function(options, originalOptions, jqXHR){
        var eventCorrelationToken = jQuery('meta[name="event-correlation-token"]').attr('content');
        if (eventCorrelationToken) {
            jqXHR.setRequestHeader('X-Amazon-vps-correlation-id', eventCorrelationToken);
        }
        jqXHR.setRequestHeader('PostAuthReferer', window.location.href);
    });
});</script><script>
    P.when('A', 'jQuery', 'productQuantityHandler', 'ready').register("PaySelectHelper", function(A, jQuery, productQuantityHandler) {
        function getOrderTotal(products) {
            return getAmountToCover(products);
        };

        function getAmountToCover(products) {
          var totalProductsPrice = getTotalProductsPrice(products);
          var taxAmount = getTotalTax(products);
          var totalDeductionAmount = getTotalDeductionAmount(products);
          var orderTotal = totalProductsPrice + taxAmount - totalDeductionAmount;
          return orderTotal;
        };

        function getTotalProductsPrice(products) {
            //override default helper method if a client helper method exists and is fetched successfully
            var clientTotal = productQuantityHandler.fetch("ClientPaySelectHelper:GetTotalProductsPrice", products);
            if (clientTotal) {
                return clientTotal;
            }

            var total = 0;
            for (var x in products) {
                var price = products[x].price;
                if (price && price.value) {
                    total += price.value;
                }
            }
            //updating order total if quantity is present
            var quantity = productQuantityHandler.fetch("ProductQuantity:GetUpdatedQuantity");
            if(quantity) {
                total *=  parseInt(quantity);
            }
            return total;
        };

        function getTotalTax(products) {
            var total = 0;
            for (var index in products) {
                 total += getTaxForSingleProduct(products[index]);
            }
            return total;
        };

        function getTaxForSingleProduct(product) {
            var breakdown = product.breakdown;
            if(breakdown && breakdown.taxAmount) {
              var price = breakdown.taxAmount.price;
              if (price && price.value) {
                return parseFloat(price.value);
              }
            }
            return 0;
        };

        function getTotalDeductionAmount(products) {
            var total = 0;
            for (var index in products) {
                 total += getDeductionForSingleProduct(products[index]);
            }
            return total;
        };

        function getDeductionForSingleProduct(product) {
            var breakdown = product.breakdown;
            var totalDeductionAmount = 0;
            if(breakdown) {
                var deductions = breakdown.deductions;
                if (deductions) {
                    for (var index = 0; index < deductions.length; index++) {
                        var deduction = deductions[index];
                        if (deduction && deduction.price && deduction.price.value) {
                            totalDeductionAmount += parseFloat(deduction.price.value);
                        }
                    }
                }
            }
            return totalDeductionAmount;
        };

        function isDeductionSufficientInOrderSummary(products) {
          var totalPrice = getTotalProductsPrice(products) + getTotalTax(products);
          var totalDeductionAmount = getTotalDeductionAmount(products);
          var deductionSufficient = totalPrice > 0 && totalDeductionAmount > 0 && (totalPrice - totalDeductionAmount) <= 0;
          return (promoInOrderSummaryEnabled() && deductionSufficient);
        };

        function promoInOrderSummaryEnabled(){
            var orderSummaryContainer = jQuery('#order-summary-container');
            return orderSummaryContainer.data('show-promotion') || orderSummaryContainer.data('should-lazy-load-promotions');
        };

        function getTestCharge(selectedPaymentOptions) {
            if (selectedPaymentOptions && selectedPaymentOptions instanceof Array) {
                for(var index = 0; index < selectedPaymentOptions.length; index++) {
                    if (selectedPaymentOptions[index].testCharge) {
                        return selectedPaymentOptions[index].testCharge;
                    }
                }
            }
        };

        function getPayable(selectedProducts, selectedPaymentOptions) {
            var payables = [];
            for (var x in selectedProducts) {
                var product = selectedProducts[x];
                var payable = {};
                payable.asin = product.id;
                payable.price = product.price;
                payable.chargeType = product.chargeType;
                if (product.vetRequired) {
                    var testCharge = getTestCharge(selectedPaymentOptions)
                    if (testCharge) {
                      var vetCharge = {};
                        vetCharge.value = testCharge.value;
                        vetCharge.unit = testCharge.unit;
                        payable.vetCharge = vetCharge;
                    }
                    payable.vetRequired = product.vetRequired;
                }
                payable.maximumMandatePrice = typeof product.maximumMandatePrice != undefined ? product.maximumMandatePrice : '';
                payable.nextBillingAmount = typeof product.nextBillingAmount != undefined ? product.nextBillingAmount : '';

                payable.billingCycle = product.billingCycle;
                payable.offeringSku = product.offeringSku;
                if (product.clientReference) {
                    payable.clientReference = product.clientReference;
                }
                if (product.recurringClientReference) {
                    payable.recurringClientReference = product.recurringClientReference;
                }
                payable.quantity = (product.breakdown && product.breakdown.quantity && product.breakdown.quantity.value) ? product.breakdown.quantity.value : '1';
                payables.push(payable);
            }
            return payables;
        };

        function removePayableByChargeType(payables, chargeType) {
            return payables.filter(function(value, index, array){
                return value != undefined && chargeType != value.chargeType;
            });
        };

        return {
          getOrderTotal : getOrderTotal,
          getAmountToCover : getAmountToCover,
          getTestCharge : getTestCharge,
          getPayable : getPayable,
          getTotalProductsPrice : getTotalProductsPrice,
          getTotalDeductionAmount : getTotalDeductionAmount,
          isDeductionSufficientInOrderSummary : isDeductionSufficientInOrderSummary,
          removePayableByChargeType : removePayableByChargeType
        };
    });
</script><script>
  P.when('A', 'jQuery', 'Handler', 'addAddress', 'chooseAddress','CDSEvents', 'DPPUIConstants', 'errorHandler', 'a-button', 'ready').execute(function(A, jQuery, Handler, addAddress, chooseAddress, CDSEvents, DPPUIConstants, errorHandler, getButtonCollection) {
    var AddressHandler = Handler.extend({
        init : function() {
            this.registerHandlerMethod("Address:FormAdded", this.initAddressForm.bind(this));
            this.registerHandlerMethod("Address:RegistrationError", this.handleRegistrationErrors.bind(this));
            this.registerHandlerMethod("Address:RegistrationGenericError", this.handleRegistrationGenericError);
            this.registerHandlerMethod("Address:InvalidAddressInformation", this.handleInvalidAddressInformation.bind(this));
            this.registerHandlerMethod("ChooseAddress:ChooseAddressClicked",this.updateAddress.bind(this));
            this.registerHandlerMethod("ChooseAddress:ShowAddAddressFormClicked",this.showAddAddress.bind(this));
            this.registerHandlerMethod("ChooseAddress:CancelClicked",this.onChooseAddressCancel.bind(this));

            this.registerHandlerMethod("AddAddress:AddAddressClicked",this.addOrUpdateAddress.bind(this));
            this.registerHandlerMethod("AddAddress:CancelClicked",this.onAddAddressCancel.bind(this));
        },

        initAddressForm : function(context) {
            var addressSection = context.form.find('.address-form');
            var isAddressListEmpty = addressSection.data("is-address-list-empty");
            addressSection.data("address-type", context.addressType);
            if(context.isAddressMandatory) {
                chooseAddress.removeCancel(addressSection);
                if(isAddressListEmpty) {
                    addAddress.removeCancel(addressSection);
                }
            }
            if(isAddressListEmpty) {
                addAddress.show(addressSection);
                this.broadcast(CDSEvents.ADD_EVENT_DATA, {eventName : context.addressType + "FormShown", result : "EmptyAddressList"});
            } else {
                this.broadcast(CDSEvents.ADD_EVENT_DATA, {eventName : context.addressType + "FormShown", result : "NonEmptyAddressList"});
            }
            addAddress.initForm(addressSection);
        },

        getAddressContainer : function(section) {
            return section.closest('.address-form');
        },

        getAddressType : function(addressSection){
            return addressSection.data("address-type");
        },

        addOrUpdateAddress : function(addressData) {
           var addressSection = this.getAddressContainer(addressData.section);
           var addressType = this.getAddressType(addressSection);
           if (addressData.address) {
               this.broadcast(CDSEvents.ADD_EVENT_DATA, {eventName : addressType + "FormShown", result : "NewAddressAdded"});
           }
           if (addressType) {
                if (this.fetch(addressType + ":ShouldJustAddAddressInAddressBook", addressSection)) {
                    // Just adds address in address book, and gets updated {addressType} form.
                    this.addAddress(addressData);
                } else {
                    this.updateAddress(addressData);
                }
           }
        },

        updateAddress : function(addressData) {
            var addressSection = this.getAddressContainer(addressData.section);
            var addressType = this.getAddressType(addressSection);
            delete addressData.section;
            if (addressData.addressId) {
               this.broadcast(CDSEvents.ADD_EVENT_DATA, {eventName : addressType + "FormShown", result : "ExistingAddressSelected", targetId : addressData.addressId});
            }
            var ajaxData = this.fetch(addressType + ":GetAddressAjaxData", addressSection);
            var data = ajaxData.data ? ajaxData.data : {};
            var ajaxUrl = ajaxData.url;
            var self = this;
            if(ajaxUrl) {

                // Disabling the button once it has been clicked to prevent customers from clicking the button multiple times.
                var selectExistingAddressButton = getButtonCollection('.select-existing-address');
                if (selectExistingAddressButton) {
                    selectExistingAddressButton.disable();
                }
                var addNewAddressButton = getButtonCollection('.add-new-address');
                if (addNewAddressButton) {
                    addNewAddressButton.disable();
                }

                var ajaxRequestData = {
                    url : ajaxUrl,
                    data : JSON.stringify(jQuery.extend(data, addressData)),
                    type : 'POST',
                    contentType : 'application/json',
                    cache : false
                };
                var ajax = jQuery.ajax(ajaxRequestData);
                ajax.done(function(response) {
                    self.process(addressType + ":Updated", {
                        "response" : response,
                        "section" : addressSection
                    });
                    if (response && response.message && response.message === "PaymentMethodInactive") {
                        errorHandler.showError(errorHandler.PAYMENT_METHOD_INACTIVE);
                    }
                    if (response.blockOriginalAddress != 'undefined') {
                        jQuery(".generic-address-form").data("block-original-address", response.blockOriginalAddress);
                    }
                    if ((response.errorFieldList && response.errorFieldList.length > 0) || (response.hasExceptionOccured) || (response.blockOriginalAddress)) {
                        var selectExistingAddressButton = getButtonCollection('.select-existing-address');
                        if (selectExistingAddressButton) {
                            selectExistingAddressButton.enable();
                        }
                        var addNewAddressButton = getButtonCollection('.add-new-address');
                        if (addNewAddressButton) {
                            addNewAddressButton.enable();
                        }
                    }
                });
                ajax.fail(function(response) {

                    // Enabling the disabled button again, if in case the Ajax call fails for some reason so that the customer could retry.
                    var selectExistingAddressButton = getButtonCollection('.select-existing-address');
                    if (selectExistingAddressButton) {
                        selectExistingAddressButton.enable();
                    }
                    var addNewAddressButton = getButtonCollection('.add-new-address');
                    if (addNewAddressButton) {
                        addNewAddressButton.enable();
                    }

                    if (response.status == 401) {
                        errorHandler.showError(errorHandler.CSRF_VALIDATION_ERROR);
                    } else if(response.status == 403) {
                        //This empty block is added to avoid control from going in else block and causing unexpected behaviour.
                    } else {
                    self.process(addressType + ":UpdateFailed", addressSection);
                    }
                });
            }
        },

        addAddress : function(addressData) {
            var addressSection = this.getAddressContainer(addressData.section);
            delete addressData.section;
            var addressType = this.getAddressType(addressSection);
            var self = this;
            var ajaxData = this.fetch(addressType + ":GetAddAddressAjaxData", addressSection);
            var data = ajaxData.data ? ajaxData.data : {};
            var ajaxUrl = ajaxData.url;
            data.addressType = addressType === "BillingAddress" ? DPPUIConstants.AddressTypes.BILLING_ADDRESS : DPPUIConstants.AddressTypes.SHIPPING_ADDRESS;
            if(ajaxUrl) {
                var ajaxRequestData = {
                    url : ajaxUrl,
                    data : JSON.stringify(jQuery.extend(data, addressData)),
                    type : 'POST',
                    contentType : 'application/json',
                    cache : false
                };
                var ajax = jQuery.ajax(ajaxRequestData);
                ajax.done(function(response) {
                    self.process(addressType + ":Added", {
                        "response" : response,
                        "section" : addressSection
                    });
                  if (response && response.message && response.message === "PaymentMethodInactive") {
                    errorHandler.showError(errorHandler.PAYMENT_METHOD_INACTIVE);
                  }
                });
                ajax.fail(function(response) {
                    if (response.status == 401){
                        errorHandler.showError(errorHandler.CSRF_VALIDATION_ERROR);
                    } else if(response.status == 403) {
                        //This empty block is added to avoid control from going in else block and causing unexpected behaviour.
                    } else {
                        self.process(addressType + ":UpdateFailed", addressSection);
                    }
                });
            }
        },

        onChooseAddressCancel : function(section) {
            var addressSection = this.getAddressContainer(section);
            chooseAddress.hide(addressSection);
            this.process(this.getAddressType(addressSection) + ":Cancelled", addressSection);
        },

        onAddAddressCancel : function(section) {
            this.broadcast('AddAddress:FormCancelled');
            var addressSection = this.getAddressContainer(section);
            addAddress.hide(addressSection);
            if(addressSection.data("is-address-list-empty")) {
                this.process(this.getAddressType(addressSection) + ":Cancelled", addressSection);
            } else {
                chooseAddress.show(addressSection);
                this.process(this.getAddressType(addressSection) + ":ContentChanged");
            }
        },

        showAddAddress : function(section) {
            var addressSection = this.getAddressContainer(section);
            chooseAddress.hide(addressSection);
            addAddress.show(addressSection);
            this.focusAddAddressForm(addressSection);
            this.process(this.getAddressType(addressSection) + ":ContentChanged");
        },

        focusAddAddressForm : function(addressSection) {
            addressSection.find('input[type="text"]').first().focus();
        },

        handleRegistrationErrors : function(errorData) {
            addAddress.handleRegistrationErrors(errorData.errorFieldList, errorData.section);
        },

        handleRegistrationGenericError : function(errorData) {
            addAddress.handleRegistrationGenericError(errorData);
        },

        handleInvalidAddressInformation : function(errorData) {
            this.process("BillingAddress:InvalidAddressInformation", errorData);
        }

    });

    var addressHandler = new AddressHandler();
    P.declare("addressHandler", addressHandler);
  });
</script>
<script>
P.when('A', 'jQuery', 'Handler', 'validateForm', 'errors', 'ready').execute(function(A, jQuery, Handler, validateForm, errors) {
    var AddAddress = Handler.extend({

        initForm : function(form) {
            var addAddressSection = this.find(form);
            var formControlList = addAddressSection.find(".AddressFormControl");
            validateForm.applyFormFieldConstraints(formControlList, addAddressSection);
        },

        find : function(form) {
            return form.find(".add-address-form");
        },

        hide : function(form) {
            this.find(form).addClass('aok-hidden');
        },

        show : function(form) {
            this.execute('AddAddress:FormDisplayed');
            this.find(form).removeClass('aok-hidden');
        },

        removeCancel : function(form) {
            form.find(".cancel-add-address").remove();
        },

        handleRegistrationErrors : function(errorFieldList, form) {
            errors.showRegistrationErrors(errorFieldList, form);
        },

        handleRegistrationGenericError : function(errorData) {
            errorData.show ? errors.showMessageInTarget(errorData.section, errorData.targetFormControlId, errorData.message) : errors.hideMessageFromTarget(errorData.section, errorData.targetFormControlId);
        }

    });
    var addAddress = new AddAddress();
    P.declare("addAddress", addAddress);
});

P.when('A', 'jQuery', 'addressHandler', 'validateForm', 'CSM', 'verifyAndValidateZipCode', 'a-button', 'errors', 'ready').execute(function(A, jQuery, addressHandler, validateForm, CSM, verifyAndValidateZipCode, getButtonCollection, errors) {

    function getAddAddressContainer(section) {
        return section.closest('.add-address-form');
    }

    function getActiveAddressSectionform(section) {
        var brFormAddress = section.find(".br-avs-form");
        var nonBRFormAddress = section.find(".non-br-avs-form");
        if (brFormAddress.hasClass("aok-hidden")) {
            return nonBRFormAddress;
        } else if (nonBRFormAddress.hasClass("aok-hidden")) {
            return brFormAddress;
        }
        return section;
    }

    function validateRequiredFieldAddressLine2(section) {
        if (section.hasClass("br-avs-form")) {
            addressLine2 = section.find("#addressLine2");
            addressLine2Value =  jQuery(addressLine2).val();
            var addressLine2Value = addressLine2Value.replace(/^\s+|\s+$/g, '');
            if ((addressLine2Value == "") && (addressLine2Value.length == 0)) {
                var message = jQuery('.br-data-address-form').data("addressline2_required_message");
                errors.showError(addressLine2, message, section);
                return false;
            }
        }
        return true;
    }

    A.declarative('AddNewAddress', 'click', function(event) {
        var addNewAddressButton = getButtonCollection('.add-new-address');
        if (addNewAddressButton.isEnabled()) {
            var requiredValidationforAddressline2 = true;
            var requireZipCodeValidation = true;
            var isAISSEnabled =  jQuery('.generic-address-form').data("is-aiss-enabled");
            var addAddressSection = getAddAddressContainer(event.$target);
            /**
             *  Check to get the active form. BR has two forms for AVS phase2 launch
             *  this will triggered once the weblab is active.
             */
            if (isAISSEnabled) {
                addAddressSection = getActiveAddressSectionform(addAddressSection);
            }
            var formControlList = addAddressSection.find(".AddressFormControl");
            addressHandler.trigger("Address:RegistrationGenericError", { "targetFormControlId": "formGenericError", "section": addAddressSection, "message":"", "show": false});
            var validationStatus  = validateForm.validate(formControlList, addAddressSection);
            if (isAISSEnabled) {
                requiredValidationforAddressline2 = validateRequiredFieldAddressLine2(addAddressSection);
            }
          var shouldRestrictInvalidZipCode = jQuery('.generic-address-form').data("should-restrict-invalid-zip-code");
          if (shouldRestrictInvalidZipCode) {
            verifyAndValidateZipCode(event);
            requireZipCodeValidation = addAddressSection.find('#postalCodeError').hasClass("aok-hidden");
          }
            if (validationStatus && requiredValidationforAddressline2 && requireZipCodeValidation) {
                var addressFormPlaceholder = addAddressSection.closest('.address-form-placeholder');
                (addressFormPlaceholder) && addressFormPlaceholder.addClass('addressAdded');
                var address = addressHandler.fetch("AddAddress:GetAddressModel", {formControlList : formControlList, addAddressSection : addAddressSection});
                address["blockOriginalAddress"] = jQuery('.generic-address-form').data("block-original-address");
                addressHandler.trigger("AddAddress:AddAddressClicked", { "address": address, "section": addAddressSection});
            } else {
                //re-setting the AlertType to Error.

                showInvalidZipCodeErrorWarning(addAddressSection, "error");
                addressHandler.trigger("Address:InvalidAddressInformation", "invalid-address-information");
                if (!jQuery('.generic-address-form').data("is-aiss-enabled") && !shouldRestrictInvalidZipCode) {
                    verifyAndValidateZipCode(event);
                }

            }
        }
    });
    A.declarative('CancelAddNewAddress', 'click', function(event) {
        CSM.log('CancelAddNewAddress', 1);
        addressHandler.trigger("AddAddress:CancelClicked", event.$target);
    });
});

P.when('A', 'jQuery', 'addressHandler', 'errors', 'ready').execute(function(A, jQuery, addressHandler, errors) {

//    changing from focusout to change to avoid multiple hits
	A.declarative('ValidateAddressZipCode', 'change', function(event) {
        verifyAndValidateZipCode(event);
	});

    // This function will invoke validation logic only if country zip-code is supported by AVS.
	function verifyAndValidateZipCode(event) {
        var countryList = jQuery('.generic-address-form').data("validate-zip-country-list");

        var section = event.$target;
        var addAddressSection = section.closest('.add-address-form');
        var formControlList = addAddressSection.find(".AddressFormControl");
        var address = addressHandler.fetch("AddAddress:GetAddressModel", {
        	formControlList: formControlList,
        	addAddressSection: addAddressSection
        });
        var countryCode = address.countryCode;
        var zipCode = address.postalCode.trim();

        if (countryList.includes(countryCode)) {
            validateAddressZipCode(event);

        } else if (((zipCode != "") && (zipCode.length != 0))) {
            var ZipOrPostalCode = addAddressSection.find("#PostalCode");
            var zipOrPostalCode = addAddressSection.find("#postalCode");
            errors.hideError(ZipOrPostalCode, addAddressSection);
            errors.hideError(zipOrPostalCode, addAddressSection);
        }
    }

	function validateAddressZipCode(event) {
        var section = event.$target;
        var addAddressSection = section.closest('.add-address-form');
        var formControlList = addAddressSection.find(".AddressFormControl");

        //Fetching state, city, zipCode section for mobile (AW) which is used in future processing.
        var StateOrRegion = addAddressSection.find("#StateOrRegion");
        var City = addAddressSection.find("#City");
        var ZipOrPostalCode = addAddressSection.find("#PostalCode");

        //Fetching state, city, zipCode section which is used in future processing.
        var stateOrRegion = addAddressSection.find("#stateOrRegion");
        var city = addAddressSection.find("#city");
        var zipOrPostalCode = addAddressSection.find("#postalCode");

        //Element of RW Address form of JP.
        var zipOrPostalCodeJP1 = addAddressSection.find("#postalCode1");
        var zipOrPostalCodeJP2 = addAddressSection.find("#postalCode2");

        //Element of AW Address form of JP.
        var ZipOrPostalCodeJP1 = addAddressSection.find("#PostalCode1");
        var ZipOrPostalCodeJP2 = addAddressSection.find("#PostalCode2");

        //Fetching complete addressForm details in address as entire formControlList is passed as an input to fetch.
        var address = addressHandler.fetch("AddAddress:GetAddressModel", {
        	formControlList: formControlList,
        	addAddressSection: addAddressSection
        });
        var zip = address.postalCode.trim();
        var country = address.countryCode.trim();

        if ((zip != "") && (zip.length != 0) && (zip != "-") && verifyElementVal(addAddressSection, "#postalCode1") && verifyElementVal(addAddressSection, "#postalCode2")) {
        	//Fetching the URL(validate-zip-code url) to which the request to be passed as an input.
        	var ajaxUrl = jQuery('.generic-address-form').data("validate-zip-url");
        	var ajaxData = {
        		"zipCode": zip,
        		"country": country,
        		"lookUpApi" : "AVS"
        	};

        	//Building Ajax request to be passed for the desired URL if present.
        	if (ajaxUrl) {
              //Instead of default asynchronous call should make synchronous ajax call to hard restrict invalid zip code if shouldRestrictInvalidZipCode is set true.
              var shouldRestrictInvalidZipCode = jQuery('.generic-address-form').data("should-restrict-invalid-zip-code");
              var ajaxRequestData = {
        			url: ajaxUrl,
        			data: JSON.stringify(ajaxData),
        			type: 'POST',
                    async: shouldRestrictInvalidZipCode ? false : true,
        			contentType: 'application/json',
        			cache: false
        		};
        	}

        	//Making Ajax call with the request data built.
        	if (ajaxRequestData) {
        		var ajax = jQuery.ajax(ajaxRequestData);
        	}

        	ajax.done(function (response) {

        		//Clearing appropriate field validation errors if present in mobile (AW).
        		if (ZipOrPostalCode.length || ZipOrPostalCodeJP1.length || ZipOrPostalCodeJP2.length) {
        			errors.hideError(ZipOrPostalCode, addAddressSection);
        			errors.hideError(ZipOrPostalCodeJP1, addAddressSection);
                    errors.hideError(ZipOrPostalCodeJP2, addAddressSection);
        		} else {
        			//Clearing appropriate field validation errors if present.
        			errors.hideError(zipOrPostalCode, addAddressSection);
        			errors.hideError(zipOrPostalCodeJP1, addAddressSection);
        			errors.hideError(zipOrPostalCodeJP2, addAddressSection);
        		}

        		var errorFieldList = response.errorFieldList;
        		if (errorFieldList && errorFieldList.length > 0) {
                  var shouldRestrictInvalidZipCode = jQuery('.generic-address-form').data("should-restrict-invalid-zip-code");
                  if (shouldRestrictInvalidZipCode) {
                    showInvalidZipCodeErrorWarning(addAddressSection, "error");
                  } else {
                    //Function call to dynamically change AlertType to Warning. Since invalid error is not hardStop for customer.
                    showInvalidZipCodeErrorWarning(addAddressSection,
                      "warning");
                  }
                  addressHandler.trigger("Address:RegistrationError", {
                    "errorFieldList": errorFieldList,
                    "section": addAddressSection
                  });
        		}
        	});

        	ajax.fail(function (response) {
        		console.log("Ajax call invoked but there is no bean initialized");
        	});
        }
	}

	function verifyElementVal(form, element) {
        if(form.find(element).length && form.find(element).val() != undefined) {
            if (form.find(element).val() == "") {
                return false;
            }
        }
        return true;
    }

	P.declare('verifyAndValidateZipCode', verifyAndValidateZipCode);
});

   function showInvalidZipCodeErrorWarning (form, alertType) {
        P.when('a-alert').execute(function (getAlertCollection) {
            var postalCodeError = getAlertCollection(form.find('#postalCodeError'));
                postalCodeError.type(alertType);
        });
   }
</script>
<script>
P.when('A', 'jQuery', 'Handler', 'ready').execute(function(A, jQuery, Handler) {
    var ChooseAddress = Handler.extend({
        init : function() {
            this.subscribe("ChooseAddress", this.chooseAddress.bind(this));
        },

        find : function(form) {
            return form.find(".choose-address-form");
        },
        hide : function(form) {
            this.find(form).addClass('aok-hidden');
        },

        show : function(form) {
            this.find(form).removeClass('aok-hidden');
        },
        removeCancel : function(form) {
            form.find(".cancel-choose-address").remove();
        },

        chooseAddress : function(event, address) {
            if (address) {
                radio = jQuery(address).find("input[type='radio']");
                if (radio && radio.length > 0) {
                    radio[0].click();
                }
            }
        }
    });
    var chooseAddress = new ChooseAddress();
    P.declare("chooseAddress", chooseAddress);
});

P.when('A', 'jQuery', 'addressHandler', 'CSM', 'a-button', 'ready').execute(function(A, jQuery, addressHandler, CSM, getButtonCollection) {

    function enableChooseAddress(chooseAddressSection) {
        P.when('a-button').execute(function (getButtonCollection) {
            var button = getButtonCollection(chooseAddressSection.find(".select-existing-address"));
            button.enable();
        });
    }

    function getChooseAddressContainer(section) {
        return section.closest('.choose-address-form');
    }

    A.declarative('addressRadio', 'click', function(event) {
        var chooseAddressSection = getChooseAddressContainer(event.$target);
        var addressRadio = chooseAddressSection.find("input[type='radio']");

        addressRadio.each(function() {
            var radio = jQuery(this).closest(".address-box");
            if(this.checked) {
                radio.removeClass("box-borderless");
                radio.addClass("box-selected");
                enableChooseAddress(chooseAddressSection);
            } else {
                radio.addClass("box-borderless");
                radio.removeClass("box-selected");
            }
        });
    });

    A.declarative('ChooseExistingAddress', 'click', function(event, data) {
        var selectExistingAddressButton = getButtonCollection('.select-existing-address');
        if (selectExistingAddressButton.isEnabled()) {
            var chooseAddressSection = jQuery(getChooseAddressContainer(event.$target));
            var addressRadio = chooseAddressSection.find("input[type='radio']");

            var  addressId;
            if (addressRadio.length) {
                addressId = chooseAddressSection.find("input[type='radio']:checked").closest('[id^="outer-billing-address-radiobutton-"]').data('address-id');
            } else {
                addressId = jQuery(event.$target.get(0)).data('address-id');
            }
            addressHandler.trigger("ChooseAddress:ChooseAddressClicked", { "addressId": addressId, "section": chooseAddressSection });
        }
    });

    A.declarative('ShowAddAddressForm', 'click', function(event) {
        CSM.log('ShowAddAddressForm', 1);
        addressHandler.trigger("ChooseAddress:ShowAddAddressFormClicked", event.$target);
    });

    A.declarative('CancelChooseAddress', 'click', function(event) {
        CSM.log('CancelChooseAddress', 1);
        addressHandler.trigger("ChooseAddress:CancelClicked", event.$target);
    });
});

</script>
<script>
P.when('A', 'jQuery', 'Handler', 'addressHandler', 'a-modal', 'ready').execute(function(A, jQuery, Handler, addressHandler, a_modal) {
    var ShippingAddressHandler = Handler.extend({
        addressType : "ShippingAddress",

        init : function() {
            this.registerHandlerMethod("ShippingAddress:FormAdded", this.initShippingAddressForm.bind(this));
            this.registerHandlerMethod("ShippingAddress:DisplayForm", this.displayShippingAddressForm.bind(this));

            addressHandler.registerDataSource(this.addressType + ":GetAddressAjaxData",  this.getAddressAjaxData.bind(this));
            addressHandler.registerCallback(this.addressType + ":Updated", this.onAddressUpdate.bind(this));
            addressHandler.registerCallback(this.addressType + ":UpdateFailed", this.onAddressUpdateFailure.bind(this));
            addressHandler.registerCallback(this.addressType + ":ContentChanged", this.updatePosition.bind(this));
        },

        initShippingAddressForm : function(form){
            var shippingAddressSection = form.find("#shipping-address-form");
            var shippingAddressData = this.findAddressData(shippingAddressSection);
            addressHandler.trigger("Address:FormAdded",
                { "isAddressMandatory" : shippingAddressData.data("is-address-mandatory"),
                  "addressType" : this.addressType,
                  "form" : shippingAddressSection
                }
            );
            var modal = a_modal.get(A.$("#shippingAddress"));
            if (modal) {
                modal.show();
            } else {
                jQuery("#pay-select-view").addClass("aok-hidden");
                jQuery("#shipping-address-placeholder").removeClass("aok-hidden");
                if (jQuery("#shipping-address-placeholder").offset() != null ) {
                    jQuery('html, body').animate({
                        scrollTop: jQuery("#shipping-address-placeholder").offset().top
                    }, 100); // time slice - 100 milliseconds, within which the scrolling executes.
                }
            }
        },

        getAddressAjaxData : function(addressSection) {
            var shippingAddressData = this.findAddressData(addressSection.closest('#shipping-address-form'));
            return {
                "url" : shippingAddressData.data("update-url")
            };
        },

        findAddressData : function(form) {
            return form.find("#shipping-address-data");
        },

        onAddressUpdate : function(updateAddressResponse) {
            var response = updateAddressResponse.response;
            var errorFieldList = response.errorFieldList;
            // jQuery.isEmptyObject is not supported in IE8
            if(errorFieldList && errorFieldList.length > 0) {
                addressHandler.trigger("Address:RegistrationError",
                        {"errorFieldList" : errorFieldList,
                         "section" : updateAddressResponse.section});
            } else if (response.hasExceptionOccured) {
                // No errors but still exception thrown then show generic error message
                addressHandler.trigger("Address:RegistrationGenericError",
                        {"targetFormControlId" : "formGenericError",
                         "section" : updateAddressResponse.section,
                         "message" : response.message,
                         "show"    : true});
            } else {
                a_modal.remove(A.$("#shippingAddress"));
                this.process("ShippingAddress:Added");
            }
        },

        updatePosition : function() {
            var modal = a_modal.get(A.$("#shippingAddress"));
            if(modal) {
                modal.updatePosition();
            }
        },

        onAddressUpdateFailure : function() {
            //TODO: Handle the case when address update fails.
        },
        
        displayShippingAddressForm: function(data) {
            var shippingAddressSection = jQuery('#shipping-address-placeholder');
            shippingAddressSection.html(data.htmlContent);
            shippingAddressSection.removeClass('aok-hidden');
            this.trigger("ShippingAddress:FormAdded", shippingAddressSection);
        }
    });

    A.on("a:popover:hide:shippingAddressModal", function(data){
        shippingAddressHandler.process("ShippingAddress:Cancelled");
    });

    var shippingAddressHandler = new ShippingAddressHandler();
    P.declare("shippingAddressHandler", shippingAddressHandler);
});

</script>
<script>
P.when('Handler','jQuery','mustache', 'ready').execute(function(Handler, jQuery, Mustache) {
    var htmlAlert = Mustache.to_html(jQuery('#expired-payment-method-alert-tmpl').html());
    jQuery('#expired-payment-method-alert').html(htmlAlert);
});
</script>
<script>
    P.when('jQuery', 'Handler', 'productQuantityHandler', 'ready').execute(function(jQuery, Handler, productQuantityHandler) {
        var KswagPaySelectHelper = Handler.extend({
            init : function() {
                this.registerDataSource("ClientPaySelectHelper:GetTotalProductsPrice", this.getTotalProductsPrice.bind(this));
            },

            getTotalProductsPrice : function(products) {
                var breakdown = jQuery('.productData').data('price-breakdown-json');
                var total = 0;
                for (var i = 0; i < breakdown.itemPrice.length; i++) {
                    if (breakdown.itemPrice[i].excludeFromCalculation) {
                        continue;
                    }
                    var price = breakdown.itemPrice[i].price;
                    if (price && price.value) {
                        total += price.value;
                    }
                }
                /*
                  Fetching quantity has two mechanism:-
                  1) Fetching quantity from simple quantity selector - quantitySelectorValue
                  2) Fetching quantity from product data - productDataQuantity

                  Below implementation is used to suffice both use cases like:-
                  1) Quantity selector is present then use quantitySelectorValue as the item quantity
                  2) Quantity selector is not present then use productDataQuantity as the item quantity
                */
                var quantitySelectorValue = productQuantityHandler.fetch("ProductQuantity:GetUpdatedQuantity");
                var productDataQuantity = breakdown.quantity;
                if(quantitySelectorValue) {
                    total *=  parseInt(quantitySelectorValue);
                } else if(productDataQuantity && productDataQuantity.value) {
                    total *=  parseInt(productDataQuantity.value);
                }
                return total;
            },
        });
        P.declare("kswagPaySelectHelper", new KswagPaySelectHelper());
    });
</script><script type="text/javascript">
    P.register('languageHandlerStrings', function() {
      var result = {
          DELIVERY_METHODS_NOW_TITLE : "Would you like Amazon to send your { AMOUNT, plural, \n one {eBook} \n other {eBooks}}?",
          DELIVERY_OPTIONS_RDL_BOTTOM_DESCRIPTION : "{ AMOUNT, plural, \n one {Youll be able to get a redemption link after completing your purchase.} \n other {You'll be able to get redemption links after completing your purchase.}}",
          CHARACTERS_REMAINING : "{AMOUNT, plural, \n =0 {no characters} \n one {1 character} \n other {# characters}} remaining",
          DELIVERY_OPTIONS_RDL_HEADER : "{ AMOUNT, plural, \n one {You can get a redemption link to send on your own} \n other {You can get some or all redemption links to send on your own}}",
          DELIVERY_OPTIONS_RDL_OPTION_1 : "{ AMOUNT, plural, \n one {Email the recipient from your email} \n other {Email recipients from your email}}",
          DELIVERY_OPTIONS_RDL_OPTION_2 : "{ AMOUNT, plural, \n one {Add a personalized message} \n other {Print redemption links to distribute in person}}",
          DELIVERY_METHODS_TITLE : "Add { AMOUNT, plural, \n one {a recipient} \n other {recipients}} to have us send this Kindle Book via email",
          DELIVERY_OPTIONS_RDL_OPTION_3 : "{ AMOUNT, plural, \n one {Print a redemption link to distribute in person} \n other {Export redemption links to use with tools like mail merge}}",
          DELIVERY_INFO_PLURAL : "If you do not add recipients, you will receive redemption links to send on your own.",
          DELIVERY_OPTIONS_RDL_DESCRIPTION : "{ AMOUNT, plural, \n one {Get a redemption link if you want to:} \n other {Get redemption links if you want to:}}",
          REDEMPTION_RESTRICTION : "{ AMOUNT, plural, \n one {This Kindle Book} \n other {These Kindle Books}} can only be redeemed by { AMOUNT, plural, \n one {a recipient} \n other {recipients}} in { COR, select, \n US {the US} \n GB {the UK} \n IE {Ireland} \n DE {Germany} \n AT {Austria} \n IN {India} \n other {the country of purchase}}.",
          DELIVERY_OPTIONS_ADL_DESCRIPTION : "{ AMOUNT, plural, \n one {You can enter an email address now or after purchase. The recipient will receive an email with a link to redeem the eBook.} \n other {You can enter email addresses now or after purchase. Each recipient will receive an email with a link to redeem the eBook.}}",
          DELIVERY_OPTIONS_ADL_HEADER : "{ AMOUNT, plural, \n one {We can send this eBook for you} \n other {We can send some or all eBooks for you}}",
          DELIVERY_INFO_SINGLE : "If you do not add a recipient, you will receive a redemption link to send on your own.",
          DELIVERY_METHODS_NOW_INFO : "Amazon will send { AMOUNT, plural, \n one {the} \n other {each}} recipient you specify below an email with a link to redeem the eBook. { AMOUNT, plural, \n one {An eBook} \n other {Any eBooks}} not sent by Amazon will be available after completing your purchase to be sent on your own.",
          DELIVERY_OPTIONS_HEADER : "Delivery Options",
          DELIVERY_OPTION_NOW : "Now",
          
        };
      return result;
    });
</script><script type="text/javascript">
        P.when('makeLanguageMoreGood', 'languageHandlerStrings').register('languageHandler', function(MLMG, stringValues) {
  MLMG.load(stringValues);

  return {
    load: function(obj) {
      MLMG.load(obj);
    },
    getString: function(key, obj) {
      return MLMG.getString(key, obj);
    },
  };
});
P.when('A', 'languageHandler', 'ready').register('pluralizationHelpers', function (
    A,
    languageHandler,
) {
  var $ = A.$;

  // languageHandler keys
  var DELIVERY_INFO_SINGLE = "DELIVERY_INFO_SINGLE";
  var DELIVERY_INFO_PLURAL = "DELIVERY_INFO_PLURAL";
  var DELIVERY_METHODS_TITLE = "DELIVERY_METHODS_TITLE";
  var REDEMPTION_RESTRICTION = "REDEMPTION_RESTRICTION";
  var SECONDARY_VIEW_HEADER = "SECONDARY_VIEW_HEADER";
  var SECONDARY_VIEW_INFO = "SECONDARY_VIEW_INFO";


  return {
    getDeliveryMethodInfoString: function(quantity) {

      // These strings are not in messageFormat and the singular/plural are kept in separate string ids.
      return languageHandler.getString(
        quantity > 1 ? DELIVERY_INFO_PLURAL : DELIVERY_INFO_SINGLE
      );
    },
    
    getDeliveryMethodTitleString: function(quantity) {
      return languageHandler.getString(DELIVERY_METHODS_TITLE, { AMOUNT: quantity });
    },

    // If `$container` is provided, only the nodes within that container will be affected.
    updateSecondaryViewHeaderNodes: function(quantity, $container) {
      var secondaryViewHeader;
      var secondaryViewInfo;

      if ($container && $container.length > 0) {
        secondaryViewHeader = $container.find('.secondary-view-header');
        secondaryViewInfo = $container.find('.secondary-view-info');
      } else {
        secondaryViewHeader = $('.secondary-view-header');
        secondaryViewInfo = $('.secondary-view-info');
      }

      secondaryViewHeader.html(languageHandler.getString(SECONDARY_VIEW_HEADER, { AMOUNT: quantity }));
      secondaryViewInfo.html(languageHandler.getString(SECONDARY_VIEW_INFO, { AMOUNT: quantity }));
    },

    updateRedemptionRestrictionNode: function(quantity) {
      var $corNode = $('#redemption-restriction');
      var cor = $corNode.length > 0 ? $corNode.data('cor') : '';
      if (cor.length === 0) {
        cor = "other";
      }
      $corNode.html(languageHandler.getString(REDEMPTION_RESTRICTION, { AMOUNT: quantity, COR: cor }))
    }
  };
});
P.when('A', 'Handler', 'productQuantityHandler', 'simple-quantity-picker', 'pluralizationHelpers', 'ready').register('pluralization', function(
  A,
  Handler,
  productQuantityHandler,
  simpleQuantityPicker,
  pluralizationHelpers
) {
  var $ = A.$;
  var $deliveryInfoNode = $('#delivery-methods-info');
  var $deliveryTitleNode = $('#delivery-methods-title');

  var createHandler = Handler.extend({

    init: function() {
      this.registerCallback('ProductQuantity:changed', this.updateLanguage.bind(this));
    },

    updateLanguage: function() {
      var quantity = Number(productQuantityHandler.fetch('ProductQuantity:GetUpdatedQuantity'));

      $deliveryTitleNode.html(pluralizationHelpers.getDeliveryMethodTitleString(quantity));
      $deliveryInfoNode.html(pluralizationHelpers.getDeliveryMethodInfoString(quantity));

      pluralizationHelpers.updateRedemptionRestrictionNode(quantity);
    },
  });

  return new createHandler();
});
P.when('jQuery', 'Handler','languageHandler',  'ready').execute(function($, Handler, languageHandler) {

    // trigger initial update
    P.when('customMessageFormUpdater', 'ready').execute(function(giftingFormUpdater) {
        giftingFormUpdater.trigger("CustomMessage:UpdateCharactersRemaining");
    });

    var CustomMessageFormUpdater = Handler.extend({
        init : function() {
           this.registerHandlerMethod("CustomMessage:UpdateCharactersRemaining", this.updateCharactersRemaining.bind(this));
        },

        updateCharactersRemaining : function($container) {

            // When a $container is provided, look for the $formContainer within it. This helps with the initial state
            // of secondary views when the view hasn't been loaded to the DOM yet.
            var $formContainer = $container ? $container.find('#message-container') : $('#message-container');

            // The $formContainer should exist here. Otherwise, there's nothing to update.
            if ($formContainer.length === 0) {
                return;
            }

            var characterLimit = $formContainer.data("message-character-limit");
            var $message = $formContainer.find('#message-input-box');
            var $charactersRemaining = $formContainer.find('#charactersRemaining');
            $charactersRemaining.html(languageHandler.getString('CHARACTERS_REMAINING', { AMOUNT: characterLimit - $message.val().length }));
        }
    });

    var customMessageFormUpdater = new CustomMessageFormUpdater();
    P.declare("customMessageFormUpdater", customMessageFormUpdater);
});P.when('jQuery', 'ready').execute( jQuery => {
    let container = jQuery("#gifting-form"),
        senderBox = container.find("#gifting-form-sender"),
        messageBox = container.find("#message-input-box");

    if (!(messageBox && senderBox)) {
        return;
    }

    let setCursor = textBox => {
        textBox.focus(() => {
        let text = textBox[0],
            textLength = text.value.length;
        text.setSelectionRange(textLength, textLength);
        });
    };

    setCursor(messageBox);
    setCursor(senderBox);
});
P.when('A', 'ready').register('customMessagePersistenceUtils', function (A) {

    var $ = A.$;

    // Set of utils that help with access to the storage that's used. 
    var storageUtils = (function() {
        var SESSION_STORAGE_KEY = 'AMAZON_CUSTOM_MESSAGE';

        return {

            // Immediately Invoked Function to cache the result of sessionStorage availability.
            // Taken from https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API
            isAvailable: (function () {
                var storage;
                try {
                    storage = window.sessionStorage;
                    var x = '__storage_test__';
                    storage.setItem(x, x);
                    storage.removeItem(x);
                    return true;
                }
                catch(e) {
                    return e instanceof DOMException && (
                        // everything except Firefox
                        e.code === 22 ||
                        // Firefox
                        e.code === 1014 ||
                        // test name field too, because code might not be present
                        // everything except Firefox
                        e.name === 'QuotaExceededError' ||
                        // Firefox
                        e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&
                        // acknowledge QuotaExceededError only if there's something already stored
                        (storage && storage.length !== 0);
                }
            })(),

            getData: function() {
                return JSON.parse(sessionStorage.getItem(SESSION_STORAGE_KEY));
            },

            setData: function(newData) {

                // Clone the new data to save
                var dataToSave = $.extend({}, newData);
                dataToSave.dateSaved = Date.now();

                sessionStorage.setItem(SESSION_STORAGE_KEY, JSON.stringify(dataToSave));
            },

            // Checks if the current contact group id matches what is persisted.
            isExpectedContactGroupId: function(currentContactGroupId, persistedData) {
                if (persistedData && persistedData.contactGroupId) {
                    return persistedData.contactGroupId === currentContactGroupId;
                } else {
                    return false;
                }
            },

            removeData: function() {
                sessionStorage.removeItem(SESSION_STORAGE_KEY);
            }
        }
    })();


    // Get the current contact group id.
    var mecData = document.getElementById('mec-data');
    var contactGroupId = mecData === null ? null : mecData.getAttribute('data-contact-group-id');

    (function () {
        // Remove data if by chance we've landed on the page from a previous session that hasn't been cleared.
        if (storageUtils.isAvailable)  {
            var previouslyPersistedData = storageUtils.getData();
            if (previouslyPersistedData !== null && !storageUtils.isExpectedContactGroupId(contactGroupId, previouslyPersistedData)) {
                storageUtils.removeData();
            }
        } 
    })();

    // Exposed persistence functions.
    return {
        updateUIFromPersistence: function ($senderNameInput, $customMessageInput) {

            if (!storageUtils.isAvailable || contactGroupId === null) {
                return;
            } 

            var persistedData = storageUtils.getData();

            // There was no data persisted, do nothing. 
            if (persistedData === null) {
                return;
            }

            if (storageUtils.isExpectedContactGroupId(contactGroupId, persistedData)) {
                $senderNameInput.val(persistedData.senderName);
                $customMessageInput.val(persistedData.customMessage);
            }            

            // Clear the data for both cases: 
            // 1) we've used the persisted data 
            // 2) we didn't use it because the contactGroupIds didn't match
            storageUtils.removeData();
        },
        
        updatePersistenceWithCurrentState: function(senderNameValue, customMessageValue) {

            if (!storageUtils.isAvailable || contactGroupId === null) {
                return;
            }
            
            if (senderNameValue === undefined || senderNameValue === null || customMessageValue === undefined || customMessageValue === null) {
                return;
            }

            storageUtils.setData({ 
                contactGroupId: contactGroupId, 
                senderName: senderNameValue, 
                customMessage: customMessageValue 
            });
        }
    };

});
P.when('A', 'customMessagePersistenceUtils', 'ready').execute(function(A, customMessagePersistenceUtils) {
    var $ = A.$;

    var senderFromId = '#gifting-form-sender';
    var customMessageId = '#message-input-box';
    customMessagePersistenceUtils.updateUIFromPersistence($(senderFromId), $(customMessageId));

    var paymentChangeUrl = $('#paymentchangeurl');
    if (paymentChangeUrl && paymentChangeUrl.length) {
        paymentChangeUrl.click(function() {
            customMessagePersistenceUtils.updatePersistenceWithCurrentState($(senderFromId).val(), $(customMessageId).val());
        });
    }
});P.when('A', 'jQuery', 'Handler', 'customMessageFormUpdater', 'ready').execute(function(A, jQuery, Handler, customMessageFormUpdater) {
    A.declarative('giftingFormMessageUpdated', 'keyup change', function(e) {
         customMessageFormUpdater.trigger("CustomMessage:UpdateCharactersRemaining");
    });
});
class ScheduledDeliveryDate {
    constructor(rawDeliveryDate, dateFormat, calendarUtils) {
        this.rawDeliveryDate = rawDeliveryDate;
        this.dateFormat = dateFormat;
        this.calendarUtils = calendarUtils;
    }

    getDateValue() {
        if (this.rawDeliveryDate === "") {
            return this.rawDeliveryDate;
        }
        return this.calendarUtils.parseDate(this.rawDeliveryDate, this.dateFormat);
    }

    isValid() {
        let date = this.getDateValue();
        return date === "" || date != null;
    }

    isEmpty() {
        return this.getDateValue() === "";
    }

    getInternalISOFormat() {
        let parsedDate = this.getDateValue();
        if (parsedDate === "") {
            return parsedDate;
        }
        return this.convertDateToISOFormat(parsedDate);
    }
    // Manually set to ISO format (YYYY-MM-DD) without timezone information to avoid backend conversion issues.
    convertDateToISOFormat(parsedDate) {
        let day = ("0" + parsedDate.getDate()).slice(-2);
        let month = ("0" + (parsedDate.getMonth() + 1)).slice(-2);
        let year = parsedDate.getFullYear();
        return year + "-" + month + "-" + day;
    }
}

P.when('jQuery', 'multi-email-control', 'Handler', 'a-calendar-utils', 'paySelectHandler', 'ready').execute(
     function(jQuery, multiEmailControl, Handler, calendarUtils, paySelectHandler) {
     const HIDDEN_TAG = "aok-hidden";
     const DATE_WARNING_DIV = "#gifting-date-warning-div";
     const EMPTY_DATE_WARNING_DIV = "#empty-gifting-date-warning-div";
     const ERROR_INVALID_DATE = "#invalid-date-alert";
     const ERROR_INVALID_DATE_RANGE = "#invalid-date-range-alert";
     var giftingFormContainer = jQuery('#gifting-form');
     var ScheduledDeliveryDateEventHandler = Handler.extend({
         init : function() {
             this.registerHandlerMethod("ScheduledDelivery:ValidateDeliveryDate", this.validateDeliveryDate.bind(this));
             this.registerDataSource("ScheduledDelivery:isDeliveryDateValid", this.isDeliveryDateValid.bind(this));
         },

         updateDateWithRangeValidation : function(aDate) {
             if (!aDate || this.isDateBetweenAcceptedRange(aDate)) {
                 this.showInfoMessageForSelectedDate(aDate == null || aDate === "" );
             } else {
                 this.displayInfoMessage(ERROR_INVALID_DATE_RANGE);
             }
         },

         createScheduledDeliveryDateHelper : function() {
             return new ScheduledDeliveryDate(
                 giftingFormContainer.find("#schedulingDeliveryDate input").first().val(),
                 giftingFormContainer.find("#deliveryDateFormat")[0].value,
                 calendarUtils
             );
         },

         isDeliveryDateValid : function() {
             let scheduledDeliveryDate = this.createScheduledDeliveryDateHelper();
             return scheduledDeliveryDate.isValid();
         },

         isDateBetweenAcceptedRange : function(aDate) {
             let minDate = this.dateFromCalendarAttributes("#scheduled-delivery-min-date");
             let maxDate = this.dateFromCalendarAttributes("#scheduled-delivery-max-date");
             return aDate === "" || (aDate >= minDate && aDate <= maxDate);
         },

         dateFromCalendarAttributes : function(dateSelectorId) {
             let stringDateValue = giftingFormContainer.find(dateSelectorId).first().val();
             let obtainedDate = new Date(stringDateValue);
             obtainedDate.setHours(0, 0, 0, 0);
             return obtainedDate;
         },

         setDeliveryDate : function(deliveryDateValue) {
             giftingFormContainer.find("#deliveryDateSetISOFormat").attr("value", deliveryDateValue);
         },

         validateDeliveryDate : function() {
             let scheduledDeliveryDate = this.createScheduledDeliveryDateHelper();

             if (scheduledDeliveryDate.isValid()) {
                 this.setDeliveryDate(scheduledDeliveryDate.getInternalISOFormat());
                 this.showInfoMessageForSelectedDate(scheduledDeliveryDate.isEmpty());
                if (multiEmailControl.getStats().emailCount >= 1 && this.hasSelectedPaymentOption()) {
                    this.process("Action:enable");
                }
             } else {
                 this.displayInfoMessage(ERROR_INVALID_DATE);
                 this.process("Action:disable", {showPopoverText : false});
             }
         },

         hasSelectedPaymentOption : function () {
             let selectedPaymentOptions = paySelectHandler.fetch('GetSelectedPaymentOptions');
             return selectedPaymentOptions && selectedPaymentOptions.length > 0;
         },

         showMessageByIdentifier : function(alertMessageIdentifier) {
             giftingFormContainer.find(alertMessageIdentifier).removeClass(HIDDEN_TAG);
         },

         hideMessageByIdentifier : function(alertMessageIdentifier) {
             giftingFormContainer.find(alertMessageIdentifier).addClass(HIDDEN_TAG);
         },

         /**
          * Hide all errors, and show the appropriate info message
          */
         displayInfoMessage : function(infoMessageIdentifier) {
             this.hideAllMessages();
             this.showMessageByIdentifier(infoMessageIdentifier);
         },

         showInfoMessageForSelectedDate : function(isEmptyDate) {
             let infoMessage = isEmptyDate ? EMPTY_DATE_WARNING_DIV : DATE_WARNING_DIV;
             this.displayInfoMessage(infoMessage);
         },

         /**
          * Disable all messages (errors, warnings, and info), prior to showing a specific one.
          */
         hideAllMessages : function() {
             this.hideMessageByIdentifier(ERROR_INVALID_DATE);
             this.hideMessageByIdentifier(ERROR_INVALID_DATE_RANGE);
             this.hideMessageByIdentifier(DATE_WARNING_DIV);
             this.hideMessageByIdentifier(EMPTY_DATE_WARNING_DIV);
         },
     });

     var scheduledDeliveryDateEventHandler = new ScheduledDeliveryDateEventHandler();
     P.declare("scheduledDeliveryDateEventHandler", scheduledDeliveryDateEventHandler);
 });

 P.when('A', 'Handler', 'scheduledDeliveryDateEventHandler', 'ready').execute(function(A, Handler, scheduledDeliveryDateEventHandler) {
     function getEventSource(e) {
         return (e.$event.srcElement || e.$event.target);
     }

     A.declarative('scheduledDeliveryDateUpdated', 'focusout', function(e) {
         scheduledDeliveryDateEventHandler.trigger("ScheduledDelivery:ValidateDeliveryDate", getEventSource(e));
     });
 });
 P.when(
    'jQuery',
    'Handler',
    'validators',
    'simple-quantity-picker',
    'productQuantityUpdateHandler',
    'multi-email-control',
    'ready').execute( function (
        jQuery,
        Handler,
        validators,
        simpleQuantityPicker,
        productQuantityUpdateHandler,
        multiEmailControl) 
    {
        
     var giftingFormContainer = jQuery('#bfo-checkout-form');
     var orderDetailsMiddleSection = jQuery('#order-details-middle-section');
     var bfoADLFormContainer = giftingFormContainer.find("#bfo-adl-form");
     var bfoRDLFormContainer = giftingFormContainer.find("#bfo-rdl-form");
     var BfoDeliveryMethodsEventHandler = Handler.extend({
         init : function() {
             this.registerHandlerMethod("BfoDeliveryOption:ADL", this.enableADLDelivery.bind(this));
             this.registerHandlerMethod("BfoDeliveryOption:RDL", this.enableRDLDelivery.bind(this));
         },

         enableADLDelivery : function() {
            this.showElement(bfoADLFormContainer);
            this.hideElement(bfoRDLFormContainer);
            this.showElement(orderDetailsMiddleSection);
            simpleQuantityPicker.uiManager.updateQuantityPicker(0);
            productQuantityUpdateHandler.trigger("ProductQuantity:changed"); 
            multiEmailControl.removeAllEmails();
            multiEmailControl.setMaxEmailCount(0);
         },

         enableRDLDelivery : function() {
            this.hideElement(bfoADLFormContainer);
            this.showElement(bfoRDLFormContainer);
            this.hideElement(orderDetailsMiddleSection);
            var quantity = "1" ? parseInt(1): 1;

            // Minimum quantity allowed in RDL is 1.
            quantity = Math.max(quantity, 1);

            simpleQuantityPicker.uiManager.updateQuantityPicker(quantity);
            productQuantityUpdateHandler.trigger("ProductQuantity:changed");
         },

         showElement : function(element) {
             element.removeClass("aok-hidden");
         },

         hideElement : function(element) {
             element.addClass("aok-hidden");
         },

     });

     var bfoDeliveryMethodsEventHandler = new BfoDeliveryMethodsEventHandler();
     P.declare("bfoDeliveryMethodsEventHandler", bfoDeliveryMethodsEventHandler);
 });

 P.when('A', 'bfoDeliveryMethodsEventHandler', 'ready').execute(function(A, bfoDeliveryMethodsEventHandler) {
     function getEventSource(e) {
         return (e.$event.srcElement || e.$event.target);
     }

     A.declarative('bfoDeliveryMethodUpdatedToADl', 'change', function(e) {
         bfoDeliveryMethodsEventHandler.trigger("BfoDeliveryOption:ADL", getEventSource(e));
     });

     A.declarative('bfoDeliveryMethodUpdatedToRDl', 'change', function(e) {
         bfoDeliveryMethodsEventHandler.trigger("BfoDeliveryOption:RDL", getEventSource(e));
     });
 });
const TOKEN_TYPE_PATTERN = 'pat';
const TOKEN_TYPE_LITERAL = 'lit';
const TOKENIZE_REGEX = /'((?:[^'])*)'|((?:[a-zA-Z])+)|([^a-zA-Z']+)/g;

/**
 * Reads the input date pattern and identifies its different parts,
 * separating it into a list of tokens. A token could be a set of literal characters,
 * that should be kept unchanged when a date is formatted using the provided pattern;
 * or a placeholder where a date component (year, month, time zone) should be replaced with.
 *
 * @param pattern the date pattern that will be tokenized. The pattern can be any set of characters,
 * and it will be tokenized following these rules:
 *   - Anything included inside single quotes will be treated as a single literal token.
 *   - A set of contiguous alphanumeric characters will be treated as a single pattern token.
 *   - Any other concatenation of special characters or symbols, excluding single quotes,
 *     will be treated as a single literal pattern token.
 *
 * Some examples of valid patterns:
 *   - dd/MM/yyyy will be separated into <dd> '/' <MM> '/' <yyyy>
 *   - YYYY-MM-dd'T'HH:mm:ss will be separated into <YYYY> '-' <MM> '-' <dd> 'T' <HH> ':' <mm> ':' <ss>
 * @returns a list of tokens.
 */
function tokenizeDateFormat(pattern) {
    return [...pattern.matchAll(TOKENIZE_REGEX)].map(groups => {
        if (groups[2]) {
            return {
                type: TOKEN_TYPE_PATTERN,
                value: groups[2]
            };
        } else {
            return {
                type: TOKEN_TYPE_LITERAL,
                value: groups[1] || groups[3]
            };
        }
    });
}

function replaceDatePattern(pattern, date, localizationData) {
    switch (pattern) {
        case "d":
            return date.getDate();
        case "MMMM":
            return localizationData.monthNames[date.getMonth()];
        default:
            return pattern;
    }
}

function formatDate(formatTokens, date, localizationData) {
    return formatTokens.map(token => {
        switch(token.type) {
            case TOKEN_TYPE_LITERAL:
                return token.value;
            case TOKEN_TYPE_PATTERN:
                return replaceDatePattern(token.value, date, localizationData);
        }
    }).join('');
}

P.when('a-calendar-renderer', 'calendar-localization-data', 'ready').register('localized-renderer', (Renderer, localizationData) => {
    // This function injects a decorator function around the original renderDay function
    // that modifies how each day of the calendar is rendered and adds a more explicit aria-label,
    // that includes, not only the day of the month, but also the name of the month (e.g. July 13).
    // This format is localized depending on the customer's locale and is sent by the server.
    function injectDayAriaLabelRenderer(renderer) {
        let renderDayOriginal = renderer.renderDay;
        let ariaLabelFormatter = tokenizeDateFormat(localizationData.dayAriaLabelFormat);

        renderer.renderDay = (dateToRender, isSelected, isOutbound, onRenderDayClass) => {
            let result = renderDayOriginal(dateToRender, isSelected, isOutbound, onRenderDayClass);
            let formattedDate = formatDate(ariaLabelFormatter, dateToRender, localizationData);
            let linkBeginIndex = result.indexOf('<a') + 2;

            return [
                result.substring(0, linkBeginIndex),
                ' aria-label="',
                formattedDate,
                '"',
                result.substring(linkBeginIndex + 1)
            ].join('');
        };
    }

    let renderer = new Renderer(localizationData);
    injectDayAriaLabelRenderer(renderer);

    return renderer;
});

P.when("a-calendar-framework", "scheduledDeliveryDateEventHandler").execute(function (calendar, scheduledDeliveryDateEventHandler) {
    let scheduledDeliveryDateCalendar = calendar.get(document.getElementById("schedulingDeliveryDate"));
    scheduledDeliveryDateCalendar.attributes.onSelectInactiveDate = (calendarDate) => {
        scheduledDeliveryDateEventHandler.updateDateWithRangeValidation(calendarDate);
    };
    scheduledDeliveryDateCalendar.attributes.onSelectDate = (date) => {
        scheduledDeliveryDateEventHandler.updateDateWithRangeValidation(date);
    }
});
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API" title="Open URL: https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API" title="Open URL in Popup: https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>

    <style>
        .min-witdh1k {
	min-width: 1000px;
}
.no-padding {
	padding : 0px !important;
}

.break-overflow-text {
	overflow-wrap: break-word;
}
input[type='number'] {
    -moz-appearance: textfield;
    -o-appearance: textfield;
    -ms-appearance: textfield;
    appearance: textfield;
}

input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
    -webkit-appearance: none;
}

.fixed-bottom {
	position: fixed;
	bottom: 0px;
	z-index: 100;
}

.full-width {
    width: 100% !important;
}

.payment-method-logo {
   width: 34px;
   height: 22px;
}

.light-background {
	background: white;
}
.dark-background {
    background: #232323;
}
.white-color {
    color: #ffffff;
}
.padding-left-base {
    padding-left: 1.3rem;
}
.disabled-container {
    pointer-events: none;
    opacity: 0.5;
}
.pointer-events-inactive {
    pointer-events: none;
}
.border-none {
    border : none !important;
    border-radius : 0 !important;
    box-shadow : none !important;
    border-top-color : transparent !important;
}
.fixed-top {
    position: fixed;
    top: 0px;
    margin-right: 22px;
    padding-top:10px;
    min-width:224px;
}
/*Temporary css fix till we migrate to ShoppingPortal.
TODO: remove this code once ShoppingPortal migration is complete*/
#nav-xshop a.nav_a {
    display:none;
}
.input-text-with-currency-padding {
    padding-left: 30px !important;
}
.input-text-currency-symbol {
    position: absolute;
    font-size: 100%;
    padding-left: 9px;
    z-index: 1;
}
.input-text-currency-symbol-margin-rw {
    margin-top: 6.5px;
}
.input-text-currency-symbol-margin-aw {
    margin-top: 15px;
}
.empty-padding-bottom {
    padding-bottom: 0px !important;
}
.update-now-clickable{
    pointer-events: auto;
}
.opaque{
    opacity: 0.5;
}.page-container {
    max-width: 1265px;
    margin: auto;
    height: 100%;
}
.paymentDetailsDiv {
    padding-left: 14px;
}
.productImageDiv {
    margin-right: 0%;
}
#order-total-label {
    margin-right: 10%;
}
.checkoutPageDiv{
    padding-left: 30px;
}
#quantity-last-option {
    border-top: 1px solid #e7e7e7;
}
.product-summary {
    margin-left: 10px;
}
.delivery-info-row {
    width: 650px;
}
.delivery-info-arrow-grid {
    position: absolute;
    left: 92.7px;
    width: 500px;
}
.arrow {
    float: left;
    width: 33.3333%;
}
.support-text {
    font-size: 12px;
    display: inline-block;
    line-height: 1.25;
}
.clickable-heading {
    cursor: pointer;
}
#checkout-header-banner-image {
    padding-top: 6px;
}
.amzn-logo-footer-minimum-width {
    min-width: 290px;
}

.a-spacing-sides-base {
    margin: 0 10px 0 10px !important
}

/** Accessibility necessity */
a:link {
    text-decoration: underline;
}

/** Fix AUI Dropdown from using the accessibility necessity */
li a:link {
    text-decoration: none;
}

#exit-handler-action-form {
    margin: 0;
}

#paymentchangeurl {
    text-decoration: none;
    float: right;
}

.date-alert-info-message {
    float: left;
    margin-left: 10px;
    margin-top: 5px;
    width: 65%;
}

.date-alert-error-message {
    float: left;
    margin-left: 10px;
    margin-top: 5px;
    width: 65%;
}

.date-picker-style {
    float: left;
    margin-bottom: 5px;
}

.date-picker-section {
    margin-top: 5px;
}.add-image {
    display: none;
}
.redeem-section {
    padding: 0px!important;
}

#redemption-input {
    width: auto!important;
}

#redemption-header {
    margin-bottom: 6px!important;
}

#balances-container .a-letter-space {
    display: none;
}

@media screen and (max-width: 1200px) {
    #redemption-input {
        width: 100%!important;
        margin-bottom: 7px;
    }
    #redemption-apply-value {
        width: 100%!important;
        margin-bottom: 7px;
    }

    #redemption-input-and-apply-row .a-letter-space {
        display: none;
    }
}.hidden {
    display:none;
}

body {
    font-family: verdana,arial,helvetica,sans-serif;
}

.box-borderless {
    border:none;
}

.box-selected {
    border-color:#e47911;
    background-color:rgba(228,121,17,0.15);
}

.align-payment-option-first-column {
    position:relative;
    right:10px;
}

.align-expiry-date-header {
    position:relative;
    right:9px;
}

.align-bank-account-header {
    position:relative;
    right:9px;
}

.padding-add-card {
    padding:0px 0px 0px 10px;
}

/* Should be the same as .padding-add-card*/
.padding-add-bank-account {
    padding:0px 0px 0px 10px;
}

.middle-align {
    vertical-align: middle;

}

.bottom-align {
    vertical-align: bottom;
}

.padding-left-bank-name {
     padding-left: 45px;
     padding-top: 4px;

}

.padding-other-payment-options-sleeve {
    padding: 20px 14px;
}

/* A hack used to fix the following error:
    For AUI textInput boxes, using the widthNamed="large" parameter
    causes the input box to not be resizable when viewing on desktop.
    TODO: remove this as soon as the AUI dependency is updated (https://sage.amazon.com/posts/207005).
*/
.rw-bank-acc-text-input {
    width: 90% !important;
}

.no-right-margin {
    margin-right: 0!important;
}

.padding-left {
    padding-left: 10px;
}

.margin-left {
    margin-left: 10px;
}

.saved-upi-handle {
    padding: 0.9rem 0 0.9rem 1.3rem;
}

.saved-upi-handle-info-section {
    padding: 1.7rem 0 1.3rem 1.7rem;
}

.saved-upi-handle-error-message {
    padding: 0 1.7rem;
}

.saved-upi-message-alignment {
    padding: 0 1rem;
}

.upi-info-message {
    padding: 0 2rem;
}

.other-upi-handle-info-section {
    padding: 0.3rem 0 0.3rem 1.7rem;
}

.align-mcb-violation {
    right:-20px;
    position:relative;
}

.align-duplicate-mcb-violation {
    right:-40px;
    position:relative;
}

.mcb-alert {
    margin-top: -6px;
    padding-left: 14px;
}

#pix-display-image {
    width: 26px;
    height: 26px;
}

.pix-padding-top input[type="radio"] {
    top: 6px;
}

.pix-aw-padding-top {
    padding-top: 2px;
}

.rectangular-search-box {
   width:117%;
   height:9.4%;
   left : -1.7rem;
   top : -1.4rem;
   border-radius : 0rem !important;
}
.netBankingSearchBox {
    border-bottom : 0.1rem solid #222222;
    border-bottom-width: 0.23rem;
    padding-left : 36px;
    height : 45px;
}
.max-width-line {
    position:relative;
    margin:0rem;
    width: 117%;
    left: -2.7rem;
}
.heavy-weight-line {
    border: 0.1rem solid #222222;
    top: -1.45rem;
}
.netBankingListItem {
    position: relative;
    border-bottom: 0.1rem solid #c7c7c7;
    padding: 1rem;
    left:-1.7rem;
    top: -1.45rem;
    width: 115%;
}
.rectangular-search-box-tablet {
    width:100%;
    height:9.4%;
    left : -1.7rem;
    top : -1.4rem;
    border-radius : 0rem !important;
}
.netBankingListItemTablet {
    position: relative;
    border-bottom: 0.1rem solid #c7c7c7;
    padding: 1rem;
    width: 100%;
}
.heavy-weight-line-tablet {
    border: 0.1rem solid #222222;
}
.highlightedText {
    color : #ff5733;
}
.a-popover-modal .a-popover-wrapper {
    height: 95%;
}
.a-popover-modal{
    min-width:80%;
    position: fixed;
}
#netBanking-aw-btn-announce {
    text-align:left;
}
.password-field {
    -webkit-text-security: disc;
}
.searchIcon:before {
   content: '';
   width: 28px;
   position: absolute;
   top: 14px;
   left: 10px;
   height: 28px;
   background-position: 0px -519px;
   background-image: url("https://images-na.ssl-images-amazon.com/images/G/01/amazonui/sprites/aui_sprite_0036-1x._V1_.png");
   background-repeat: no-repeat;
   background-size: 400px 650px;
   -webkit-background-size: 400px 650px;
   display: inline-block;
   vertical-align: top; 
}
ul {
    outline: none;
}
.disabledDropdownOption {
    pointer-events: none;
    cursor: not-allowed;
    opacity: 0.5;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
.align-payment-options-section {
	padding : 0px 20px;
}
.align-input {
	padding-left : 10px;
	display : inline-block;
}

.paymentInstrument .billing-address .add-address-box {
    border: none;
}

.align-icon {
    vertical-align: middle;
}
.bottomsheet-header-height{
    height: 135px;
}

.bottom-sheet-left-margin{
    margin-left : 21px;
}

.bottom-sheet-right-margin{
    margin-right : 21px;
}

.responsive-truncated {
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.storage-consent-radio-heading {
    padding-left : 0px;
}

.nontokenized-cards-badge {
    width: 100px;
    background-color: bisque;
}

.netBankingListTablet li:last-child {
    margin-bottom: 3rem;
}<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://sage.amazon.com/posts/207005" title="Open URL: https://sage.amazon.com/posts/207005 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://sage.amazon.com/posts/207005" title="Open URL in Popup: https://sage.amazon.com/posts/207005 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></style>
<script type="text/javascript">
window.ue_ihe = (window.ue_ihe || 0) + 1;
if (window.ue_ihe === 1) {
(function(c){c&&1===c.ue_jsmtf&&"object"===typeof c.P&&"function"===typeof c.P.when&&c.P.when("mshop-interactions").execute(function(e){"object"===typeof e&&"function"===typeof e.addListener&&e.addListener(function(b){"object"===typeof b&&"ORIGIN"===b.dataSource&&"number"===typeof b.clickTime&&"object"===typeof b.events&&"number"===typeof b.events.pageVisible&&(c.ue_jsmtf_interaction={pv:b.events.pageVisible,ct:b.clickTime})})})})(ue_csm);
(function(c,e,b){function m(a){f||(f=d[a.type].id,"undefined"===typeof a.clientX?(h=a.pageX,k=a.pageY):(h=a.clientX,k=a.clientY),2!=f||l&&(l!=h||n!=k)?(r(),g.isl&&e.setTimeout(function(){p("at",g.id)},0)):(l=h,n=k,f=0))}function r(){for(var a in d)d.hasOwnProperty(a)&&g.detach(a,m,d[a].parent)}function s(){for(var a in d)d.hasOwnProperty(a)&&g.attach(a,m,d[a].parent)}function t(){var a="";!q&&f&&(q=1,a+="&ui="+f);return a}var g=c.ue,p=c.uex,q=0,f=0,l,n,h,k,d={click:{id:1,parent:b},mousemove:{id:2,
parent:b},scroll:{id:3,parent:e},keydown:{id:4,parent:b}};g&&p&&(s(),g._ui=t)})(ue_csm,window,document);


(function(s,l){function m(b,e,c){c=c||new Date(+new Date+t);c="expires="+c.toUTCString();n.cookie=b+"="+e+";"+c+";path=/"}function p(b){b+="=";for(var e=n.cookie.split(";"),c=0;c<e.length;c++){for(var a=e[c];" "==a.charAt(0);)a=a.substring(1);if(0===a.indexOf(b))return decodeURIComponent(a.substring(b.length,a.length))}return""}function q(b,e,c){if(!e)return b;-1<b.indexOf("{")&&(b="");for(var a=b.split("&"),f,d=!1,h=!1,g=0;g<a.length;g++)f=a[g].split(":"),f[0]==e?(!c||d?a.splice(g,1):(f[1]=c,a[g]=
f.join(":")),h=d=!0):2>f.length&&(a.splice(g,1),h=!0);h&&(b=a.join("&"));!d&&c&&(0<b.length&&(b+="&"),b+=e+":"+c);return b}var k=s.ue||{},t=3024E7,n=ue_csm.document||l.document,r=null,d;a:{try{d=l.localStorage;break a}catch(u){}d=void 0}k.count&&k.count("csm.cookieSize",document.cookie.length);k.cookie={get:p,set:m,updateCsmHit:function(b,e,c){try{var a;if(!(a=r)){var f;a:{try{if(d&&d.getItem){f=d.getItem("csm-hit");break a}}catch(k){}f=void 0}a=f||p("csm-hit")||"{}"}a=q(a,b,e);r=a=q(a,"t",+new Date);
try{d&&d.setItem&&d.setItem("csm-hit",a)}catch(h){}m("csm-hit",a,c)}catch(g){"function"==typeof l.ueLogError&&ueLogError(Error("Cookie manager: "+g.message),{logLevel:"WARN"})}}}})(ue_csm,window);


(function(l,e){function c(b){b="";var c=a.isBFT?"b":"s",d=""+a.oid,g=""+a.lid,h=d;d!=g&&20==g.length&&(c+="a",h+="-"+g);a.tabid&&(b=a.tabid+"+");b+=c+"-"+h;b!=f&&100>b.length&&(f=b,a.cookie?a.cookie.updateCsmHit(m,b+("|"+ +new Date)):e.cookie="csm-hit="+b+("|"+ +new Date)+n+"; path=/")}function p(){f=0}function d(b){!0===e[a.pageViz.propHid]?f=0:!1===e[a.pageViz.propHid]&&c({type:"visible"})}var n="; expires="+(new Date(+new Date+6048E5)).toGMTString(),m="tb",f,a=l.ue||{},k=a.pageViz&&a.pageViz.event&&
a.pageViz.propHid;a.attach&&(a.attach("click",c),a.attach("keyup",c),k||(a.attach("focus",c),a.attach("blur",p)),k&&(a.attach(a.pageViz.event,d,e),d({})));a.aftb=1})(ue_csm,ue_csm.document);


ue_csm.ue.stub(ue,"impression");


ue.stub(ue,"trigger");


if(window.ue&&uet) { uet('bb'); }

}
</script>
<script>window.ue && ue.count && ue.count('CSMLibrarySize', 3172)</script><meta content="hE6BUQ+8957WyxOu8zGcX/dStaC/jKipoDfnRKoc0IvTAAAAAGPHi5EAAAAB" name="csrf-token-v2">
        <div id="a-page"><script type="a-state" data-a-state="{&quot;key&quot;:&quot;a-wlab-states&quot;}">{"AUI_LAUNCH_2021_ALLY_FIXES_392482":"T1"}</script>

<script>
!function(){function n(n,t){var r=i(n);return t&&(r=r("instance",t)),r}var r=[],c=0,i=function(t){return function(){var n=c++;return r.push([t,[].slice.call(arguments,0),n,{time:Date.now()}]),i(n)}};n._s=r,this.csa=n}();;
csa('Config', {"ContentInteractionsSummary.FlushInterval":5000});
if (window.csa) {
    csa("Config", {
        
        'Events.Namespace': 'csa',
        'ObfuscatedMarketplaceId': 'A21TJRUUN4KGV',
        'Events.SushiEndpoint': 'https://unagi.amazon.in/1/events/com.amazon.csm.csa.prod',
        'CacheDetection.RequestID': "E2WFHK2PD2NF0NVZ86FC",
        'CacheDetection.Callback': window.ue && ue.reset,
        'LCP.elementDedup': 1
    });

    csa("Events")("setEntity", {
        page: {requestId: "E2WFHK2PD2NF0NVZ86FC", meaningful: "interactive"},
        session: {id: "257-6328836-0330509"}
    });
}
!function(r){var i,e,o="splice",u=r.csa,f={},c={},a=r.csa._s,s=0,l=0,g=-1,h={},v={},d={},n=Object.keys,p=function(){};function t(n,t){return u(n,t)}function m(n,t){var r=c[n]||{};k(r,t),c[n]=r,l++,S(U,0)}function w(n,t,r){var i=!0;return t=D(t),r&&r.buffered&&(i=(d[n]||[]).every(function(n){return!1!==t(n)})),i?(h[n]||(h[n]=[]),h[n].push(t),function(){!function(n,t){var r=h[n];r&&r[o](r.indexOf(t),1)}(n,t)}):p}function b(n,t){if(t=D(t),n in v)return t(v[n]),p;return w(n,function(n){return t(n),!1})}function y(n,t){if(u("Errors")("logError",n),f.DEBUG)throw t||n}function E(){return Math.abs(4294967295*Math.random()|0).toString(36)}function D(n,t){return function(){try{return n.apply(this,arguments)}catch(n){y(n.message||n,n)}}}function S(n,t){return r.setTimeout(D(n),t)}function U(){for(var n=0;n<a.length;){var t=a[n],r=t[0]in c;if(!r&&!e)return void(s=t.length);r?(a[o](s=n,1),I(t)):n++}g=l}function I(n){var arguments,t=c[n[0]],r=(arguments=n[1])[0];if(!t||!t[r])return y("Undefined function: "+t+"/"+r);i=n[3],c[n[2]]=t[r].apply(t,arguments.slice(1))||{},i=0}function O(){e=1,U()}function k(t,r){n(r).forEach(function(n){t[n]=r[n]})}b("$beforeunload",O),m("Config",{instance:function(n){k(f,n)}}),u.plugin=D(function(n){n(t)}),t.config=f,t.register=m,t.on=w,t.once=b,t.blank=p,t.emit=function(n,t,r){for(var i=h[n]||[],e=0;e<i.length;)!1===i[e](t)?i[o](e,1):e++;v[n]=t||{},r&&r.buffered&&(d[n]||(d[n]=[]),100<=d[n].length&&d[n].shift(),d[n].push(t||{}))},t.UUID=function(){return[E(),E(),E(),E()].join("-")},t.time=function(n){var t=i?new Date(i.time):new Date;return"ISO"===n?t.toISOString():t.getTime()},t.error=y,t.warn=function(n,t){if(u("Errors")("logWarn",n),f.DEBUG)throw t||n},t.exec=D,t.timeout=S,t.interval=function(n,t){return r.setInterval(D(n),t)},(t.global=r).csa._s.push=function(n){n[0]in c&&(!a.length||e)?(I(n),a.length&&g!==l&&U()):a[o](s++,0,n)},U(),S(function(){S(O,f.SkipMissingPluginsTimeout||5e3)},1)}("undefined"!=typeof window?window:global);csa.plugin(function(o){var f="addEventListener",e="requestAnimationFrame",t=o.exec,r=o.global,u=o.on;o.raf=function(n){if(r[e])return r[e](t(n))},o.on=function(n,e,t,r){if(n&&"function"==typeof n[f]){var i=o.exec(t);return n[f](e,i,r),function(){n.removeEventListener(e,i,r)}}return"string"==typeof n?u(n,e,t,r):o.blank}});csa.plugin(function(o){var t,n,r={},e="localStorage",c="sessionStorage",a="local",i="session",u=o.exec;function s(e,t){var n;try{r[t]=!!(n=o.global[e]),n=n||{}}catch(e){r[t]=!(n={})}return n}function f(){t=t||s(e,a),n=n||s(c,i)}function l(e){return e&&e[i]?n:t}o.store=u(function(e,t,n){f();var o=l(n);return e?t?void(o[e]=t):o[e]:Object.keys(o)}),o.storageSupport=u(function(){return f(),r}),o.deleteStored=u(function(e,t){f();var n=l(t);if("function"==typeof e)for(var o in n)n.hasOwnProperty(o)&&e(o,n[o])&&delete n[o];else delete n[e]})});csa.plugin(function(n){n.types={ovl:function(n){var r=[];if(n)for(var i in n)n.hasOwnProperty(i)&&r.push(n[i]);return r}}});csa.plugin(function(o){function r(n){return function(r){o("Metrics",{producerId:"csa",dimensions:{message:r}})("recordMetric",n,1)}}o.register("Errors",{logError:r("jsError"),logWarn:r("jsWarn")})});csa.plugin(function(o){var i,e,n,a,t,r="function",u="willDisappear",c="$app.",f="$document.",p="focus",d="blur",s="active",l="resign",$=o.global,b=o.exec,m=o("Events"),g=$.location,v=$.document||{},h=$.P||{},y=(($.performance||{}).navigation||{}).type,P=o.on,w=o.emit,k=v.hidden,E={};g&&v&&(P($,"beforeunload",D),P($,"pagehide",D),P(v,"visibilitychange",A(f,function(){return v.visibilityState||"unknown"})),P(v,p,A(f+p)),P(v,d,A(f+d)),h.when&&h.when("mash").execute(function(e){e&&(P(e,"appPause",A(c+"pause")),P(e,"appResume",A(c+"resume")),A(c+"deviceready")(),$.cordova&&$.cordova.platformId&&A(c+cordova.platformId)(),P(v,s,A(c+s)),P(v,l,A(c+l)))}),e=$.app||{},n=b(function(){w(c+"willDisappear"),D()}),t=typeof(a=e[u])==r,e[u]=b(function(){n(),t&&a()}),$.app||($.app=e),"complete"===v.readyState?T():P($,"load",T),k?S():x(),o.on("$app.blur",S),o.on("$app.focus",x),o.on("$document.blur",S),o.on("$document.focus",x),o.on("$document.hidden",S),o.on("$document.visible",x),o.register("SPA",{newPage:I}),I({transitionType:{0:"hard",1:"refresh",2:"back-button"}[y]||"unknown"}));function I(n,e){var a=!!i,t=(e=e||{}).keepPageAttributes;a&&(w("$beforePageTransition"),w("$pageTransition")),a&&!t&&m("removeEntity","page"),i=o.UUID(),t?E.id=i:E={schemaId:"<ns>.PageEntity.1",id:i,url:g.href,server:g.hostname,path:g.pathname,referrer:v.referrer,title:v.title},Object.keys(n||{}).forEach(function(e){E[e]=n[e]}),m("setEntity",{page:E}),w("$pageChange",E,{buffered:1}),a&&w("$afterPageTransition")}function T(){w("$load"),w("$ready"),w("$afterload")}function D(){w("$ready"),w("$beforeunload"),w("$unload"),w("$afterunload")}function S(){k||(w("$visible",!1,{buffered:1}),k=!0)}function x(){k&&(w("$visible",!0,{buffered:1}),k=!1)}function A(n,a){return b(function(){var e=typeof a==r?n+a():n;w(e)})}});csa.plugin(function(c){var t="Events",e="UNKNOWN",a="id",u="all",n="messageId",i="timestamp",f="producerId",o="application",r="obfuscatedMarketplaceId",s="entities",d="schemaId",l="version",p="attributes",v="<ns>",g=c.config,h=(c.global.location||{}).host,m=g[t+".Namespace"]||"csa_other",I=g.Application||"Other"+(h?":"+h:""),b=c("Transport"),y={},O=function(t,e){Object.keys(t).forEach(e)};function E(n,i,o){O(i,function(t){var e=o===u||(o||{})[t];t in n||(n[t]={version:1,id:i[t][a]||c.UUID()}),U(n[t],i[t],e)})}function U(e,n,i){O(n,function(t){!function(t,e,n){return"string"!=typeof e&&t!==l?c.error("Attribute is not of type string: "+t):!0===n||1===n||(t===a||!!~(n||[]).indexOf(t))}(t,n[t],i)||(e[t]=n[t])})}function N(o,t,r){O(t,function(t){var e=o[t];if(e[d]){var n={},i={};n[a]=e[a],n[f]=e[f]||r,n[d]=e[d],n[l]=e[l]++,n[p]=i,S(n),U(i,e,1),k(i),b("log",n)}})}function S(t){t[i]=function(t){return"number"==typeof t&&(t=new Date(t).toISOString()),t||c.time("ISO")}(t[i]),t[n]=t[n]||c.UUID(),t[o]=I,t[r]=g.ObfuscatedMarketplaceId||e,t[d]=t[d].replace(v,m)}function k(t){delete t[l],delete t[d],delete t[f]}function w(o){var r={};this.log=function(t,e){var n={},i=(e||{}).ent;return t?"string"!=typeof t[d]?c.error("A valid schema id is required for the event"):(S(t),E(n,y,i),E(n,r,i),E(n,t[s]||{},i),O(n,function(t){k(n[t])}),t[f]=o[f],t[s]=n,void b("log",t,e)):c.error("The event cannot be undefined")},this.setEntity=function(t){E(r,t,u),N(r,t,o[f])}}g["KillSwitch."+t]||c.register(t,{setEntity:function(t){E(y,t,u),N(y,t,"csa")},removeEntity:function(t){delete y[t]},instance:function(t){return new w(t)}})});csa.plugin(function(s){var c,g="Transport",l="post",f="preflight",r="csa.cajun.",i="store",a="deleteStored",u="sendBeacon",t="__merge",e="messageId",n=".FlushInterval",o=0,d=s.config[g+".BufferSize"]||2e3,h=s.config[g+".RetryDelay"]||1500,p={},v=0,y=[],m=s.global,E=m.document,b=s.timeout,k=m.Object.keys,w=s.config[g+n]||5e3,I=w,O=s.config[g+n+".BackoffFactor"]||1,R=s.config[g+n+".BackoffLimit"]||3e4,S=0;function B(n){if(864e5<s.time()-+new Date(n.timestamp))return s.warn("Event is too old: "+n);v<d&&(n[e]in p||(p[n[e]]=n,v++),"function"==typeof n[t]&&n[t](p[n[e]]),!S&&o&&(S=b(T,function(){var n=I;return I=Math.min(n*O,R),n}())))}function T(){y.forEach(function(e){var o=[];k(p).forEach(function(n){var t=p[n];e.accepts(t)&&o.push(t)}),o.length&&(e.chunks?e.chunks(o).forEach(function(n){D(e,n)}):D(e,o))}),p={},S=0}function D(t,e){function o(){s[a](r+n)}var n=s.UUID();s[i](r+n,JSON.stringify(e)),[function(n,t,e){var o=m.navigator||{},r=m.cordova||{};if(!o[u]||!n[l])return 0;n[f]&&r&&"ios"===r.platformId&&!c&&((new Image).src=n[f]().url,c=1);var i=n[l](t);if(!i.type&&o[u](i.url,i.body))return e(),1},function(n,t,e){if(!n[l])return 0;var o=n[l](t),r=o.url,i=o.body,c=o.type,f=new XMLHttpRequest,a=0;function u(n,t,e){f.open("POST",n),f.withCredentials=!0,e&&f.setRequestHeader("Content-Type",e),f.send(t)}return f.onload=function(){f.status<299?e():s.config[g+".XHRRetries"]&&a<3&&b(function(){u(r,i,c)},++a*h)},u(r,i,c),1}].some(function(n){try{return n(t,e,o)}catch(n){}})}k&&(s.once("$afterload",function(){o=1,function(e){(s[i]()||[]).forEach(function(n){if(!n.indexOf(r))try{var t=s[i](n);s[a](n),JSON.parse(t).forEach(e)}catch(n){s.error(n)}})}(B),s.on(E,"visibilitychange",T,!1),T()}),s.once("$afterunload",function(){o=1,T()}),s.on("$afterPageTransition",function(){v=0,I=w}),s.register(g,{log:B,register:function(n){y.push(n)}}))});csa.plugin(function(n){var r=n.config["Events.SushiEndpoint"];n("Transport")("register",{accepts:function(n){return n.schemaId},post:function(n){var t=n.map(function(n){return{data:n}});return{url:r,body:JSON.stringify({events:t})}},preflight:function(){var n,t=/\/\/(.*?)\//.exec(r);return t&&t[1]&&(n="https://"+t[1]+"/ping"),{url:n}},chunks:function(n){for(var t=[];500<n.length;)t.push(n.splice(0,500));return t.push(n),t}})});csa.plugin(function(n){var t,a,o,r,e=n.config,i="PageViews",d=e[i+".ImpressionMinimumTime"]||1e3,s="hidden",c="innerHeight",g="innerWidth",l="renderedTo",f=l+"Viewed",m=l+"Meaningful",u=l+"Impressed",p=1,v=2,h=3,w=4,y=5,P="loaded",I=7,T=8,b=n.global,E=n.on,V=n("Events",{producerId:"csa"}),$=b.document,M={},S={},H=y;function K(e){if(!M[I]){var i;if(M[e]=n.time(),e!==h&&e!==P||(t=t||M[e]),t&&H===w)a=a||M[e],(i={})[m]=t-o,i[f]=a-o,R("PageView.4",i),r=r||n.timeout(j,d);if(e!==y&&e!==p&&e!==v||(clearTimeout(r),r=0),e!==p&&e!==v||R("PageRender.3",{transitionType:e===p?"hard":"soft"}),e===I)(i={})[m]=t-o,i[f]=a-o,i[u]=M[e]-o,R("PageImpressed.2",i)}}function R(e,i){S[e]||(i.schemaId="<ns>."+e,V("log",i,{ent:"all"}),S[e]=1)}function W(){0===b[c]&&0===b[g]?(H=T,n("Events")("setEntity",{page:{viewport:"hidden-iframe"}})):H=$[s]?y:w,K(H)}function j(){K(I),r=0}function k(){var e=o?v:p;M={},S={},a=t=0,o=n.time(),K(e),W()}function q(){var e=$.readyState;"interactive"===e&&K(h),"complete"===e&&K(P)}e["KillSwitch."+i]||($&&void 0!==$[s]?(k(),E($,"visibilitychange",W,!1),E($,"readystatechange",q,!1),E("$afterPageTransition",k),E("$timing:loaded",q),n.once("$load",q)):n.warn("Page visibility not supported"))});csa.plugin(function(c){var s=c.config["Interactions.ParentChainLength"]||15,e="click",r="touches",f="timeStamp",o="length",u="pageX",g="pageY",p="pageXOffset",h="pageYOffset",m=250,v=5,d=200,l=.5,t={capture:!0,passive:!0},X=c.global,Y=c.emit,n=c.on,x=X.Math.abs,a=(X.document||{}).documentElement||{},y={x:0,y:0,t:0,sX:0,sY:0},N={x:0,y:0,t:0,sX:0,sY:0};function b(t){if(t.id)return"//*[@id='"+t.id+"']";var e=function(t){var e,n=1;for(e=t.previousSibling;e;e=e.previousSibling)e.nodeName===t.nodeName&&(n+=1);return n}(t),n=t.nodeName;return 1!==e&&(n+="["+e+"]"),t.parentNode&&(n=b(t.parentNode)+"/"+n),n}function I(t,e,n){var a=c("Content",{target:n}),i={schemaId:"<ns>.ContentInteraction.1",interaction:t,interactionData:e,messageId:c.UUID()};if(n){var r=b(n);r&&(i.attribution=r);var o=function(t){for(var e=t,n=e.tagName,a=!1,i=t?t.href:null,r=0;r<s;r++){if(!e||!e.parentElement){a=!0;break}n=(e=e.parentElement).tagName+"/"+n,i=i||e.href}return a||(n=".../"+n),{pc:n,hr:i}}(n);o.pc&&(i.interactionData.parentChain=o.pc),o.hr&&(i.interactionData.href=o.hr)}a("log",i),Y("$content.interaction",i)}function i(t){I(e,{interactionX:""+t.pageX,interactionY:""+t.pageY},t.target)}function C(t){if(t&&t[r]&&1===t[r][o]){var e=t[r][0];N=y={e:t.target,x:e[u],y:e[g],t:t[f],sX:X[p],sY:X[h]}}}function D(t){if(t&&t[r]&&1===t[r][o]&&y&&N){var e=t[r][0],n=t[f],a=n-N.t,i={e:t.target,x:e[u],y:e[g],t:n,sX:X[p],sY:X[h]};N=i,d<=a&&(y=i)}}function E(t){if(t){var e=x(y.x-N.x),n=x(y.y-N.y),a=x(y.sX-N.sX),i=x(y.sY-N.sY),r=t[f]-y.t;if(m<1e3*e/r&&v<e||m<1e3*n/r&&v<n){var o=n<e;o&&a&&e*l<=a||!o&&i&&n*l<=i||I((o?"horizontal":"vertical")+"-swipe",{interactionX:""+y.x,interactionY:""+y.y,endX:""+N.x,endY:""+N.y},y.e)}}}n(a,e,i,t),n(a,"touchstart",C,t),n(a,"touchmove",D,t),n(a,"touchend",E,t)});csa.plugin(function(t){var n,s,u,e="MutationObserver",i="observe",r="disconnect",o="mutObs",c=t.global,a=c.document,f=a.body||a.documentElement,b=Date.now,l=[],d=[],g=[],m=0,p=0,v=0,h=t.blank,O={buffered:1},w=0;function _(e){t.global.ue_csa_ss_tag||t.emit("$csmTag:"+e,0,O)}b&&c[e]?(_(o+"Yes"),m=0,(s=new c[e](B))[i](f,{childList:!0,subtree:!0}),(u=new c[e](y))[i](f,{attributes:!0,subtree:!0,attributeFilter:["src"],attributeOldValue:!0}),h=t.on(c,"scroll",L,{passive:!0}),t.register("SpeedIndexBuffers",{getBuffers:function(e){e&&(L(),e(m,l,d,g),s&&s[r](),u&&u[r](),h())},registerListener:function(e){n=e}})):_(o+"No");function y(e){l.push({t:b(),m:e})}function B(e){d.push({t:b(),m:e}),w||_(o+"Active"),w=v=1,n&&n()}function L(){v&&(g.push({t:b(),y:p}),p=c.pageYOffset,v=0)}});

var ue_csa_ss_tag = false;
csa.plugin(function(b){var a=b.global,e=a.uet,f=a.uex,c=a.ue,d=a.Object,g={largestContentfulPaint:"lcp",speedIndex:"si",atfSpeedIndex:"atfsi",visuallyLoaded50:"vl50",visuallyLoaded90:"vl90",visuallyLoaded100:"vl100"},k="perfNo perfYes browserQuiteFn browserQuiteUd browserQuiteLd browserQuiteMut mutObsNo mutObsYes mutObsActive startVL endVL".split(" ");b&&e&&f&&d.keys&&c&&(d.keys(g).forEach(function(h){b.on("$timing:"+h,function(a){var b=g[h];if(c.isl){var d="csa:"+b;e(b,d,void 0,a);f("at",d)}else e(b,
void 0,void 0,a)})}),a.ue_csa_ss_tag||k.forEach(function(a){b.on("$csmTag:"+a,function(){c.tag&&c.tag(a);c.isl&&f("at","csa:"+a)},{buffered:1})}))});

<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://unagi.amazon.in/1/events/com.amazon.csm.csa.prod" title="Open URL: https://unagi.amazon.in/1/events/com.amazon.csm.csa.prod (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://unagi.amazon.in/1/events/com.amazon.csm.csa.prod" title="Open URL in Popup: https://unagi.amazon.in/1/events/com.amazon.csm.csa.prod (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>
<script type="text/javascript">

(function(){function l(a){for(var c=b.location.search.substring(1).split("&"),e=0;e<c.length;e++){var d=c[e].split("=");if(d[0]===a)return d[1]}}window.amzn=window.amzn||{};amzn.copilot=amzn.copilot||{};var b=window,f=document,g=b.P||b.AmazonUIPageJS,h=f.head||f.getElementsByTagName("head")[0],m=0,n=0;amzn.copilot.checkCoPilotSession=function(){f.cookie.match("cpidv")&&("undefined"!==typeof jQuery&&k(jQuery),g&&g.when&&g.when("jQuery").execute(function(a){k(a)}),b.amznJQ&&b.amznJQ.available&&b.amznJQ.available("jQuery",
function(){k(jQuery)}),b.jQuery||g||b.amznJQ||q())};var q=function(){m?b.ue&&"function"===typeof b.ue.count&&b.ue.count("cpJQUnavailable",1):(m=1,f.addEventListener?f.addEventListener("DOMContentLoaded",amzn.copilot.checkCoPilotSession,!1):f.attachEvent&&f.attachEvent("onreadystatechange",function(){"complete"===f.readyState&&amzn.copilot.checkCoPilotSession()}))},k=function(a){if(!n){n=1;amzn.copilot.jQuery=a;a=l("debugJS");var c="https:"===b.location.protocol?1:0,e=1;url="/gp/copilot/handlers/copilot_strings_resources.html";
window.texas&&texas.locations&&(url=texas.locations.makeUrl(url));g&&g.AUI_BUILD_DATE&&(e=0);amzn.copilot.jQuery.ajax&&amzn.copilot.jQuery.ajax({url:url,dataType:"json",data:{isDebug:a,isSecure:c,includeAUIP:e},success:function(a){amzn.copilot.vip=a.serviceEndPoint;amzn.copilot.enableMultipleTabSession=a.isFollowMe;r(a)},error:function(){b.ue.count("cpLoadResourceError",1)}})}},r=function(a){var c=amzn.copilot.jQuery,e=function(){amzn.copilot.setup(c.extend({isContinuedSession:!0},a))};a.CSSUrls&&
c.each(a.CSSUrls[0],function(a,c){var b=f.createElement("link");b.type="text/css";b.rel="stylesheet";b.href=c;h.appendChild(b)});a.CSSTag&&s(a.CSSTag);if(a.JSUrls){var d=l("forceSynchronousJS"),b=a.JSUrls[0];c.each(b,function(a,c){a===b.length-1?p(c,d,e):p(c,d)})}a.JSTag&&(t(a.JSTag),P.when("CSCoPilotPresenterAsset").execute(function(){e()}))},t=function(a){var c=f.createElement("div");c.innerHTML=a;a=0;for(var b=c.children.length;a<b;a++){var d=f.createElement("script");d.type="text/javascript";
d.innerHTML=c.children[a].innerHTML;h.appendChild(d)}},s=function(a){var b=f.createElement("div");b.innerHTML=a;a=0;for(var e=b.children.length;a<e;a++)h.appendChild(b.children[a])},p=function(a,b,e){var d=f.createElement("script");d.type="text/javascript";d.src=a;d.async=b?!1:!0;e&&(d.onload=e);h.appendChild(d)}})();

amzn.copilot.checkCoPilotSession();

<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: rgb(255, 102, 0); display: inline-block; line-height: normal;"><a href="ssh://b.ue.count" title="SSH: b.ue.count (right-click for more options)" style="color: white; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> SSH</a></span></span></script>

<script>window.ue && ue.count && ue.count('CSMLibrarySize', 16659)</script><div class="a-container a-global-nav-wrapper"><div id="checkout-header" class="a-row"><div class="a-row a-grid-vertical-align a-grid-center page-container"><div class="a-column a-span2 a-text-center"><div class="a-row"><div id="checkout-header-banner-image" class="a-column a-span10 a-push2"><span class="a-declarative" data-action="a-popover" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-a-popover" data-a-popover="{&quot;closeButton&quot;:false,&quot;name&quot;:&quot;amzn-logo-popover&quot;,&quot;activate&quot;:&quot;onclick&quot;,&quot;position&quot;:&quot;triggerBottom&quot;}" data-csa-c-id="l12xtb-xes4ug-1s96r1-neslli"><div class="a-row"><i id="checkout-header-orderReview-amazonLogo" class="a-icon a-icon-logo clickable-heading" role="presentation"></i></div></span></div></div></div><div class="a-column a-span8 a-text-center"><h1 class="a-text-center">Complete your Kindle Book purchase</h1></div><div class="a-column a-span2 a-text-center a-span-last"><a class="a-link-normal" target="_blank" href="https://www.amazon.in/gp/help/customer/display.html?nodeId=200522700"><img alt="Privacy notice" src="./BFO Page_files/01Yjh2J67iL.png" id="checkout-header-orderReview-lockImage"></a></div></div></div><div class="a-popover-preload" id="a-popover-amzn-logo-popover"><div class="a-row a-spacing-base"><span class="a-color-base"><span>Are you sure you want to cancel your purchase?</span></span></div><div class="a-row amzn-logo-footer-minimum-width"><div class="a-column a-span6"><span class="a-declarative" data-action="a-popover-close" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-a-popover-close" data-a-popover-close="{}" data-csa-c-id="115d45-q8czdg-8speo4-ou7sum"><span class="a-button a-button-span12 a-button-base" id="a-autoid-0"><span class="a-button-inner"><input class="a-button-input" type="submit" aria-labelledby="a-autoid-0-announce"><span class="a-button-text" aria-hidden="true" id="a-autoid-0-announce"><span>Stay in checkout</span></span></span></span></span></div><div class="a-column a-span6 a-span-last"><span class="a-button a-button-span12 a-button-primary aok-float-right" id="a-autoid-1"><span class="a-button-inner"><a href="https://www.amazon.in/dp/B07VRS84D1/ref=dppui_kswag_checkout_dp?_token_v2=hE6BUQ%252B8957WyxOu8zGcX%252FdStaC%252FjKipoDfnRKoc0IvTAAAAAGPHi5EAAAAB" class="a-button-text" id="a-autoid-1-announce"><span>Return to shopping</span></a></span></span></div></div></div></div><div id="currencyOfPreferenceUnit" data-value="" class="a-section showable aok-hidden"></div><div id="currencyOfPreferenceEnabled" data-value="false" class="a-section showable aok-hidden"></div><div id="currencyOfPreferenceValue" data-value="" class="a-section showable aok-hidden"></div><div id="currencyData" data-currency-format-map="{&quot;INR&quot;:{&quot;radix&quot;:&quot;.&quot;,&quot;symbolAfterNumber&quot;:false,&quot;fixedDecimalPrecision&quot;:2,&quot;numberDelimiter&quot;:&quot;,&quot;,&quot;indianNumberSystem&quot;:true,&quot;symbol&quot;:&quot;&amp;#8377;&quot;}}" class="a-section showable aok-hidden"></div><div id="eventLoggingConfig" data-url="/dppui/event/ref=dppui_kswag_checkout_event?clientId=kswag&amp;variant=&amp;view=desktop&amp;oL=&amp;MarketplaceID=A21TJRUUN4KGV&amp;businessProfile&amp;_token_v2=hE6BUQ%252B8957WyxOu8zGcX%252FdStaC%252FjKipoDfnRKoc0IvTAAAAAGPHi5EAAAAB" data-batch-size="10" data-interval="60000"></div>

    <div class="a-container page-container"><div class="a-section a-spacing-large a-padding-large min-witdh1k"><style>
    #page-blocker {
    position:fixed;
    left:0;
    top:0;
    background: rgba(255,255,255,.5);
    width:100%;
    height:100%;
    z-index: 10;
    display: block;
}

#page-blocker-spinner {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}
</style>

<div id="page-blocker" class="a-section aok-hidden"><div id="page-blocker-spinner" class="a-box a-color-base-background"><div class="a-box-inner"><span class="a-spinner a-spinner-medium"></span></div></div></div><div class="a-row a-spacing-none"><div class="a-column a-span12"><script>
P.when('A', 'Handler', 'jQuery', 'a-modal', 'ready').execute(function(A, Handler, jQuery, modal){
    var ErrorHandler = Handler.extend({
        INTERNAL_ERROR_INFORM : "internalErrorInform",
        INTERNAL_ERROR_REDIRECT : "internalErrorRedirect",
        ORDER_ERROR_REDIRECT : "orderErrorRedirect",
        ORDER_ERROR_REFRESH : "orderErrorRefresh",
        PAYMENT_METHOD_INACTIVE : "paymentMethodInactive",
        CSRF_VALIDATION_ERROR : "csrfValidationError",
        INVALID_VERIFICATION_ERROR : "invalidVerificationError",

        init : function() {
            A.declarative('Error:Refresh', 'click', function(event) {
               location.reload();
            });

            A.declarative('Error:Redirect', 'click', function(event) {
                var url = event.data.url;
                if (!url.startsWith("/")) {
                    url = "/" + url;
                }
                location.href = url;
            });

            A.declarative('Error:Close', 'click', function(event) {
                var popup = modal.get(jQuery("#error-popover"));
                popup.hide();
            });
        },

        getHtml : function(templateId, data) {
            var template, html;
            template = jQuery('#' + templateId).html();
            return Mustache.to_html(template, data);
        },

        showError : function(messageId) {
            var config = jQuery('#error-messages').data("config");
            var errorMessage = config && config[messageId] ? config[messageId] : messageId;
            this.showCustomError(errorMessage);
        },

        redirectToLocation : function(Location) {
            window.location = Location;
        },

        showCustomError : function(errorMessage) {
            var popup = modal.get(jQuery("#error-popover")).attrs("dataStrategy", "inline");
            var header = this.getHtml('error-popover-header-tmpl', errorMessage);
            var content = this.getHtml('error-popover-content-tmpl', errorMessage);
            if (popup) {
                popup.update({"header" : header, "content": content}).show();

                var actionName = errorMessage.errorAction.name;
                var data = { url : errorMessage.errorAction.url };
                A.declarative.create(jQuery("#error-popover-button"), actionName, data);
            }
        }
    });

    var errorHandler = new ErrorHandler();
    P.declare("errorHandler", errorHandler);
});
</script><div id="error-messages" data-config="{&quot;orderErrorRedirect&quot;:{&quot;errorAction&quot;:{&quot;displayLabel&quot;:&quot;Go to Detail Page&quot;,&quot;url&quot;:&quot;/dp/B07VRS84D1/ref=dppui_kswag_checkout_dp?_token_v2=hE6BUQ%252B8957WyxOu8zGcX%252FdStaC%252FjKipoDfnRKoc0IvTAAAAAGPHi5EAAAAB&quot;,&quot;name&quot;:&quot;Error:Redirect&quot;},&quot;errorDescription&quot;:&quot;There was an error processing your order. Please try again after some time.&quot;,&quot;errorHeader&quot;:&quot;Error&quot;},&quot;orderErrorRefresh&quot;:{&quot;errorAction&quot;:{&quot;displayLabel&quot;:&quot;Continue&quot;,&quot;url&quot;:&quot;&quot;,&quot;name&quot;:&quot;Error:Refresh&quot;},&quot;errorDescription&quot;:&quot;There was an error processing your order. Please click continue to refresh the page.&quot;,&quot;errorHeader&quot;:&quot;Error&quot;},&quot;paymentMethodInactive&quot;:{&quot;errorAction&quot;:{&quot;displayLabel&quot;:&quot;Ok&quot;,&quot;url&quot;:&quot;&quot;,&quot;name&quot;:&quot;Error:Refresh&quot;},&quot;errorDescription&quot;:&quot;The payment method used is no longer available.&quot;,&quot;errorHeader&quot;:&quot;There was a problem&quot;},&quot;internalErrorRedirect&quot;:{&quot;errorAction&quot;:{&quot;displayLabel&quot;:&quot;Go to Detail Page&quot;,&quot;url&quot;:&quot;/dp/B07VRS84D1/ref=dppui_kswag_checkout_dp?_token_v2=hE6BUQ%252B8957WyxOu8zGcX%252FdStaC%252FjKipoDfnRKoc0IvTAAAAAGPHi5EAAAAB&quot;,&quot;name&quot;:&quot;Error:Redirect&quot;},&quot;errorDescription&quot;:&quot;There was an error processing your request. Please try again after some time.&quot;,&quot;errorHeader&quot;:&quot;Error&quot;},&quot;invalidVerificationError&quot;:{&quot;errorAction&quot;:{&quot;displayLabel&quot;:&quot;OK&quot;,&quot;url&quot;:&quot;&quot;,&quot;name&quot;:&quot;Error:Close&quot;},&quot;errorDescription&quot;:&quot;&quot;,&quot;errorHeader&quot;:&quot;Error&quot;},&quot;internalErrorInform&quot;:{&quot;errorAction&quot;:{&quot;displayLabel&quot;:&quot;OK&quot;,&quot;url&quot;:&quot;&quot;,&quot;name&quot;:&quot;Error:Close&quot;},&quot;errorDescription&quot;:&quot;There was an error processing your request. Please try again after some time.&quot;,&quot;errorHeader&quot;:&quot;Error&quot;},&quot;csrfValidationError&quot;:{&quot;errorAction&quot;:{&quot;displayLabel&quot;:&quot;Continue&quot;,&quot;url&quot;:&quot;&quot;,&quot;name&quot;:&quot;Error:Refresh&quot;},&quot;errorDescription&quot;:&quot;There was an error processing your order. Please click continue to refresh the page.&quot;,&quot;errorHeader&quot;:&quot;Error&quot;}}"></div>
<script id="error-popover-header-tmpl" type="text/x-tmpl-mustache">
    <span class="a-size-medium a-color-base a-text-bold">
        {{errorHeader}}
    </span></script>
<script id="error-popover-content-tmpl" type="text/x-tmpl-mustache">
    {{errorDescription}}
    <br/><br/>
    {{#errorAction}}
        <div class="a-section a-text-center"><span id="error-popover-button" class="a-button a-button-span3 a-button-primary"><span class="a-button-inner"><button id="error-popover-button-announce" class="a-button-text a-text-center" type="button">
                {{displayLabel}}
            </button></span></span></div>
    {{/errorAction}}
</script>

<span class="a-declarative" data-action="a-modal" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-a-modal" data-a-modal="{&quot;closeButton&quot;:&quot;false&quot;,&quot;activate&quot;:&quot;onclick&quot;}" id="error-popover" data-csa-c-id="buwf6i-ql50o5-o8k797-n2pnpj"></span></div></div><div class="a-row"><div class="a-column a-span3"><script>
P.when('A', 'Handler', 'jQuery', 'mustache', 'ready').execute(function(A, Handler, jQuery, Mustache) {
    var template, detailsJson, html;
    template = jQuery('#product-image-tmpl').html();
    detailsJson = jQuery('.productImageData').data("details-json");
    html = Mustache.to_html(template, detailsJson);
    jQuery('#product-image-container').html(html);
});
</script><div data-details-json="{&quot;asin&quot;:&quot;B07VRS84D1&quot;,&quot;title&quot;:&quot;Pragmatic Programmer, The: Your journey to mastery, 20th Anniversary Edition&quot;,&quot;imageUrl&quot;:&quot;https://m.media-amazon.com/images/I/71Nxk9VhSTL._SX600_.jpg&quot;,&quot;byLine&quot;:&quot;by David Thomas&quot;,&quot;price&quot;:{&quot;currency&quot;:&quot;INR&quot;,&quot;amount&quot;:1296.75},&quot;loyaltyPoints&quot;:{&quot;percentage&quot;:null,&quot;number&quot;:0,&quot;numberString&quot;:null},&quot;preOrderDeliveryMessage&quot;:null,&quot;additionalDetails&quot;:{&quot;binding&quot;:&quot;Kindle Edition&quot;,&quot;seller&quot;:&quot;Sold by: Amazon Asia-Pacific Holdings Private Limited&quot;}}" class="a-section a-spacing-none a-padding-none productImageData"></div><div id="product-image-container" class="a-section a-spacing-none a-padding-none">
    <img alt="Pragmatic Programmer, The: Your journey to mastery, 20th Anniversary Edition" src="./BFO Page_files/71Nxk9VhSTL._SX600_.jpg" id="product-display-image"></div><script id="product-image-tmpl" type="text/x-tmpl-mustache">
    <img alt="{{title}}" src="{{imageUrl}}" id="product-display-image"/></script>
<div class="a-row a-spacing-large a-spacing-top-mini"><script>
P.when('A', 'jQuery', 'productPreSelectionHandler', 'Handler', 'productSelectorHandler', 'productQuantityUpdateHandler', 'DPPUIConstants', 'ready').execute(function(A, jQuery, productPreSelectionHandler, Handler, productSelectorHandler, productQuantityUpdateHandler, DPPUIConstants) {

    // Text box value change
    function updateQuantityOnClickOrEnter() {
        P.when("a-dropdown", 'simple-quantity-picker', 'ready').execute(function (dropdown, simpleQuantityPicker) {
            simpleQuantityPicker.uiManager.hideUpdateButton();
            simpleQuantityPicker.uiManager.hideQuantityWarning();

            var quantity = simpleQuantityPicker.getValidatedQuantityText();
            simpleQuantityPicker.uiManager.refresh(quantity);
            productQuantityUpdateHandler.trigger("ProductQuantity:changed");
        });
    };

    // Dropdown value change
    A.declarative('quantityChanged', 'change', function(event) {
        P.when("simple-quantity-picker").execute(function(simpleQuantityPicker) {
            simpleQuantityPicker.uiManager.refresh(simpleQuantityPicker.getDropdownValue());
            productQuantityUpdateHandler.trigger("ProductQuantity:changed");
        });
    });

    // Update button clicked
    A.declarative('quantityUpdated', 'click', function(event) {
        updateQuantityOnClickOrEnter();
    });

    // Enter button pressed
    A.declarative('quantity-update-text-action', 'keypress', function(e) {
        var event = e.$event;
        if (event.keyCode == parseInt(DPPUIConstants.KEYCODES.ENTER)) {
            updateQuantityOnClickOrEnter();
        }
    })

});

P.when('jQuery', 'Handler', 'ready').execute(function(jQuery, Handler) {
    var ProductQuantityHandler = Handler.extend({
        init : function() {
            this.registerDataSource("ProductQuantity:GetUpdatedQuantity", this.getUpdatedQuantity.bind(this));
        },

        // All code comes here to get the current quantity value.
        getUpdatedQuantity : function() {
            return this.fetch("Quantity:currentQuantityValue");
        },
    });
    var productQuantityHandler = new ProductQuantityHandler();
    P.declare("productQuantityHandler", productQuantityHandler);
    if(jQuery('#quantitySelector').length > 0) {
        jQuery('#quantitySelector').val(jQuery('.productData').data('price-breakdown-json').quantity.value);
    }
});

// Recalculate price, promotions, total before tax, and tax
P.when('A', 'Handler', 'productPreSelectionHandler', 'productSelectorHandler', 'orderComponentsHandler', 'productQuantityHandler', 'paySelectHandler', 'jQuery', 'currencyManager', 'ready').execute(function(A, Handler, productPreSelectionHandler, productSelectorHandler, orderComponentUtilHandler, productQuantityHandler, paySelectHandler, jQuery, currencyManager){

    var updateOrderComponentsRequestData = {};
    var orderComponentTypes = ["TAX", "SITEWIDE_PROMOTION", "COUPON_PROMOTION", "SITEWIDE_PROMOTION_TAX", "COUPON_PROMOTION_TAX"];
    var products = null;
    var payable = {};
    var updatedQuantity = null;

    var ProductQuantityUpdateHandler = Handler.extend({
        init : function() {
            this.registerHandlerMethod("ProductQuantity:changed", this.onProductQuantityChanged.bind(this));
        },

        onProductQuantityChanged : function() {
            products = productSelectorHandler.fetch("ProductSelector:SelectedProductDetails");
            payable.asin =  products[0].details.asin;
            payable.price = products[0].price;
            payable.chargeType = products[0].chargeType;
            updatedQuantity = productQuantityHandler.fetch("ProductQuantity:GetUpdatedQuantity");

            var selectedPaymentOptions = paySelectHandler.fetch("GetSelectedPaymentOptions");
            var matchingPaymentOptions =  A.filter(selectedPaymentOptions, function(paymentOption) {
                return paymentOption.type == 'Card' || paymentOption.type == 'BankAccount';
            });
            // Only add selectedPaymentOption if a valid option exists and is not empty
            if (matchingPaymentOptions.length > 0 && matchingPaymentOptions[0].instrumentId) {
                updateOrderComponentsRequestData.selectedPaymentOption = {
                    instrumentId: matchingPaymentOptions[0].instrumentId,
                    paymentMethodCode: matchingPaymentOptions[0].paymentMethodCode
                };
            }
            this.updatePlaceYourOrderFormData(updatedQuantity);

            updateOrderComponentsRequestData.quantity = parseInt(updatedQuantity);
            updateOrderComponentsRequestData.payable = payable;
            updateOrderComponentsRequestData.orderComponentTypes = orderComponentTypes;
            updateOrderComponentsRequestData.callback = this.updateOrderSummaryWithOrderComponents;
            orderComponentUtilHandler.fetch("ProductSelector:GetUpdatedOrderComponents", updateOrderComponentsRequestData);

            //Broadcast event to other queue
            this.process("ProductQuantity:changed");
        },

        // Updates PYO Button form data value for param 'quantity' which is used in PSP page
        // to display quantity of ebook in BFO order.
        updatePlaceYourOrderFormData : function(updatedQuantity) {
            var quantityField = document.getElementsByName("quantity");
            if (quantityField && quantityField.length) {
                  if ( quantityField.length == 2 ) {
                    quantityField[1].value = updatedQuantity;
                  } else {
                    quantityField[0].value = updatedQuantity;
                  }
            }
        },

        updateOrderSummaryWithOrderComponents : function(updatedOrderComponentsMap) {
            var siteWidePromotionAmount = 0;
            var couponPromotionAmount = 0;

            if (updatedOrderComponentsMap.SITEWIDE_PROMOTION) {
                var siteWidePromotion = updatedOrderComponentsMap.SITEWIDE_PROMOTION;
                siteWidePromotionAmount = Math.abs(parseFloat(siteWidePromotion.value));

                if (updatedOrderComponentsMap.SITEWIDE_PROMOTION_TAX) {
                    var siteWidePromotionTax = updatedOrderComponentsMap.SITEWIDE_PROMOTION_TAX;
                    var siteWidePromotionTaxAmount = Math.abs(parseFloat(siteWidePromotionTax.value));
                    siteWidePromotionAmount += siteWidePromotionTaxAmount;
                }
            }
            if (updatedOrderComponentsMap.COUPON_PROMOTION) {
                couponPromotion = updatedOrderComponentsMap.COUPON_PROMOTION;
                couponPromotionAmount = Math.abs(parseFloat(couponPromotion.value));

                if (updatedOrderComponentsMap.COUPON_PROMOTION_TAX) {
                    var couponPromotionTax = updatedOrderComponentsMap.COUPON_PROMOTION_TAX;
                    var couponPromotionTaxAmount = Math.abs(parseFloat(couponPromotionTax.value));
                    couponPromotionAmount += couponPromotionTaxAmount;
                }
            }
            var priceBreakDown = jQuery('.productData').data('price-breakdown-json');

            var deductions = priceBreakDown.deductions;
            for (var index in deductions) {
               // TODO: Move logic to view model and remove logic key from displayablePriceModel
               // https://issues.amazon.com/issues/KSWAG-2313
               if (deductions[index].labelKey == "dppui-promotions-label") {
                    var currentPromotionPrice = deductions[index].price;
                    var currentPromotionCOPPrice = deductions[index].copPrice;
                    var promotionAmount = couponPromotionAmount + siteWidePromotionAmount;
                    var currencyOfPreferencePrice = currencyManager.currencyConverter(promotionAmount, currentPromotionPrice.unit);
                    if(currencyOfPreferencePrice) {
                        currentPromotionCOPPrice.value = parseFloat(currencyOfPreferencePrice.value);
                        currentPromotionCOPPrice.displayString = currencyManager.format(currencyOfPreferencePrice.value, currencyOfPreferencePrice.unit);
                     }
                    currentPromotionPrice.value = promotionAmount;
                    currentPromotionPrice.displayString = currencyManager.format(promotionAmount, currentPromotionPrice.unit);
               }
            }

            if (priceBreakDown.orderTotalBeforeTax) {
                var updatedTotalBeforeTax = null;
                var totalBeforeTax = null;
                if (jQuery('#currencyOfPreferenceEnabled').data("value") == true) {
                    updatedTotalBeforeTax = priceBreakDown.orderTotalBeforeTax.copPrice;
                    totalBeforeTax = parseInt(updatedQuantity) * priceBreakDown.itemPrice[0].copPrice.value;
                } else {
                    updatedTotalBeforeTax = priceBreakDown.orderTotalBeforeTax.price;
                    totalBeforeTax = parseInt(updatedQuantity) * priceBreakDown.itemPrice[0].price.value;
                }
                updatedTotalBeforeTax.value = totalBeforeTax;
                updatedTotalBeforeTax.displayString = currencyManager.format(updatedTotalBeforeTax.value, updatedTotalBeforeTax.unit);
            }

            if(updatedOrderComponentsMap.TAX && priceBreakDown.taxAmount) {
                var taxPrice = priceBreakDown.taxAmount.price;
                var taxPriceCOP = priceBreakDown.taxAmount.copPrice;
                taxPrice.value = parseFloat(updatedOrderComponentsMap.TAX.value);
                var unit = taxPrice.unit;
                taxPrice.displayString = currencyManager.format(taxPrice.value, unit);
                var currencyOfPreferencePrice = currencyManager.currencyConverter(updatedOrderComponentsMap.TAX.value, unit);
                if(currencyOfPreferencePrice) {
                    taxPriceCOP.value = parseFloat(currencyOfPreferencePrice.value);
                    taxPriceCOP.displayString = currencyManager.format(currencyOfPreferencePrice.value, currencyOfPreferencePrice.unit);
                }
            }

            productSelectorHandler.trigger("ProductSelector:productChanged");
        },

    });
    var ProductQuantityUpdateHandler = new ProductQuantityUpdateHandler();
    P.declare("productQuantityUpdateHandler", ProductQuantityUpdateHandler);
});

<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://issues.amazon.com/issues/KSWAG-2313" title="Open URL: https://issues.amazon.com/issues/KSWAG-2313 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://issues.amazon.com/issues/KSWAG-2313" title="Open URL in Popup: https://issues.amazon.com/issues/KSWAG-2313 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>
<script>
P.when('Handler', 'jQuery', 'ready').execute(function(Handler, jQuery){

    var fetchOrderComponentsUrl = jQuery('#fetchOrderComponentsUrl');
    var OrderComponentsHandler = Handler.extend({
        init : function() {
            this.registerDataSource("ProductSelector:GetUpdatedOrderComponents", this.fetchOrderComponents.bind(this));
        },
        fetchOrderComponents : function(data) {
            var parameters = {
                              quantity : data.quantity,
                              orderComponentTypes : data.orderComponentTypes,
                              selectedPaymentOption : data.selectedPaymentOption,
                              payableData : data.payable};
            jQuery.ajax({
            	url: fetchOrderComponentsUrl.data('fetch-order-components-url'),
            	contentType: 'application/json',
            	data: JSON.stringify(parameters),
	    	type: 'POST',
            	async: true,
		success: function(response) {
                data.callback(response.orderComponents);
             }
	    });
      },
   });
    var orderComponentsHandler = new OrderComponentsHandler();
    P.declare("orderComponentsHandler", orderComponentsHandler);
});
</script>
<script>
P.when('Handler','productSelectorHandler', 'productBuilder', 'orderSummaryHandler', 'jQuery', 'ready').execute(function(Handler, productSelectorHandler, productBuilder, orderSummaryHandler, jQuery){
    var ProductPreSelectionHandler = Handler.extend({
        init : function() {
            productSelectorHandler.registerDataSource("ProductSelector:SelectedProductDetails", this.getSelectedProduct.bind(this));
            productSelectorHandler.trigger("ProductSelector:productChanged");
            this.broadcast("PaymentOptions:SelectDefaultPaymentMethod");
        },

        getSelectedProduct : function() {
            var self = this;
            var productList = [];

            jQuery('.productData').each(function() {
                var productElementData = jQuery(this).data();
                var products = productBuilder.fetch("ProductBuilder:buildProduct", productElementData);
                if (!products) {
                    return;
                }
                jQuery.merge(productList,products);
            });
            return jQuery.extend(true, {}, productList);
        }
    });

    var ProductPreSelectionHandler = new ProductPreSelectionHandler();
    P.declare("productPreSelectionHandler", ProductPreSelectionHandler);
});

</script>
<script>

P.when('Handler', 'productQuantityHandler', 'jQuery', 'ready').execute(function(Handler, productQuantityHandler, jQuery){
    var ProductBuilder = Handler.extend({
        init : function() {
            this.registerDataSource("ProductBuilder:buildProduct", this.buildProduct.bind(this));
        },

        buildProduct : function(productElementData) {
            var products = [];
            var trialType = productElementData.trialType;
            if(productElementData.chargeType == "PREFERENCE" && !this.shouldSkipPreferenceFromProducts()) {
                return ;
            }
            if(trialType == "FREE" || trialType == "PAID") {
                products.push(this.populateProductData(productElementData,
                productElementData.pendingPlanPriceValue,
                productElementData.chargeType,
                null,
                productElementData.chargeType == "RECURRING"));

                products.push(this.populateProductData(productElementData,
                productElementData.value,
                (trialType == "FREE") ? "NONE" : "ONE_TIME",
                productElementData.priceBreakdownJson,
                productElementData.chargeType == "RECURRING"));
            } else {
                products.push(this.populateProductData(productElementData,
                productElementData.value,
                productElementData.chargeType,
                productElementData.priceBreakdownJson,
                productElementData.chargeType == "RECURRING"));
            }
            return products;
        },

        populateProductData : function(productElementData, priceValue, chargeType, priceBreakdownJson, isRecurring) {
            var product = {};
            product.id = productElementData.id;
            var price = {};
            price.value = priceValue;
            price.unit = productElementData.unit;
            if (price.value != null) {
                product.price = price;
            }
            var breakdown = priceBreakdownJson;
            if(jQuery('#quantitySelectionContainer').length > 0) {
                breakdown.quantity.value = productQuantityHandler.fetch("ProductQuantity:GetUpdatedQuantity");
            }
            product.breakdown = breakdown;
            var productDetails = productElementData.detailsJson;
            product.details = productDetails;
            product.chargeType = chargeType;
            product.clientReference = productElementData.clientReference;
            product.productType = productElementData.productType;
            product.dependentProductIds = productElementData.dependentProductIds;
            if(jQuery('#currencyOfPreferenceEnabled').data("value") == true) {
                var copPrice = {};
                copPrice.value = productElementData.copValue;
                copPrice.unit = productElementData.copUnit;
                product.copPrice = copPrice;
            }
            if(isRecurring)
            {
                product.vetRequired = productElementData.vetRequired;
                var billingCycle = {};
                if(productElementData.pendingPlanDurationPeriod) {
                    var trialPeriod = {};
                    trialPeriod.unit = this.getPlanDurationUnit(productElementData.durationUnit);
                    trialPeriod.value = productElementData.durationPeriod;
                    billingCycle.trialPeriod = trialPeriod;
                    billingCycle.frequency = this.getFrequencyForPlan(productElementData.pendingPlanDurationPeriod, productElementData.pendingPlanDurationUnit);
                } else {
                    billingCycle.frequency = this.getFrequencyForPlan(productElementData.durationPeriod, productElementData.durationUnit);
                }
                product.billingCycle = billingCycle;
                product.recurringClientReference = productElementData.recurringClientReference;
                var maximumMandatePrice = {};
                maximumMandatePrice.unit = productElementData.maximumMandatePriceUnit;
                maximumMandatePrice.value = productElementData.maximumMandatePriceValue;
                var nextBillingAmount = {};
                nextBillingAmount.unit = productElementData.nextBillAmountUnit;
                nextBillingAmount.value = productElementData.nextBillAmountValue;
                product.maximumMandatePrice = maximumMandatePrice;
                product.nextBillingAmount = nextBillingAmount;
            }
            return product;
        },

        getFrequencyForPlan : function(period, unit) {
            if(unit === undefined) return;
            var monthUnits = {
                1 : "MONTHLY",
                3 : "QUARTERLY",
                6 : "HALF_YEARLY",
                12 : "YEARLY"
            }
            var unitNormalized = unit.toUpperCase();
            if (unitNormalized === "DAY" || unitNormalized === "DAYS") {
                if (period >=28 && period <= 31) {
                    return "MONTHLY";
                }
            } else if (unitNormalized === "MONTH" || unitNormalized === "MONTHS") {
                return monthUnits[period];
            } else if (unitNormalized === "YEAR" || unitNormalized === "YEARS") {
                if (period === 1) {
                    return "YEARLY";
                }
            }
            return "MONTHLY";
        },

        getPlanDurationUnit : function(unit) {
            if(unit === undefined) return;
            var unitNormalized = unit.toUpperCase();
            var units = {
                "DAYS" : "DAY",
                "MONTHS" : "MONTH",
                "YEARS" : "YEAR"
            }
            return (units[unitNormalized] ? units[unitNormalized] : unitNormalized);
        },

        shouldSkipPreferenceFromProducts : function() {
            var preferenceCheckBox = jQuery('.preference-message:visible').find("input[name^='preferenceCheckBox']");
            if(preferenceCheckBox && preferenceCheckBox.get(0) && !preferenceCheckBox.get(0).checked) {
                return false;
            }
            return true;
        }
    });
    var productBuilder = new ProductBuilder();
    P.declare("productBuilder", productBuilder);
});

</script>
<script>
P.when('A', 'Handler','paySelectHandler', 'jQuery', 'a-button', 'ready').execute(function(A, Handler, paySelectHandler, jQuery, getButtonCollection){
    var ProductSelectorHandler = Handler.extend({
        init : function() {
            paySelectHandler.registerDataSource("GetSelectedProductDetails", this.getSelectedProducts.bind(this));
            this.registerHandlerMethod("ProductSelector:productChanged", this.onProductSelection.bind(this));
            var self = this;
            A.declarative('ProductSelection', 'click', function(event){
                paySelectHandler.trigger("Product:changed");
                self.showPaySelect();
                window.history.pushState({}, document.title, window.location.href);
                window.onpopstate = function(event) {
                    self.showProductSelector();
                };
            });

            A.declarative('ChangeProduct', 'click', function(event){
                self.showProductSelector();
                window.history.back();
            });
        },

        showPaySelect : function() {
            jQuery('#product-selector-view').addClass("aok-hidden");
            jQuery('#pay-select-view').removeClass("aok-hidden");
            jQuery("#shipping-address-placeholder").addClass("aok-hidden");
        },

        showProductSelector : function() {
            jQuery('#product-selector-view').removeClass("aok-hidden");
            jQuery('#pay-select-view').addClass("aok-hidden");
            jQuery("#shipping-address-placeholder").addClass("aok-hidden");
        },

        getSelectedProducts : function() {
            return this.fetch("ProductSelector:SelectedProductDetails");
        },
        
        onProductSelection : function() {
            var continueButton = getButtonCollection('.productSelectorContinue');
            // Continue button is applicable only in Mobile view where product selector is shown before showing payment options.
            if (!continueButton.isEmpty()) {
                continueButton.enable();
            } else {
                paySelectHandler.trigger("Product:changed");
                jQuery('#product-selector-view').addClass("aok-hidden");
                jQuery('#pay-select-view').removeClass("aok-hidden");
            }
        }
    });

    var ProductSelectorHandler = new ProductSelectorHandler();
    P.declare("productSelectorHandler", ProductSelectorHandler);
});
</script><div id="B07VRS84D1" data-charge-type="ONE_TIME" data-details-json="{&quot;asin&quot;:&quot;B07VRS84D1&quot;,&quot;title&quot;:&quot;Pragmatic Programmer, The: Your journey to mastery, 20th Anniversary Edition&quot;,&quot;imageUrl&quot;:&quot;https://m.media-amazon.com/images/I/71Nxk9VhSTL._SX600_.jpg&quot;,&quot;byLine&quot;:&quot;by David Thomas&quot;,&quot;price&quot;:{&quot;currency&quot;:&quot;INR&quot;,&quot;amount&quot;:1296.75},&quot;loyaltyPoints&quot;:{&quot;percentage&quot;:null,&quot;number&quot;:0,&quot;numberString&quot;:null},&quot;preOrderDeliveryMessage&quot;:null,&quot;additionalDetails&quot;:{&quot;binding&quot;:&quot;Kindle Edition&quot;,&quot;seller&quot;:&quot;Sold by: Amazon Asia-Pacific Holdings Private Limited&quot;}}" data-id="B07VRS84D1" data-price-breakdown-json="{&quot;header&quot;:&quot;Order Summary&quot;,&quot;itemPrice&quot;:[{&quot;label&quot;:&quot;eBook price:&quot;,&quot;secondaryLabel&quot;:null,&quot;labelKey&quot;:null,&quot;description&quot;:null,&quot;percentageString&quot;:null,&quot;price&quot;:{&quot;unit&quot;:&quot;INR&quot;,&quot;value&quot;:1296.75,&quot;displayString&quot;:&quot;&amp;#8377;1,296.75&quot;,&quot;secondaryDisplayString&quot;:null},&quot;excludeFromCalculation&quot;:false,&quot;preDiscountPrice&quot;:null,&quot;preDiscountCopPrice&quot;:null,&quot;copPrice&quot;:null}],&quot;audibleOur&quot;:null,&quot;taxAmount&quot;:null,&quot;orderTotalBeforeTax&quot;:{&quot;label&quot;:&quot;Total before tax:&quot;,&quot;secondaryLabel&quot;:null,&quot;labelKey&quot;:null,&quot;description&quot;:null,&quot;percentageString&quot;:null,&quot;price&quot;:{&quot;unit&quot;:&quot;INR&quot;,&quot;value&quot;:1296.75,&quot;displayString&quot;:&quot;&amp;#8377;1,296.75&quot;,&quot;secondaryDisplayString&quot;:null},&quot;excludeFromCalculation&quot;:false,&quot;preDiscountPrice&quot;:null,&quot;preDiscountCopPrice&quot;:null,&quot;copPrice&quot;:null},&quot;quantity&quot;:{&quot;label&quot;:&quot;Quantity:&quot;,&quot;value&quot;:&quot;1&quot;,&quot;changeQuantityLabel&quot;:null},&quot;deductions&quot;:[],&quot;discounts&quot;:null,&quot;orderTotal&quot;:{&quot;label&quot;:&quot;Order total:&quot;,&quot;secondaryLabel&quot;:&quot;Subtotal:&quot;,&quot;labelKey&quot;:null,&quot;description&quot;:null,&quot;percentageString&quot;:null,&quot;price&quot;:{&quot;unit&quot;:&quot;INR&quot;,&quot;value&quot;:1296.75,&quot;displayString&quot;:&quot;&amp;#8377;1,296.75&quot;,&quot;secondaryDisplayString&quot;:null},&quot;excludeFromCalculation&quot;:false,&quot;preDiscountPrice&quot;:null,&quot;preDiscountCopPrice&quot;:null,&quot;copPrice&quot;:null},&quot;loyaltyPoints&quot;:null,&quot;hidePriceSummary&quot;:false,&quot;copDisclaimer&quot;:&quot;Due to currency conversion rounding, values in your preferred currency are for reference only and may not exactly match the amount you will be charged.&quot;}" data-unit="INR" data-value="1296.75" class="a-section a-spacing-none a-padding-none productData"></div><div id="product-details-container" class="a-section a-spacing-none a-padding-none">
    <div class="a-section a-spacing-none"><div class="a-row"><span id="product-title" class="a-size-base a-text-bold">Pragmatic Programmer, The: Your journey to mastery, 20th Anniversary Edition</span></div><div class="a-row"><div class="a-column a-span12 a-text-left"><span class="a-size-base a-color-tertiary">
                    by David Thomas
                </span></div></div></div></div><script id="product-template-tmpl" type="text/x-tmpl-mustache">
    <div class="a-section a-spacing-none"><div class="a-row"><span id="product-title" class="a-size-base a-text-bold">{{{title}}}</span></div><div class="a-row"><div class="a-column a-span12 a-text-left"><span class="a-size-base a-color-tertiary">
                    {{{byLine}}}
                </span></div></div></div></script>
</div></div><div class="a-column a-span6"><div class="a-row"><div id="expired-payment-method-alert" class="a-section a-spacing-none a-padding-none"></div></div><div class="a-row"><div id="bfo-checkout-form" class="a-section"><fieldset class="a-form-horizontal"><h2 id="bfo-choose-delivery-methods-title" class="a-spacing-top-medium">Choose your delivery options</h2><span class="a-declarative" data-action="bfoDeliveryMethodUpdatedToADl" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-bfoDeliveryMethodUpdatedToADl" data-bfodeliverymethodupdatedtoadl="{}" data-csa-c-id="w8wno8-j57qyf-fp4uep-ic829w"><div data-a-input-name="DeliveryMethodID" class="a-radio"><label for="ADL"><input id="ADL" type="radio" name="DeliveryMethodID" value="ADL" autocomplete="off" checked=""><i class="a-icon a-icon-radio"></i><span class="a-label a-radio-label">We will email redemption links directly to your recipients</span></label></div></span><span class="a-declarative" data-action="bfoDeliveryMethodUpdatedToRDl" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-bfoDeliveryMethodUpdatedToRDl" data-bfodeliverymethodupdatedtordl="{}" data-csa-c-id="a0zydb-em004k-fc9700-86ka4f"><div data-a-input-name="DeliveryMethodID" class="a-radio"><label for="RDL"><input id="RDL" type="radio" name="DeliveryMethodID" value="RDL" autocomplete="off"><i class="a-icon a-icon-radio"></i><span class="a-label a-radio-label">We will give you redemption links to send to your recipients</span></label></div></span><div id="bfo-adl-form" class="a-section"><div id="mec-form" class="a-section a-spacing-top-base"><div class="mec">
    <script type="text/javascript">
        (function(w){
            if(typeof w.MultiEmailControl === 'undefined'){
                w.MultiEmailControl = {};
            }

            w.MultiEmailControl.language = {
                ARIA_MAX_QUANTITY_ERR : "{AMOUNT} over quantity,",
                ARIA_TOO_LONG_EMAIL_ERR_CLEAR : "Emails removed. ",
                ARIA_TEXT_ENTRY_INSTRUCT : "Use arrow keys to navigate emails.",
                ARIA_INVALID_EMAIL_ERR_CLEAR : "invalids removed. ",
                SELECTED_EMAILS : "Order quantity is {AMOUNT}.",
                ARIA_EMAIL_REMOVE : "remove {EMAIL}",
                TOO_LONG_EMAIL_ERR_ACTION : "Please remove the invalid email { AMOUNT, plural, \n one {address}\n other {addresses}\n}.",
                OVER_QUANTITY_ERR : "Please increase quantity or remove { AMOUNT, plural, \n one {# email address} \n other {# email addresses}}",
                ARIA_EMAIL_SELECTED_INVALID : "invalid.",
                ARIA_OVER_QUANTITY_ERR_CLEAR : "quantity increased. ",
                ARIA_TEXT_ENTRY_ERR : "Errors in emails.",
                EMAIL_EXAMPLE : "Example: joe@example.com",
                ARIA_TOO_LONG_EMAIL_ERR : "{AMOUNT} too long,  ",
                TO_FIELD : "To",
                INVALID_EMAIL_ERR : "Invalid email address: '{FIRST_INVALID_EMAIL}'. Please delete and enter valid email address.",
                ARIA_EMAIL_SELECTED_DUPE : "duplicate.",
                ARIA_EMAIL_SELECTED_TOO_LONG : "too long. ",
                MAX_QUANTITY_ERR : "Quantity limited to {QUANTITY} per customer. Please remove {AMOUNT} emails.",
                INVALID_EMAIL_ERR_ACTION : "Please remove the invalid email { AMOUNT, plural, \n one {address}\n other {addresses}\n}.",
                SELECTED_EMAILS_INFO : "(enter an email address for each recipient)",
                ARIA_INVALID_EMAIL_ERR : "{AMOUNT} invalid, ",
                DUPE_EMAIL_ERR : "Your recipient list has duplicates. ",
                ARIA_EMAIL_DELETED : "{EMAIL} removed. ",
                ARIA_OVER_QUANTITY_ERR : "{AMOUNT} over quantity,",
                ARIA_DUPE_EMAIL_ERR_CLEAR : "duplicates removed. ",
                ARIA_EMAIL_SELECTED : "{EMAIL} selected",
                DUPE_EMAIL_ERR_ACTION : "Please remove the duplicate email { AMOUNT, plural,\n one {address} \n other {addresses}\n}.",
                OVER_QUANTITY_ERR_ACTION : "increase your order quantity to {QUANTITY}.",
                PLACEHOLDER_TEXT : "Quantity will be determined by the number of emails you enter.",
                ARIA_EMAIL_EDITING_INSTRUCT : "editing {EMAIL} press enter to confirm",
                TOO_LONG_EMAIL_ERR : "Email addresses cannot be over 255 characters in length. ",
                ARIA_DUPE_EMAIL_ERR : "{AMOUNT} duplicates, ",
                ARIA_EMAIL_SELECTED_INSTRUCT : "Press enter to edit. Delete or Backspace to remove.",
                ARIA_EMAIL_SELECTED_INDEX : "{INDEX} of {AMOUNT} ",
                
            };

        })(window);
    </script>

    <div class="mec-info">
                <div class="mec-label">
                    <label for="mec-holder-input" class="a-form-label">To (enter an email address for each recipient)</label></div>
                <span id="mec-quantity-how-it-works-label" class="a-color-secondary">Quantity will be determined by the number of emails you enter.</span><span id="mec-desktop-instructions-keyboard-nav-label" class="aok-hidden aok-offscreen">Use arrow keys to navigate emails.</span></div>
            <div class="mec-area">
                <ul class="mec-tab-box" role="listbox">
                    
                    <textarea id="mec-holder-input" class="mec-holder-input" spellcheck="false" autocomplete="off" rows="1" aria-describedby="mec-quantity-how-it-works-label mec-desktop-instructions-keyboard-nav-label mec-aria-errors-label mec-selected" placeholder="Example: joe@example.com" aria-invalid="false" style="width: 203px;"></textarea></ul>
            <span style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; z-index: -1;"></span></div>
            <div class="mec-errors">
            </div>
            <div id="mec-selected" class="mec-selected aok-hidden" aria-live="polite"></div>
        <input name="mec_weblab_treatment" type="hidden" value="T1">
<div id="mec-aria-errors-label" class="aok-hidden aok-offscreen" style="height: 0px;"></div></div>
<div id="mec-data" data-contact-group-id="b916fbe8-9fff-493d-b1ba-c65e09362943" data-get-emails-url="/dppui/mec-get-contacts/ref=dppui_kswag_checkout_mec-get-contacts?clientId=kswag&amp;variant=&amp;view=desktop&amp;oL=&amp;MarketplaceID=A21TJRUUN4KGV&amp;businessProfile&amp;_token_v2=hJmDc%252B3uW8kujsFCPPoVLrWIryRFnxz8w7jLv6I1nyJ%252FAAAAAGPHi5IAAAAB" data-max-quantity="1000" data-pyo-popover-text="Make sure you have fixed the email address issue before proceeding." data-related-request-id="E2WFHK2PD2NF0NVZ86FC" data-save-url="/dppui/mec-save/ref=dppui_kswag_checkout_mec-save?clientId=kswag&amp;variant=&amp;view=desktop&amp;oL=&amp;MarketplaceID=A21TJRUUN4KGV&amp;businessProfile&amp;_token_v2=hJmDc%252B3uW8kujsFCPPoVLrWIryRFnxz8w7jLv6I1nyJ%252FAAAAAGPHi5IAAAAB" data-update-url="/dppui/mec-update/ref=dppui_kswag_checkout_mec-update?clientId=kswag&amp;variant=&amp;view=desktop&amp;oL=&amp;MarketplaceID=A21TJRUUN4KGV&amp;businessProfile&amp;sif_profile=giftingEmailListEU&amp;_token_v2=hJmDc%252B3uW8kujsFCPPoVLrWIryRFnxz8w7jLv6I1nyJ%252FAAAAAGPHi5IAAAAB" class="a-section a-padding-none aok-hidden"></div><script type="text/javascript">
            "use strict";

P.when(
    'A',
    'jQuery',
    'multi-email-control',
    'confirmOrderHandler',
    'productQuantityUpdateHandler',
    'simple-quantity-picker',
    'DPPUIConstants',
    'ready').execute(function (
        A,
        jQuery,
        multiEmailControl,
        confirmOrderHandler,
        productQuantityUpdateHandler,
        simpleQuantityPicker,
        DPPUIConstants)
    {
        
    
    var emailParsed = false;
    var bulkEntry = false;
    var duplicateEmailError = false;
    var invalidEmailError = false;
    var overQuantityError = false;
    var maxQuantityError = false;
    var mecErrorOccured = false;

    
    function updateQuantityOnClickOrEnter() {
        P.when('a-dropdown', 'ready').execute(function (dropdown) {
            multiEmailControl.setMaxEmailCount(simpleQuantityPicker.getValidatedQuantityText());
            logMetric('CheckoutUpdateQuantityClicked', true);
        });
    }

    
    function logMECErrors(errObj) {
        if (errObj.errors) {
            if (!mecErrorOccured) {
                logMetric("MECErrorOccured");
                mecErrorOccured = true;
            }
            errObj.errors.forEach(function(error) {
                if (!duplicateEmailError && error.type === "DUPE_EMAIL_ERR")  {
                    duplicateEmailError = true;                        
                    logMetric('MECDuplicateEmailError');
                    logMetric("MECErrorTypes", true);
                }
                else if (!invalidEmailError && error.type === "INVALID_EMAIL_ERR") {
                    invalidEmailError = true;
                    logMetric('MECInvalidEmailError');
                    logMetric("MECErrorTypes", true);
                }
                else if (!overQuantityError && error.type === "OVER_QUANTITY_ERR") {
                    overQuantityError = true;
                    logMetric('MECOverQuantityError');
                    logMetric("MECErrorTypes", true);
                }
                else if (!maxQuantityError && error.type === "MAX_QUANTITY_ERR") {
                    maxQuantityError = true;
                    logMetric('MECMaxQuantityError');
                    logMetric("MECErrorTypes", true);
                }
            });
        }
    }

    
    A.declarative('quantityChanged', 'change', function(event) {
        multiEmailControl.setMaxEmailCount(simpleQuantityPicker.getDropdownValue());
    });

    
    A.declarative('quantityUpdated', 'click', function(event) {
        updateQuantityOnClickOrEnter();
    });

    
    A.declarative('quantity-update-text-action', 'keypress', function(e) {
        var event = e.$event;
        if (event.keyCode == parseInt(DPPUIConstants.KEYCODES.ENTER)) {
            updateQuantityOnClickOrEnter();
        }
    });

    var mecData = jQuery('#mec-data');

    
    var maxQuantity = mecData.data("max-quantity");
    var cappedMaxQuantity = (maxQuantity > 999) ? 999 : maxQuantity;

    var options = {
        
        overQuantityCallback: function (overQuantity) {
            multiEmailControl.setMaxEmailCount(overQuantity);
            simpleQuantityPicker.uiManager.updateQuantityPicker(overQuantity);
            productQuantityUpdateHandler.trigger("ProductQuantity:changed");
            logMetric('MECIncreaseQuantityClicked', true);
        },
        errorStateCallback: function (errObj) {
            if(errObj.hasErrors) {
                confirmOrderHandler.process("Action:disable", {showPopoverText : false});
                logMECErrors(errObj);
            } else {
                confirmOrderHandler.mecReadyToEnable();
            }
        },
        metricsCallback: function () {
            var stats = multiEmailControl.getStats();
            var selectedDeliveryMethod = jQuery("input[name='DeliveryMethodID']:checked").val();
            if (selectedDeliveryMethod === 'ADL') {
                var emailCount = stats.emailCount;
                var giftingFormContainer = jQuery('#bfo-checkout-form');
                if (emailCount == 0) {
                    confirmOrderHandler.process("Action:disable", {showPopoverText : false});
                    giftingFormContainer.find("#bfo-adl-zero-quantity-alert").removeClass("aok-hidden");
                } else {
                    giftingFormContainer.find("#bfo-adl-zero-quantity-alert").addClass("aok-hidden");
                }
                giftingFormContainer.find("#mec-information").removeClass('aok-hidden');
                giftingFormContainer.find("#mec-information").removeClass('aok-offscreen');
                if (emailCount > 0) {
                    giftingFormContainer.find("#mec-selected").removeClass('aok-hidden');
                    giftingFormContainer.find("#mec-selected").removeClass('aok-offscreen');
                } else {
                    giftingFormContainer.find("#mec-selected").addClass('aok-hidden');
                }
                multiEmailControl.setMaxEmailCount(emailCount);
                /* Math.max(0, emailCount) function is used to update quantity value to 0 when an invalid email address is entered
                This is temporary CX fix and ToDo task for CX improvement: https://issues.amazon.com/issues/BOOKSENT-901 */
                simpleQuantityPicker.uiManager.updateQuantityPicker(Math.max(0, emailCount));
                productQuantityUpdateHandler.trigger("ProductQuantity:changed");
            }
            if (!emailParsed && stats.emailParsed == true) {
                emailParsed = true;
                logMetric('emailParsedForADL');
            }
            if (!bulkEntry && stats.bulkEntry == true) {
                bulkEntry = true;
                logMetric('bulkEntryForADL');
            }
        },
        maxQuantity: cappedMaxQuantity,
        
        updateUrl: mecData.data("update-url"),
        saveUrl: mecData.data("save-url"),
        getUrl: mecData.data("get-emails-url"),
        savePayload: {
            mec_contact_group_id: mecData.data("contact-group-id"),
            mec_related_request_id: mecData.data("related-request-id")
        },
        saveParameters: {
            chunkSize: 40,
        },
    };

    function logMetric(metric, isCumulative, count) {
        P.when('A', 'CSM', 'ready').execute(function(A, CSM) {
            if (isCumulative === undefined) {
                isCumulative = false;   
            }
            if (count === undefined) {
                count = 1;
            }
            CSM.logCount(metric, isCumulative, count);
        });
    }

    
    P.when('Handler').execute(function(Handler) {
        var MultiEmailControllerHandler = Handler.extend({
            init : function() {
                this.registerDataSource("MultiEmailController:isValid", this.isValid.bind(this));
                this.registerDataSource("MultiEmailController:submit", this.submit.bind(this));
                
                logMetric("MECErrorTypes", false, 0);
                logMetric("MECErrorOccured", false, 0);
            },
            isValid : function() {
                var selectedDeliveryMethod = jQuery("input[name='DeliveryMethodID']:checked").val();
                if (selectedDeliveryMethod) {
                    // Quantity of the order is now in sync with emails in MEC for ADL delivery method. Hence, emailCount >= 1 is required for order state to be valid
                    return selectedDeliveryMethod === 'RDL' || (multiEmailControl.getStats().emailCount >= 1 && multiEmailControl.isValid() && this.fetch("ScheduledDelivery:isDeliveryDateValid"));
                } else {
                    return multiEmailControl.isValid();
                }
            },
            submit : function() {
                return multiEmailControl.submit();
            },
        });

        var multiEmailControllerHandler = new MultiEmailControllerHandler();
        P.declare("mecHandler", multiEmailControllerHandler);
    });

    var paymentChangeUrl = document.getElementById('paymentchangeurl');
    if (paymentChangeUrl && paymentChangeUrl.length) {
        paymentChangeUrl.addEventListener('click', function() {
            logMetric('MECEntriesBeforePaymentChange', false, multiEmailControl.getStats().emailParsed ? 1 : 0);
        });
    }

    multiEmailControl.init(options);
    multiEmailControl.setMaxEmailCount(simpleQuantityPicker.getCurrentQuantityValue());
});
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://issues.amazon.com/issues/BOOKSENT-901" title="Open URL: https://issues.amazon.com/issues/BOOKSENT-901 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://issues.amazon.com/issues/BOOKSENT-901" title="Open URL in Popup: https://issues.amazon.com/issues/BOOKSENT-901 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>
    <div id="bfo-adl-zero-quantity-alert" class="a-section showable"><div id="bfo-adl-zero-quantity-message" class="a-box a-alert-inline a-alert-inline-info" aria-live="polite" aria-atomic="true"><div class="a-box-inner a-alert-container"><i class="a-icon a-icon-alert"></i><div class="a-alert-content">Enter one or more emails to enable purchase</div></div></div></div></div><script type="a-state" data-a-state="{&quot;key&quot;:&quot;localized-calendar-page-state&quot;}">{"firstDay":0,"dateFormat":"d/m/yy","dayNamesShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"dayAriaLabelFormat":"d MMMM","monthNames":["January","February","March","April","May","June","July","August","September","October","November","December"]}</script><script>
    P.when('A', 'a-calendar-renderer', 'ready').register('calendar-localization-data', function (A) {
        let calendarSettings = A.state('localized-calendar-page-state');
        return {
            monthNames: calendarSettings.monthNames,
            dayNamesShort: calendarSettings.dayNamesShort,
            firstDay: calendarSettings.firstDay,
            currentFormat: "{{month}} {{year}}",
            genericStatus: "Show {{month}} {{year}}",
            dateFormat: calendarSettings.dateFormat,
            dateFormatDescription: "Delivery Date (now, or up to 45 days from today), Date with format d / m / y y",
            dayAriaLabelFormat: "d MMMM"
        };
    });
</script><div id="gifting-form" data-should-tokenize-gift-info="true" data-surface="RW" data-tokenize-url="/dppui/tokenize-gift-info/ref=dppui_kswag_checkout_tokenize-gift-info?clientId=kswag&amp;variant=&amp;view=desktop&amp;oL=&amp;MarketplaceID=A21TJRUUN4KGV&amp;businessProfile&amp;_token_v2=hE6BUQ%252B8957WyxOu8zGcX%252FdStaC%252FjKipoDfnRKoc0IvTAAAAAGPHi5EAAAAB" class="a-section a-spacing-base gifting-form"><div class="a-section"><label for="gifting-form-sender" class="a-form-label a-text-bold">From</label><span class="a-declarative" data-action="giftingFormSenderUpdated" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-giftingFormSenderUpdated" data-giftingformsenderupdated="{}" data-csa-c-id="v6b58s-cgdqbn-py3chp-p1xhzp"><input type="text" maxlength="40" value="srivatsan" id="gifting-form-sender" class="a-input-text a-span12 giftingFormElement" data-content-type="sender" data-element-type="input" data-gifting-mapping="items[0].giftInfo.orderingCustomerNicknameToken"></span></div><div id="message-container" data-message-character-limit="400" class="a-section"><label for="message-input-box" class="a-form-label a-text-bold">Message</label><span class="a-declarative" data-action="giftingFormMessageUpdated" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-giftingFormMessageUpdated" data-giftingformmessageupdated="{}" data-csa-c-id="7dun96-gte4u0-vbzcfj-3y5nr1"><div data-content-type="giftingMessage" data-element-type="textarea" data-gifting-mapping="items[0].giftInfo.giftMessageToken" aria-describedby="charactersRemaining" class="a-input-text-wrapper a-span12 giftingFormElement"><textarea maxlength="400" id="message-input-box" style="height:10em;" aria-describedby="charactersRemaining">Hope you enjoy the book!</textarea></div></span><span id="charactersRemaining" aria-live="polite" class="a-size-base a-color-tertiary">376 characters remaining</span></div><div id="gifting-date" data-surface="RW" class="a-section a-spacing-top-base gifting-form"><span class="a-size-base a-text-bold">Delivery Date (now or up to 45 days from today)</span><div class="a-section date-picker-section"><span class="a-declarative" data-action="scheduledDeliveryDateUpdated" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-scheduledDeliveryDateUpdated" data-scheduleddeliverydateupdated="{}" data-csa-c-id="rg20ca-8mpxpl-2nd4vc-rwt15n"><div id="schedulingDeliveryDate" data-content-type="deliveryDate" data-element-type="input" data-a-cal-attributes="{&quot;minDate&quot;:{&quot;month&quot;:1,&quot;year&quot;:2023,&quot;day&quot;:18},&quot;maxDate&quot;:{&quot;month&quot;:3,&quot;year&quot;:2023,&quot;day&quot;:3}}" data-a-cal-renderer-instance="localized-renderer" data-a-cal-input="true" class="a-cal-calendar-container giftingFormElement date-picker-style"><div class="a-cal-dropdown-container a-hidden" aria-hidden="true"><select data-content-type="deliveryDate" data-csa-c-func-deps="aui-da-a-cal-dropdown-select" data-csa-c-type="widget" data-element-type="input" data-action="a-cal-dropdown-select" class="a-cal-select-month a-declarative" data-csa-c-id="kllnk-mt6f86-8if2p0-nzwyx7"><option value="">Month</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select><select data-content-type="deliveryDate" data-csa-c-func-deps="aui-da-a-cal-dropdown-select" data-csa-c-type="widget" data-element-type="input" data-action="a-cal-dropdown-select" class="a-cal-select-day a-declarative" data-csa-c-id="os7u3m-64u7kf-4xsvus-73igce"><option value="">Day</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option></select><select data-content-type="deliveryDate" data-csa-c-func-deps="aui-da-a-cal-dropdown-select" data-csa-c-type="widget" data-element-type="input" data-action="a-cal-dropdown-select" class="a-cal-select-year a-declarative" data-csa-c-id="dzxsac-xcbluf-ngdhz1-ufz05d"><option value="">Year</option><option value="1900">1900</option><option value="1901">1901</option><option value="1902">1902</option><option value="1903">1903</option><option value="1904">1904</option><option value="1905">1905</option><option value="1906">1906</option><option value="1907">1907</option><option value="1908">1908</option><option value="1909">1909</option><option value="1910">1910</option><option value="1911">1911</option><option value="1912">1912</option><option value="1913">1913</option><option value="1914">1914</option><option value="1915">1915</option><option value="1916">1916</option><option value="1917">1917</option><option value="1918">1918</option><option value="1919">1919</option><option value="1920">1920</option><option value="1921">1921</option><option value="1922">1922</option><option value="1923">1923</option><option value="1924">1924</option><option value="1925">1925</option><option value="1926">1926</option><option value="1927">1927</option><option value="1928">1928</option><option value="1929">1929</option><option value="1930">1930</option><option value="1931">1931</option><option value="1932">1932</option><option value="1933">1933</option><option value="1934">1934</option><option value="1935">1935</option><option value="1936">1936</option><option value="1937">1937</option><option value="1938">1938</option><option value="1939">1939</option><option value="1940">1940</option><option value="1941">1941</option><option value="1942">1942</option><option value="1943">1943</option><option value="1944">1944</option><option value="1945">1945</option><option value="1946">1946</option><option value="1947">1947</option><option value="1948">1948</option><option value="1949">1949</option><option value="1950">1950</option><option value="1951">1951</option><option value="1952">1952</option><option value="1953">1953</option><option value="1954">1954</option><option value="1955">1955</option><option value="1956">1956</option><option value="1957">1957</option><option value="1958">1958</option><option value="1959">1959</option><option value="1960">1960</option><option value="1961">1961</option><option value="1962">1962</option><option value="1963">1963</option><option value="1964">1964</option><option value="1965">1965</option><option value="1966">1966</option><option value="1967">1967</option><option value="1968">1968</option><option value="1969">1969</option><option value="1970">1970</option><option value="1971">1971</option><option value="1972">1972</option><option value="1973">1973</option><option value="1974">1974</option><option value="1975">1975</option><option value="1976">1976</option><option value="1977">1977</option><option value="1978">1978</option><option value="1979">1979</option><option value="1980">1980</option><option value="1981">1981</option><option value="1982">1982</option><option value="1983">1983</option><option value="1984">1984</option><option value="1985">1985</option><option value="1986">1986</option><option value="1987">1987</option><option value="1988">1988</option><option value="1989">1989</option><option value="1990">1990</option><option value="1991">1991</option><option value="1992">1992</option><option value="1993">1993</option><option value="1994">1994</option><option value="1995">1995</option><option value="1996">1996</option><option value="1997">1997</option><option value="1998">1998</option><option value="1999">1999</option><option value="2000">2000</option><option value="2001">2001</option><option value="2002">2002</option><option value="2003">2003</option><option value="2004">2004</option><option value="2005">2005</option><option value="2006">2006</option><option value="2007">2007</option><option value="2008">2008</option><option value="2009">2009</option><option value="2010">2010</option><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option><option value="2014">2014</option><option value="2015">2015</option><option value="2016">2016</option><option value="2017">2017</option><option value="2018">2018</option><option value="2019">2019</option><option value="2020">2020</option><option value="2021">2021</option><option value="2022">2022</option><option value="2023">2023</option><option value="2024">2024</option><option value="2025">2025</option><option value="2026">2026</option><option value="2027">2027</option><option value="2028">2028</option><option value="2029">2029</option><option value="2030">2030</option><option value="2031">2031</option><option value="2032">2032</option><option value="2033">2033</option><option value="2034">2034</option><option value="2035">2035</option><option value="2036">2036</option><option value="2037">2037</option><option value="2038">2038</option><option value="2039">2039</option></select></div><div class="a-cal-date-range-group a-cal-date-range-group-vertical"><div class="a-cal-date-range-wrapper"><div class="a-input-text-addon-group-wrapper"><div class="a-input-text-addon-group a-width-medium"><span class="a-input-text-addon"><i class="a-icon a-icon-calendar"></i></span><input type="text" maxlength="10" placeholder="18/1/23" data-content-type="deliveryDate" data-csa-c-func-deps="aui-da-a-cal-input" data-csa-c-type="widget" data-csa-interaction-events="click" data-element-type="input" data-action="a-cal-input" data-input="start" class="a-input-text a-cal-input a-declarative" data-csa-c-id="q73f7y-823xi7-h4dkhu-jwrm7m" aria-label="Delivery Date (now, or up to 45 days from today), Date with format d / m / y y"></div></div></div></div></div><input type="hidden" name="deliveryDateFormat" value="d/m/yy" id="deliveryDateFormat"><input type="hidden" name="scheduledDeliveryMinDate" value="2023-01-18" id="scheduled-delivery-min-date"><input type="hidden" name="scheduledDeliveryMaxDate" value="2023-03-03" id="scheduled-delivery-max-date"><input class="giftingFormElement aok-hidden" id="deliveryDateSetISOFormat" data-gifting-mapping="items[0].giftInfo.giftDeliveryDate" data-element-type="input">
            </span><div id="invalid-date-alert" class="a-box a-alert-inline a-alert-inline-error showable aok-hidden date-alert-error-message" role="alert"><div class="a-box-inner a-alert-container"><i class="a-icon a-icon-alert"></i><div class="a-alert-content">Please choose a valid delivery date</div></div></div><div id="invalid-date-range-alert" class="a-box a-alert-inline a-alert-inline-error showable aok-hidden date-alert-error-message" role="alert"><div class="a-box-inner a-alert-container"><i class="a-icon a-icon-alert"></i><div class="a-alert-content">Selected date is out of range.</div></div></div><div id="gifting-date-warning-div" class="a-box a-alert-inline a-alert-inline-info date-alert-info-message aok-hidden" aria-live="polite" aria-atomic="true"><div class="a-box-inner a-alert-container"><i class="a-icon a-icon-alert"></i><div class="a-alert-content">We will send an email to your recipients on this date</div></div></div><div id="empty-gifting-date-warning-div" class="a-box a-alert-inline a-alert-inline-info date-alert-info-message" aria-live="polite" aria-atomic="true"><div class="a-box-inner a-alert-container"><i class="a-icon a-icon-alert"></i><div class="a-alert-content">We will send your item(s) as soon as the order is complete unless you choose a future date.</div></div></div><input class="giftingFormElement aok-hidden" id="gifting-instant-order" value="false" type="text" data-gifting-mapping="items[0].giftInfo.instantDelivery" data-element-type="input" data-content-type="instantDelivery">
        </div></div></div></div><div id="bfo-rdl-form" class="a-section showable aok-hidden"><div id="quantitySelectionContainer" data-bifrost-mapping="items[0].quantity" data-quantity-selector-limit="14" class="a-section a-spacing-mini a-spacing-top-mini"><div class="a-row"><script>

    P.when('A', 'jQuery', 'a-dropdown', 'DPPUIConstants', 'validators', 'ready').execute(function(A, jQuery, dropdown, DPPUIConstants, validators) {
        var simpleQuantityUIManager = {};

        var debug = false;
        var simpleQuantityPicker = jQuery("#simple-quantity-picker");
        var quantitySelectionContainer = jQuery("#quantitySelectionContainer");
        var quantityFormField = quantitySelectionContainer.find("#quantityText");
        var quantityTextField = simpleQuantityPicker.find("#quantity-update-text");
        var quantityTextFieldBox = simpleQuantityPicker.find("#quantity-update-text-outer");
        var quantityDropdownSelect = dropdown.getSelect("#quantitySelector");
        var quantityDropdown = simpleQuantityPicker.find("#quantity-dropdown");
        var quantityLimitMessage = simpleQuantityPicker.find("#quantity-picker-warning");
        var quantityLimitBanner = jQuery("#purchaseLimitAlert");
        var quantityUpdateButton = simpleQuantityPicker.find("#quantityUpdateButton");
        var quantityFixedText = simpleQuantityPicker.find("#quantity-fixed-text");
        var maxQuantity = getOrDefaultInt("999", 1);
        var minQuantity = getOrDefaultInt("1", 1);
        var maxDropDownQuantity = getOrDefaultInt("14", 1);
        var minDropDownQuantity = getOrDefaultInt("1", 1);
        var isFixedQuantity = maxQuantity <= minDropDownQuantity;
        var initialized = false;
        var quantityUpdated = true;
        var hide = "aok-hidden";

        var paySelectUrl = jQuery("#paymentchangeurl");
        var quantityEqualsValueRegex = /quantity%3D[0-9]+/

        function getOrDefaultInt(input, defaultVal) {
            var inputInt = parseInt(input);
            if (isNaN(inputInt)) {
                return defaultVal;
            }
            return inputInt;
        }

        simpleQuantityUIManager = {
            
            refresh : function(qty) {
                
                logDebug("refresh called.  Quantity update to: " + qty);
                quantityTextField.val(qty);
                quantityFormField.val(qty);
                if (initialized) {
                    this.updatePaySelectUrl(qty);

                    // Record metrics.
                    var ue = window.ue;
                    if (ue && ue.count) {
                        ue.count('dppuiCheckoutQuantityChange', 1 + (ue.count('dppuiCheckoutQuantityChange') || 0));
                    }
                }

                if (isFixedQuantity) {
                    if (!initialized) {
                        quantityFixedText.html(qty);
                    }
                } else {
                    if(quantityDisplaysOnDropdown(qty)) {
                        this.hideQuantityTextField();
                        quantityDropdownSelect.val(qty);
                        this.showElement(quantityDropdown, true);
                    } else {
                        this.showElement(quantityDropdown, false);
                        this.showQuantityTextField();
                    }
                }
            },

            showElement : function(element, show) {
                if (show) {
                    element.removeClass(hide);
                } else {
                    element.addClass(hide);
                }
            },

            showQuantityTextField : function() {
                if ( quantityTextField.hasClass(hide) || quantityTextFieldBox.hasClass(hide) ) {
                    this.showElement(quantityTextField, true);
                    this.showElement(quantityTextFieldBox, true);
                }
                if (initialized) {
                    quantityTextField.focus();
                }
            },

            hideQuantityTextField : function() {
                this.showElement(quantityTextField, false);
                this.showElement(quantityTextFieldBox, false);

                // Use simple hide for update button when popover refresh is not needed.
                // This prevents the PYO button from disabling when changing quantity on dropdown.
                if (!quantityUpdated) {
                    this.hideUpdateButton();
                } else {
                    this.showElement(quantityUpdateButton, false);
                }

                if (initialized) {
                    this.hideQuantityWarning();
                }
            },

            showQuantityWarning : function(qty) {
                this.showElement(quantityLimitMessage, true);
                if (!initialized && quantityLimitBanner) {
                    this.showElement(quantityLimitBanner, true);
                }
                A.slideDown(quantityLimitMessage, 300, 'ease-out', function(){
                    quantityTextField.val(qty);
                });
            },

            hideQuantityWarning : function() {
                if (quantityLimitBanner) {
                    this.showElement(quantityLimitBanner, false);
                }
                A.slideUp(quantityLimitMessage, 500, 'ease-out', function(){
                    quantityLimitMessage.addClass(hide);
                });
            },

            showUpdateButton : function() {
                quantityUpdated = false;
                P.when('confirmOrderHandler').execute( function(confirmOrderHandler) {
                    if (confirmOrderHandler.disableAction) {
                        confirmOrderHandler.disableAction();
                    }
                });
                this.showElement(quantityUpdateButton, true);
            },

            hideUpdateButton : function() {
                quantityUpdated = true;
                P.when('confirmOrderHandler').execute( function(confirmOrderHandler) {
                    if (confirmOrderHandler.refreshPopoverText) {
                        confirmOrderHandler.refreshPopoverText();
                    }
                });
                this.showElement(quantityUpdateButton, false);
            },

            updatePaySelectUrl : function(qty) {
                if (paySelectUrl && paySelectUrl.length) {
                    var paySelectUrlString = paySelectUrl.attr("href");
                    var updatedQty = "quantity%3D" + qty;
                    var updatedUrl = paySelectUrlString.replace(quantityEqualsValueRegex, updatedQty);

                    paySelectUrl.prop("href", updatedUrl);
                }
            },

            updateQuantityPicker : function(qty) {
                this.refresh(qty);
                this.hideQuantityWarning(qty);
                this.hideUpdateButton();
            }
        };

        
        simpleQuantityUIManager.refresh(getValidatedQuantityText());
        initialized = true;

        
        A.declarative("quantity-update-text-action", "keydown", quantityTextChangeHandler);
        A.declarative("quantity-update-text-action", "keyup", quantityTextValueChangeHandler);

        
        quantityTextField.bind("paste", function(event) {
            event.preventDefault();
        });

        function quantityTextValueChangeHandler() {
            logDebug("quantityTextValueChangeHandler fired.");

            
            var initialQuantityTextFieldVal = quantityTextField.val();
            var sanitizedQty = sanitizeInput(initialQuantityTextFieldVal);

            var displayQty = sanitizedQty;
            if ((sanitizedQty.length > 0) && (!validators.hasLeadingZeros(sanitizedQty))) {
                displayQty = getValidatedQuantity(sanitizedQty);
            }
             
            if(initialQuantityTextFieldVal != displayQty) {
                quantityTextField.val(displayQty);
            }

            
            if (sanitizedQty != quantityFormField.val()) {
                simpleQuantityUIManager.showUpdateButton();
            }
        }

        function sanitizeInput(rawInput) {
            
            return rawInput.replace(/\D/g,'');
        }

        function getValidatedQuantityText() {
            return getValidatedQuantity(quantityTextField.val());
        }

        function getValidatedQuantity(qty) {
            var intQty = parseInt(qty) || 0;

            if ( intQty > maxQuantity ) {
                
                qty = maxQuantity;
                simpleQuantityUIManager.showQuantityWarning(qty);
            } else if ( intQty < minQuantity ) {
                
                qty = minQuantity;
            } else {
                
                qty = intQty;
            }

            return qty;
        }

        function quantityTextChangeHandler(e) {
            logDebug("quantityTextChangeHandler fired.");
            var event = e.$event;
            if (isSpecialKey(event) || !isAllowedKeyCode(event.keyCode)) {
                event.preventDefault();
            }
        }

        function dropdownOptionChangeHandler(event) {
            logDebug("dropdownOptionChangeHandler fired.");
            simpleQuantityUIManager.refresh(quantityDropdownSelect.val());
        }

        function isSpecialKey(event) {
            return (event.shiftKey && event.keyCode != parseInt(DPPUIConstants.KEYCODES.TAB)) || event.ctrlKey || event.altKey;
        }

        function isAllowedKeyCode(keyCode) {
            return ((keyCode >= parseInt(DPPUIConstants.KEYCODES.ZERO_NUMERIC_KEY) && keyCode <= parseInt(DPPUIConstants.KEYCODES.NINE_NUMERIC_KEY)) || // primary numeric keys
                (keyCode >= parseInt(DPPUIConstants.KEYCODES.ZERO_NUM_PAD_KEY) && keyCode <= parseInt(DPPUIConstants.KEYCODES.NINE_NUM_PAD_KEY)) || // num pad numeric keys
                (keyCode == parseInt(DPPUIConstants.KEYCODES.BACKSPACE)) || // backspace key
                (keyCode == parseInt(DPPUIConstants.KEYCODES.DELETE)) || // delete key
                (keyCode == parseInt(DPPUIConstants.KEYCODES.TAB)) || // tab key
                (keyCode == parseInt(DPPUIConstants.KEYCODES.ENTER)) || // enter key
                (keyCode == parseInt(DPPUIConstants.KEYCODES.HOME)) || // home key
                (keyCode == parseInt(DPPUIConstants.KEYCODES.END)) || // end key
                (keyCode == parseInt(DPPUIConstants.KEYCODES.LEFT_ARROW)) || // left arrow key
                (keyCode == parseInt(DPPUIConstants.KEYCODES.RIGHT_ARROW)) // right arrow key
            );
        }

        function quantityDisplaysOnDropdown(quantity) {
            var qty = parseInt(quantity);
            return qty >= minQuantity
              && qty <= maxDropDownQuantity;
        }

        function logDebug(msg) {
            if ( console && debug === true ) {
                console.log("simpleQuantityPicker: " + msg);
            }
        }

        P.now("jQuery").register("simple-quantity-picker", function(jQuery) {
            return {
                uiManager: simpleQuantityUIManager,
                getValidatedQuantityText: function() {
                    var qty = jQuery("#quantity-update-text").val();

                    var intQty = parseInt(qty) || 0;

                    if ( intQty > maxQuantity ) {
                        
                        qty = maxQuantity;
                        this.uiManager.showQuantityWarning(qty);
                    } else if ( intQty < minQuantity ) {
                        
                        qty = minQuantity;
                    } else {
                        
                        qty = intQty;
                    }

                    return qty;
                },
                getDropdownValue: function() {
                    return quantityDropdownSelect.val();
                },
                getCurrentQuantityValue: function() {
                    return quantityFormField.val();
                },
            };
        });

        
        P.when('Handler').execute(function(Handler) {
            var SimpleQuantityPickerHandler = Handler.extend({
                init : function() {
                    this.registerDataSource("Quantity:currentQuantityValue", this.getCurrentQuantityValue.bind(this));
                    this.registerDataSource("Quantity:isQuantityPickerUpdated", this.isUpdated.bind(this));
                },
                getCurrentQuantityValue : function() {
                    return quantityFormField.val();
                },
                isUpdated : function() {
                    return quantityUpdated;
                },
            });

            var simpleQuantityPickerHandler = new SimpleQuantityPickerHandler();
            P.declare("quantityHandler", simpleQuantityPickerHandler);
        });
    });
</script>
<div id="sqp-popover-string" class="a-section a-padding-none aok-hidden">Update your quantity to proceed</div><div id="simple-quantity-picker" class="a-section"><style>
        
#quantity-last-option {
   border-top-color: #e7e7e7;
   border-top-width: 1px;
   border-top-style: solid;
}

#quantity-update-text {
   width: 54px;
}


#quantity-dropdown.a-button-dropdown.quantity-selector {
    width: auto !important;
}


#quantity-dropdown.a-button-dropdown.quantity-selector.aok-hidden {
    display: none !important;
}


.quantity-selector-nowrap {
    white-space: nowrap;
}


#quantity-update-text {
    padding-bottom: 4px;
}


#quantity-picker-label.web {
    position: relative;
    top: 1px;
}
#quantity-picker-label.mobile {
    position: relative;
    top: 2px;
}


#quantity-fixed-text.web {
    position: relative;
    top: 1px;
}
#quantity-fixed-text.mobile {
    position: relative;
    top: 2px;
}


#quantity-update-text-outer.quantity-text-input-mobile {
    display: inline-table;
}


#quantity-update-text-outer.quantity-text-input-mobile::before {
    display: none;
}


#quantity-update-text-outer.quantity-text-input-mobile::after {
    display: none;
}


#quantityUpdateButton.mobile {
    display: inline-table;
    position: relative;
}


#quantity-dropdown.mobile {
    display: inline-table;
}
</style>

    <div id="quantity-picker-grid-row" class="a-row a-spacing-top-micro a-grid-vertical-align a-grid-center"><div class="a-column a-span12 aok-nowrap"><span id="quantity-picker-label" class="web">Quantity:</span><span class="a-declarative" data-action="quantity-update-text-action" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-quantity-update-text-action" data-quantity-update-text-action="{}" data-csa-c-id="k3uie5-c9zm86-zfdl8n-rtiesx"><input type="tel" maxlength="3" value="1" id="quantity-update-text" autocomplete="off" class="a-input-text quantity-text-input-web a-spacing-sides-base"></span><span class="a-declarative" data-action="quantityUpdated" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-quantityUpdated" data-quantityupdated="{}" data-csa-c-id="s1joch-fubjip-xl0ng5-wopqc5"><span id="quantityUpdateButton" class="a-button a-button-base showable aok-hidden web"><span class="a-button-inner"><input class="a-button-input" type="submit" aria-labelledby="quantityUpdateButton-announce"><span id="quantityUpdateButton-announce" class="a-button-text" aria-hidden="true">Update</span></span></span></span><span class="a-declarative" data-action="quantityChanged" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-quantityChanged" data-quantitychanged="{}" data-csa-c-id="9sp128-tboozl-9k8slu-zfygly"><span class="a-dropdown-container"><select name="" autocomplete="off" id="quantitySelector" tabindex="0" data-action="a-dropdown-select" class="a-native-dropdown a-declarative"><option value="1" selected="">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15" id="quantityToggleOption" data-a-id="quantity-last-option">15+
                        </option></select><span tabindex="-1" id="quantity-dropdown" data-a-class="quantity-selector a-spacing-sides-base  web" class="a-button a-button-dropdown quantity-selector a-spacing-sides-base web aok-hidden" aria-hidden="true" style="min-width: 0%;"><span class="a-button-inner"><span class="a-button-text a-declarative" data-csa-c-func-deps="aui-da-a-dropdown-button" data-csa-c-type="widget" data-csa-interaction-events="click" data-action="a-dropdown-button" aria-hidden="true" data-csa-c-id="yvjlby-uot522-j4o28g-hb5ii"><span class="a-dropdown-prompt">1</span></span><i class="a-icon a-icon-dropdown"></i></span></span></span></span><input type="hidden" id="quantityText" name="quantity" value="0" data-max-quantity="999">
        </div></div><div id="quantity-picker-warning" class="a-box a-alert-inline a-alert-inline-warning aok-hidden a-spacing-micro a-spacing-top-mini" aria-live="polite" aria-atomic="true" style="display: none;"><div class="a-box-inner a-alert-container"><i class="a-icon a-icon-alert"></i><div class="a-alert-content">This item has a maximum order quantity limit.</div></div></div></div></div><div id="bfo-rdl-delivery-message" class="a-box a-alert-inline a-alert-inline-info" aria-live="polite" aria-atomic="true"><div class="a-box-inner a-alert-container"><i class="a-icon a-icon-alert"></i><div class="a-alert-content">We will send you an email with instructions for viewing and managing your redemption links so you can send them to your recipients yourself.</div></div></div></div></div></fieldset></div></div></div><div class="a-column a-span3 a-span-last"><div class="a-row"><div class="a-box a-alert a-alert-info restriction-message" aria-live="polite" aria-atomic="true"><div class="a-box-inner a-alert-container"><i class="a-icon a-icon-alert"></i><div class="a-alert-content"><span id="redemption-restriction" data-cor="IN" class="restriction-text">These Kindle Books can only be redeemed by recipients in India.</span></div></div></div></div><br><div class="a-row"><script>
  function Price(value, unit) {
      this.value = value;
      this.unit = unit;
  }

  function DisplayablePrice(value, unit, displayString) {
      this.value = value;
      this.unit = unit;
      this.displayString = displayString;
  }

  function PaymentMethodTraits(preferenceEligible, isAuthorizationRequired, isUnlimitedCoverage, storageConsentProvided) {
      this.preferenceEligible = preferenceEligible;
      this.isAuthorizationRequired = isAuthorizationRequired;
      this.isUnlimitedCoverage = isUnlimitedCoverage;
      this.storageConsentProvided = storageConsentProvided;
  }

  function PaymentMethodDetails(instrument, index, instrumentId, paymentMethodCode, type, bankCode, traits, displayText, balance, testCharge, eligibleBackingMethods, additionalData) {
      this.instrument = instrument;
      this.index = index;
      this.instrumentId = instrumentId;
      this.paymentMethodCode = paymentMethodCode;
      this.type = type;
      this.bankCode = bankCode;
      this.traits = traits;
      this.displayText = displayText;
      this.balance = balance;
      this.testCharge = testCharge;
      this.eligibleBackingMethods = eligibleBackingMethods;
      this.additionalData = additionalData;
  }

  P.when('A', 'jQuery', 'Handler','paySelectHandler', 'errorHandler', 'CSM', 'DPPUIConstants', 'DataStoreEventLogger', 'PaySelectEventNames', 'PaySelectEventActionAttributeKeys', 'DataStoreEventStatus','ready').execute(function(A, jQuery, Handler, paySelectHandler, errorHandler, CSM, DPPUIConstants, DataStoreEventLogger, PaySelectEventNames, PaySelectEventActionAttributeKeys, DataStoreEventStatus) {
    /**
        Note: There is one paymentOptionsRadio button for each existing or added payment instrument owned by the customer
        (e.g. "Card ending in 1111", "Card ending in 2372", "Bank Account ending in 500", etc will each have one
        paymentOptionsRadio button).
    */

    var PaymentMethodsHandler = Handler.extend({
        init : function() {
            this.registerHandlerMethod("PaymentMethod:Keypress", this.initNumberValidation.bind(this));
            this.registerHandlerMethod("PaymentMethod:StateChanged",this.OnPaymentInstrumentSelectionChange);
            this.registerHandlerMethod("PaymentMethod:ResetPaymentOptions", this.resetPaymentOptions.bind(this));
            this.registerHandlerMethod("PaymentMethod:CardAdded", this.onCardAddition.bind(this));
            this.registerHandlerMethod("PaymentMethod:MCBAdded", this.onMCBAddition.bind(this));
            this.registerHandlerMethod("PaymentMethod:IdealAdded", this.onIdealAddition.bind(this));
            this.registerHandlerMethod("PaymentMethod:initRadioButtons", this.initPaymentOptionsRadio.bind(this));
            this.registerHandlerMethod("PaymentMethod:UnknownError", this.handleUnknownError.bind(this));
            this.registerHandlerMethod("PaymentMethod:UnAuthorizedError", this.handleUnAuthorizedError.bind(this));
            paySelectHandler.registerDataSource("GetSelectedPaymentOptions", this.GetSelectedPaymentOptions.bind(this));
            paySelectHandler.registerDataSource("GetDisplayStringForSelectedPaymentOptions", this.GetDisplayStringForSelectedPaymentOptions.bind(this));
            paySelectHandler.registerDataSource("GetBalanceTopupInfo", this.getBalanceTopupInfo.bind(this));
            paySelectHandler.registerDataSource("GetBalances", this.getBalances.bind(this));
            paySelectHandler.registerDataSource("GetReloadSleeveData", this.GetReloadSleeveData.bind(this));
            paySelectHandler.registerDataSource("GetPaymentPlanContext", this.GetPaymentPlanContext.bind(this));
            paySelectHandler.registerDataSource("PaymentOptions:GetAction", this.getAction.bind(this));
            paySelectHandler.registerDataSource("PaymentOptions:IsPurchaseScenario", this.isPurchaseScenario.bind(this));
            this.registerDataSource("PaymentMethod:GetOrderTotal", this.GetOrderTotal.bind(this));
            this.registerDataSource("PaymentMethod:GetEventDifferentiator", this.getEventDifferentiator.bind(this));
            this.registerDataSource("PaymentMethod:GetPayable", this.GetPayable.bind(this));
            this.registerDataSource("PaymentMethod:GetEligibilityCriteria", this.GetEligibilityCriteria.bind(this));
            paySelectHandler.registerCallback("PaymentMethod:ResetPaymentOptions", this.resetPaymentOptions.bind(this));
            this.subscribe("PaymentOptions:SelectDefaultPaymentMethod", this.selectDefaultPaymentMethod.bind(this));

            this.initNumberValidation();
            this.initPaymentOptionsRadio();
            this.selectAddedPaymentOption();
        },

        /** Register a "change" event handler for _each_ paymentOptionsRadio button, on all payment instrument sleeves.
        On being triggered, the handler refreshes _all_ sleeves.
        Note, this function only registers handlers, it does not trigger them.
        */
        initPaymentOptionsRadio : function() {
            var paymentOptions = jQuery("input[name='paymentOptionsRadio']");
            var handler = this;
            paymentOptions.change(function() {
                CSM.instrumentSelection(this);
                handler.process('DebitCardSleeve:Refresh');
                handler.process('NetBankingSleeve:Refresh');
                handler.process('Cards:Refresh');
                handler.process('Balances:Refresh');
                handler.process('Balances:DeselectSufficientBalance');
                handler.process('AliPay:Refresh');
                handler.process('ToggleAddgenericCardForm');
                handler.process('MCB:Refresh');
                handler.process('ToggleAddMCBForm');
                handler.process('UPI:Refresh');
                handler.process('SavedUPI:Refresh');
                handler.process('UPI:HandleSuppression');
                handler.process('ToggleUPIForm');
                handler.process('ToggleAdddebitCardForm');
                handler.process('CreditOrDebitCardSleeve:Refresh');
                handler.process('WeChatContract:Refresh');
                handler.process('WeChat:Refresh');
                handler.process('ToggleAddPaidyForm');
                handler.process('LOC:Refresh');
                handler.process('ToggleAddDigitalWalletForm');
                handler.process('DigitalWallet:Refresh');
                handler.process('Ideal:Refresh');
                handler.broadcast('Boleto:Refresh');
                handler.broadcast('Pix:Refresh');
                handler.broadcast('BankAccountsSleeve:Refresh');
                handler.broadcast('AddBankAccountSleeve:Refresh');
                handler.OnPaymentInstrumentSelectionChange();
            });
        },

        initNumberValidation : function() {
            jQuery('.number-only').keypress(function(value) {
                if (isNotBackSpace(value) && isNotNull(value) && isNonNumeric(value)) {
                    return false;
                }
            });

            function isNotBackSpace(value) {
                if(value.which != 8) {
                    return true;
                }
            }

            function isNotNull(value) {
                if(value.which != 0) {
                    return true;
                }
            }

            function isNonNumeric(value) {
                if(value.which < 48 || value.which > 57) {
                    return true;
                }
            }
        },

        selectAddedPaymentOption: function() {
            var handler = this;
            /**
            * TODO: Need to remove dependency on productPreSelectionHandler.
            * SIM: https://sim.amazon.com/issues/BoxOffice-1449
            */
            P.when('cardsSleeveHandler', 'mcbSleeveHandler', 'productPreSelectionHandler', 'ready').execute(function() {
                var paymentOptionId = URLUtil.getQueryStringParameter('paymentOptionId');
                handler.process('PaymentMethod:SelectDefault', paymentOptionId);
                var selectedInstrument = jQuery('.box-selected');

                if (selectedInstrument.length != 0) {
                    jQuery('html, body').animate({
                        scrollTop: jQuery(selectedInstrument).offset().top
                    }, 300); // time slice - 300 milliseconds, within which the scrolling executes.
                }
            });
        },

        selectPreferredPaymentOption: function () {
            var preferredInstrument = jQuery("#preferredInstrumentSleeve").find("input[name='paymentOptionsRadio']");
            var balanceSleeve = jQuery("#balanceSleeve");
            var balances = balanceSleeve.find('.balance');
            if (preferredInstrument.length > 0 && !(balanceSleeve && balanceSleeve.find("input[name='paymentOptionsRadio']:visible").length)
                && (jQuery(balances).length > 0 ? !this.fetch("Balances:isSufficientBalancePresent") : true)) {
                if (typeof preferredInstrument.click == 'function') {
                    preferredInstrument.click();
                }
            }
        },

        selectDefaultPaymentMethod: function () {
            var supportedViolations = ["CVV"];
            var paymentOptionsContent = jQuery("#paymentOptionsContent");
            var balanceSleeve = jQuery("#balanceSleeve");
            var balances = balanceSleeve.find('.balance');
            if(paymentOptionsContent.data('select-first-available-payment-option')
                && !(balanceSleeve && balanceSleeve.find("input[name='paymentOptionsRadio']:visible").length)
                && (balances.length ? !this.fetch("Balances:isSufficientBalancePresent") : true)) {
                var defaultSelectablePaymentMethods = this.getAllDefaultSelectablePaymentMethods();
                for(i = 0; i < defaultSelectablePaymentMethods.length; i++) {
                    var paymentOption = jQuery(defaultSelectablePaymentMethods[i]);
                    var violation = paymentOption.find(".violation");
                    var isSupportedViolation = true;
                    if(violation.length !== 0) {
                        violation.each(function() {
                            var violationCode = jQuery(this).data('violation');
                            isSupportedViolation &= violationCode && supportedViolations.includes(violationCode);
                        });
                    }
                    if(paymentOption && !paymentOption.hasClass("disabled-container") && isSupportedViolation) {
                        var paymentOptionRadio = paymentOption.find("input[name='paymentOptionsRadio']");
                        if(typeof paymentOptionRadio.click == 'function' ) {
                            paymentOptionRadio.click();
                            return true;
                        }
                    }
                }
            }
        },

        getAllDefaultSelectablePaymentMethods: function() {
            var selectablePaymentOptions = [];
            jQuery(".defaultSelectableAvailablePaymentMethod").each(function(){
                selectablePaymentOptions.push(this);
            });
            jQuery(".defaultSelectableCreatablePaymentMethod").each(function(){
                selectablePaymentOptions.push(this);
            });
            return selectablePaymentOptions;
        },

        onCardAddition : function(data) {
            this.process('PaymentMethod:CardAdded', data);
        },

        onMCBAddition :  function(data) {
            this.process('PaymentMethod:MCBAdded', data);
        },

        onIdealAddition :  function(data) {
          this.process('PaymentMethod:IdealAdded', data);
        },

        /** Deselects and refreshes all payment instruments.
        */
        resetPaymentOptions : function(eligibilityCriteria) {
            var paymentOptionsRadio = jQuery("input[name='paymentOptionsRadio']");
            paymentOptionsRadio.each(function() {
                this.checked = false;
            });
            this.process('DebitCardSleeve:Refresh', eligibilityCriteria);
            this.process('NetBankingSleeve:Refresh', eligibilityCriteria);
            this.process('Cards:Refresh', eligibilityCriteria);
            this.process('Balances:Refresh', eligibilityCriteria);
            this.process('AliPay:Refresh', eligibilityCriteria);
            this.process('WeChat:Refresh', eligibilityCriteria);
            this.process('WeChatContract:Refresh', eligibilityCriteria);
            this.process('MCB:Refresh');
            this.process('UPI:Refresh', eligibilityCriteria);
            this.process('SavedUPI:Refresh', eligibilityCriteria);
            this.broadcast('BankAccountsSleeve:Refresh');
            this.process('CreditOrDebitCardSleeve:Refresh', eligibilityCriteria);
            this.broadcast('LOC:Refresh');
            this.broadcast('DigitalWallet:Refresh');
            this.OnPaymentInstrumentSelectionChange();
            this.selectPreferredPaymentOption();
        },

        handleUnknownError : function() {
            errorHandler.showError(errorHandler.INTERNAL_ERROR_INFORM);
        },

        handleUnAuthorizedError : function() {
            errorHandler.showError(errorHandler.CSRF_VALIDATION_ERROR);
         },

        OnPaymentInstrumentSelectionChange : function(sourceSleeve) {
            var selectedBalances = this.fetch("Balances:getSelectedBalances");
            if(selectedBalances && selectedBalances.length > 0) {
                if(!this.fetch("Balances:isSufficientBalancePresent")) {
                    /* If sufficient balance is present, Balance will be a radio button not check box.
                     * Sufficient balance will always be single Tender.
                     */
                    jQuery("#smartPSP-price-summary").removeClass("aok-hidden");
                    this.process("PaymentMethod:DisableSingleTenderInstruments");
                }

                /* This is a temporary hack requested by PayStation to disable
                 * multi-tender consisting of both MCB and Balances. */
                 //TODO: Merge PaymentMethod:MultiTenderViolation and SingleTenderInstrument methods.

                var isAnyMCBSelected = this.fetch("MCB:isAnyMCBSelected");
                var isAnyLOCSelected = this.fetch("LOC:isAnyLOCSelected");
                var isAnyDigitalWalletSelected = this.fetch("DigitalWallet:isAnyDigitalWalletSelected");
                var multiTenderIncapableSleeve = DPPUIConstants.SleeveNames.UNKNOWN;
                if (isAnyMCBSelected) {
                    multiTenderIncapableSleeve = DPPUIConstants.SleeveNames.MCB;
                }

                if (isAnyDigitalWalletSelected) {
                  multiTenderIncapableSleeve = DPPUIConstants.SleeveNames.DIGITAL_WALLET;
                }

                if (isAnyLOCSelected && !this.fetch("LOC:isMultiTenderEnabled")) {
                   multiTenderIncapableSleeve = DPPUIConstants.SleeveNames.LOC;
                }

                if (sourceSleeve && multiTenderIncapableSleeve !== DPPUIConstants.SleeveNames.UNKNOWN) {
                    this.process("PaymentMethod:MultiTenderViolation", {
                        sourceSleeve : sourceSleeve,
                        multiTenderIncapableSleeve : multiTenderIncapableSleeve
                    });
                    return;
                }
            } else {
                var eligibilityCriteria =  paymentMethodsHandler.fetch("PaymentMethod:GetEligibilityCriteria");
                this.process("PaymentMethod:EnableSingleTenderInstruments", eligibilityCriteria);
            }

            var balances = this.fetch("Balances:getBalances");

            if(balances && balances.length !== 0 && this.fetch("Balances:shouldMoveBalancesToTop")) {
                this.process("PaymentMethod:moveToTop");
            }
            paySelectHandler.trigger("PaymentMethod:changed");
        },

        GetPaymentPlanContext : function(data) {
            var paymentContext = jQuery("#paymentContext").data('payment-ctx');
            return paymentContext;
        },

        GetPayable : function(data) {
            return paySelectHandler.fetch("PaySelect:GetPayable");
        },

        GetOrderTotal : function(data) {
            return paySelectHandler.fetch("PaySelect:GetOrderTotal");
        },

        /** Gets the eligibilityCriteria, i.e. whether the selected payment instrument(s) can be set as one-click.
        This data comes by evaluating the selected product(s); if the chargeType of any of the selected product(s) is
        RECURRING, then the selected payment instrument(s) can be used as one-click, hence the `preferenceEligible`
        field is set to `true`.
        */
        GetEligibilityCriteria : function(data) {
            return paySelectHandler.fetch("GetEligibilityCriteria");
        },

        getBalanceTopupInfo : function(data) {
            return this.fetch("Balances:getBalanceTopupInfo",data);
        },

        getBalances : function(data) {
            return this.fetch("Balances:getBalances", data);
        },

        GetDisplayStringForSelectedPaymentOptions : function(data) {
           var cardDisplayString = this.fetch("Cards:getSelectedCardDisplayString", data);
           if(cardDisplayString != null){
                return cardDisplayString;
           }
           var debitCardDisplayString = this.fetch("DebitCard:getSelectedDebitCardDisplayString", data);
           if(debitCardDisplayString != null) {
                return debitCardDisplayString;
           }
           var netBankingDisplayString = this.fetch("NetBanking:getSelectedNetBankingDisplayString", data);
           if(netBankingDisplayString != null){
                return netBankingDisplayString;
           }
           var upiDisplayString = this.fetch("UPI:getSelectedUPIDisplayString", data);
           if(upiDisplayString != null){
                return upiDisplayString;
           }
           var balanceDisplayString = this.fetch("Balances:getSelectedBalancesDisplayString", data);
           if(balanceDisplayString != null){
                return balanceDisplayString;
           }
           return null;
        },

        /** @return : a list of selected payment option objects. Each is an instance of `PaymentMethodDetails`.
        */
        GetSelectedPaymentOptions : function(data) {
            var selectedPaymentOptions = [];
            var selectedCards = this.fetch("Cards:getSelectedCard",data);
            selectedCards = selectedCards ? selectedCards : [];
            var selectedBalances = this.fetch("Balances:getSelectedBalances",data);
            selectedBalances = selectedBalances ? selectedBalances : [];
            var selectedDebitCards = this.fetch("DebitCard:getSelectedDebitCard",data);
            selectedDebitCards = selectedDebitCards ? selectedDebitCards : [];
            var selectedNetBankings = this.fetch("NetBanking:getSelectedNetBanking",data);
            selectedNetBankings = selectedNetBankings ? selectedNetBankings : [];
            var selectedMCBInstruments = this.fetch("MCB:getSelectedMCBInstruments",data);
            selectedMCBInstruments = selectedMCBInstruments ? selectedMCBInstruments : [];
            var selectedWeChat = this.fetch("WeChat:getSelectedWeChat",data);
            selectedWeChat = selectedWeChat ? selectedWeChat : [];
            var selectedAliPay = this.fetch("AliPay:getSelectedAliPay",data);
            selectedAliPay = selectedAliPay ? selectedAliPay : [];
            var selectedSavedUpi = this.fetch("SavedUPI:getSelectedSavedUPI",data);
            selectedSavedUpi = selectedSavedUpi ? selectedSavedUpi : [];
            var selectedUpi = this.fetch("UPI:getSelectedUPI",data);
            selectedUpi = selectedUpi ? selectedUpi : [];
            var selectedBankAccounts = this.fetch("BankAccounts:getSelectedBankAccounts", data);
            selectedBankAccounts = Array.isArray(selectedBankAccounts) ? selectedBankAccounts : [];
            var selectedCreditOrDebitCard = this.fetch("CreditOrDebitCard:getSelectedCreditOrDebitCard",data);
            selectedCreditOrDebitCard = selectedCreditOrDebitCard? selectedCreditOrDebitCard: [];
            var selectedWeChatContract = this.fetch("WeChatContract:getSelectedWeChatContract",data);
            selectedWeChatContract = selectedWeChatContract ? selectedWeChatContract : [];
            var selectedBoleto = this.fetch("Boleto:getSelectedBoleto", data);
            selectedBoleto = selectedBoleto ? selectedBoleto : [];
            var selectedPix = this.fetch("Pix:getSelectedPix", data);
            selectedPix = selectedPix ? selectedPix : [];
            var selectedIdeal = this.fetch("Ideal:getSelectedIdeal", data);
            selectedIdeal = selectedIdeal ? selectedIdeal : [];
            var selectedLOCInstruments = this.fetch("LOC:getSelectedLOCInstruments",data);
            selectedLOCInstruments = selectedLOCInstruments ? selectedLOCInstruments : [];
            var selectedDigitalWalletInstruments = this.fetch("DigitalWallet:getSelectedDigitalWalletInstruments",data);
            selectedDigitalWalletInstruments = selectedDigitalWalletInstruments ? selectedDigitalWalletInstruments : [];
            selectedPaymentOptions = selectedPaymentOptions.concat(selectedBalances, selectedCards, selectedDebitCards, selectedNetBankings, selectedMCBInstruments, selectedWeChat, selectedAliPay, selectedUpi, selectedSavedUpi, selectedBankAccounts, selectedCreditOrDebitCard, selectedWeChatContract, selectedBoleto, selectedLOCInstruments, selectedDigitalWalletInstruments, selectedPix, selectedIdeal);
            this.emitTogglePaymentInstrumentEvent(selectedPaymentOptions);
            return selectedPaymentOptions;
        },

        emitTogglePaymentInstrumentEvent: function (selectedPaymentOptions) {
              if (DataStoreEventLogger != undefined && selectedPaymentOptions) {
                  for (var index = 0; index < selectedPaymentOptions.length; index++) {
                      var eventData = DataStoreEventLogger.buildEventData(PaySelectEventNames.TOGGLE_PAYMENT_INSTRUMENT_EVENT, DataStoreEventStatus.SUCCESS,
                      selectedPaymentOptions[index].paymentMethodCode, selectedPaymentOptions[index].instrumentId, undefined);
                      DataStoreEventLogger.logDataStoreEvent(eventData);
                  }

                  if (selectedPaymentOptions.length > 0) {
                      var eventData = DataStoreEventLogger.buildEventData(PaySelectEventNames.TOGGLE_PAYMENT_INSTRUMENT_EVENT, DataStoreEventStatus.SUCCESS,
                      PaySelectEventNames.TOGGLE_PAYMENT_INSTRUMENT_COUNT_EVENT, selectedPaymentOptions.length, undefined);
                      DataStoreEventLogger.logDataStoreEvent(eventData);
                  }
            }
        },

        getEventDifferentiator : function() {
            return paySelectHandler.fetch("PaySelect:GetEventDifferentiator");
        },

        getAction: function(data) {
            var allSelectedInstruments = data.allSelectedInstruments;
            if(!allSelectedInstruments) {
                return;
            }
            for(var index = 0; index < allSelectedInstruments.length; index++) {
                if(allSelectedInstruments[index].type === "Card") {
                    return this.fetch("Cards:GetAction", data);
                }
                if(allSelectedInstruments[index].type === DPPUIConstants.PaymentMethodType.WE_CHAT_CONTRACT_PAY) {
                    return this.fetch("WeChatContract:GetAction");
                }
            }
        },

        GetReloadSleeveData : function() {
            var reloadSleeve = jQuery('#reloadSleeveData');
            return {
                'url' : reloadSleeve.data('url')
            };
        },

        isPurchaseScenario: function() {
            var paymentOptionsContent = jQuery("#paymentOptionsContent");
            return paymentOptionsContent.data("is-non-purchase") != true;
        }
    });

    var paymentMethodsHandler = new PaymentMethodsHandler();
    P.declare("paymentMethodsHandler", paymentMethodsHandler);
  });
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://sim.amazon.com/issues/BoxOffice-1449" title="Open URL: https://sim.amazon.com/issues/BoxOffice-1449 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://sim.amazon.com/issues/BoxOffice-1449" title="Open URL in Popup: https://sim.amazon.com/issues/BoxOffice-1449 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>
<script>
P.when('A', 'jQuery', 'Handler', 'paySelectHandler', 'PaySelectHelper', 'shippingAddressHandler', 'currencyManager', 'CDSEvents', 'DPPUIConstants', 'errorHandler', 'validators', 'exitHandlerEventAction', 'validateForm','DPPUITreatments', 'CSM', 'cpfFormHandler', 'paymentMethodsHandler', 'DataStoreEventLogger', 'PaySelectEventNames', 'PaySelectEventActionAttributeKeys', 'DataStoreEventStatus', 'ready').execute(function(A, jQuery, Handler, paySelectHandler, PaySelectHelper, shippingAddressHandler, currencyManager, CDSEvents, DPPUIConstants, errorHandler, validators, exitHandlerEventAction, validateForm, DPPUITreatments, CSM, cpfFormHandler, paymentMethodsHandler, DataStoreEventLogger, PaySelectEventNames, PaySelectEventActionAttributeKeys, DataStoreEventStatus) {
    var ConfirmOrderHandler = Handler.extend({
        init : function() {
            this.DEFAULT_ACTION_HANDLER = "Action",
            this.DEFAULT_ACTION_ROLES = ["UpdatePayment"],
            this.ActionCallbackEvents = {
                "Action": {
                    ENABLE_ACTION: "Action:enable",
                    DISABLE_ACTION: "Action:disable",
                    HIDE_ACTION: "ActionContainer:hide",
                    SHOW_ACTION: "ActionContainer:show",
                    UPDATE_PAYMENT_ACTION_SUCCESS: "Action:OnUpdatePaymentSuccess",
                    UPDATE_ROLES: "Action:UpdateRoles",
                    GET_ACTION_DATA: "Action:GetData"
                },
                "GetOTPAction": {
                    ENABLE_ACTION: "GetOTPAction:Enable",
                    DISABLE_ACTION: "GetOTPAction:Disable",
                    UPDATE_PAYMENT_ACTION_SUCCESS: "GetOTPAction:OnUpdatePaymentSuccess",
                    GET_ACTION_DATA: "GetOTPAction:GetData"
                }
            };

            this.RoleFunctions = {
                ActionPerformed: {
                    "UpdatePayment": this.updatePaymentActionPerformed,
                    "SubmitOTP": this.submitOTPActionPerformed,
                    "SignContract": this.signContractActionPerformed
                },
                ValidateStateChange: {
                    "UpdatePayment": this.isStateValidForUpdatePaymentAction,
                    "SubmitOTP": this.isStateValidForSubmitOTPAction,
                    "SignContract": this.isStateValidForSignContractAction
                },
                ExitHandler: {
                    "UpdatePayment": this.updatePaymentExitHandler,
                    "SubmitOTP": this.submitOTPExitHandler
                }
            };

            this.isPyoClicked = false;

            this.OrderSummaryDataProvider = {
                "BALANCE_TOPUP": this._getBalanceTopupOrderSummaryData,
                "DEFAULT": this._getDefaultOrderSummaryData
            };

            paySelectHandler.registerCallback("PaySelect:paymentMethodChanged", this.OnPaymentMethodChange.bind(this));
            paySelectHandler.registerCallback("PaySelect:productChanged", this.OnProductChange.bind(this));
            paySelectHandler.registerCallback("PaySelect:OnUpdate", this.OnUpdate.bind(this));
            this.registerCallback("ActionContainer:hide", this.hideActionContainer.bind(this));
            this.registerCallback("ActionContainer:show", this.showActionContainer.bind(this));
            this.subscribe(DPPUIConstants.EventTypes.PYO_CARD_STATUS_CHANGED, this.pyoCardPreferenceMessage.bind(this));

            shippingAddressHandler.registerCallback("ShippingAddress:Added", this.changeDisplayLabel.bind(this));
            shippingAddressHandler.registerCallback("ShippingAddress:Cancelled", this.enableAction.bind(this));
            paySelectHandler.registerCallback("PaySelect:ChangeDisplayLabel", this.changeDisplayLabel.bind(this));

            this.registerHandlerMethod("OrderConfirmation:ShowPreferenceMessage", this.ShowPreferenceEligibleMessage.bind(this));
            this.registerHandlerMethod("OrderConfirmation:HidePreferenceMessage", this.HidePreferenceEligibleMessage.bind(this));
            this.registerHandlerMethod("Action:performed", this.OnActionPerformed);
            this.registerCallback("Action:OnUpdatePaymentSuccess", this.onUpdatePaymentSuccess.bind(this));
            this.registerDataSource("GetPreferenceMessage", this.getPreferenceMessage.bind(this));
            //If PYO AddCard is Enable then Floating Order Summary should be shown.
            if(DPPUITreatments.getTreatment('PYOEnableTreatment') == null && jQuery("#order-confirmation").data('pyo-add-card')) {
                DPPUITreatments.setTreatment('PYOEnableTreatment',true);
            }
            if(jQuery("#orderSummaryGrid")) {
                P.when('FloatingOrderSummaryHelper', 'ready').execute(function(FloatingOrderSummaryHelper) {
                    FloatingOrderSummaryHelper.floatOrFixOrderSummary();
                    jQuery(window).scroll(FloatingOrderSummaryHelper.floatOrFixOrderSummary)
                        .resize(FloatingOrderSummaryHelper.floatOrFixOrderSummary);
                });
            }
        },

        logEvent : function(selectedProducts, selectedPaymentOptions) {
            var paymentMethods = "";
            for (i = 0; i < selectedPaymentOptions.length; i++) {
                paymentMethods += selectedPaymentOptions[i].paymentMethodCode;
                if (i != selectedPaymentOptions.length-1) {
                    paymentMethods += '_';
                }
            }

            for (var index in selectedProducts) {
                var chargeType = selectedProducts[index].chargeType;
                var productType = selectedProducts[index].productType;
                this.broadcast(CDSEvents.ADD_EVENT_DATA,
                        { eventName : DPPUIConstants.EventTypes.PAYMENT_WORKFLOW_COMPLETED,
                          result : chargeType,
                          targetId : paymentMethods,
                          differentiator : productType });
            }
        },

        pyoCardPreferenceMessage : function(eventname, data) {
            if (data.enabled) {
                this.ShowPreferenceEligibleMessage({"preferenceMessage" : this.fetch("GetPreferenceMessage")});
            } else {
                this.HidePreferenceEligibleMessage();
            }
        },

        OnPaymentMethodChange : function(selectedPaymentOptions) {
            var selectedProducts = paySelectHandler.fetch("GetSelectedProductDetails");
            this.update(selectedProducts, selectedPaymentOptions);
        },

        OnProductChange : function(selectedProducts) {
            var selectedPaymentOptions = paySelectHandler.fetch("GetSelectedPaymentOptions");
            this.update(selectedProducts, selectedPaymentOptions);
        },

        OnUpdate : function() {
            paySelectHandler.trigger("ProductPrice:updated");
            var selectedPaymentOptions = paySelectHandler.fetch("GetSelectedPaymentOptions");
            var selectedProducts = paySelectHandler.fetch("GetSelectedProductDetails");
            this.update(selectedProducts, selectedPaymentOptions);
        },

        getPreferenceMessage : function() {
            return this.fetch("Action:GetPreferenceMessage");
        },

        ShowPreferenceEligibleMessage : function(preferenceData) {
            var preferenceMessage = jQuery("#order-confirmation").find(".preference-message");
            var preferenceText =  preferenceMessage.find(".preference-text");
            preferenceText.text(preferenceData.preferenceMessage);
            preferenceMessage.removeClass("aok-hidden");
        },

        HidePreferenceEligibleMessage : function() {
            var preferenceMessage = jQuery("#order-confirmation").find(".preference-message");
            preferenceMessage.addClass("aok-hidden");
        },

         isFormValid : function() {
            return true;
        },

        enableAction : function() {
             this.process("Action:enable");
         },

        hideActionContainer : function() {
             jQuery("#order-confirmation").addClass("aok-hidden");
             this.process("Action:hide");
         },

        showActionContainer : function() {
             jQuery("#order-confirmation").removeClass("aok-hidden");
             this.process("Action:enable");
             this.process("Action:show");
         },

        changeDisplayLabel : function() {
            this.process("Action:changeDisplayLabel");
        },

        isCPFRequired : function() {
            var result = false;
            if ((cpfFormHandler.cpfContainer.length) && (!cpfFormHandler.cpfContainer.data('is-cpf-updated'))) {
                result = true;
                P.when('addCPFSleeveHandler').execute(function(addCPFSleeveHandler) {
                    addCPFSleeveHandler.broadcast("CPFSleeve:HANDLE_CPF_REQUIRED_RESPONSE");
                });
            }
            return result;
         },

        //TODO: Merge OnActionPerformed and Update Methods.
        OnActionPerformed: function (action) {
            if (this.isCPFRequired()) {
               return;
            }
            action = this._sanitizeActionDescriptor(action);
            if (jQuery("#preferredInstrumentSleeve").length > 0 && jQuery("#preferredInstrumentSleeve").data('is-suppressed')) {
                CSM.log("PlaceOrderOnSuppressedPreferredInstrument",1);
            }
            var selectedPaymentOptions = this._mergeSelectedPaymentOptions(paySelectHandler.fetch("GetSelectedPaymentOptions"), action.selectedPaymentOptions);
            var selectedProducts = paySelectHandler.fetch("GetSelectedProductDetails");
            this.RoleFunctions.ActionPerformed[action.roles[0]].call(this, action, selectedPaymentOptions, selectedProducts); //TODO: Handle multiple roles.
        },

        _mergeSelectedPaymentOptions: function (selectedPaymentOptions, selectedPaymentOptionsToBeMerged) {
            if (!(selectedPaymentOptionsToBeMerged && selectedPaymentOptionsToBeMerged.length)) {
                return selectedPaymentOptions;
            }
            if (!(selectedPaymentOptions && selectedPaymentOptions.length)) {
                return selectedPaymentOptionsToBeMerged;
            }

            selectedPaymentOptions.forEach(function(selectedPaymentOption) {
                selectedPaymentOptionsToBeMerged.forEach(function(selectedPaymentOptionToBeMerged) {
                    if (selectedPaymentOption.instrumentId == selectedPaymentOptionToBeMerged.instrumentId) {
                        selectedPaymentOptionsToBeMerged.splice(y, 1);
                    }
                });
            });
            return selectedPaymentOptions.concat(selectedPaymentOptionsToBeMerged);
        },

        _sanitizeActionDescriptor: function (action) {
            var actionElement = action && action.element ? action.element : undefined;
            var actionHandler = action && action.handler ? action.handler : this.DEFAULT_ACTION_HANDLER;
            var actionRoles = action && action.roles && action.roles.length > 0 ? action.roles : this.DEFAULT_ACTION_ROLES;
            return new ActionDescriptor(actionElement, actionHandler, actionRoles, action && action.selectedPaymentOptions);
        },

        _shouldUpdatePreferredOption: function(selectedPaymentOption) {
            var selectedSection = jQuery('.box-selected');
            var preferenceCheckbox = selectedSection.find('input[name="savePreferredInstrumentPreferenceCheckbox"]');
            var preferredInstrumentSleeve = jQuery("#preferredInstrumentSleeve");
            var surface = jQuery("#paymentOptionsSection").data("surface");
            var resetPreference = null;
            if (preferenceCheckbox.length > 0) {
                if (preferenceCheckbox.prop('checked')) {
                    resetPreference = true;
                    if (preferredInstrumentSleeve.length > 0
                        && selectedSection.parents('#preferredInstrumentSleeve').length == 0) {
                        CSM.log("PlaceOrderNewPreferredOption" + surface, 1);
                        this.broadcast(CDSEvents.ADD_EVENT_DATA,
                            { eventName : DPPUIConstants.EventTypes.PLACE_ORDER_NEW_PREFERRED_OPTION,
                            result : selectedPaymentOption.paymentMethodCode });
                    }
                } else if (preferredInstrumentSleeve.length > 0
                        && preferredInstrumentSleeve.data("instrumentid") === selectedPaymentOption.instrumentId){
                    resetPreference = false;
                }
                if(preferredInstrumentSleeve.length > 0 && preferredInstrumentSleeve.data("instrumentid") != selectedPaymentOption.instrumentId
                        && preferredInstrumentSleeve.data("isrecommended")) {
                            CSM.log("PlacedOrderWithNonRecommendedPaymentOption" + surface, 1);
                        }
                CSM.log("UpdateSelectedPaymentOptions" + surface, 1);
            }
            return resetPreference;
        },

        updatePaymentActionPerformed: function(action, selectedPaymentOptions, selectedProducts) {
            var actionData = this.fetch(this.ActionCallbackEvents[action.handler].GET_ACTION_DATA);

            // The instrumentId and methodCode check have to be explicit
            // There are cases when the customer has no payment instruments, but the list is non-empty.
            // TODO: Update the exact use-case here
            if (selectedPaymentOptions && selectedPaymentOptions.length > 0
                && selectedPaymentOptions[0].instrumentId == ""
                && selectedPaymentOptions[0].paymentMethodCode == "") {
                    exitHandlerEventAction.trigger("ExitHandler:action", {"params": {}});
            }

            var payableDataList = PaySelectHelper.getPayable(selectedProducts, selectedPaymentOptions);

            // If a consent is not provided, then removing preference payable to avoid setting preference
            if (this.shouldFilterPreferencePayableForNonConsentedStorage(selectedPaymentOptions)) {
                payableDataList = PaySelectHelper.removePayableByChargeType(payableDataList, "PREFERENCE");
            }
            var paymentData = this.getPaymentDataForPlaceOrder(actionData, selectedPaymentOptions, selectedProducts)
            this.sendUpdatePaymentRequest(action, actionData, payableDataList, paymentData, selectedPaymentOptions, selectedProducts);
        },

        shouldFilterPreferencePayableForNonConsentedStorage(selectedPaymentOptions) {
            var storageConsentCollectionEnabled = jQuery("#order-confirmation").data('storage-consent-collection-enabled');
            var storageConsentNotProvided = false;
            if (selectedPaymentOptions &&  selectedPaymentOptions instanceof Array) {
                selectedPaymentOptions.forEach(function(selectedPaymentOption) {
                    storageConsentNotProvided = storageConsentNotProvided ||
                        (selectedPaymentOption.traits && selectedPaymentOption.traits.storageConsentProvided != null && !selectedPaymentOption.traits.storageConsentProvided);
                });
            } else if (selectedPaymentOptions) {
                storageConsentNotProvided = storageConsentNotProvided ||
                    (selectedPaymentOption.traits && selectedPaymentOption.traits.storageConsentProvided != null && !selectedPaymentOption.traits.storageConsentProvided);
            }
            return storageConsentCollectionEnabled && storageConsentNotProvided;
        },

        getPaymentDataForPlaceOrder: function(actionData, selectedPaymentOptions, selectedProducts) {
            var displayText = '';
            var selectedPaymentOptionList = [];
            var fieldsToBeEncrypted = [];

            // Preference type will be undefined only for IN market place.
            if (A.objectIsEmpty(actionData.preferenceType) || actionData.preferenceType === "") {
                var amountToCover = PaySelectHelper.getOrderTotal(selectedProducts);
                var availableCoverage = 0;

                var sufficientBalanceList = [];

                selectedPaymentOptions.forEach(function(selectedPaymentOption){
                    var balance = selectedPaymentOption.balance;
                    if(balance) {
                        var coverage = parseFloat(balance.value);
                        availableCoverage += coverage;
                        sufficientBalanceList.push(selectedPaymentOption);
                    }
                });

                if (amountToCover <= availableCoverage) {
                    selectedPaymentOptions = sufficientBalanceList;
                }
            }
            var self = this;
            var shouldUpdatePaymentPreference = false;
            selectedPaymentOptions.forEach(function(selectedPaymentOption){
                var additionalData = selectedPaymentOption.additionalData;
                var bankDisplayText = selectedPaymentOption.displayText;

                if (additionalData) {
                    var values = {};
                    additionalData.forEach(function(data){
                        if (data.encrypt) {
                            fieldsToBeEncrypted.push({ 'key' : data.key , 'value' : data.value});
                            values[data.key] = '';
                        } else {
                            values[data.key] = data.value;
                        }
                    });
                    selectedPaymentOption["values"] = values;
                } else {
                    selectedPaymentOption["values"] = {};
                }
                if(bankDisplayText) {
                    displayText = bankDisplayText;
                }

                var resetPreference = self._shouldUpdatePreferredOption(selectedPaymentOption);

                // If preference enable checkbox is displayed.
                if(resetPreference != null) {
                    var surface;
                    if(jQuery("#paymentOptionsSection").length > 0) {
                        surface = jQuery("#paymentOptionsSection").data("surface");
                    }
                    if(!resetPreference) {
                        // For resetting the preferred Payment option we shouldn't make that payment option preference eligible.
                        selectedPaymentOption.traits.preferenceEligible = false;
                        var surface = jQuery("#paymentOptionsSection").data("surface");
                        CSM.log("PlaceYourOrderSetPreferredOptionDeselected" + surface, 1);
                        if(jQuery("#preferredInstrumentSleeve").length > 0 && jQuery("#preferredInstrumentSleeve").data('isrecommended')) {
                            CSM.log("PlaceOrderWithRecommendedPaymentOptionRemovePreferred" + surface , 1);
                        }
                        self.broadcast(CDSEvents.ADD_EVENT_DATA,
                            { eventName : DPPUIConstants.EventTypes.PLACE_ORDER_SET_PREFERRED_OPTION_DESELECTED,
                              result : selectedPaymentOption.paymentMethodCode });
                    } else {
                        CSM.log("PlaceYourOrderSetPreferredOptionSelected" + surface, 1);
                        if(jQuery("#preferredInstrumentSleeve").length > 0 && jQuery("#preferredInstrumentSleeve").data('isrecommended')) {
                            CSM.log("PlaceOrderWithRecommendedPaymentOptionSetPreferred" + surface , 1);
                        }
                        self.broadcast(CDSEvents.ADD_EVENT_DATA,
                            { eventName : DPPUIConstants.EventTypes.PLACE_ORDER_SET_PREFERRED_OPTION_SELECTED,
                              result : selectedPaymentOption.paymentMethodCode });
                    }
                    shouldUpdatePaymentPreference = true;
                }

                selectedPaymentOptionList.push({"instrumentId":selectedPaymentOption.instrumentId,
                                                "paymentMethodCode":selectedPaymentOption.paymentMethodCode,
                                                "values":selectedPaymentOption.values,
                                                "preferenceEligible":selectedPaymentOption.traits.preferenceEligible,
                                                "bankCode":selectedPaymentOption.bankCode});
            });
            return {
                    displayText: displayText,
                    selectedPaymentOptionList: selectedPaymentOptionList,
                    fieldsToBeEncrypted: fieldsToBeEncrypted,
                    shouldUpdatePaymentPreference : shouldUpdatePaymentPreference
            };
        },

        sendUpdatePaymentRequest: function(action, actionData, payableDataList, paymentData, selectedPaymentOptions, selectedProducts) {
            if (PaySelectHelper.isDeductionSufficientInOrderSummary(selectedProducts)) {
                // If promotion is sufficient which enables the PYO and no payment instrument is selected so needs to remove set preference payable.
                this.removePayablesWhichCanCauseSettingPreference(payableDataList)
            }
            var selectedSection = jQuery('.box-selected');
            var consentCheckbox = selectedSection.find('input[name="ConsentCollectionCheckbox"]');
            var consentSelectionStatus = "";
            if (consentCheckbox != null && consentCheckbox.length > 0 && consentCheckbox.prop('checked')) {
                consentSelectionStatus = true;
            } else if (consentCheckbox != null && consentCheckbox.length > 0) {
                consentSelectionStatus = false;
            }
            var parameters = {"payableDataList": payableDataList,
                              "selectedPaymentOption": paymentData.selectedPaymentOptionList,
                              "paymentPlanId": actionData.paymentPlanId,
                              "paymentContractId": actionData.paymentContractId,
                              "subscriptionId": actionData.subscriptionId,
                              "preferenceType": actionData.preferenceType,
                              "acquisitionId": actionData.acquisitionId,
                              "validateShippingAddress": actionData.validateShippingAddress,
                              "bifrostClientId": actionData.bifrostClientId,
                              "shouldUpdatePaymentPreference": paymentData.shouldUpdatePaymentPreference,
                              "consentSelectionStatus": consentSelectionStatus,
                              "nonConsentedCardWithPreferenceOnlyPayable": this.shouldFilterPreferencePayableForNonConsentedStorage(selectedPaymentOptions)};
            if (jQuery("#order-confirmation").data('storage-consent-collection-enabled')) {
                parameters["storageConsentCollectionEnabled"] = true;
            }

            var cvvFieldName = '';
            var cvvValue = '';
            paymentData.fieldsToBeEncrypted.forEach(function(field){
                if (field.key == 'SecurityCode') {
                    cvvFieldName = field.key;
                    cvvValue = field.value;
                }
            });

            var formData = {
                    'request' : JSON.stringify(parameters),
                    'addCreditCardVerificationNumberFieldName' : cvvFieldName,
                    'addCreditCardVerificationNumber' : cvvValue
            };

            var ajaxRequestData = {
                url: actionData.url,
                data: jQuery.param(formData),
                type: 'POST',
                contentType: 'application/x-www-form-urlencoded',
                cache: false
            };

            this.process(this.ActionCallbackEvents[action.handler].DISABLE_ACTION, {action: action, showPopoverText : false, isPyoClicked : true});

            var self = this;
            var ajax = jQuery.ajax(ajaxRequestData);
            self.isPyoClicked = true;
            ajax.done(function(response) {
                self.process(self.ActionCallbackEvents[action.handler].UPDATE_PAYMENT_ACTION_SUCCESS, {
                    action: action,
                    response : response,
                    selectedProducts: selectedProducts,
                    selectedPaymentOptions: selectedPaymentOptions,
                    redirectionBankName: paymentData.displayText
                });
            });
            ajax.fail(function(response) {
                if (response.status == 401){
                    errorHandler.showError(errorHandler.CSRF_VALIDATION_ERROR);
                } else if(response.status == 403) {
                    //This empty block is added to avoid control from going in else block and causing unexpected behaviour.
                } else {
                    errorHandler.showError(errorHandler.ORDER_ERROR_REDIRECT);
                }
            });
        },

        onUpdatePaymentSuccess: function(data) {
            var response = data.response;
            if (response.status === 'COMPLETED') {
                this.RoleFunctions.ExitHandler[data.action.roles[0]].call(this, data);
            } else if (response.status === 'DEFAULT_SHIPPING_ADDRESS_REQUIRED') {
                this._handleShippingAddressRequired({action: data.action, htmlContent: data.response.htmlContent});
            } else if (response.status === 'VERIFICATION_FAILED') {
                // this error occurs when paystation returns an invalid verification for the payment method
                errorHandler.showError(errorHandler.INVALID_VERIFICATION_ERROR);
            } else if (response.status === 'PAYMENT_METHOD_INACTIVE') {
                errorHandler.showError(errorHandler.PAYMENT_METHOD_INACTIVE);
            } else { // Handling error response such as, when billing address required, when user deletes selected payment instrument from other surface etc.
                errorHandler.showError(errorHandler.ORDER_ERROR_REFRESH);
            }
        },

        _handleShippingAddressRequired: function (data) {
            shippingAddressHandler.registerCallback("ShippingAddress:Added", onShippingAddressAdded);
            shippingAddressHandler.trigger("ShippingAddress:DisplayForm", data);
            var self = this;
            function onShippingAddressAdded() {
                self.OnActionPerformed(data.action);
            }
        },

        updatePaymentExitHandler: function(data) {
            this.logEvent(data.selectedProducts, data.selectedPaymentOptions);
            var response = data.response;
            var csrfTokenV2 = jQuery('meta[name="csrf-token-v2"]');
            // Call buy handler with payment plan id.
            var exitHandlerArgs = {
                paymentPlanId : response.paymentPlanId,
                paymentContractId : response.paymentContractId,
                paymentContractVersion : response.paymentContractVersion,
                ppAuthorizationRequired : response.authorizationRequired,
                authRequired : response.authorizationRequired,
                authorizationType : response.authorizationType,
                redirectToAIPS : response.redirectToAIPS,
                orderConfirmationTime : (new Date).getTime(),
                redirectionBankName : data.redirectionBankName,
                updateVersionId : response.updateVersionId,
                paymentPlanVersionId : response.updateVersionId,
                selectedInstrumentId : response.paymentMethodRequiringOTP,
                issuingBank : response.issuingBank,
                brand : response.brand,
                category : response.category,
                mfaSupported : response.mfaSupported,
                dppuiClientId : response.dppuiClientId,
                paymentPreferenceId : response.paymentPreferenceId,
                selectedPaymentMethodId : this._retrieveNonConsentedPaymentMethodId(data.selectedPaymentOptions),
                walletIdList : this._retrieveWalletIdListFromPaymentContext()
            };

            /*
            Populate anti-csrftoken-a2z in form data to be used by Secure-By-Default | https://w.amazon.com/bin/view/Horizonte/Features/Integrations/CSRF/5.3.1#HVerifyingTokens
             */
            if (csrfTokenV2) {
                exitHandlerArgs['anti-csrftoken-a2z'] = csrfTokenV2.attr('content');
            }

            /*
            Populate the billingAddressId in form data only for whitelisted clientIds | Vermont Law fix : https://w.amazon.com/bin/view/VermontBillingAddressIncorporation/
            */
            var isBillingAddressIdEnabled = jQuery('#BillingAddressIdEnabledValue').data('value');
            if (isBillingAddressIdEnabled) {
                exitHandlerArgs['billingAddressId'] = response.billingAddressId;
            }

            /*TODO : Need to make sure that either paymentPlanId or payment.paymentPlanId is sent in exitHandlerArgs.
            Temporary Fix : Made null check to unblock KSWAG & tracking issue is https://t.corp.amazon.com/P20336855*/
            if (response.paymentPlanId) {
                exitHandlerArgs['payment.paymentPlanId'] = response.paymentPlanId;
            }
            if (response.paymentContractId) {
                exitHandlerArgs['payment.paymentContractId'] = response.paymentContractId;
            }
            if (response.paymentContractVersion) {
                exitHandlerArgs['payment.paymentContractVersion'] = response.paymentContractVersion;
            }
            if (!A.objectIsEmpty(response.paymentMethodRequiringOTP) && PaySelectHelper.getTotalDeductionAmount(data.selectedProducts) == 0) {
                var noRedirectUrl = jQuery('#noRedirect').data('no-redirect-url');
                exitHandlerEventAction.trigger("ExitHandler:action", {"actionUrl": noRedirectUrl, "params": exitHandlerArgs, "isFastlaneJuspayEnabled": jQuery("#noRedirect").data('is-fastlane-juspay-enabled'), "domainName": jQuery("#noRedirect").data('no-redirect-domain')});
            } else {
                exitHandlerEventAction.trigger("ExitHandler:action", {"params": exitHandlerArgs});
            }
        },

        submitOTPActionPerformed: function (action, selectedPaymentOptions, selectedProducts) {
            var data = this.fetch("SubmitOTPForm:GetSubmitOTPData", selectedPaymentOptions);
            if (this._hasPaymentInstrumentSelectionChanged(data.selectedPaymentOptionIds, selectedPaymentOptions)) {
                this.updatePaymentActionPerformed(action, selectedPaymentOptions, selectedProducts);
            } else {
                var self = this;
                this.process(this.ActionCallbackEvents[action.handler].DISABLE_ACTION, {action: action, showPopoverText : false});
                var ajaxRequest = this._validateShippingAddressAjaxRequest(data);
                ajaxRequest.done(function (validateShippingAddressResponse) {
                    if (validateShippingAddressResponse.valid) {
                        self._submitOTP({
                            submitOTPData: data,
                            selectedPaymentOptions: selectedPaymentOptions,
                            selectedProducts: selectedProducts
                        });
                    } else {
                        self._handleShippingAddressRequired({ action: action, htmlContent: validateShippingAddressResponse.htmlContent });
                    }
                })
            }
        },

        signContractActionPerformed: function (action, selectedPaymentOptions, selectedProducts) {
            var actionData = this.fetch(this.ActionCallbackEvents[action.handler].GET_ACTION_DATA);
            var payableDataList = PaySelectHelper.getPayable(selectedProducts, selectedPaymentOptions);
            var paymentData = this.getPaymentDataForPlaceOrder(actionData, selectedPaymentOptions, selectedProducts);
            var paymentMethodData = selectedPaymentOptions && selectedPaymentOptions[0];
            var exitHandler = jQuery('#exit-handler-action-form')[0];

            var contractSignData = {
                paymentMethodData : paymentMethodData,
                placeOrderData : {
                   payableDataList : payableDataList,
                   actionUrl: actionData.url,
                   paymentPlanId: actionData.paymentPlanId,
                   preferenceType: actionData.preferenceType,
                   acquisitionId: actionData.acquisitionId,
                   validateShippingAddress: actionData.validateShippingAddress,
                   displayText: paymentData.displayText,
                   fieldsToBeEncrypted: paymentData.fieldsToBeEncrypted,
                   selectedPaymentOptions: paymentData.selectedPaymentOptionList
                },
                exitHandler : {
                    action: exitHandler.attributes.action.value,
                    exitService: exitHandler.attributes.exitService.value,
                    method: exitHandler.attributes.method.value,
                    args: exitHandler
                }
            }

            this.broadcast(DPPUIConstants.EventTypes.SIGN_CONTRACT, contractSignData);
        },

        _hasPaymentInstrumentSelectionChanged: function(lastSelection, currentSelection) {
            var selectionChanged = false;
            if(lastSelection.length !== currentSelection.length) {
                selectionChanged = true;
            }
            for(var index = 0; index < currentSelection.length; index++) {
                if(lastSelection.indexOf(currentSelection[index].instrumentId) < 0) {
                    selectionChanged = true;
                    break;
                }
            }
            return selectionChanged;
        },

        submitOTPExitHandler: function(data) {
            data.submitOTPData = this.fetch("SubmitOTPForm:GetSubmitOTPData", data.selectedPaymentOptions);
            this._submitOTP(data);
        },

        _validateShippingAddressAjaxRequest: function(data) {
            var ajaxRequestData = {
                url : data.validateShippingAddressUrl,
                type : 'GET',
                contentType: 'application/json',
                cache : false
            };
            return jQuery.ajax(ajaxRequestData);
        },

        _submitOTP: function (data) {
            var self = this;
            P.when('noRedirectHandler').execute(function (noRedirectHandler) {
                var submitOTPData = data.submitOTPData;
                noRedirectHandler.registerCallback("SubmitOTPAction:OnSuccess", onSubmitOTPSuccess);
                noRedirectHandler.trigger("NoRedirectHandler:SubmitOTP", submitOTPData);

                function onSubmitOTPSuccess(submitOTPResponse) {
                    self.logEvent(data.selectedProducts, data.selectedPaymentOptions);
                    submitOTPData.authorizationRequired = false;
                    submitOTPData.updateVersionId = submitOTPResponse.recentInactivePaymentPlanVersionId;
                    noRedirectHandler.trigger("NoRedirectHandler:Exit", submitOTPData);
                }
            });
        },

        removePayablesWhichCanCauseSettingPreference : function(payables) {
            // In future if order summay split up is enabled for KU then RECURRING charge type also needs to be excluded.
            for (var index = 0 ; index < payables.length; index++) {
                if (payables[index].chargeType == "PREFERENCE") {
                    payables.splice(index, 1);
                }
            }
        },

        _isSufficient : function(selectedProducts, selectedPaymentOptions) {
            var amountToCover = PaySelectHelper.getOrderTotal(selectedProducts);
            if(PaySelectHelper.isDeductionSufficientInOrderSummary(selectedProducts)) {
                return true;
            }
            var isSufficient = false;
            var isPurchaseScenario = paymentMethodsHandler.fetch("PaymentOptions:IsPurchaseScenario");
            if(selectedPaymentOptions && selectedPaymentOptions instanceof Array) {
                for(var index = 0; index < selectedPaymentOptions.length; index++) {
                    var paymentMethod = selectedPaymentOptions[index];
                    if(paymentMethod.traits.isUnlimitedCoverage) {
                        isSufficient = true;
                        break;
                    }

                    var eligibleBackingMethods = paymentMethod.eligibleBackingMethods;
                    if(Array.isArray(eligibleBackingMethods) && eligibleBackingMethods.length > 0) {

                        var isBackingMethodSelected = false;
                        for(var y in selectedPaymentOptions) {
                            var selectedPaymentMethod = selectedPaymentOptions[y];
                            var paymentMethodCode = selectedPaymentMethod.paymentMethodCode;
                            if(eligibleBackingMethods.indexOf(paymentMethodCode) != -1) {
                                isBackingMethodSelected = true;
                                break;
                            }
                        }

                        if(!isBackingMethodSelected) {
                            continue;
                        }
                    }

                    amountToCover = (amountToCover - paymentMethod.balance.value).toFixed(2);
                    if(amountToCover <= 0 && isPurchaseScenario) {
                        isSufficient = true;
                        break;
                    }
                }
            }
            return isSufficient;
        },

        _retrieveNonConsentedPaymentMethodId : function(selectedPaymentOptions) {
            var storageConsentCollectionEnabled = jQuery("#order-confirmation").data('storage-consent-collection-enabled');
            if (storageConsentCollectionEnabled && selectedPaymentOptions && selectedPaymentOptions instanceof Array) {
                var nonConsentedInstrumentList = selectedPaymentOptions.filter(function(value, index, array){
                    return value != undefined && value.traits && value.traits.storageConsentProvided != null && !value.traits.storageConsentProvided;
                });
                return nonConsentedInstrumentList != undefined && nonConsentedInstrumentList[0] ? nonConsentedInstrumentList[0].instrumentId : "";
            }
            return "";
        },

        _retrieveWalletIdListFromPaymentContext : function() {
            var storageConsentCollectionEnabled = jQuery("#order-confirmation").data('storage-consent-collection-enabled');
            if (storageConsentCollectionEnabled) {
                var paymentContext = paymentMethodsHandler.fetch("GetPaymentPlanContext");
                return paymentContext != undefined ? paymentContext.walletIdList : ""
            }
            return "";
        },

        _updatePriceSummary : function (priceSummary, breakdown) {
            if (breakdown) {
                if (breakdown.itemPrice) {
                    for (var index = 0; index < breakdown.itemPrice.length; index++) {
                        priceSummary.itemPrice.push(breakdown.itemPrice[index]);
                    }
                }
                if (breakdown.audibleOur) {
                    priceSummary.audibleOur = breakdown.audibleOur;
                }
                if (breakdown.deductions) {
                    for (var index = 0; index < breakdown.deductions.length; index++) {
                        priceSummary.deductions.push(breakdown.deductions[index]);
                    }
                }
                if (breakdown.discounts) {
                    for (var index = 0; index < breakdown.discounts.length; index++) {
                        priceSummary.discounts.push(breakdown.discounts[index]);
                    }
                }
                if (!priceSummary.header) {
                    priceSummary.header = breakdown.header;
                }
                if (!priceSummary.orderTotal) {
                    priceSummary.orderTotal = breakdown.orderTotal;
                }
                if (!priceSummary.taxAmount) {
                    priceSummary.taxAmount = breakdown.taxAmount;
                }
                if (!priceSummary.orderTotalBeforeTax) {
                    priceSummary.orderTotalBeforeTax = breakdown.orderTotalBeforeTax;
                }
                if (!priceSummary.loyaltyPoints) {
                    priceSummary.loyaltyPoints = breakdown.loyaltyPoints;
                }
                if (!priceSummary.quantity && typeof breakdown.quantity !== 'undefined') {
                    priceSummary.quantity = breakdown.quantity;
                }
                priceSummary.hidePriceSummary = false;
                if (typeof breakdown.hidePriceSummary !== 'undefined') {
                    priceSummary.hidePriceSummary = breakdown.hidePriceSummary;
                }
                if (!priceSummary.copDisclaimer) {
                    priceSummary.copDisclaimer = breakdown.copDisclaimer;
                }
            }
            return priceSummary;
        },

        _getDefaultTestCharge : function() {
             var testChargeData = jQuery('#defaultTestCharge');
             var testCharge = {};
             if (testChargeData) {
                 testCharge.value = testChargeData.data('value');
                 testCharge.unit = testChargeData.data('unit');
                 testCharge.label = testChargeData.data('label');
                 testCharge.description = testChargeData.data('description');
                 testCharge.orderTotalLabel = testChargeData.data('order-total-label');
             }
             return testCharge;
         },

        _getOrderSummaryDataProvider: function(selectedProducts) {
            var orderSummaryType = "DEFAULT";
            for (index in selectedProducts) {
                if (selectedProducts[index].productType == "BALANCE_TOPUP") {
                    orderSummaryType = selectedProducts[index].productType;
                    break;
                }
            }
            return this.OrderSummaryDataProvider[orderSummaryType];
        },

        _getOrderSummaryData : function(selectedProducts, selectedPaymentOptions) {
            return this._getOrderSummaryDataProvider(selectedProducts).call(this, selectedProducts, selectedPaymentOptions);
        },

        _getBalanceTopupOrderSummaryData : function(selectedProducts, selectedPaymentOptions) {
            var orderSummaryData = {};

            var balanceProduct = selectedProducts[0];
            orderSummaryData.product = balanceProduct;

            var breakdown = balanceProduct.breakdown;
            var hasDependentProduct = false;
            if (breakdown && breakdown.orderTotal && breakdown.orderTotal.price) {
                orderSummaryData.priceSummary = breakdown;
                hasDependentProduct = true;
            }

            if (balanceProduct.dependentProductIds) {
                var dependentProducts = paySelectHandler.fetch("GetProductsById", balanceProduct.dependentProductIds);
                var balancePaymentOptions = paySelectHandler.fetch("GetBalances");
                var filteredBalancePaymentOptions = this._filterZeroBalancePaymentOptions(balancePaymentOptions);
                var dependentProductsOrderSummaryData = this._getOrderSummaryDataProvider().call(this, dependentProducts, filteredBalancePaymentOptions, hasDependentProduct);
                orderSummaryData.dependentProductsOrderSummaryData = dependentProductsOrderSummaryData;
            }

            orderSummaryData.orderSummaryType = balanceProduct.productType;
            return orderSummaryData
        },

        _filterZeroBalancePaymentOptions : function(paymentOptions) {
             if(paymentOptions && paymentOptions instanceof Array) {
                 return paymentOptions.filter(function(paymentOption) {
                     if (!paymentOption.traits.isUnlimitedCoverage && paymentOption.balance.value <= 0) {
                         return false;
                     }
                     return true;
                 });
             }
        },

        _getDefaultOrderSummaryData : function(selectedProducts, selectedPaymentOptions, hasDependentProduct) {
            var contributions = [];
            amountToCover = PaySelectHelper.getOrderTotal(selectedProducts);
            if(selectedPaymentOptions && selectedPaymentOptions instanceof Array) {
                for (var index = 0; index < selectedPaymentOptions.length; index++) {
                    var paymentMethod = selectedPaymentOptions[index];
                    if(!paymentMethod.traits.isUnlimitedCoverage) {
                        var balance = paymentMethod.balance;
                        var value = balance.value;
                        if(amountToCover >= value) {
                            amountToCover = (amountToCover - value);
                        } else {
                            value = amountToCover;
                            amountToCover = 0;
                        }
                        var contribution = {};
                        var price = {};
                        price.value = value;
                        price.unit = balance.unit;
                        price.displayString = currencyManager.format(price.value, price.unit);
                        contribution.price = price;
                        contribution.label = paymentMethod.displayText;
                        contribution.index = paymentMethod.index;
                        var currencyOfPreferencePrice = currencyManager.currencyConverter(price.value, price.unit);
                        if(currencyOfPreferencePrice) {
                            currencyOfPreferencePrice.displayString = currencyManager.format(currencyOfPreferencePrice.value, currencyOfPreferencePrice.unit);
                            contribution.copPrice = currencyOfPreferencePrice;
                        }
                        //Neglecting the contributions, if the price covered by contribution is 0
                        if(contribution.price.value != 0){
                            contributions.push(contribution);
                        }
                    }
                }
            }

            var orderSummaryData = {};
            orderSummaryData.productDetails = [];
            var priceSummary = {};
            priceSummary.itemPrice = [];
            priceSummary.deductions = [];
            priceSummary.discounts = [];
            for (var x in selectedProducts) {
                if (selectedProducts[x].details) {
                    orderSummaryData.productDetails.push(selectedProducts[x].details);
                }
                if (selectedProducts[x].vetRequired) {
                    var testCharge = PaySelectHelper.getTestCharge(selectedPaymentOptions);
                     if (!testCharge) {
                         testCharge = this._getDefaultTestCharge();
                     }
                     testCharge.displayString = currencyManager.format(testCharge.value, testCharge.unit);
                     priceSummary.testCharge = testCharge;
                }
                if(selectedProducts[x].chargeType) {
                    priceSummary.chargeType = selectedProducts[x].chargeType
                }
                priceSummary = this._updatePriceSummary(priceSummary, selectedProducts[x].breakdown);
            }
            priceSummary.contributions = contributions;
            priceSummary.showSubtotal = hasDependentProduct;
            orderSummaryData.priceSummary = priceSummary;
            orderSummaryData.orderSummaryType = "DEFAULT";
            return orderSummaryData;
        },

        update : function(selectedProducts, selectedPaymentOptions) {
            var allSelectedInstruments = paySelectHandler.fetch("GetSelectedPaymentOptions", {includeViolations : true});
            this.showOrHideTurnOffIMB(allSelectedInstruments);
            var action = paySelectHandler.fetch("GetAction", {
                allSelectedInstruments: allSelectedInstruments
            });
            action = this._sanitizeActionDescriptor(action);
            this.process(this.ActionCallbackEvents[action.handler].UPDATE_ROLES, action);
            var isStateValid = this.RoleFunctions.ValidateStateChange[action.roles[0]].call(this, action, selectedPaymentOptions, selectedProducts); //TODO: Handle multiple roles.

            if(isStateValid) {
                var actionName = this.getActionForValidState();
                this.broadcast("SelectInstrument:update", {"showSelectInstrumentMessage" : false});
                this.process(this.ActionCallbackEvents[action.handler][actionName], {action: action, isPyoClicked: this.isPyoClicked });
                this._disableOtherActions(action);
            } else {
                var actionName = this.getActionForInvalidState();
                var showSelectInstrumentMessage = this._shouldShowSelectInstrumentText(allSelectedInstruments);
                this.broadcast("SelectInstrument:update", {"showSelectInstrumentMessage" : showSelectInstrumentMessage});
                this.process(this.ActionCallbackEvents[action.handler][actionName], { action: action}); //TODO: Have seperate handlers to get data based on action.
                this._disableOtherActions(action);
            }
            var orderSummaryData = this._getOrderSummaryData(selectedProducts, selectedPaymentOptions);
            this.process("OrderSummary:update", orderSummaryData);
        },

        emitTurnOffIMBLoadEvent: function () {
            if (DataStoreEventLogger != undefined) {
                var eventData = DataStoreEventLogger.buildEventData(PaySelectEventNames.IMB_DISPLAY_LOAD_EVENT, DataStoreEventStatus.SUCCESS,
                PaySelectEventActionAttributeKeys.RESTRICTION_LEVEL, "TurnOff", undefined);
                DataStoreEventLogger.logDataStoreEvent(eventData);
            }
        },

        showOrHideTurnOffIMB: function(allSelectedInstruments) {
            var restrictionLevel = jQuery("#imbContext").data('restriction-level');
            var emitTurnOffIMBLoadEventCallback = this.emitTurnOffIMBLoadEvent.bind(this);
            if(typeof restrictionLevel !== "undefined" && restrictionLevel === "signalling") {
                return;
            }
            jQuery("#payment-option-signaling-info-box").addClass("aok-hidden");
            jQuery("#payment-option-restriction-info-box").addClass("aok-hidden");
            if(!allSelectedInstruments) {
                return;
            }
            for(var index = 0; index < allSelectedInstruments.length; index++) {
                if(allSelectedInstruments[index].type === "Card") {
                    var additionalData = allSelectedInstruments[index].additionalData;
                    additionalData.forEach(function (data) {
                        if (data.key === "cardTurnoffRestriction") {
                            if (data.value) {
                                jQuery("#payment-option-restriction-info-box").removeClass("aok-hidden");
                                emitTurnOffIMBLoadEventCallback();
                            }
                        }
                    });
                return;
                }
             }
        },

        getActionForValidState: function() {
            return "ENABLE_ACTION";
        },

        getActionForInvalidState: function() {
            return "DISABLE_ACTION";
        },

        isStateValidForUpdatePaymentAction: function(action, selectedPaymentOptions, selectedProducts) {
            var isSufficient = this._isSufficient(selectedProducts, selectedPaymentOptions);
            return (isSufficient && this.isFormValid()) || this.checkPYOAddCardEnabled();
        },

        isStateValidForSubmitOTPAction: function(action, selectedPaymentOptions, selectedProducts) {
            //Doing this as we are updating contract after Submit OTP, for now.
            var stateValidForUpdatePaymentAction = this.isStateValidForUpdatePaymentAction(action, selectedPaymentOptions, selectedProducts);
            return stateValidForUpdatePaymentAction && this.fetch("SubmitOTPForm:CanEnableSubmitOTP", action);
        },

        isStateValidForSignContractAction: function(action, selectedPaymentOptions, selectedProducts) {
            return this.fetch("WeChatContract:NeedContractSigning");
        },

        _disableOtherActions: function(action) {
            var thisActionCallback = this.ActionCallbackEvents[action.handler];
            for(key in this.ActionCallbackEvents) {
                var otherActionCallback = this.ActionCallbackEvents[key];
                if(otherActionCallback != thisActionCallback) {
                    this.process(otherActionCallback.DISABLE_ACTION);
                }
            }
        },

        checkPYOAddCardEnabled : function() {
            var self = this;
            P.when('addCardHandler','ready').execute(function(addCardHandler) {
                var addCardActionData = addCardHandler.fetch("AddCardActionData");
                if (!self.isEmptyObject(addCardActionData)) {
                    var selectedForm = addCardActionData.containerDiv;
                    var cardNumber = selectedForm.find('.cardNumber');
                    var cardHolderName = selectedForm.find('.cardHolderName');
                    var cvvCodeField = selectedForm.find("input[id*='cvv']");
                    var postalCodeField = selectedForm.find("input[id*='billingAddressPostalCode']");
                    var PYOEnableTreatment = DPPUITreatments.getTreatment('PYOEnableTreatment');
                    var codeField = self.checkVerificationCodeField(cvvCodeField) || self.checkVerificationCodeField(postalCodeField);
                    return (PYOEnableTreatment && selectedForm.length && codeField && cardNumber.val().length > 0
                        && validateForm.validate(cardNumber, selectedForm) && validateForm.validate(cardHolderName, selectedForm)
                        && validateForm.validate(codeField, selectedForm))
                }
                return false;
            });
        },

        checkVerificationCodeField : function(field) {
            return (!field.is('.aok-hidden')) ? field : undefined;
        },

        isEmptyObject : function(object) {
            for (var name in object) {
                return false;
            }
            return true;
        },

        _shouldShowSelectInstrumentText : function(allSelectedInstruments) {
            return this._shouldShowPopoverText(allSelectedInstruments);
        },

        _shouldShowPopoverText : function(allSelectedInstruments) {
            if (jQuery("#pay-select-view").data("show-tool-tip") == false) {
                return false;
            }
            var shouldDisplay = true;
            if(allSelectedInstruments == undefined
                || allSelectedInstruments.length == 0) {
                shouldDisplay = false;
                return;
            }
            jQuery.each(allSelectedInstruments, function(i, paymentMethod) {
                if (paymentMethod.traits.isUnlimitedCoverage) {
                    shouldDisplay = false;
                }
            });
            return shouldDisplay;
        },
    });
    P.declare("ConfirmOrderHandler", ConfirmOrderHandler);
});

<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://w.amazon.com/bin/view/Horizonte/Features/Integrations/CSRF/5.3.1#HVerifyingTokens" title="Open URL: https://w.amazon.com/bin/view/Horizonte/Features/Integrations/CSRF/5.3.1#HVerifyingTokens (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://w.amazon.com/bin/view/Horizonte/Features/Integrations/CSRF/5.3.1#HVerifyingTokens" title="Open URL in Popup: https://w.amazon.com/bin/view/Horizonte/Features/Integrations/CSRF/5.3.1#HVerifyingTokens (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>
<script>
P.declare('kswag-config', {
  allowPaysSelectCheck: false,
  allowUpdatePaymentAction: false
});
</script>
<script>
P.when('jQuery','exitHandlerEventAction', 'ConfirmOrderHandler', 'validators', 'kswag-config', 'ready').execute(
    function(jQuery, exitHandlerEventAction, ConfirmOrderHandler, validators, config) {
    var ADLConfirmOrderHandler = ConfirmOrderHandler.extend({

        isMultiEmailControlValid : function() {
            var isValid = this.fetch("MultiEmailController:isValid");

            
            if(typeof isValid === 'undefined'){
                return true;
            }

            return isValid;
        },

        isQuantityPickerValid : function() {
            return this.fetch("Quantity:isQuantityPickerUpdated");
        },

        
        isFormValid : function() {
            return jQuery('#order-summary-container').data("enable-pyo-button-after-lazy-load");
        },

        getCustomPopoverText : function() {
            var customPopoverText = false;
            if (!this.isQuantityPickerValid()) {
                customPopoverText = jQuery("#sqp-popover-string").text();
            } else if (!this.isMultiEmailControlValid()) {
                customPopoverText = jQuery('#mec-data').data("pyo-popover-text");
            }
            return customPopoverText;
        },

        
        mecReadyToEnable : function() {
            if (this.isQuantityPickerValid() && this.isFormValid()) {
                this.process("Action:enable");
            } else {
                this.disableAction();
            }
        },

        
        disableAction : function() {
            this.process("Action:disable", {"showPopoverText" : false});
        },

        
        update : function(selectedProducts, selectedPaymentOptions) {
            var enablePYOButton = this.isMultiEmailControlValid() && this.isQuantityPickerValid() && this.isFormValid();
            if (config && config.allowPaysSelectCheck) {
                var isSufficient = this._isSufficient(selectedProducts, selectedPaymentOptions);
                enablePYOButton =  enablePYOButton && isSufficient;
            }
            if (enablePYOButton) {
                this.process("Action:enable");
            } else {
                this.disableAction();
            }

            let orderSummaryData = this.getOrderSummaryDataOverride(selectedProducts, selectedPaymentOptions);
            this.process("OrderSummary:update", orderSummaryData);
        },

        getOrderSummaryDataOverride : function(selectedProducts, selectedPaymentOptions) {
            let orderSummaryData = this._getOrderSummaryData(selectedProducts, selectedPaymentOptions);
            if (orderSummaryData.priceSummary.quantity.value == 0) {
                delete orderSummaryData.priceSummary.taxAmount;
                orderSummaryData.priceSummary.contributions = [];
            }
            return orderSummaryData;
        },

        
        OnActionPerformed : function(action) {
            this.process("Action:disable", {showPopoverText : false});

            var handlerSuper = this._super.bind(this, action);
            var submitPromise = this.fetch("MultiEmailController:submit");

            if(typeof submitPromise === 'undefined'){
                
                (config && config.allowUpdatePaymentAction) ? handlerSuper() : exitHandlerEventAction.trigger("ExitHandler:action", {"params": {}});
            } else {
                submitPromise.then(function(res) {
                    
                    (config && config.allowUpdatePaymentAction) ? handlerSuper() : exitHandlerEventAction.trigger("ExitHandler:action", {"params": {}});
                }, function (rej) {
                    
                    logMetric('MECSubmitFailed');
                    displayError();
                });
            }

            var pageBlockerSpinner = jQuery('#page-blocker');
            if(pageBlockerSpinner.length > 0) {
                pageBlockerSpinner.removeClass("aok-hidden");
             }
            return;
        },
    });

    function logMetric(metric) {
        P.when('CSM', 'ready').execute(function(CSM) {
            CSM.log(metric);
        });
    }

    function displayError() {
        P.when('errorHandler', 'ready').execute(function(errorHandler) {
            errorHandler.showError(errorHandler.ORDER_ERROR_REFRESH);
        });
    }

    var adlConfirmOrderHandler = new ADLConfirmOrderHandler();
    P.declare("confirmOrderHandler", adlConfirmOrderHandler);
});
</script>
<script>
P.when('A', 'Handler', 'jQuery', 'OrderSummaryHandler', 'paySelectHandler', 'currencyManager', 'productQuantityHandler', 'confirmOrderHandler', 'checkoutOrderTotalHandler', 'ready').execute(function(A, Handler, jQuery, OrderSummaryHandler, paySelectHandler, currencyManager, productQuantityHandler, confirmOrderHandler, checkoutOrderTotalHandler) {
    var orderSummaryContainer = jQuery('#order-summary-container');
    var CheckoutOrderSummaryHandler = OrderSummaryHandler.extend({
        init : function() {
            confirmOrderHandler.registerCallback("OrderSummary:update", this.update.bind(this));
            paySelectHandler.registerCallback("PaySelect:productChanged", this.OnProductChange.bind(this));
        },

        OnProductChange : function(products) {
            if (orderSummaryContainer.data('should-lazy-load-promotions')) {
                this.fetchAndUpdatePriceSummary(products);
             }
        },

        fetchAndUpdatePriceSummary : function(products) {
            var self = this;
            var parameters = {
                quantity : productQuantityHandler.fetch("ProductQuantity:GetUpdatedQuantity"),
                asin : (products && products[0]) ? products[0].details.asin : null,
                shouldLazyLoadOrderSummary : true };

            var ajaxRequestData = {
                url: orderSummaryContainer.data('lazy-load-promotions-url'),
                type: 'POST',
                data: JSON.stringify(parameters),
                contentType: 'application/json',
            };

            var ajax = jQuery.ajax(ajaxRequestData);
            ajax.done(function(response) {
                if (response && response.priceBreakDownJson) {
                    jQuery('#' + response.id).data('price-breakdown-json', JSON.parse(response.priceBreakDownJson));
                    var orderSummarySpinner = orderSummaryContainer.find("#order-summary-spinner");
                    if(orderSummarySpinner.length > 0) {
                        orderSummarySpinner.addClass("aok-hidden");
                     }
                    //enable the PYO button once ajax call finishes if the flag is set
                    var shouldEnablePYOButton = orderSummaryContainer.data("enable-pyo-button-after-lazy-load");
                    if (shouldEnablePYOButton != null && shouldEnablePYOButton != undefined && shouldEnablePYOButton == false) {
                        orderSummaryContainer.data("enable-pyo-button-after-lazy-load", true);
                     }
                    self.process("PaySelect:OnUpdate");
                  }
               });
            ajax.fail(function(response) {
            //enable the PYO button if the button is disabled on the checkout page
                var shouldEnablePYOButton = orderSummaryContainer.data("enable-pyo-button-after-lazy-load");
                if (shouldEnablePYOButton != null && shouldEnablePYOButton != undefined && shouldEnablePYOButton == false) {
                    self.process("Action:enable");
               }
            });
        },

        update : function(data) {
            if (data && data.priceSummary) {
                var shouldUpdateOrderSummary = orderSummaryContainer.data("enable-pyo-button-after-lazy-load");
                var priceSummaryTotal = null;
                var isCopEnabled = jQuery('#currencyOfPreferenceEnabled').data("value");
                if (shouldUpdateOrderSummary == true) {
                    var expandedForm = orderSummaryContainer.find('.expanded-form');
                    this.applyTemplate(expandedForm.find('#order-summary-header'), 'order-summary-header-tmpl', data.priceSummary);
                    priceSummaryTotal = this._updateOrdertotal(data.priceSummary);
                    this.applyTemplate(expandedForm.find('.price-summary'), 'price-summary-tmpl', data.priceSummary);
                    this.applyTemplate(expandedForm.find('#order-total-section'), 'order-total-tmpl', priceSummaryTotal);
                    checkoutOrderTotalHandler.process("OrderTotal:updated", priceSummaryTotal);

                    P.when("a-dropdown", 'ready').execute(function (dropdown) {
                        var quantitySelector = dropdown.getSelect("quantitySelector");
                        if (quantitySelector != null) {
                            quantitySelector.update({status:"enabled"});
                        }
                    });

                    jQuery('.contributionContainer').each(function() {
                        var container = jQuery(this);
                        var labelElement = container.find('.contributionLabel');
                        var valueElement = container.find('.contribution');
                        valueElement.html("-");
                        valueElement.data("value","");
                        valueElement.data("unit","");
                    });

                    var contributions = data.priceSummary.contributions;
                    jQuery.each(contributions, function(i, contribution) {
                        var container = jQuery('.contributionContainer[data-index='+ contribution.index +']');
                        var valueElement = container.find('.contribution');
                        if (valueElement.length > 0) {
                            valueElement.data("value", -contribution.price.value);
                            valueElement.data("unit", contribution.price.unit);
                            currencyManager.update(valueElement);
                        }
                    });

                    var collapsedForm = orderSummaryContainer.find('.collapsed-form');
                    if (collapsedForm.length) {
                        this.applyTemplate(collapsedForm.find('.price-summary'), 'price-summary-collapsed-tmpl', data.priceSummary);

                        if (data.priceSummary.testCharge) {
                            this.showCollapsedForm();
                            orderSummaryContainer.find('.order-summary-expander').removeClass('aok-hidden');
                        } else {
                            this.showExpandedForm();
                            orderSummaryContainer.find('.order-summary-expander').addClass('aok-hidden');
                        }
                    }
                 }

                //Showing an alert on rounding error with conversion if one of the local mp total or cop total and the other is not
                if (isCopEnabled) {
                    var priceSummary = priceSummaryTotal ? priceSummaryTotal : data.priceSummary ;
                    if ((priceSummary.orderTotal.copPrice && priceSummary.orderTotal.price.value != priceSummary.orderTotal.copPrice.value)
                        && (priceSummary.orderTotal.price.value == 0 || priceSummary.orderTotal.copPrice.value == 0)) {
                        jQuery('#totalMismatchAlert').removeClass('aok-hidden');
                    } else {
                        jQuery('#totalMismatchAlert').addClass('aok-hidden');
                    }
                }
                if (data.productDetails.length > 0) {
                    var productDetails = data.productDetails[0];
                    template = jQuery('#product-template-tmpl').html();
                    productDetails.additionalDetails = this._formatData(productDetails.additionalDetails);
                    if(data.priceSummary) {
                        if(isCopEnabled) {
                            productDetails.copPrice = data.priceSummary.itemPrice[0].copPrice;
                        }
                        productDetails.price = data.priceSummary.itemPrice[0].price;
                    }
                    html = Mustache.to_html(template, productDetails);
                    jQuery("[id='product-details-container']").each(function(index, element) {
                        jQuery(element).html(html);
                    });
                }
            }
        },
    });
    var checkoutOrderSummaryHandler = new CheckoutOrderSummaryHandler();
    P.declare("orderSummaryHandler", checkoutOrderSummaryHandler);
});
</script>
<script>
P.when('A', 'Handler', 'jQuery', 'currencyManager','mustache','confirmOrderHandler', 'checkoutOrderTotalHandler','DPPUITreatments','ready').execute(function(A, Handler, jQuery, currencyManager, Mustache, confirmOrderHandler, checkoutOrderTotalHandler, DPPUITreatments) {
    var OrderSummaryHandler = Handler.extend({
        init : function() {
            confirmOrderHandler.registerCallback("OrderSummary:update", this.update.bind(this));
            var self = this;
            A.on('a:expander:order_summary_expander:toggle:expand', function(data) {
                self.showExpandedForm();
            });
            A.on('a:expander:order_summary_expander:toggle:collapse', function(data) {
                self.showCollapsedForm();
            });
            if(jQuery('#order-summary-container').data('should-lazy-load-promotions') && !jQuery('#order-summary-container').data('multi-item-purchase')) {
                self.fetchAndUpdatePriceSummary();
            }

            this.RenderOrderSummaryFunctions = {
                "BALANCE_TOPUP": this.renderBalanceTopupOrderSummary,
                "DEFAULT": this.renderDefaultOrderSummary
            };
        },

        // Makes an Ajax request to get the list of products and uses it to update the price breakdown with tax/promo split.
        fetchAndUpdatePriceSummary : function() {
            var self = this;
            var ajaxRequestData = {
                url: jQuery('#order-summary-container').data('lazy-load-promotions-url') + window.location.search,
                type: 'POST',
                contentType: 'application/json',
            };
            var ajax = jQuery.ajax(ajaxRequestData);
            ajax.done(function(response) {
                if(response && response.products) {
                    for (var index = 0; index < response.products.length; index++) {
                        var product = response.products[index];
                        if (product.priceBreakDownJson) {
                            jQuery('#' + product.id).data('price-breakdown-json', JSON.parse(product.priceBreakDownJson));
                        }
                    }
                    self.process("PaySelect:OnUpdate");
                    // Get's the eligibilityCriteria and reset the PaymentOptions to disable the instruments if promotions are sufficient and eligible for Free Order.
                    var eligibilityCriteria =  self.fetch("GetEligibilityCriteria");
                    if (eligibilityCriteria && eligibilityCriteria.eligibleForFreeOrder === true) {
                        self.process("PaymentMethod:ResetPaymentOptions", eligibilityCriteria);
                    }
                }
            });
            ajax.fail(function(response) {
                // do nothing
            });
        },

        showExpandedForm : function() {
            var orderSummaryContainer = jQuery('#order-summary-container');
            orderSummaryContainer.find('.expanded-form').removeClass('aok-hidden');
            orderSummaryContainer.find('.collapsed-form').addClass('aok-hidden');
        },

        showCollapsedForm : function() {
            var orderSummaryContainer = jQuery('#order-summary-container');
            orderSummaryContainer.find('.expanded-form').addClass('aok-hidden');
            orderSummaryContainer.find('.collapsed-form').removeClass('aok-hidden');
        },

        applyTemplate : function($placeHolder, templateId, data) {
            var template, html;
            template = jQuery('#' + templateId).html();
            data = data ? data : {};
            html = Mustache.to_html(template, data);
            jQuery($placeHolder).html(html);
        },

        hideOrderSummary : function() {
            jQuery('#balance-topup-product-summary').addClass('aok-hidden');
            jQuery('#order-summary-container').addClass('aok-hidden');
        },

        update : function(data) {
            this.hideOrderSummary();
            var orderSummaryType = data.orderSummaryType ? data.orderSummaryType : "DEFAULT";
            this.RenderOrderSummaryFunctions[orderSummaryType].call(this, data);
        },

        renderBalanceTopupOrderSummary : function(data) {
            jQuery('#balance-topup-product-summary').removeClass('aok-hidden');
            this.applyTemplate(jQuery.find('#balance-topup-product-summary'), 'balance-topup-product-summary-tmpl', data.priceSummary);
            this.applyTemplate(jQuery.find('#order-total-value') , "order-total-header-section-tmpl", data.priceSummary);
            this.applyTemplate(jQuery("#order-total-bottom-sheet") , 'balance-topup-product-summary-tmpl', data.priceSummary);
            if (data.dependentProductsOrderSummaryData) {
                this.RenderOrderSummaryFunctions[data.dependentProductsOrderSummaryData.orderSummaryType].call(this, data.dependentProductsOrderSummaryData);
            }
        },

        renderDefaultOrderSummary : function(data) {
            var priceSummaryTotal;
            if (data.priceSummary) {
                var orderSummaryContainer = jQuery('#order-summary-container');
                orderSummaryContainer.removeClass('aok-hidden');

                var expandedForm = orderSummaryContainer.find('.expanded-form');
                var loyaltyPointsContainer = expandedForm.find('#loyalty-points-container')
                var copDisclaimerContainer = expandedForm.find('#cop-disclaimer-container')

                this.applyTemplate(expandedForm.find('#order-summary-header'), 'order-summary-header-tmpl', data.priceSummary);
                priceSummaryTotal = this._updateOrdertotal(data.priceSummary);
                if (data.priceSummary.deductions.length != 0) {
                  jQuery("#smartPSP-price-summary").removeClass("aok-hidden");
                }
                this.applyTemplate(expandedForm.find('.price-summary'), 'price-summary-tmpl', data.priceSummary);
                this.applyTemplate(jQuery("#top-up-pay-order-summary"), 'price-summary-tmpl', data.priceSummary);
                this.applyTemplate(jQuery("#top-up-pay-order-total") , 'order-total-tmpl', priceSummaryTotal);

                if(priceSummaryTotal.deductions.length == 0 && priceSummaryTotal.contributions.length == 0){
                    this.applyTemplate(jQuery("#top-up-pay-order-summary"), 'price-summary-tmpl-top-up-without-payment-summary', data.priceSummary);
                    jQuery("#top-up-pay-order-total").addClass("aok-hidden");
                    jQuery("#smartPSP-price-summary").addClass("aok-hidden");
                } else {
                    jQuery("#top-up-pay-order-total").removeClass("aok-hidden");
                }

                if(!jQuery("#smartPSP-price-summary").hasClass("aok-hidden")){
                    this.applyTemplate(jQuery("#payment-summary-bottom-sheet") , "price-summary-tmpl", data.priceSummary);
                }
                if(jQuery('#balance-topup-product-summary').hasClass('aok-hidden')){
                    this.applyTemplate(jQuery('#order-total-value') , "order-total-header-section-tmpl", priceSummaryTotal);
                    if(priceSummaryTotal.orderTotal && priceSummaryTotal.orderTotal.price.value > 0) {
                        jQuery("#order-total-value").removeClass("aok-hidden");
                    } else {
                        jQuery("#order-total-value").addClass("aok-hidden");
                    }

                } else {
                    jQuery("#smartPSP-price-summary").removeClass("aok-hidden");
                }

                if (typeof data.priceSummary.hidePriceSummary === "boolean"  && !data.priceSummary.hidePriceSummary) {
                    orderSummaryContainer.find('.price-summary-not-shown').removeClass('aok-hidden');
                }

                if (data.priceSummary.loyaltyPoints) {
                    this.applyTemplate(loyaltyPointsContainer, 'loyalty-points-tmpl', data.priceSummary);
                }

                if (data.priceSummary.copDisclaimer) {
                    this.applyTemplate(copDisclaimerContainer, 'cop-disclaimer-tmpl', data.priceSummary);
                }

                if (priceSummaryTotal.orderTotal && priceSummaryTotal.orderTotal.price && priceSummaryTotal.orderTotal.price.value == 0) {
                    this.process("OrderTotal:UpdatedToZero");
                }
                if (data.priceSummary.showSubtotal) {
                    if(priceSummaryTotal.contributions.length > 0 ){
                        jQuery("#smartPSP-price-summary").removeClass("aok-hidden");
                    }
                    this.applyTemplate(expandedForm.find('#order-sub-total-section'), 'order-sub-total-tmpl', priceSummaryTotal);
                    this.applyTemplate(jQuery("#order-sub-total-bottom-sheet"), 'order-sub-total-tmpl', priceSummaryTotal);
                    this.applyTemplate(jQuery("#"), 'order')
                    if(data.priceSummary.deductions.length == 0 && data.priceSummary.contributions.length == 0){
                        jQuery("#order-sub-total-bottom-sheet").addClass('aok-hidden');
                    } else {
                        jQuery("#order-sub-total-bottom-sheet").removeClass('aok-hidden');
                    }
                    expandedForm.find('#order-total-container').addClass('aok-hidden');
                    expandedForm.find('#order-sub-total-section').removeClass('aok-hidden');
                    jQuery("#order-total-bottom-sheet").removeClass("aok-hidden");
                    if(priceSummaryTotal && priceSummaryTotal.orderTotal && priceSummaryTotal.orderTotal.copPrice) {
                        jQuery('#copDisclaimerSubtotal').removeClass("aok-hidden");
                    } else {
                        jQuery('#copDisclaimerSubtotal').addClass("aok-hidden");
                    }
                } else {
                    this.applyTemplate(expandedForm.find('#order-total-section'), 'order-total-tmpl', priceSummaryTotal);
                    if(!(jQuery("#smartPSP-price-summary").hasClass("aok-hidden"))) {
                        if(jQuery('#balance-topup-product-summary').hasClass('aok-hidden')) {
                            this.applyTemplate(jQuery("#order-total-bottom-sheet") , 'order-total-tmpl', priceSummaryTotal);
                        }
                        jQuery("#order-total-bottom-sheet").removeClass("aok-hidden");
                    } else {
                        jQuery("#order-total-bottom-sheet").addClass("aok-hidden");
                    }
                    jQuery("#order-sub-total-bottom-sheet").addClass('aok-hidden');
                    expandedForm.find('#order-total-container').removeClass('aok-hidden');
                    expandedForm.find('#order-sub-total-section').addClass('aok-hidden');
                }
                checkoutOrderTotalHandler.process("OrderTotal:updated", priceSummaryTotal);
                // The following code is applicable only for mobile view where balances are inside order summary.
                jQuery('.contributionContainer').each(function() {
                    var container = jQuery(this);
                    var labelElement = container.find('.contributionLabel');
                    var valueElement = container.find('.contribution');
                    valueElement.html("-");
                    valueElement.data("value","");
                    valueElement.data("unit","");
                });

                var contributions = data.priceSummary.contributions;
                jQuery.each(contributions, function(i, contribution) {
                    var container = jQuery('.contributionContainer[data-index='+ contribution.index +']');
                    var valueElement = container.find('.contribution');
                    if (valueElement.length > 0) {
                        var value = -contribution.price.value;
                        var unit = contribution.price.unit;
                        var currencyOfPreferencePrice = currencyManager.currencyConverter(value, unit);
                        if(currencyOfPreferencePrice) {
                            value = currencyOfPreferencePrice.value;
                            unit = currencyOfPreferencePrice.unit;
                        }
                        valueElement.data("value", value);
                        valueElement.data("unit", unit);
                        currencyManager.update(valueElement);
                    }
                });

                var collapsedForm = orderSummaryContainer.find('.collapsed-form');
                if (collapsedForm.length) {
                    this.applyTemplate(collapsedForm.find('.price-summary'), 'price-summary-collapsed-tmpl', data.priceSummary);

                    if (data.priceSummary.testCharge) {
                        this.showCollapsedForm();
                        orderSummaryContainer.find('.order-summary-expander').removeClass('aok-hidden');
                    } else {
                        this.showExpandedForm();
                        orderSummaryContainer.find('.order-summary-expander').addClass('aok-hidden');
                    }
                }
            }

            if (data.productDetails.length > 0) {
                //Format server's response data and populate Mustache template to list the products along with its price
                var productTemplateData = { "productDetailsList" : [], "seller" : "" };
                if (typeof data.productDetails[0].additionalDetails === 'object' && data.productDetails[0].additionalDetails !== null) {
                    productTemplateData.seller = data.productDetails[0].additionalDetails.seller;
                }
                productTemplateData.productDetailsList = data.productDetails.map(function(item, index) {
                    if(data.priceSummary && data.priceSummary.itemPrice && index < data.priceSummary.itemPrice.length) {
                        item.price = data.priceSummary.itemPrice[index].price;
                        item.copPrice = data.priceSummary.itemPrice[index].copPrice;
                        item.quantity = data.priceSummary.quantity;
                        if (jQuery("#smartPSP-price-summary").hasClass("aok-hidden")){
                            item.smartPSPLabel = data.priceSummary.itemPrice[index].label;
                            item.isLabelLink = false;
                        } else if (priceSummaryTotal && priceSummaryTotal.orderTotal) {
                            item.smartPSPLabel = priceSummaryTotal.orderTotal.label;
                            item.isLabelLink = true;
                        }
                    }
                    item.additionalDetails = this._formatData(item.additionalDetails);
                    item.bindingInfo = item.additionalDetails.filter(function(additionalInfo) {
                        return (additionalInfo.key && additionalInfo.key == 'binding');
                    });

                    item.smartPSPOrderTotalDisplayString = jQuery("#order-total-header").data('displaystring');
                    return item;
                }, this);
                if(data.priceSummary) {
                    productTemplateData.header = data.priceSummary.header;
                }
                template = jQuery('#product-template-tmpl').html();
                if (orderSummaryContainer.data("multi-item-purchase")) {
                    var productDetailsHtml = Mustache.to_html(template, productTemplateData).trim();
                } else {
                    var onlyProduct = productTemplateData.productDetailsList[0];
                    var productDetailsHtml = Mustache.to_html(template, onlyProduct).trim();
                    if(!onlyProduct.imageUrl) {
                        // This is to handle product selector view when image is null.
                        var templContent = jQuery(productDetailsHtml);
                        templContent.find("#clm-product-image").remove();
                        templContent.find("#clm-product-title").addClass('full-width');
                        productDetailsHtml = templContent.html();
                    }
                }
                /* If the imageUrl is 'null'(incase of KU Redrive flow) a broken image is shown. To remove it, a check is made on imageUrl.
                 * So, image div is removed if imageUrl is 'null' and the title div is moved left by adding extra css.
                 * To remove the section we need to convert string of html into DOM elements using jQuery. If we try to convert the string of html
                 * to DOM elements before passing it to Mustache.js using jQuery then jQuery parses the string to create DOM elements, in this process
                 * it tries to fetch the image from <img> tag src which is {{imageUrl}} and because of this, image div is removed after replacing the
                 * values in Mustache template.
                */
                jQuery('#product-details-container').html(productDetailsHtml);
                jQuery('#product-details-bottom-sheet').html(productDetailsHtml);
                this.applyTemplate(jQuery('#topup-and-pay-product-details-section'),"topup-and-pay-product-details" , productTemplateData.productDetailsList[0]);
            }
            if(priceSummaryTotal && priceSummaryTotal.deductions && priceSummaryTotal.deductions.length == 0){
                jQuery("#promo-sleeve").addClass("aok-hidden");
                jQuery("#promo-sleeve-bottom-sheet").addClass("aok-hidden");
            }
            if(priceSummaryTotal && priceSummaryTotal.orderTotal && priceSummaryTotal.orderTotal.copPrice) {
                jQuery('#copDisclaimer').removeClass("aok-hidden");
            } else {
                jQuery('#copDisclaimer').addClass("aok-hidden");
            }
        },

        _formatData : function (data) {
            var formattedData = { 'data' : [] };
            for (var prop in data) {
                if (data.hasOwnProperty(prop)) {
                    formattedData['data'].push({
                      'key' : prop,
                      'value' : data[prop]
                    });
                }
            }
            return formattedData['data'];
        },

        _updateOrdertotal : function(priceSummary) {
            var total = 0;
            var totalCOP = 0;
            var unit;
            var unitCOP;
            var index;
            var actualPrice = 0;
            var actualPriceCOP = 0;
            var copEnabled = jQuery('#currencyOfPreferenceEnabled').data("value");
            if(priceSummary.quantity !== null) {
                if (priceSummary.itemPrice) {
                    for (var index = 0; index < priceSummary.itemPrice.length; index++) {
                        var value = priceSummary.itemPrice[index].price.value;
                        unit = priceSummary.itemPrice[index].price.unit;
                        total = total + parseFloat(value)*parseInt(priceSummary.quantity.value);
                        if(copEnabled && priceSummary.itemPrice[index].copPrice) {
                            var copValue = priceSummary.itemPrice[index].copPrice.value;
                            unitCOP = jQuery('#currencyOfPreferenceUnit').data("value");
                            totalCOP = totalCOP + parseFloat(copValue) * parseInt(priceSummary.quantity.value);
                            priceSummary.itemPrice[index].copPrice.displayString = currencyManager.format(copValue, unitCOP);
                        }
                    }
                }
            }
            else {
                if (priceSummary.itemPrice) {
                    for (var index = 0; index < (priceSummary.itemPrice.length); index++) {
                        if (priceSummary.itemPrice[index].excludeFromCalculation) {
                            continue;
                        }
                        var value = priceSummary.itemPrice[index].price.value;
                        unit = priceSummary.itemPrice[index].price.unit;
                        total = total + value;
                        if(copEnabled && priceSummary.itemPrice[index].copPrice) {
                            var copValue = priceSummary.itemPrice[index].copPrice.value;
                            unitCOP = jQuery('#currencyOfPreferenceUnit').data("value");
                            totalCOP = totalCOP + copValue;
                            priceSummary.itemPrice[index].copPrice.displayString = currencyManager.format(copValue, unitCOP);
                        }
                    }
                }
            }
            if(priceSummary.taxAmount && priceSummary.taxAmount.price) {
                var taxValue = priceSummary.taxAmount.price.value;
                total = total + parseFloat(taxValue);
                if(copEnabled && priceSummary.taxAmount.copPrice) {
                    var taxValueCOP = priceSummary.taxAmount.copPrice.value;
                    totalCOP = totalCOP + parseFloat(taxValueCOP);
                    priceSummary.taxAmount.copPrice.displayString = currencyManager.format(taxValueCOP, priceSummary.taxAmount.copPrice.unit);
                }
            }
            if (priceSummary.deductions) {
                for (var index = 0; index < priceSummary.deductions.length; index++) {
                    var value = priceSummary.deductions[index].price.value;
                    if (copEnabled && priceSummary.deductions[index].copPrice) {
                        var valueCOP = priceSummary.deductions[index].copPrice.value;
                        unitCOP = priceSummary.deductions[index].copPrice.unit;
                    }
                    unit = priceSummary.deductions[index].price.unit;
                    if (total-value < 0) {
                        value = total;
                        if(copEnabled) {
                            valueCOP = totalCOP;
                        }
                        priceSummary.deductions[index].price.value = total;
                        priceSummary.deductions[index].price.displayString = currencyManager.format(value, unit);
                    }
                    total = total - value;
                    totalCOP = totalCOP - valueCOP;
                    if(total == 0){
                        priceSummary.deductions.splice(index+1, priceSummary.deductions.length-index-1);
                    }
                }
            }

            total = parseFloat(total.toFixed(2));
            totalCOP = parseFloat(totalCOP.toFixed(2));
            actualPrice = total;
            actualPriceCOP = totalCOP;

            if (priceSummary.contributions) {
                for (var index = 0; index < priceSummary.contributions.length; index++) {
                    var value = priceSummary.contributions[index].price.value;
                    unit = priceSummary.contributions[index].price.unit;
                    total = total - value;
                    if(copEnabled && priceSummary.contributions[index].copPrice) {
                        var valueCOP = priceSummary.contributions[index].copPrice.value;
                        totalCOP = totalCOP - valueCOP;
                    }
                }
            }

            if (priceSummary.testCharge) {
                total = priceSummary.testCharge.value;
                if(copEnabled) {
                    totalCOP = total * jQuery('#currencyOfPreferenceValue').data("value");
                    totalCOP = parseFloat(totalCOP.toFixed(2));
                }
            }

            if (priceSummary.audibleOur && priceSummary.audibleOur.price) {
                total = total + priceSummary.audibleOur.price.value;
                if (copEnabled && priceSummary.audibleOur.copPrice) {
                    totalCOP = totalCOP + priceSummary.audibleOur.copPrice.value;
                    priceSummary.audibleOur.copPrice.displayString = currencyManager.format(priceSummary.audibleOur.copPrice.value,
                     priceSummary.audibleOur.copPrice.unit);
                }
            }

            if (priceSummary.orderTotalBeforeTax && priceSummary.orderTotalBeforeTax.copPrice) {
                if (copEnabled) {
                    priceSummary.orderTotalBeforeTax.copPrice.displayString = currencyManager.format(priceSummary.orderTotalBeforeTax.copPrice.value,
                    priceSummary.orderTotalBeforeTax.copPrice.unit);
                }
            }

            if (priceSummary.orderTotal && priceSummary.orderTotal.price) {
                priceSummary.orderTotal.price.value = total;
                priceSummary.orderTotal.price.unit = unit;

                if(copEnabled && priceSummary.orderTotal.copPrice) {
                    priceSummary.orderTotal.copPrice.value = totalCOP;
                    priceSummary.orderTotal.copPrice.unit = unitCOP;
                }
                if(DPPUITreatments.getTreatment('bottomSheetTreatment') && total==0 && !priceSummary.showSubtotal){
                    priceSummary.orderTotal.price.displayString = currencyManager.format(actualPrice, unit);
                    if(copEnabled && priceSummary.orderTotal.copPrice){
                        priceSummary.orderTotal.copPrice.displayString = currencyManager.format(actualPriceCOP, unitCOP);
                    }
                    if(priceSummary.deductions.length == 0){
                        jQuery("#smartPSP-price-summary").addClass("aok-hidden");
                    }
                } else {
                    priceSummary.orderTotal.price.displayString = currencyManager.format(total, unit);
                    if(copEnabled && priceSummary.orderTotal.copPrice){
                        priceSummary.orderTotal.copPrice.displayString = currencyManager.format(totalCOP, unitCOP);
                    }
                }
            }
            return priceSummary;
        }
    });
      P.declare("OrderSummaryHandler", OrderSummaryHandler);
});
</script><script>
P.when('Handler','jQuery','mustache', 'ready').execute(function(Handler, jQuery, Mustache) {
       var CheckoutOrderTotalHandler = Handler.extend({
        init : function() {
            this.registerCallback("OrderTotal:updated", this.updateOrderTotal.bind(this));
        },

        updateOrderTotal : function(data) {
            var htmlCheckout = Mustache.to_html( jQuery('#order-total-tmpl-checkout').html(), data);
            jQuery('#order-total-checkout').html(htmlCheckout);
        },
     });
    var checkoutOrderTotalHandler = new CheckoutOrderTotalHandler();
    P.declare("checkoutOrderTotalHandler", checkoutOrderTotalHandler);
});
</script><script>
// CSM Counter for TaxExemptionPopover
P.when('A', 'CSM', 'ready').execute(function(A, CSM) {
    var ue = window.ue;
    A.on("a:popover:show:taxExemptionPopover", function(){
        if (ue && ue.count){
            CSM.log('taxExemptionPopoverShow', 1 + (ue.count('taxExemptionPopoverShow') || 0));
        }
    });

    A.on("a:popover:show:ebookGiftingPopover", function(){
        if (ue && ue.count){
            CSM.log('ebookGiftingPopoverShow', 1 + (ue.count('ebookGiftingPopoverShow') || 0));
        }
    });
});
</script><div id="fetchOrderComponentsUrl" data-fetch-order-components-url="/dppui/fetch-order-components/ref=dppui_kswag_checkout_fo?clientId=kswag&amp;variant=&amp;view=desktop&amp;oL=&amp;MarketplaceID=A21TJRUUN4KGV&amp;businessProfile&amp;_token_v2=hE6BUQ%252B8957WyxOu8zGcX%252FdStaC%252FjKipoDfnRKoc0IvTAAAAAGPHi5EAAAAB" class="a-section showable aok-hidden"></div><div class="a-box"><div class="a-box-inner"><script>
P.when('jQuery', 'ready').register('tokenizeGiftInfoHelper', function(jQuery, errorHandler) {

    /**
     * Tokenize Gift Info in DPPUI layer
     * Input param:-
     * 1) giftMessage
     * 2) giftSender
     * 3) giftRecipient
     *
     * @param giftingFormContainer - Gift form container for ebook gifting.
     * @returns:-
     * 1) Gift container with tokenized values.
     * 2) Tokenization status.
     */
    function tokenizeGiftingElements(giftingFormContainer) {
        var self = this;
        var container, processed, giftRecipient, message, sender;

        /*
         * Due to secondary view for BFO AW there is different textArea ID for AW and RW BFO view.
         */
        if (giftingFormContainer.find("#message-input-box") && giftingFormContainer.find("#message-input-box")[0]) {
            message = giftingFormContainer.find("#message-input-box")[0].value;
        } else if (giftingFormContainer.find("#message-input-box-hidden") && giftingFormContainer.find("#message-input-box-hidden")[0]) {
            message = giftingFormContainer.find("#message-input-box-hidden")[0].value;
        }

        /*
         * Due to secondary view for BFO AW there is different input ID for AW and RW BFO view.
         */
        if (giftingFormContainer.find("#gifting-form-sender") && giftingFormContainer.find("#gifting-form-sender")[0]) {
            sender = giftingFormContainer.find("#gifting-form-sender")[0].value;
        } else if (giftingFormContainer.find("#sender-from-input-hidden") && giftingFormContainer.find("#sender-from-input-hidden")[0]) {
            sender = giftingFormContainer.find("#sender-from-input-hidden")[0].value;
        }
        /*
         * Check for Identifying whether form contains single email sleeve or multi email sleeve.
         * Multi Email sleeve doesn't require email tokenization as emails are stored in address service using contactGroupId.
         */
        if (giftingFormContainer.find("#giftingRecipient") && giftingFormContainer.find("#giftingRecipient")[0]) {
            giftRecipient = giftingFormContainer.find("#giftingRecipient")[0].value;
        }
        var tokenizeURL = giftingFormContainer.data("tokenize-url");

        var ajaxData = {
            'giftMessage' : message,
            'giftSender' : sender,
            'giftRecipient' : giftRecipient
        };

        var ajaxRequestData = {
            url: tokenizeURL,
            data: JSON.stringify(ajaxData),
            type: 'POST',
            contentType: 'application/json',
            cache: false,
            async: false
        };

        var ajax = jQuery.ajax(ajaxRequestData);
        ajax.done(function(response) {
            if (giftingFormContainer.find("#message-input-box") && giftingFormContainer.find("#message-input-box")[0]) {
                giftingFormContainer.find("#message-input-box")[0].value = response.tokenizedGiftMessage;
            } else if (giftingFormContainer.find("#message-input-box-hidden") && giftingFormContainer.find("#message-input-box-hidden")[0]) {
                giftingFormContainer.find("#message-input-box-hidden")[0].value = response.tokenizedGiftMessage;
            }

            if (giftingFormContainer.find("#gifting-form-sender") && giftingFormContainer.find("#gifting-form-sender")[0]) {
                giftingFormContainer.find("#gifting-form-sender")[0].value = response.tokenizedGiftSenderName;
            } else if (giftingFormContainer.find("#sender-from-input-hidden") && giftingFormContainer.find("#sender-from-input-hidden")[0]) {
                giftingFormContainer.find("#sender-from-input-hidden")[0].value = response.tokenizedGiftSenderName;
            }
            /*
             * Check for Identifying whether form contains single email sleeve or multi email sleeve.
             * Multi Email sleeve doesn't require email tokenization as emails are stored in address service using contactGroupId.
             */
            if (giftingFormContainer.find("#giftingRecipient") && giftingFormContainer.find("#giftingRecipient")[0]) {
                giftingFormContainer.find("#giftingRecipient")[0].value = response.tokenizedGiftRecipientEmail;
            }
            /*
             * Check for Identifying whether form contains single email sleeve or multi email sleeve.
             * Multi Email sleeve doesn't require recipient nickname tokenization.
             */
            if (giftingFormContainer.find("#gifting-recipient-nickname") && giftingFormContainer.find("#gifting-recipient-nickname")[0]) {
                giftingFormContainer.find("#gifting-recipient-nickname")[0].value = response.tokenizedGiftRecipientNicknameToken;
            }
            self.container = giftingFormContainer;
            self.processed = true;
        });

        ajax.fail(function(response) {
            self.container = giftingFormContainer;
            self.processed = false;
        });

        return {
            container: self.container,
            processed: self.processed
        };
    }

    return {
        tokenizeGiftingElements : tokenizeGiftingElements
    };
});
</script><script type="text/javascript">
        P.when('jQuery','Handler', 'exitHandlerFormAppender', 'multi-email-control', 'tokenizeGiftInfoHelper', 'errorHandler', 'ready').execute(function(jQuery,Handler, exitHandlerFormAppender, multiEmailControl, tokenizeGiftInfoHelper, errorHandler){
    var exitHandlerForm = jQuery('#exit-handler-action-form');
    var ExitHandlerEventAction = Handler.extend({
        init : function() {
            this.registerHandlerMethod("ExitHandler:action", this.action.bind(this));
        },

        action : function(options) {
            exitHandlerFormAppender.trigger("ExitHandler:UpdateExitHandlerForm", {"options": options, "exitHandlerForm": exitHandlerForm});
            var appendToFormResult = this.appendAdditionalElementsToForm();
            if (appendToFormResult && appendToFormResult.shouldSubmitForm) {
                exitHandlerForm.submit();
            }
        },

        appendAdditionalElementsToForm : function() {
            var container = jQuery('#quantitySelectionContainer');
            if(container.length > 0) {
                exitHandlerFormAppender.trigger("ExitHandler:AppendQuantityToForm", {"container": container, "exitHandlerForm": exitHandlerForm});
            }

            // If there are no emails specified, no need to append custom messaging to the form as it won't be used.
            var mecStats = multiEmailControl.getStats();
            if (mecStats && mecStats.emailCount === 0) {
                return {
                    shouldSubmitForm: true
                };
            }

            var container = jQuery('#gifting-form');
            if(container.length > 0) {
                if (container.data("should-tokenize-gift-info")) {
                    var tokenizedGiftInfoResult = tokenizeGiftInfoHelper.tokenizeGiftingElements(container.clone());
                    if (tokenizedGiftInfoResult && tokenizedGiftInfoResult.processed) {
                        container = tokenizedGiftInfoResult.container;
                    } else {
                        errorHandler.showError(errorHandler.ORDER_ERROR_REFRESH);
                        this.process("Action:disable", {showPopoverText : false});
                        return {
                            shouldSubmitForm: false
                        };
                    }
                }
                exitHandlerFormAppender.trigger("ExitHandler:AppendGiftingElementsToForm", {"container": container, "exitHandlerForm": exitHandlerForm});
            }
            return {
                shouldSubmitForm: true
            };
        },
     });
    var exitHandlerEventAction = new ExitHandlerEventAction();
    P.declare("exitHandlerEventAction", exitHandlerEventAction);
});
</script>
    <script>

P.when('jQuery','Handler','ready').execute(function(jQuery,Handler){
    var ExitHandlerFormAppender = Handler.extend({

        init : function() {
            this.registerHandlerMethod("ExitHandler:AppendQuantityToForm", this.appendQuantityToForm.bind(this));
            this.registerHandlerMethod("ExitHandler:AppendGiftingElementsToForm", this.appendGiftingParametersToForm.bind(this));
            this.registerHandlerMethod("ExitHandler:UpdateExitHandlerForm", this.updateExitHandlerForm.bind(this));
        },

        updateExitHandlerForm : function(updateFormParameters) {
            var params;
            var self = this;
            var options = updateFormParameters.options;
            var exitHandlerForm = updateFormParameters.exitHandlerForm;
            if(options) {
                params = (options.params)? options.params : options;
                var actionUrl = options.actionUrl;
                if (actionUrl) {
                    params.exitPath = exitHandlerForm.attr('action');
                    exitHandlerForm.attr('action', actionUrl);
                }
            }
            if(params) {
                jQuery.each(params, function(key, value) {
                    var formInput = exitHandlerForm.find("input[name='" + key + "']");
                    if((key == "paymentPlanId" || key == "paymentContractId") && value == null ) {
                        return;
                    }
                    if (formInput.length) {
                        formInput.val(value);
                    } else {
                        self.addElementToForm(exitHandlerForm, key, value);
                    }
                });
            }

        },

        addElementToForm : function(exitHandlerForm, elementName, elementValue) {
            jQuery('<input>').attr({
                'type': 'hidden',
                'name':  elementName,
                'value': elementValue
            }).appendTo(exitHandlerForm);
        },
        appendMultipleElementsToForm : function(inputElements, exitHandlerForm, elementNameMapping) {
            var formElement;
            var self = this;
            inputElements.each(function() {
                var inputElement = jQuery(this);
                if(inputElement[0].value) {
                    formElement = inputElement[0];
                } else {
                    var elementType = inputElement.data("element-type");
                    formElement = inputElement[0].getElementsByTagName(elementType)[0];
                }
                if(formElement) {
                    var contentType = inputElement.data("content-type");
                    if(contentType == "deliveryDate") {
                    //TO-DO : move this out of here : https://issues.amazon.com/issues/DBSTasks-3410
                        self.setInstantOrder(formElement);
                    }
                    if((contentType == "giftingMessage" || contentType == "sender") && !(formElement.value)) {
                        return;
                    }
                    self.addElementToForm(exitHandlerForm, inputElement.data(elementNameMapping), formElement.value);
                }
           });
         },

        appendQuantityToForm : function(quantityAppenderParameters) {
            var exitHandlerForm = quantityAppenderParameters.exitHandlerForm;
            var quantityValue = exitHandlerForm.find("input[name='quantity']");
            var container = quantityAppenderParameters.container;
            var quantity = this.fetchUpdatedQuantity(container);
            this.addElementToForm(exitHandlerForm, container.data("bifrost-mapping"), quantity);
        },

        fetchUpdatedQuantity : function(quantityContainer) {
            var quantityText = quantityContainer.find('#quantityText');
            return quantityText.val();
        },

        setInstantOrder : function(formElement) {
            if (formElement.value == "" || formElement.value.toLowerCase() == "now") {
                jQuery("#gifting-form").find("#gifting-instant-order")[0].value = "true";
                formElement.value = new Date().toISOString();
            }
        },

        appendGiftingParametersToForm : function(giftingAppenderParameters) {
            var giftingFormElements = giftingAppenderParameters.container.find(".giftingFormElement");
            this.appendMultipleElementsToForm(giftingFormElements, giftingAppenderParameters.exitHandlerForm, "gifting-mapping");
        },
    });
    var exitHandlerFormAppender = new ExitHandlerFormAppender();
    P.declare("exitHandlerFormAppender", exitHandlerFormAppender);

});

<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://issues.amazon.com/issues/DBSTasks-3410" title="Open URL: https://issues.amazon.com/issues/DBSTasks-3410 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://issues.amazon.com/issues/DBSTasks-3410" title="Open URL in Popup: https://issues.amazon.com/issues/DBSTasks-3410 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script><form id="exit-handler-action-form" name="exitHandlerAction" action="https://www.amazon.in/api/bifrost/acquisitions/v1/asins/B07VRS84D1/ref=dppui_kswag_checkout?_token_v2=hE6BUQ%252B8957WyxOu8zGcX%252FdStaC%252FjKipoDfnRKoc0IvTAAAAAGPHi5EAAAAB" method="POST" exitservice="">
    <input type="hidden" name="preview" value="0">
    <input type="hidden" name="displayedPrice" value="1296.75">
    <input type="hidden" name="clientId" value="kswag">
    <input type="hidden" name="quantity" value="0">
    <input type="hidden" name="csrf" value="g+olBZccGmXbcWfmUm1pXbsDF1qr1N6g8tBgV2Fy88L0AAAADAAAAABjx4uRcmF3AAAAABVX8CwXqz4nuL9RKX///w==">
    <input type="hidden" name="destinationUrl" value="/api/bifrost/acquisitions/v1/asins/B07VRS84D1?_encoding=UTF8&amp;amp;amp;amp;x-client-id=ebook-dp-others&amp;amp;amp;amp;csrf=g%2BolBZccGmXbcWfmUm1pXbsDF1qr1N6g8tBgV2Fy88L0AAAADAAAAABjx4uRcmF3AAAAABVX8CwXqz4nuL9RKX%2F%2F%2Fw%3D%3D&amp;amp;amp;amp;items%5B0%5D.action.displayedPrice.value=1296.75&amp;amp;amp;amp;items%5B0%5D.action.displayedPrice.currency=INR&amp;amp;amp;amp;items%5B0%5D.action.actionType=Gift">
    <input type="hidden" name="cor.0" value="IN">
    <input type="hidden" name="items[0].giftInfo.giftSentToSelf" value="0">
    <input type="hidden" name="items[0].action.actionType" value="Gift">
    <input type="hidden" name="displayedPriceCurrency" value="INR">
    <input type="hidden" name="x-client-id" value="ebook-dp-others">
    <input type="hidden" name="_encoding" value="UTF8">
    <input type="hidden" name="items[0].action.displayedPrice.currency" value="INR">
    <input type="hidden" name="quantityLimit" value="1000">
    <input type="hidden" name="items[0].action.displayedPrice.value" value="1296.75">
    <input type="hidden" name="asin" value="B07VRS84D1">
    <input type="hidden" name="delivery.contactGroup.groupId" value="b916fbe8-9fff-493d-b1ba-c65e09362943">
    <input type="hidden" name="payment.mode" value="checkout">
    <input type="hidden" name="collectShippingAddress" value="1">
    </form>
<script>
P.when('jQuery', 'confirmOrderHandler', 'DPPUIConstants', 'DPPUITreatments', 'ready').register("action", function(jQuery, confirmOrderHandler, DPPUIConstants, DPPUITreatments) {
    var buttonEnableTime, buttonClickTime;
    var actionLabel;
    function init() {
        actionLabel = jQuery("#place-your-order").text();
        confirmOrderHandler.registerCallback("Action:enable",enable);
        confirmOrderHandler.registerCallback("Action:changeDisplayLabel",changeSecondaryLabelWithDisplayLabel);
        confirmOrderHandler.registerCallback("Action:disable",disable);
        confirmOrderHandler.registerCallback("Action:UpdateRoles",updateRoles);
        confirmOrderHandler.registerDataSource("Action:GetData",getActionData);
        confirmOrderHandler.registerDataSource("Action:GetPreferenceMessage",getPreferenceMessage);
        var self = this;
        window.onorientationchange = function(event) {
            P.when('CSM', 'ready').execute(function(CSM) {
                CSM.log("OrientationChanged", 1);
            });
        }
        P.when('A', 'addCardHandler', 'CDSEvents', 'CSM', 'paymentMethodsHandler').execute(function(A, addCardHandler, CDSEvents, CSM, paymentMethodsHandler) {
            if(DPPUITreatments.getTreatment('bottomSheetTreatment') == null && (jQuery("#pay-select-view").data('bottom-sheet-treatment') == 'T1' || jQuery("#pay-select-view").data('bottom-sheet-treatment') == 'T2')) {
                DPPUITreatments.setTreatment('bottomSheetTreatment', true);
            }

            A.declarative('ContinueOrder', 'click',  function(event) {
                 triggerBottomSheet();
            });

            A.declarative('PlaceOrderWithConsent', 'click', function(event) {
                hideNudgeForConsentCollection(A);
                var selectedSection = jQuery('.box-selected');
                // Check if it is Add card Flow
                if(selectedSection != null && selectedSection.length == 0) {
                    var addCardActionData;
                    addCardActionData = addCardHandler.fetch("AddCardActionData");
                    if (!isEmptyObject(addCardActionData)){
                          selectedSection = addCardActionData.containerDiv;
                    }
                }
                var consentCheckbox = selectedSection.find('input[name="ConsentCollectionCheckbox"]');
                if (consentCheckbox != null && consentCheckbox.length > 0 ) {
                    consentCheckbox.prop('checked', true);
                }
                placeYourOrder();
            });

            A.declarative('PlaceOrderWithoutConsent', 'click', function(event) {
                hideNudgeForConsentCollection(A);
                placeYourOrder();
            });

            A.declarative('EmandatePlaceOrderWithConsent', 'click', function(event) {
                var selectedSection = jQuery('.box-selected');
                // Check if it is Add card Flow
                if(selectedSection != null && selectedSection.length == 0) {
                    var addCardActionData;
                    addCardActionData = addCardHandler.fetch("AddCardActionData");
                    if (!isEmptyObject(addCardActionData)){
                          selectedSection = addCardActionData.containerDiv;
                    }
                }
                var consentCheckbox = selectedSection.find('input[name="ConsentCollectionCheckbox"]');
                if (consentCheckbox != null && consentCheckbox.length > 0 ) {
                    consentCheckbox.prop('checked', true);
                }
                jQuery('#emandate_nudge_for_consent_bottom_sheet #emandate-place-order-without-consent').attr('disabled', true);
                jQuery('#emandate_nudge_for_consent_bottom_sheet #emandate-place-order-with-consent').attr('disabled', true);
                hideEmandateNudgeForConsentCollection(A);
                placeYourOrder();
            });

            A.declarative('EmandatePlaceOrderWithoutConsent', 'click', function(event) {
                hideEmandateNudgeForConsentCollection(A);
            });

            A.declarative('PlaceOrderWithoutResavingCard', 'click', function(event){
                var selectedSection = jQuery('.box-selected');
                var tokenExpiryNudgeData = selectedSection.find('.tokenExpiryNudgeData');
                var tokenExpiryDays = tokenExpiryNudgeData.data('tokenexpirycountdown')
                var sheetName = "nudge_for_token_expiry_bottom_sheet-" + tokenExpiryDays;
                jQuery('#do-it-later-button #place-order-without-resaving-card').attr('disabled', true);
                hideNudgeForTokenExpiry(A,sheetName);
                placeYourOrder();
            });

            A.declarative('ReEnterCard', 'click',function(event){
                var selectedSection = jQuery('.box-selected');
                var tokenExpiryNudgeData = selectedSection.find('.tokenExpiryNudgeData');
                var tokenExpiryDays = tokenExpiryNudgeData.data('tokenexpirycountdown')
                var sheetName = "nudge_for_token_expiry_bottom_sheet-" + tokenExpiryDays;
                var addCardFormContainer = jQuery('#add-new-generic-card-radio-button');
                addCardFormContainer.click();

                /*Update Add Card Form Header*/
                jQuery('#addCardHeader').addClass('aok-hidden');
                jQuery('#add-card-label').addClass('aok-hidden');
                jQuery('#resaveCardHeader').removeClass('aok-hidden');

                /* update meta tags for details to resave card */
                var paymentMethodId = selectedSection.find(".data").data('id');
                jQuery('meta[name="shouldResaveCard"]').attr('content', true);
                jQuery('meta[name="paymentMethodIdToResave"]').attr('content', paymentMethodId);

                hideNudgeForTokenExpiry(A, sheetName);
             });

            A.declarative('PlaceOrder', 'click', function(event){
                buttonClickTime = new Date().getTime();
                //Gets the metric name based on the type of Button.
                (jQuery(".log-click-to-pyo-metric").length > 0) && logTimeToClick(jQuery("#action_button_bottom").length > 0 ? "FloatingButtonClickTime" : "FixedButtonClickTime");
                var addCardActionData;
                addCardActionData = addCardHandler.fetch("AddCardActionData");
                var PYOEnableTreatment = DPPUITreatments.getTreatment('PYOEnableTreatment');
                (jQuery("#orderSummaryGrid").length) && logTimeToClick((PYOEnableTreatment && event.$target.closest('#order-confirmation').hasClass("fixed-top"))
                    ? "FloatingOrderSummaryClickTime" : "FixedOrderSummaryClickTime");

                var selectedSection;

                if (!isEmptyObject(addCardActionData)) {
                    var selectedForm = addCardActionData.containerDiv;
                    if (selectedForm.length && PYOEnableTreatment) {
                        event.$target.closest("#place-your-order").removeClass("a-button-focus");
                        logPYOAddCard();
                        selectedSection = selectedForm;
                    }
                } else {
                    var modalName = event.action + event.type;
                    if (modalName) {
                        confirmOrderHandler.broadcast(CDSEvents.ADD_EVENT_DATA,
                            { eventName : DPPUIConstants.EventTypes.PLACE_ORDER,
                              result : modalName });
                    }
                    CSM.log("PlaceYourOrderClicked", 1);
                    selectedSection = jQuery('.box-selected');
                }
                var showNudgeForConsentCollection = shouldinvokeNudgeForConsentCollection(selectedSection);
                if(showNudgeForConsentCollection === true)
                {
                    invokeNudgeForConsentCollection();
                } else if (shouldInvokeNudgeForTokenExpiry(selectedSection)) {
                    invokeNudgeForTokenExpiry(selectedSection);
                }
                else {
                    placeYourOrder();
                }
            });

            // Refactored existing PYO callback function logic to support Nudge Feature For COFT
            function placeYourOrder() {
                console.log("Refactor PYO callback invoked");
                var addCardActionData;
                addCardActionData = addCardHandler.fetch("AddCardActionData");
                var PYOEnableTreatment = DPPUITreatments.getTreatment('PYOEnableTreatment');
                if (!isEmptyObject(addCardActionData)) {
                    var selectedForm = addCardActionData.containerDiv;
                    if (selectedForm.length && PYOEnableTreatment) {
                        logCSMMetricsForCardFlow("AddCardFlow");
                        confirmOrderHandler.broadcast(DPPUIConstants.EventTypes.PAYMENT_METHOD_ADDED, {addCardActionData: addCardActionData, pyoenabled: PYOEnableTreatment});
                    }
                } else {
                    logCSMMetricsForCardFlow("SavedCardFlow");
                    confirmOrderHandler.trigger("Action:performed", new ActionDescriptor(undefined, "Action", jQuery('#place-order-button').data('action-roles')));
                }
            }

            function shouldInvokeNudgeForTokenExpiry(selectedSection){
                var nudgeCustomerForTokenExpiryLaunched = jQuery('#place-order-button').data('nudge-customer-for-token-expiry-launched');
                var tokenExpiryNudgeData = selectedSection.find('.tokenExpiryNudgeData');
                var countdown = tokenExpiryNudgeData.data('tokenexpirycountdown');

                return (typeof nudgeCustomerForTokenExpiryLaunched !== "undefined" && nudgeCustomerForTokenExpiryLaunched === true)
                && (typeof countdown !== "undefined" && countdown != '-1');
            }

            function shouldinvokeNudgeForConsentCollection(selectedSection) {
                //Nudge Pop Up should only be shown when consent is not provided for non tokenized card (consentSelectionStatus is false).
                //Nudge shouldn't be shown for :
                //1. For payment instruments other than cards, cards ineligible for tokenization for which consentSelectionStatus is empty
                //2. Card for which consent has been already provided i.e. consentSelectionStatus is true

                var nudgeCustomerForConsentLaunched = jQuery('#place-order-button').data('nudge-customer-for-consent-launched');
                console.log("Nudge Customer For Consent Launched : " + nudgeCustomerForConsentLaunched);

                var consentSelectionStatus = "";
                var consentCheckbox = selectedSection.find('input[name="ConsentCollectionCheckbox"]');
                if (consentCheckbox != null && consentCheckbox.length > 0 && consentCheckbox.prop('checked')) {
                    consentSelectionStatus = true;
                } else if (consentCheckbox != null && consentCheckbox.length > 0
                        && !jQuery(selectedSection.find("#consent-collection-section")).hasClass('aok-hidden')) {
                    consentSelectionStatus = false;
                }

                return (typeof nudgeCustomerForConsentLaunched !== "undefined"
                    && nudgeCustomerForConsentLaunched === true && consentSelectionStatus === false);
            }

            function invokeNudgeForConsentCollection() {
                var eligibilityCriteria = paymentMethodsHandler.fetch("PaymentMethod:GetEligibilityCriteria");
                var emandateNudgeCustomerForConsentLaunched = jQuery('#place-order-button').data('emandate-nudge-customer-for-consent-launched');
                if(typeof emandateNudgeCustomerForConsentLaunched !== "undefined"
                    && emandateNudgeCustomerForConsentLaunched === true && eligibilityCriteria != null
                    && eligibilityCriteria.preferenceEligible) {
                    P.when('a-modal', 'ready').execute(function(modal) {
                        var modal = modal.get(A.$("#emandate-nudge-customer-for-consent-popup"));
                        if(modal != null) {
                            modal.lock(20).show();
                        }
                    });
                    if (jQuery.find("#emandate-nudge-customer-for-consent-bottomsheet").length != 0) {
                        P.when('A', 'a-sheet').execute('emandate-nudge-customer-for-consent-bottomsheet', function (A, sheet) {
                            var sheetInstance = sheet.get('emandate-nudge-customer-for-consent-bottomsheet');
                            if(sheetInstance != null) {
                                sheetInstance.show();
                            } else {
                                var actionParams = {
                                    name: 'emandate-nudge-customer-for-consent-bottomsheet',
                                    preloadDomId: 'emandate_nudge_for_consent_bottom_sheet',
                                    closeType: 'icon'
                                }
                                sheet.create(actionParams).show();
                            }

                        });
                    }
                } else {
                    if (jQuery.find("#nudge-customer-for-consent-bottomsheet").length != 0) {
                        P.when('A', 'a-sheet').execute('nudge-customer-for-consent-bottomsheet', function (A, sheet) {
                            var sheetInstance = sheet.get('nudge-customer-for-consent-bottomsheet');
                            if(sheetInstance != null) {
                                sheetInstance.show();
                            } else {
                                var actionParams = {
                                    name: 'nudge-customer-for-consent-bottomsheet',
                                    preloadDomId: 'nudge_for_consent_bottom_sheet',
                                    closeType: 'icon'
                                }
                                sheet.create(actionParams).show();
                            }
                        });
                    }
                    P.when('a-modal', 'ready').execute(function(modal) {
                        var modal = modal.get(A.$("#nudge-customer-for-consent-popup"));
                        if(modal != null) {
                            modal.lock(20).show();
                        }
                    });
                }
            }

            function invokeNudgeForTokenExpiry(selectedSection){
                var tokenExpiryNudgeData = selectedSection.find('.tokenExpiryNudgeData');
                var header = tokenExpiryNudgeData.data('header');
                var inlineContent = tokenExpiryNudgeData.data('content');
                var tokenExpiryDays = tokenExpiryNudgeData.data('tokenexpirycountdown')
                var sheetName = "nudge_for_token_expiry_bottom_sheet-" + tokenExpiryDays;

                showPopupForTokenExpiry(header,inlineContent);
                showBottomSheetForTokenExpiry(sheetName,header,inlineContent);
            }

            function showBottomSheetForTokenExpiry(sheetName, sheetHeader, sheetContent){
                if (jQuery.find("#nudge-customer-for-token-expiry-bottomsheet").length != 0){
                    P.when('A', 'a-sheet').execute(sheetName, function (A, sheet) {
                        A.on('a:sheet:beforeShow:' + sheetName, function(event){
                            jQuery('.tokenExpirySheetHeader').text(sheetHeader)
                            jQuery('.tokenExpirySheetContent').text(sheetContent)
                         })
                        var actionParams = {
                            name: sheetName,
                            preloadDomId: 'nudge_for_token_expiry_bottom_sheet',
                            closeType: 'icon'
                        }
                        sheet.create(actionParams).show();
                    })
                }
            }

            function showPopupForTokenExpiry(header, inlineContent){
                P.when('a-modal', 'ready').execute(function(modal) {
                    var modal = modal.get(A.$("#nudge-customer-for-token-expiry-popup"));
                    if(modal != null) {
                        modal.update({
                            header: header,
                            inlineContent: inlineContent
                        })
                        modal.lock(20).show();
                    }
                });
            }

            A.declarative('updateNowCard', 'click',  function(event) {
                var addCardFormContainer = jQuery('#add-new-generic-card-radio-button');
                addCardFormContainer.click();

                /* Update Add Card Form heading */
                jQuery('#addCardHeader').addClass('aok-hidden');
                jQuery('#add-card-label').addClass('aok-hidden');
                jQuery('#resaveCardHeader').removeClass('aok-hidden');
                /* Scroll till Add Card Form */
                jQuery('#resaveCardHeader').get(0).scrollIntoView();

                /* update meta tags for details to resave card */
                var paymentMethodId = jQuery(event.$event.target.closest('.paymentInstrument')).find(".data").data('id');
                jQuery('meta[name="shouldResaveCard"]').attr('content', true);
                jQuery('meta[name="paymentMethodIdToResave"]').attr('content', paymentMethodId);

            });
        });
    }


    function hideNudgeForConsentCollection(A) {
        jQuery('#nudge_for_consent_bottom_sheet #place-order-without-consent').attr('disabled', true);
        jQuery('#nudge_for_consent_bottom_sheet #place-order-with-consent').attr('disabled', true);
        P.when('a-sheet', 'CSM', 'ready').execute(function (sheet, CSM) {
            var sheetInstance = sheet.get('nudge-customer-for-consent-bottomsheet');
            if (sheetInstance != null) {
                try {
                    sheetInstance.hide();
                } catch (err) {
                    CSM.log('COFTBottomSheetInstanceHideError', 1);
                }
                CSM.log('COFTBottomSheetButtonClicked', 1);
            }
        });
        P.when('a-modal', 'ready').execute(function(modal) {
            var modal = modal.get(A.$("#nudge-customer-for-consent-popup"));
            if(modal != null) {
                modal.unlock(20).hide();
            }
        });
    }

    function hideEmandateNudgeForConsentCollection(A) {
        P.when('a-sheet', 'CSM', 'ready').execute(function (sheet, CSM) {
            var sheetInstance = sheet.get('emandate-nudge-customer-for-consent-bottomsheet');
            if (sheetInstance != null) {
                try {
                    sheetInstance.hide();
                } catch (err) {
                    CSM.log('COFTEmandateBottomSheetInstanceHideError', 1);
                }
                CSM.log('COFTEmandateBottomSheetButtonClicked', 1);
            }
        });
        P.when('a-modal', 'ready').execute(function(modal) {
            var modal = modal.get(A.$("#emandate-nudge-customer-for-consent-popup"));
            if(modal != null) {
                modal.unlock(20).hide();
            }
        });
    }

    function hideNudgeForTokenExpiry(A, sheetName) {
        P.when('a-modal', 'ready').execute(function(modal) {
            var modal = modal.get(A.$("#nudge-customer-for-token-expiry-popup"));
            if(modal != null) {
                modal.unlock(20).hide();
            }
            A.on('a:popover:afterHide:nudge-customer-for-token-expiry-popup', function(event){
                jQuery('#resaveCardHeader').get(0).scrollIntoView();
            })
        });

        P.when('a-sheet', 'CSM', 'ready').execute(function (sheet, CSM) {
            A.on('a:sheet:afterHide:' + sheetName, function(event){
                jQuery('#resaveCardHeader').get(0).scrollIntoView();
            })
            var sheetInstance = sheet.get(sheetName);
            if (sheetInstance != null) {
                try {
                    sheetInstance.hide();
                } catch (err) {
                    CSM.log('TokenExpiryBottomSheetInstanceHideError', 1);
                }
                CSM.log('TokenExpiryBottomSheetButtonClicked', 1);
            }
        });
    }

    //TODO Find a better way to implement this
    function getSelectedPaymentType(selectedPaymentOptions) {
        var type = null;
        if(selectedPaymentOptions.length >= 2){
            selectedPaymentOptions.forEach(function(selectedPaymentOption) {
               if(selectedPaymentOption.type != "Balance") {
                   type = selectedPaymentOption.type;
               }
            });
        } else if(selectedPaymentOptions.length > 0) {
            type = selectedPaymentOptions[0].type;
        }

        return type;
    }

    function triggerBottomSheet() {
        P.when("paySelectHandler", "orderSummaryBottomSheetHelper", "a-button", "mustache", "CSM" , "ready").execute(function (paySelectHandler , orderSummaryBottomSheetHelper, getButtonCollection, Mustache, CSM) {

            var selectedPaymentOptions = paySelectHandler.fetch("GetSelectedPaymentOptions");
            var selectedProducts = paySelectHandler.fetch("GetSelectedProductDetails");
            var type = getSelectedPaymentType(selectedPaymentOptions);
            var orderSummaryData = confirmOrderHandler._getOrderSummaryData(selectedProducts, selectedPaymentOptions);
            confirmOrderHandler.process("OrderSummary:update",orderSummaryData);
            var button = getButtonCollection('.place-your-order');

            var proceedToPaymentStrings = jQuery("#pay-select-view").data('proceed-to-pay-strings');
            if(type != null) {
                button.text(proceedToPaymentStrings[type]);
            } else {
                button.text(jQuery("#place-order-button").data('display-label'));
            }
            button.enable();
            var selectedInstrument = {};

            //TODO Find a better way to implement selected payment instrument in Bottom Sheet

            selectedInstrument.placeHolder = jQuery("#order-summary-bottom-sheet").data('pay-with-string')

            //DisplayString - String displayed describing the paymentOption selected (Like Card Ending in /Name of the bank chosen...)
            //If no payment Options are selected - It is sufficient Promotions case - hence the display string is changed
            if(selectedPaymentOptions != null && selectedPaymentOptions.length == 0) {
                selectedInstrument.displayString = jQuery("#order-summary-bottom-sheet").data('ebook-credit-string');
            } else {
                selectedInstrument.displayString = paySelectHandler.fetch("GetDisplayStringForSelectedPaymentOptions");
            }

            selectedInstrument.isUpiSelected = (type == "UnifiedPaymentsInterface");
            if (selectedInstrument.isUpiSelected) {
                selectedInstrument.upiVerifiedText = jQuery("#upiAccountName").data('alternate-text');
            }

            applyTemplate(jQuery("#selected-payment-instrument"), "selected-instrument-tmpl", selectedInstrument);
            orderSummaryBottomSheetHelper.showBottomSheet();
            CSM.log("BottomSheetEnabled", 1);

        });
    }

    function applyTemplate ($placeHolder, templateId, data) {
        var template, html;
        template = jQuery('#' + templateId).html();
        data = data ? data : {};
        html = Mustache.to_html(template, data);
        jQuery($placeHolder).html(html);
    }

    function isEmptyObject (object) {
        for (var name in object ) {
            return false;
        }
        return true;
    }

    function logTimeToClick(metricName) {
        P.when('CSM', 'ready').execute(function(CSM) {
            var timetoClick = buttonClickTime - buttonEnableTime;
            CSM.log(metricName, timetoClick);
        });
    }

    function logPYOAddCard() {
        P.when('CSM', 'ready').execute(function(CSM) {
            CSM.log("PYOAddCardClicked", 1);
        });
    }

    function logCSMMetricsForCardFlow(metricName) {
        P.when('CSM', 'ready').execute(function(CSM) {
            var buttonElement = jQuery('#place-order-button');
            var urlParams = new URLSearchParams(window.location.search);
            var voltronClientId = urlParams.get('clientId');
            CSM.log(voltronClientId + ":" + metricName);
        });
    }

    function getActionData() {
        var buttonElement = jQuery('#place-order-button');
        var actionData = {
            'url' : buttonElement.data('url'),
            'paymentPlanId' : buttonElement.data('paymentplan-id'),
            'paymentContractId' : buttonElement.data('paymentcontract-id'),
            'preferenceType' : buttonElement.data('preference-type'),
            'acquisitionId' : buttonElement.data('acquisition-id'),
            "validateShippingAddress": buttonElement.data('validate-shipping-address'),
            "subscriptionId": buttonElement.data('subscription-id'),
            "bifrostClientId": buttonElement.data('bifrost-client-id')
        };
        return actionData;
    }

    function getPreferenceMessage() {
        return jQuery('#place-order-button').data('preference-message');
    }

    function shouldChangePYOText() {
        return (jQuery("#pay-select-view").data('smart-psp-treatment') == 'T1'
        && (jQuery("#pay-select-view").data('bottom-sheet-treatment') != 'T1'
        && jQuery("#pay-select-view").data('bottom-sheet-treatment') != 'T2'))
        || (jQuery.find("#boleto").length > 0);
    }

    function enable(data) {
        P.when("a-button", "paySelectHandler", "ready").execute(function (getButtonCollection, paySelectHandler) {
            hidePopover();
            var button = getButtonCollection('.place-your-order');
            if (DPPUITreatments.getTreatment('bottomSheetTreatment') && jQuery.find("#continue-order").length > 0) {
                 button = getButtonCollection('.continue-order');
                 jQuery("input[id^='cvv']").blur();
            }

            var selectedPaymentOptions = paySelectHandler.fetch("GetSelectedPaymentOptions");
            var type = getSelectedPaymentType(selectedPaymentOptions);

            if(shouldChangePYOText()) {
                var proceedToPaymentStrings = jQuery("#pay-select-view").data('proceed-to-pay-strings');
                if(type != null && proceedToPaymentStrings[type] != null) {
                    button.text(proceedToPaymentStrings[type]);
                } else {
                    button.text(jQuery("#place-order-button").data('display-label'));
                }
            }

            buttonEnableTime = new Date().getTime();
            if(data === undefined || (data && !data.isPyoClicked))
                button.enable();
            triggerFloatingButtonLogic();
            if(DPPUITreatments.getTreatment('bottomSheetTreatment') && jQuery.find("#continue-order").length > 0) {
                if( (type == "UnifiedPaymentsInterface" || type == "NetBanking" || type == "DebitCard") && jQuery("#pay-select-view").data('preferred-instrument-category') != type ) {
                    var productSelectorElem = jQuery.find("#product-selector");
                    if(productSelectorElem.length == 0 || (productSelectorElem.length>0 && jQuery("#product-selector").hasClass("aok-hidden"))){
                        triggerBottomSheet();
                    }
                }
            }
        });
    }

    function disable(data) {
        P.when("a-button", "ready").execute(function (getButtonCollection) {
            if(data && data.showPopoverText) {
                showPopover();
            } else if (data && data.customPopoverText) {
                showCustomPopover(data);
            } else {
                hidePopover();
            }
            var isPyoClicked = false;
            if(data && data.isPyoClicked){
                isPyoClicked = true;
            }
            var button = getButtonCollection('.place-your-order');
            if((jQuery("#pay-select-view").data('bottom-sheet-treatment') == 'T1' || jQuery("#pay-select-view").data('bottom-sheet-treatment') == 'T2') && !isPyoClicked){
                button = getButtonCollection('.continue-order');
            }
            if(jQuery("#pay-select-view").data('smart-psp-treatment') == 'T1' && (jQuery("#pay-select-view").data('bottom-sheet-treatment') != 'T1' && jQuery("#pay-select-view").data('bottom-sheet-treatment') != 'T2') && !isPyoClicked) {
                button.text(jQuery("#place-order-button").data('display-label'));
            }
            button.disable();
            if((jQuery("#pay-select-view").data('bottom-sheet-treatment') == 'T1' || jQuery("#pay-select-view").data('bottom-sheet-treatment') == 'T2') && isPyoClicked){
                button.text(jQuery("#order-summary-bottom-sheet").data('payment-processing-string'));
            }
            triggerFloatingButtonLogic();
        });
    }

    function hidePopover() {
        P.when("A", "a-popover", "ready").execute(function (A, popover) {
            var $ = A.$;
            popover.remove($("#place-your-order"));
        });
    }

    function showPopover() {
        P.when("A", "a-popover", "ready").execute(function(A, popover) {
            var $ = A.$;
            var PYOEnableTreatment = $("#add-card-form").data('pyo-add-card');
            //AW bottom place your order button.
            var $bottomPYO = $("#action_button_bottom");
            var $trigger = $("#place-your-order");
            if (!jQuery('#suppressedbankmessage').hasClass('aok-hidden')) {
                var options = {
                    "inlineContent": $("#suppressedbankmessagetext").text(),
                    "width": 400,
                    "closeButton": false,
                    "position": "triggerLeft"
                };
                popover.create($trigger, options);
            }
            // If floating place your order is present we should not show Popover.
            else if (!($bottomPYO.length > 0) || !PYOEnableTreatment) {
                var options = $("#select-instrument-popover").data("custom-popover");
                var instance = popover.create($trigger, options);
                instance.lock().show();
            }
        });
    }

    function showCustomPopover(data) {
        P.when("A", "a-popover", "ready").execute(function(A, popover) {
            var $ = A.$;
            var $trigger = $("#place-your-order");
            // If popover already exists, don't create a new one
            var instance = popover.get($trigger);
            if (!instance) {
                var options = $("#pyo-disabled-popover").data("pyo-disabled-popover");
                instance = popover.create($trigger, options);
            }

            // If popover is not Active or should be refreshed, update and show
            if (!instance.isActive() || data.refreshCustomPopover) {
                instance.update({"content": data.customPopoverText}).lock().show();
            }
        });
    }

    function changeSecondaryLabelWithDisplayLabel() {
        P.when("a-button", "ready").execute(function (getButtonCollection) {
            var button = getButtonCollection('.place-your-order');
                button.text(getDisplayLabel());
        });
    }

    function triggerFloatingButtonLogic() {
        P.when("FloatingPYOHelper", "ready").execute(function (FloatingPYOHelper) {
            FloatingPYOHelper.showOrHideFloatingButton();
        });
    }

    function getDisplayLabel() {
        return jQuery('#place-order-button').data('display-label');
    }

    function updateRoles(action) {
        jQuery("#place-order-button").data('action-roles', action.roles);
    }

    return {
        init : init
    }
});

P.when("action", 'ready').execute(function(action){
    action.init();
});


P.when( 'a-button', 'Handler',  'ready').execute(function(getButtonCollection, Handler) {

    var PYOButtonHandler = Handler.extend({
        init: function () {
            this.registerCallback("Action:hide", this.hidePlaceYourOrderButton.bind(this));
            this.registerCallback("Action:show", this.showPlaceYourOrderButton.bind(this));
        },

        showPlaceYourOrderButton: function () {
            var pyo_button_collection = getButtonCollection('.place-your-order');
            pyo_button_collection.show();
        },

        hidePlaceYourOrderButton: function () {
            var pyo_button_collection = getButtonCollection('.place-your-order');
            pyo_button_collection.hide();
        }
    });

    P.declare("PYOButtonHandler", new PYOButtonHandler());
});

</script>
<script>
// CSM Counter for PlaceOrder button
P.when('A', 'CSM', 'ready').execute(function(A, CSM) {
    var ue = window.ue;
    A.declarative('PlaceOrder', 'click', function(event){
        if (ue && ue.count){
            if (ue.count('quantityExceededAlertShow')) {
                CSM.log('quantityLimitExceededAndPlaceOrderButtonClicked', 1);
            } else {
                CSM.log('quantityLimitOkayAndPlaceOrderButtonClicked', 1);
            }
        }
    });
});

P.when('A', 'CSM', 'multi-email-control', 'simple-quantity-picker', 'ready').execute(function(A, CSM, multiEmailControl, simpleQuantityPicker) {
    var ue = window.ue;
    A.declarative('PlaceOrder', 'click', function(event){
        var stats = multiEmailControl.getStats();
        var emailCount = stats.emailCount;
        var quantity = simpleQuantityPicker.getCurrentQuantityValue();
        var mecErrorTypesCount = 0;

        if (ue && ue.count) {
            // ADL usage metrics
            if (emailCount == 0) {
                CSM.log('PlaceOrderButtonClickedNoEmails', 1);
            } else if (emailCount == quantity) {
                CSM.log('PlaceOrderButtonClickedAllEmails', 1);
            } else {
                CSM.log('PlaceOrderButtonClickedSomeEmails', 1);
            }

            CSM.log('PlaceOrderButtonClickedQuantity', quantity);

            if (ue.count('CheckoutUpdateQuantityClicked'))  {                        
                CSM.log('PlaceOrderButtonClickedCheckoutUpdateQuantityClicked', 1);
            }            

            // MEC usage metrics
            if (stats.emailParsed == true) {
                CSM.log('PlaceOrderButtonClickedAfterEmailParsed', 1);
            }
            if (stats.bulkEntry == true) {
                CSM.log('PlaceOrderButtonClickedAfterBulkEntry', 1);
            }
            if (ue.count('MECIncreaseQuantityClicked')) {  
                CSM.log('PlaceOrderButtonClickedMECIncreaseQuantityClicked', 1);
            }

            // MEC error metrics
            if (ue.count('MECDuplicateEmailError'))  {                        
                CSM.log('PlaceOrderButtonClickedMECDuplicateEmailError', 1);
                mecErrorTypesCount += 1;
            }
            if (ue.count('MECInvalidEmailError')) {  
                CSM.log('PlaceOrderButtonClickedMECInvalidEmailError', 1);
                mecErrorTypesCount += 1;
            }
            if (ue.count('MECOverQuantityError'))  {                        
                CSM.log('PlaceOrderButtonClickedMECOverQuantityError', 1);
                mecErrorTypesCount += 1;
            }
            if (ue.count('MECMaxQuantityError')) {  
                CSM.log('PlaceOrderButtonClickedMECMaxQuantityError', 1);
                mecErrorTypesCount += 1;
            }
            CSM.log('PlaceOrderButtonClickedMECErrorTypes', mecErrorTypesCount);
            CSM.log('PlaceOrderButtonClickedMECErrorOccured', mecErrorTypesCount>0 ? 1 : 0);            
        }
    });
});
</script><div class="a-section a-spacing-base"><div class="a-row"><div class="a-column a-span12 a-text-center"><span class="a-declarative" data-action="PlaceOrder" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-PlaceOrder" data-placeorder="{}" data-csa-c-id="yyac28-j9klte-31pzml-6lgy1d"><span id="place-your-order" class="a-button a-button-span12 a-button-primary place-your-order a-button-disabled"><span class="a-button-inner"><button id="place-order-button" data-acquisition-id="" data-bifrost-client-id="" data-display-label="Place your order" data-emandate-nudge-customer-for-consent-launched="" data-nudge-customer-for-consent-launched="" data-nudge-customer-for-token-expiry-launched="" data-paymentcontract-id="" data-paymentplan-id="" data-preference-message="" data-preference-type="" data-secondary-label="" data-subscription-id="" data-url="/dppui/update-payment/ref=dppui_kswag_checkout_u?clientId=kswag&amp;variant=&amp;view=desktop&amp;oL=&amp;MarketplaceID=A21TJRUUN4KGV&amp;businessProfile&amp;_token_v2=hE6BUQ%252B8957WyxOu8zGcX%252FdStaC%252FjKipoDfnRKoc0IvTAAAAAGPHi5EAAAAB" data-validate-shipping-address="false" class="a-button-text a-text-center" type="button" disabled="">Proceed to pay</button></span></span></span></div></div></div><span class="a-declarative" data-action="pyo-disabled-popover" data-csa-c-type="widget" data-csa-c-func-deps="aui-da-pyo-disabled-popover" data-pyo-disabled-popover="{&quot;focusWhenShown&quot;:&quot;false&quot;,&quot;activate&quot;:&quot;onclick&quot;,&quot;width&quot;:&quot;250&quot;,&quot;inlineContent&quot;:&quot;\u003cspan id=\&quot;pyo-popover-text\&quot; class=\&quot;a-size-small\&quot;&gt;\u003c\/span&gt;&quot;,&quot;position&quot;:&quot;triggerLeft&quot;,&quot;restoreFocusOnHide&quot;:&quot;false&quot;}" id="pyo-disabled-popover" data-csa-c-id="b5pwmj-gayuq2-c2c5n2-10je1n"></span><div class="a-row"><div class="a-column a-span12 a-text-center"><span class="a-size-small">Sold by Amazon Asia-Pacific Holdings Private Limited.</span></div></div><hr aria-hidden="true" class="a-spacing-small a-spacing-top-small a-divider-normal"><div class="a-row"><h3 class="a-text-bold">Order Summary</h3></div><div id="order-summary-container" data-enable-pyo-button-after-lazy-load="true" data-lazy-load-promotions-url="/dppui/product-details/**/ref=dppui_kswag_checkout_product-details?clientId=kswag&amp;variant=&amp;view=desktop&amp;oL=&amp;MarketplaceID=A21TJRUUN4KGV&amp;businessProfile&amp;_token_v2=hE6BUQ%252B8957WyxOu8zGcX%252FdStaC%252FjKipoDfnRKoc0IvTAAAAAGPHi5EAAAAB" data-should-lazy-load-promotions="false" class="a-section a-spacing-none a-padding-none"><div class="a-section a-spacing-none a-padding-none expanded-form"><div class="a-section a-spacing-mini a-padding-none price-summary">
        <div class="a-row a-spacing-top-micro"><div class="a-column a-span8"><span class="item-price-label line-item-label"> eBook price:  </span></div><div class="a-column a-span4 a-text-right a-span-last">
                            <span data-unit="INR" data-value="1296.75" class="item-price line-item-price"> 1,296.75 </span>
            </div></div><div class="a-row"><span class="a-color-tertiary item-price-description">   </span></div>
    
    <div class="a-row a-spacing-top-micro"><div class="a-column a-span8"><span class="item-price-label line-item-label"> Quantity:  </span></div><div class="a-column a-span4 a-text-right a-span-last"><span class="item-price line-item-price">x0 </span></div></div>
</div><hr aria-hidden="true" class="a-spacing-mini a-divider-normal"><div id="order-total-section" class="a-section a-spacing-mini a-padding-none">
    <div class="a-row a-spacing-top-micro"><div class="a-column a-span7">
                <span id="order-total-label" class="a-size-medium a-text-bold"> Order total:  </span>
        </div><div class="a-column a-span5 a-text-right a-span-last">
                    <span data-unit="INR" data-value="0" class="a-size-medium a-color-price order-total a-text-bold"> 0.00 </span>
        </div></div><div class="a-row"><span class="a-color-attainable order-total-description">   </span></div>
</div></div></div><script id="price-summary-tmpl" type="text/x-tmpl-mustache">
    {{#itemPrice}}
        <div class="a-row a-spacing-top-micro"><div class="a-column a-span8"><span class="item-price-label line-item-label"> {{{label}}}  </span></div><div class="a-column a-span4 a-text-right a-span-last">
                {{#preDiscountPrice}}
                <span data-unit="{{unit}}" data-value="{{value}}" class="item-price line-item-price"> {{{displayString}}} </span>
                {{/preDiscountPrice}}
                {{^preDiscountPrice}}
                    {{#copPrice}}
                        <span data-unit="{{unit}}" data-value="{{value}}" class="item-price"> {{{displayString}}} </span>
                    {{/copPrice}}
                    {{^copPrice}}
                        {{#price}}
                            <span data-unit="{{unit}}" data-value="{{value}}" class="item-price line-item-price"> {{{displayString}}} </span>
                        {{/price}}
                    {{/copPrice}}
                {{/preDiscountPrice}}
            </div></div><div class="a-row"><span class="a-color-tertiary item-price-description"> {{{description}}}  </span></div>
    {{/itemPrice}}
    
{{#quantity}}
    <div class="a-row a-spacing-top-micro"><div class="a-column a-span8"><span class="item-price-label line-item-label"> {{{label}}}  </span></div><div class="a-column a-span4 a-text-right a-span-last"><span class="item-price line-item-price">x{{value}} </span></div></div>
{{/quantity}}
    {{#deductions}}
        <div class="a-row a-spacing-top-micro"><div class="a-column a-span8"><span class="deduction-label line-item-label"> {{{label}}} </span></div><div class="a-column a-span4 a-text-right a-span-last">
                {{#copPrice}}
                    <span data-unit="{{unit}}" data-value="{{value}}" class="deduction line-item-price"> &minus; {{{displayString}}} </span>
                {{/copPrice}}
                {{^copPrice}}
                    {{#price}}
                        <span data-unit="{{unit}}" data-value="{{value}}" class="deduction line-item-price"> &minus; {{{displayString}}} </span>
                    {{/price}}
                {{/copPrice}}
            </div></div><div class="a-row"><span class="a-color-tertiary deduction-description"> {{{description}}}  </span></div>
    {{/deductions}}
   {{#testCharge}}
        <div class="a-row a-spacing-top-micro"><div class="a-column a-span8"><span class="item-price-label line-item-label"> {{{label}}}  </span></div><div class="a-column a-span4 a-text-right a-span-last"><span data-unit="{{unit}}" data-value="{{value}}" class="item-price line-item-price"> {{{displayString}}} </span></div></div><div class="a-row"><span class="a-color-tertiary item-price-description"> {{{description}}} </span></div>
    {{/testCharge}}
   {{#contributions}}
        <div class="a-row a-spacing-top-micro"><div class="a-column a-span8"><span class="contribution-label line-item-label"> {{{label}}} </span></div><div class="a-column a-span4 a-text-right a-span-last">
                {{#copPrice}}
                    <span data-unit="{{unit}}" data-value="{{value}}" class="contribution line-item-price"> &minus;{{{displayString}}} </span>
                {{/copPrice}}
                {{^copPrice}}
                    {{#price}}
                        <span data-unit="{{unit}}" data-value="{{value}}" class="contribution line-item-price"> &minus;{{{displayString}}} </span>
                    {{/price}}
                {{/copPrice}}
            </div></div>
    {{/contributions}}
    {{#discounts}}
        <div class="a-row a-spacing-top-micro a-color-success" style="height:1.2rem;"><div class="a-column a-span8"><span class="discount-label line-item-label"> {{{label}}} </span></div><div class="a-column a-span4 a-text-right a-span-last">
                {{#price}}
                <span data-unit="{{unit}}" data-value="{{value}}" class="discount line-item-price"> &minus;{{{displayString}}} </span>
                {{/price}}
            </div></div><div class="a-row"><span class="a-color-tertiary discount-description"> {{{description}}}  </span></div>
    {{/discounts}}
</script><script id="order-total-tmpl" type="text/x-tmpl-mustache">
    {{#orderTotal}}
    <div class="a-row a-spacing-top-micro"><div class="a-column a-span7">
            {{#testCharge}}
                <span id="order-total-label" class="a-size-medium a-text-bold"> {{{orderTotalLabel}}} </span>
            {{/testCharge}}
            {{^testCharge}}
                <span id="order-total-label" class="a-size-medium a-text-bold"> {{{label}}}  </span>
            {{/testCharge}}
        </div><div class="a-column a-span5 a-text-right a-span-last">
            {{#copPrice}}
                <span data-unit="{{unit}}" data-value="{{value}}" class="a-size-medium order-total a-text-bold"> {{{displayString}}} </span>
            {{/copPrice}}
            {{^copPrice}}
                {{#price}}
                    <span data-unit="{{unit}}" data-value="{{value}}" class="a-size-medium a-color-price order-total a-text-bold"> {{{displayString}}} </span>
                {{/price}}
            {{/copPrice}}
        </div></div><div class="a-row"><span class="a-color-attainable order-total-description"> {{{description}}}  </span></div>
    {{#copPrice}}
        <div class="a-row"><div class="a-column a-span7"><span id="order-total-cop-label" class="a-size-small a-color-price a-text-bold"> {{{secondaryDisplayString}}} </span></div><div class="a-column a-span5 a-text-right a-span-last">
                {{#price}}
                    <span data-unit="{{unit}}" data-value="{{value}}" class="a-size-small a-color-price order-total-cop a-text-bold"> {{{displayString}}} </span>
                {{/price}}
            </div></div>
    {{/copPrice}}
    {{/orderTotal}}
</script>

<script id="order-sub-total-tmpl" type="text/x-tmpl-mustache">
    {{#orderTotal}}
    <div class="a-row"><div class="a-column a-span8">
            {{#testCharge}}
                <span id="order-sub-total-label" class="a-text-bold"> {{{orderTotalLabel}}} </span>
            {{/testCharge}}
            {{^testCharge}}
                <span id="order-sub-total-label" class="a-text-bold"> {{{secondaryLabel}}}  </span>
            {{/testCharge}}
        </div><div class="a-column a-span4 a-text-right a-span-last">
            {{#price}}
            <span id="order-sub-total" data-unit="{{unit}}" data-value="{{value}}" class="a-text-bold"> {{{displayString}}} </span>
            {{/price}}
        </div></div><div class="a-row"><span class="a-color-attainable order-sub-total-description"> {{{description}}}  </span></div>
    {{/orderTotal}}
</script><script id="balance-topup-product-summary-tmpl" type="text/x-tmpl-mustache">
    {{#orderTotal}}
    <hr aria-hidden="true" class="a-spacing-mini a-spacing-top-mini a-divider-normal"/><div class="a-row"><div class="a-column a-span8"><span class="a-text-bold"> {{{label}}}  </span></div><div class="a-column a-span4 a-text-right a-span-last">
            {{#price}}
            <span data-unit="{{unit}}" data-value="{{value}}" class="a-color-price a-text-bold"> {{{displayString}}} </span>
            {{/price}}
        </div></div><div class="a-row"><span class="a-size-mini a-color-attainable"> {{{balanceAfterTransaction}}}  </span><span class="a-size-mini"> {{{description}}}  </span></div>
    {{/orderTotal}}
</script><div id="totalMismatchAlert" class="a-box a-alert-inline a-alert-inline-info aok-hidden a-spacing-small" aria-live="polite" aria-atomic="true"><div class="a-box-inner a-alert-container"><i class="a-icon a-icon-alert"></i><div class="a-alert-content"><span class="a-size-small"></span></div></div></div><div class="a-row a-spacing-mini"><span class="a-size-small">eBooks and redemption links cannot be resold.</span></div></div></div></div></div></div><div class="a-row"><div class="a-column a-span9 a-spacing-extra-large"><div id="footer-container" class="a-section"><hr aria-hidden="true" class="a-spacing-none a-divider-normal"><br><div class="a-row"><span class="a-size-small a-color-secondary">Need help? Check our <a href="https://www.amazon.in/help/kindle/booksforothers/" target="_blank">Help pages</a> or <a href="https://www.amazon.in/gp/help/contact-us/general-questions.html/" target="_blank">contact us</a>.</span></div><br><div class="a-row"><span class="a-size-small a-color-secondary">Cancel an accidental ebook order within 30 days. Only orders for eBooks that have not been redeemed within 30 days from purchase can be cancelled. Approved refunds are credited to original payment source within three to five days. See Amazon.in's <a href="https://www.amazon.in/gp/help/customer/display.html?nodeId=202111910" target="_blank">Returns Policy</a></span></div><br><div class="a-row"><span class="a-size-small a-color-secondary">Need to buy more items? Continue shopping on the <a href="https://www.amazon.in/" target="_blank">Amazon homepage</a>.</span></div></div></div></div></div></div><div id="be" style="display:none;visibility:hidden;"><form name="ue_backdetect" action="https://www.amazon.in/dppui/get"><input type="hidden" name="ue_back" value="1"></form>


<script type="text/javascript">
window.ue_ibe = (window.ue_ibe || 0) + 1;
if (window.ue_ibe === 1) {
(function(e,c){function h(b,a){f.push([b,a])}function g(b,a){if(b){var c=e.head||e.getElementsByTagName("head")[0]||e.documentElement,d=e.createElement("script");d.async="async";d.src=b;d.setAttribute("crossorigin","anonymous");a&&a.onerror&&(d.onerror=a.onerror);a&&a.onload&&(d.onload=a.onload);c.insertBefore(d,c.firstChild)}}function k(){ue.uels=g;for(var b=0;b<f.length;b++){var a=f[b];g(a[0],a[1])}ue.deffered=1}var f=[];c.ue&&(ue.uels=h,c.ue.attach&&c.ue.attach("load",k))})(document,window);


if (window.ue && window.ue.uels) {
        var cel_widgets = [ { "c":"celwidget" },{ "s":"#nav-swmslot > div", "id_gen":function(elem, index){ return 'nav_sitewide_msg'; } } ];

                ue.uels("https://images-eu.ssl-images-amazon.com/images/I/31YXrY93hfL.js");
}
var ue_mbl=ue_csm.ue.exec(function(h,a){function s(c){b=c||{};a.AMZNPerformance=b;b.transition=b.transition||{};b.timing=b.timing||{};if(a.csa){var d;b.timing.transitionStart&&(d=b.timing.transitionStart);b.timing.processStart&&(d=b.timing.processStart);d&&(csa("PageTiming")("mark","nativeTransitionStart",d),csa("PageTiming")("mark","transitionStart",d))}h.ue.exec(t,"csm-android-check")()&&b.tags instanceof Array&&(c=-1!=b.tags.indexOf("usesAppStartTime")||b.transition.type?!b.transition.type&&-1<
b.tags.indexOf("usesAppStartTime")?"warm-start":void 0:"view-transition",c&&(b.transition.type=c));n=null;"reload"===e._nt&&h.ue_orct||"intrapage-transition"===e._nt?u(b):"undefined"===typeof e._nt&&f&&f.timing&&f.timing.navigationStart&&a.history&&"function"===typeof a.History&&"object"===typeof a.history&&a.history.length&&1!=a.history.length&&(b.timing.transitionStart=f.timing.navigationStart);p&&e.ssw(q,""+(b.timing.transitionStart||n||""));c=b.transition;d=e._nt?e._nt:void 0;c.subType=d;a.ue&&
a.ue.tag&&a.ue.tag("has-AMZNPerformance");e.isl&&a.uex&&a.uex("at","csm-timing");v()}function w(c){a.ue&&a.ue.count&&a.ue.count("csm-cordova-plugin-failed",1)}function t(){return a.cordova&&a.cordova.platformId&&"android"==a.cordova.platformId}function u(){if(p){var c=e.ssw(q),a=function(){},x=e.count||a,a=e.tag||a,k=b.timing.transitionStart,g=c&&!c.e&&c.val;n=c=g?+c.val:null;k&&g&&k>c?(x("csm.jumpStart.mtsDiff",k-c||0),a("csm-rld-mts-gt")):k&&g?a("csm-rld-mts-leq"):g?k||a("csm-rld-mts-no-new"):a("csm-rld-mts-no-old")}f&&
f.timing&&f.timing.navigationStart?b.timing.transitionStart=f.timing.navigationStart:delete b.timing.transitionStart}function v(){try{a.P.register("AMZNPerformance",function(){return b})}catch(c){}}function r(){if(!b)return"";ue_mbl.cnt=null;var c=b.timing,d=b.transition,d=["mts",l(c.transitionStart),"mps",l(c.processStart),"mtt",d.type,"mtst",d.subType,"mtlt",d.launchType];a.ue&&a.ue.tag&&(c.fr_ovr&&a.ue.tag("fr_ovr"),c.fcp_ovr&&a.ue.tag("fcp_ovr"),d.push("fr_ovr",l(c.fr_ovr),"fcp_ovr",l(c.fcp_ovr)));
for(var c="",e=0;e<d.length;e+=2){var f=d[e],g=d[e+1];"undefined"!==typeof g&&(c+="&"+f+"="+g)}return c}function l(a){if("undefined"!==typeof a&&"undefined"!==typeof m)return a-m}function y(a,d){b&&(m=d,b.timing.transitionStart=a,b.transition.type="view-transition",b.transition.subType="ajax-transition",b.transition.launchType="normal",ue_mbl.cnt=r)}var e=h.ue||{},m=h.ue_t0,q="csm-last-mts",p=1===h.ue_sswmts,n,f=a.performance,b;if(a.P&&a.P.when&&a.P.register)return 1===a.ue_fnt&&(m=a.aPageStart||
h.ue_t0),a.P.when("CSMPlugin").execute(function(a){a.buildAMZNPerformance&&a.buildAMZNPerformance({successCallback:s,failCallback:w})}),{cnt:r,ajax:y}},"mobile-timing")(ue_csm,ue_csm.window);

(function(d){d._uess=function(){var a="";screen&&screen.width&&screen.height&&(a+="&sw="+screen.width+"&sh="+screen.height);var b=function(a){var b=document.documentElement["client"+a];return"CSS1Compat"===document.compatMode&&b||document.body["client"+a]||b},c=b("Width"),b=b("Height");c&&b&&(a+="&vw="+c+"&vh="+b);return a}})(ue_csm);

(function(a){var b=document.ue_backdetect;b&&b.ue_back&&a.ue&&(a.ue.bfini=b.ue_back.value);a.uet&&a.uet("be");a.onLdEnd&&(window.addEventListener?window.addEventListener("load",a.onLdEnd,!1):window.attachEvent&&window.attachEvent("onload",a.onLdEnd));a.ueh&&a.ueh(0,window,"load",a.onLd,1);a.ue&&a.ue.tag&&(a.ue_furl?(b=a.ue_furl.replace(/\./g,"-"),a.ue.tag(b)):a.ue.tag("nofls"))})(ue_csm);

(function(g,h){function d(a,d){var b={};if(!e||!f)try{var c=h.sessionStorage;c?a&&("undefined"!==typeof d?c.setItem(a,d):b.val=c.getItem(a)):f=1}catch(g){e=1}e&&(b.e=1);return b}var b=g.ue||{},a="",f,e,c,a=d("csmtid");f?a="NA":a.e?a="ET":(a=a.val,a||(a=b.oid||"NI",d("csmtid",a)),c=d(b.oid),c.e||(c.val=c.val||0,d(b.oid,c.val+1)),b.ssw=d);b.tabid=a})(ue_csm,ue_csm.window);

ue_csm.ue.exec(function(e,f){var a=e.ue||{},b=a._wlo,d;if(a.ssw){d=a.ssw("CSM_previousURL").val;var c=f.location,b=b?b:c&&c.href?c.href.split("#")[0]:void 0;c=(b||"")===a.ssw("CSM_previousURL").val;!c&&b&&a.ssw("CSM_previousURL",b);d=c?"reload":d?"intrapage-transition":"first-view"}else d="unknown";a._nt=d},"NavTypeModule")(ue_csm,window);
ue_csm.ue.exec(function(c,a){function g(a){a.run(function(e){d.tag("csm-feature-"+a.name+":"+e);d.isl&&c.uex("at")})}if(a.addEventListener)for(var d=c.ue||{},f=[{name:"touch-enabled",run:function(b){var e=function(){a.removeEventListener("touchstart",c,!0);a.removeEventListener("mousemove",d,!0)},c=function(){b("true");e()},d=function(){b("false");e()};a.addEventListener("touchstart",c,!0);a.addEventListener("mousemove",d,!0)}}],b=0;b<f.length;b++)g(f[b])},"csm-features")(ue_csm,window);


(function(a,e){function c(a){d("recordCounter",a.c,a.v)}var b=e.images,d=csa("Metrics",{producerId:"csa"});b&&b.length&&a.ue.count("totalImages",b.length);a.ue.cv.buffer&&d&&(a.ue.cv.buffer.forEach(c),a.ue.cv.buffer.push=c)})(ue_csm,document);
(function(b){function c(){var d=[];a.log&&a.log.isStub&&a.log.replay(function(a){e(d,a)});a.clog&&a.clog.isStub&&a.clog.replay(function(a){e(d,a)});d.length&&(a._flhs+=1,n(d),p(d))}function g(){a.log&&a.log.isStub&&(a.onflush&&a.onflush.replay&&a.onflush.replay(function(a){a[0]()}),a.onunload&&a.onunload.replay&&a.onunload.replay(function(a){a[0]()}),c())}function e(d,b){var c=b[1],f=b[0],e={};a._lpn[c]=(a._lpn[c]||0)+1;e[c]=f;d.push(e)}function n(b){q&&(a._lpn.csm=(a._lpn.csm||0)+1,b.push({csm:{k:"chk",
f:a._flhs,l:a._lpn,s:"inln"}}))}function p(a){if(h)a=k(a),b.navigator.sendBeacon(l,a);else{a=k(a);var c=new b[f];c.open("POST",l,!0);c.setRequestHeader&&c.setRequestHeader("Content-type","text/plain");c.send(a)}}function k(a){return JSON.stringify({rid:b.ue_id,sid:b.ue_sid,mid:b.ue_mid,mkt:b.ue_mkt,sn:b.ue_sn,reqs:a})}var f="XMLHttpRequest",q=1===b.ue_ddq,a=b.ue,r=b[f]&&"withCredentials"in new b[f],h=b.navigator&&b.navigator.sendBeacon,l="//"+b.ue_furl+"/1/batch/1/OE/",m=b.ue_fci_ft||5E3;a&&(r||h)&&
(a._flhs=a._flhs||0,a._lpn=a._lpn||{},a.attach&&(a.attach("beforeunload",a.exec(g,"fcli-bfu")),a.attach("pagehide",a.exec(g,"fcli-ph"))),m&&b.setTimeout(a.exec(c,"fcli-t"),m),a._ffci=a.exec(c))})(window);


(function(k,c){function l(a,b){return a.filter(function(a){return a.initiatorType==b})}function f(a,c){if(b.t[a]){var g=b.t[a]-b._t0,e=c.filter(function(a){return 0!==a.responseEnd&&m(a)<g}),f=l(e,"script"),h=l(e,"link"),k=l(e,"img"),n=e.map(function(a){return a.name.split("/")[2]}).filter(function(a,b,c){return a&&c.lastIndexOf(a)==b}),q=e.filter(function(a){return a.duration<p}),s=g-Math.max.apply(null,e.map(m))<r|0;"af"==a&&(b._afjs=f.length);return a+":"+[e[d],f[d],h[d],k[d],n[d],q[d],s].join("-")}}
function m(a){return a.responseEnd-(b._t0-c.timing.navigationStart)}function n(){var a=c[h]("resource"),d=f("cf",a),g=f("af",a),a=f("ld",a);delete b._rt;b._ld=b.t.ld-b._t0;b._art&&b._art();return[d,g,a].join("_")}var p=20,r=50,d="length",b=k.ue,h="getEntriesByType";b._rre=m;b._rt=c&&c.timing&&c[h]&&n})(ue_csm,window.performance);


(function(c,d){var b=c.ue,a=d.navigator;b&&b.tag&&a&&(a=a.connection||a.mozConnection||a.webkitConnection)&&a.type&&b.tag("netInfo:"+a.type)})(ue_csm,window);


(function(c,d){function h(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=b.encode(e);if(e[k]){var g=b.metaSep,e=e[k],l=b.metaPairSep,h=[],m=void 0;for(m in e)e.hasOwnProperty(m)&&h.push(m+"="+e[m]);e=h.join(l);f+=g+e}c.push(f)}return c.join(b.resourceSep)}function s(a){var b=a[k]=a[k]||{};b[t]||(b[t]=c.ue_mid);b[u]||(b[u]=c.ue_sid);b[f]||(b[f]=c.ue_id);b.csm=1;a="//"+c.ue_furl+"/1/"+a[v]+"/1/OP/"+a[w]+"/"+a[x]+"/"+h([a],y);if(n)try{n.call(d[p],a)}catch(g){c.ue.sbf=1,(new Image).src=a}else(new Image).src=
a}function q(){g&&g.isStub&&g.replay(function(a,b,c){a=a[0];b=a[k]=a[k]||{};b[f]=b[f]||c;s(a)});l.impression=s;g=null}if(!(1<c.ueinit)){var k="metadata",x="impressionType",v="foresterChannel",w="programGroup",t="marketplaceId",u="session",f="requestId",p="navigator",l=c.ue||{},n=d[p]&&d[p].sendBeacon,r=function(a,b,c,d){return{encode:d,resourceSep:a,metaSep:b,metaPairSep:c}},y=r("","?","&",function(a){return h(a.impressionData,z)}),z=r("/",":",",",function(a){return a.featureName+":"+h(a.resources,
A)}),A=r(",","@","|",function(a){return a.id}),g=l.impression;n?q():(l.attach("load",q),l.attach("beforeunload",q));try{d.P&&d.P.register&&d.P.register("impression-client",function(){})}catch(B){c.ueLogError(B,{logLevel:"WARN"})}}})(ue_csm,window);



var ue_pty = "kswag";

var ue_spty = "checkout";


    var uept = window.uept || {
        "pageType":"kswag","subPageType":"checkout"
    };

var ue_adb = 4;
var ue_adb_rtla = 1;
ue_csm.ue.exec(function(y,a){function t(){if(d&&f){var a;a:{try{a=d.getItem(g);break a}catch(c){}a=void 0}if(a)return b=a,!0}return!1}function u(){if(a.fetch)fetch(m).then(function(a){if(!a.ok)throw Error(a.statusText);return a.text?a.text():null}).then(function(b){b?(-1<b.indexOf("window.ue_adb_chk = 1")&&(a.ue_adb_chk=1),n()):h()})["catch"](h);else e.uels(m,{onerror:h,onload:n})}function h(){b=k;l();if(f)try{d.setItem(g,b)}catch(a){}}function n(){b=1===a.ue_adb_chk?p:k;l();if(f)try{d.setItem(g,
b)}catch(c){}}function q(){a.ue_adb_rtla&&c&&0<c.ec&&!1===r&&(c.elh=null,ueLogError({m:"Hit Info",fromOnError:1},{logLevel:"INFO",adb:b}),r=!0)}function l(){e.tag(b);e.isl&&a.uex&&uex("at",b);s&&s.updateCsmHit("adb",b);c&&0<c.ec?q():a.ue_adb_rtla&&c&&(c.elh=q)}function v(){return b}if(a.ue_adb){a.ue_fadb=a.ue_fadb||10;var e=a.ue,k="adblk_yes",p="adblk_no",m="https://m.media-amazon.com/images/G/01/csm/showads.v2.js?adtag=csm&adflag=-google-adsense.",b="adblk_unk",d;a:{try{d=a.localStorage;break a}catch(z){}d=
void 0}var g="csm:adb",c=a.ue_err,s=e.cookie,f=void 0!==a.localStorage,w=Math.random()>1-1/a.ue_fadb,r=!1,x=t();w||!x?u():l();a.ue_isAdb=v;a.ue_isAdb.unk="adblk_unk";a.ue_isAdb.no=p;a.ue_isAdb.yes=k}},"adb")(document,window);




(function(c,l,m){function h(a){if(a)try{if(a.id)return"//*[@id='"+a.id+"']";var b,d=1,e;for(e=a.previousSibling;e;e=e.previousSibling)e.nodeName===a.nodeName&&(d+=1);b=d;var c=a.nodeName;1!==b&&(c+="["+b+"]");a.parentNode&&(c=h(a.parentNode)+"/"+c);return c}catch(f){return"DETACHED"}}function f(a){if(a&&a.getAttribute)return a.getAttribute(k)?a.getAttribute(k):f(a.parentElement)}var k="data-cel-widget",g=!1,d=[];(c.ue||{}).isBF=function(){try{var a=JSON.parse(localStorage["csm-bf"]||"[]"),b=0<=a.indexOf(c.ue_id);
a.unshift(c.ue_id);a=a.slice(0,20);localStorage["csm-bf"]=JSON.stringify(a);return b}catch(d){return!1}}();c.ue_utils={getXPath:h,getFirstAscendingWidget:function(a,b){c.ue_cel&&c.ue_fem?!0===g?b(f(a)):d.push({element:a,callback:b}):b()},notifyWidgetsLabeled:function(){if(!1===g){g=!0;for(var a=f,b=0;b<d.length;b++)if(d[b].hasOwnProperty("callback")&&d[b].hasOwnProperty("element")){var c=d[b].callback,e=d[b].element;"function"===typeof c&&"function"===typeof a&&c(a(e))}d=null}},extractStringValue:function(a){if("string"===
typeof a)return a}}})(ue_csm,window,document);


(function(a){a.ue_cel||(a.ue_cel=function(){function f(a,c){c?c.r=v:c={r:v,c:1};!ue_csm.ue_sclog&&c.clog&&d.clog?d.clog(a,c.ns||q,c):c.glog&&d.glog?d.glog(a,c.ns||q,c):d.log(a,c.ns||q,c)}function m(a,d){"function"===typeof g&&g("log",{schemaId:s+".RdCSI.1",eventType:a,clientData:d},{ent:{page:["requestId"]}})}function c(){var a=n.length;if(0<a){for(var c=[],b=0;b<a;b++){var F=n[b].api;F.ready()?(F.on({ts:d.d,ns:q}),e.push(n[b]),f({k:"mso",n:n[b].name,t:d.d()})):c.push(n[b])}n=c}}function h(){if(!h.executed){for(var a=
0;a<e.length;a++)e[a].api.off&&e[a].api.off({ts:d.d,ns:q});A();f({k:"eod",t0:d.t0,t:d.d()},{c:1,il:1});h.executed=1;for(a=0;a<e.length;a++)n.push(e[a]);e=[];b(t);b(x)}}function A(a){f({k:"hrt",t:d.d()},{c:1,il:1,n:a});l=Math.min(w,r*l);y()}function y(){b(x);x=k(function(){A(!0)},l)}function u(){h.executed||A()}var p=a.window,k=p.setTimeout,b=p.clearTimeout,r=1.5,w=p.ue_cel_max_hrt||3E4,s="robotdetection",n=[],e=[],q=a.ue_cel_ns||"cel",t,x,d=a.ue,E=a.uet,B=a.uex,v=d.rid,C=p.csa,g,l=p.ue_cel_hrt_int||
3E3,z=p.requestAnimationFrame||function(a){a()};!a.ue_cel_lclia&&C&&(g=C("Events",{producerId:s}));if(d.isBF)f({k:"bft",t:d.d()});else{"function"==typeof E&&E("bb","csmCELLSframework",{wb:1});k(c,0);d.onunload(h);if(d.onflush)d.onflush(u);t=k(h,6E5);y();"function"==typeof B&&B("ld","csmCELLSframework",{wb:1});return{registerModule:function(a,b){n.push({name:a,api:b});f({k:"mrg",n:a,t:d.d()});c()},reset:function(a){f({k:"rst",t0:d.t0,t:d.d()});n=n.concat(e);e=[];for(var r=n.length,g=0;g<r;g++)n[g].api.off(),
n[g].api.reset();v=a||d.rid;c();b(t);t=k(h,6E5);h.executed=0},timeout:function(a,d){return k(function(){z(function(){h.executed||a()})},d)},log:f,csaEventLog:m,off:h}}}())})(ue_csm);
(function(a){a.ue_pdm||!a.ue_cel||a.ue.isBF||(a.ue_pdm=function(){function f(){try{var d=b.screen;if(d){var c={w:d.width,aw:d.availWidth,h:d.height,ah:d.availHeight,cd:d.colorDepth,pd:d.pixelDepth};e&&e.w===c.w&&e.h===c.h&&e.aw===c.aw&&e.ah===c.ah&&e.pd===c.pd&&e.cd===c.cd||(e=c,e.t=s(),e.k="sci",E(e),!C&&g&&l("sci",{h:(e.h||"0")+""}))}var k=r.body||{},h=r.documentElement||{},m={w:Math.max(k.scrollWidth||0,k.offsetWidth||0,h.clientWidth||0,h.scrollWidth||0,h.offsetWidth||0),h:Math.max(k.scrollHeight||
0,k.offsetHeight||0,h.clientHeight||0,h.scrollHeight||0,h.offsetHeight||0)};q&&q.w===m.w&&q.h===m.h||(q=m,q.t=s(),q.k="doi",E(q));w=a.ue_cel.timeout(f,n);x+=1}catch(p){b.ueLogError&&ueLogError(p,{attribution:"csm-cel-page-module",logLevel:"WARN"})}}function m(){u("ebl","default",!1)}function c(){u("efo","default",!0)}function h(){u("ebl","app",!1)}function A(){u("efo","app",!0)}function y(){b.setTimeout(function(){r[H]?u("ebl","pageviz",!1):u("efo","pageviz",!0)},0)}function u(a,d,c){t!==c&&(E({k:a,
t:s(),s:d},{ff:!0===c?0:1}),!C&&g&&l(a,{t:(s()||"0")+"",s:d}));t=c}function p(){d.attach&&(z&&d.attach(D,y,r),I&&P.when("mash").execute(function(a){a&&a.addEventListener&&(a.addEventListener("appPause",h),a.addEventListener("appResume",A))}),d.attach("blur",m,b),d.attach("focus",c,b))}function k(){d.detach&&(z&&d.detach(D,y,r),I&&P.when("mash").execute(function(a){a&&a.removeEventListener&&(a.removeEventListener("appPause",h),a.removeEventListener("appResume",A))}),d.detach("blur",m,b),d.detach("focus",
c,b))}var b=a.window,r=a.document,w,s,n,e,q,t=null,x=0,d=a.ue,E=a.ue_cel.log,B=a.uet,v=a.uex,C=a.ue_cel_lclia,g=b.csa,l=a.ue_cel.csaEventLog,z=!!d.pageViz,D=z&&d.pageViz.event,H=z&&d.pageViz.propHid,I=b.P&&b.P.when;"function"==typeof B&&B("bb","csmCELLSpdm",{wb:1});return{on:function(a){n=a.timespan||500;s=a.ts;p();a=b.location;E({k:"pmd",o:a.origin,p:a.pathname,t:s()});f();"function"==typeof v&&v("ld","csmCELLSpdm",{wb:1})},off:function(a){clearTimeout(w);k();d.count&&d.count("cel.PDM.TotalExecutions",
x)},ready:function(){return r.body&&a.ue_cel&&a.ue_cel.log},reset:function(){e=q=null}}}(),a.ue_cel&&a.ue_cel.registerModule("page module",a.ue_pdm))})(ue_csm);
(function(a){a.ue_vpm||!a.ue_cel||a.ue.isBF||(a.ue_vpm=function(){function f(){var a=y(),b={w:k.innerWidth,h:k.innerHeight,x:k.pageXOffset,y:k.pageYOffset};c&&c.w==b.w&&c.h==b.h&&c.x==b.x&&c.y==b.y||(b.t=a,b.k="vpi",c=b,r(c,{clog:1}),!q&&t&&x("vpi",{t:(c.t||"0")+"",h:(c.h||"0")+"",y:(c.y||"0")+"",w:(c.w||"0")+"",x:(c.x||"0")+""}));h=0;u=y()-a;p+=1}function m(){h||(h=a.ue_cel.timeout(f,A))}var c,h,A,y,u=0,p=0,k=a.window,b=a.ue,r=a.ue_cel.log,w=a.uet,s=a.uex,n=b.attach,e=b.detach,q=a.ue_cel_lclia,t=
k.csa,x=a.ue_cel.csaEventLog;"function"==typeof w&&w("bb","csmCELLSvpm",{wb:1});return{on:function(a){y=a.ts;A=a.timespan||100;f();n&&(n("scroll",m),n("resize",m));"function"==typeof s&&s("ld","csmCELLSvpm",{wb:1})},off:function(a){clearTimeout(h);e&&(e("scroll",m),e("resize",m));b.count&&(b.count("cel.VPI.TotalExecutions",p),b.count("cel.VPI.TotalExecutionTime",u),b.count("cel.VPI.AverageExecutionTime",u/p))},ready:function(){return a.ue_cel&&a.ue_cel.log},reset:function(){c=void 0},getVpi:function(){return c}}}(),
a.ue_cel&&a.ue_cel.registerModule("viewport module",a.ue_vpm))})(ue_csm);
(function(a){if(!a.ue_fem&&a.ue_cel&&a.ue_utils){var f=a.ue||{},m=a.window,c=m.document;!f.isBF&&!a.ue_fem&&c.querySelector&&m.getComputedStyle&&[].forEach&&(a.ue_fem=function(){function h(a,d){return a>d?3>a-d:3>d-a}function A(a,d){var c=m.pageXOffset,b=m.pageYOffset,k;a:{try{if(a){var g=a.getBoundingClientRect(),e,r=0===a.offsetWidth&&0===a.offsetHeight;c:{for(var f=a.parentNode,w=g.left||0,n=g.top||0,p=g.width||0,q=g.height||0;f&&f!==document.body;){var l;d:{try{var s=void 0;if(f)var G=f.getBoundingClientRect(),
s={x:G.left||0,y:G.top||0,w:G.width||0,h:G.height||0};else s=void 0;l=s;break d}catch(v){}l=void 0}var t=window.getComputedStyle(f),u="hidden"===t.overflow,y=u||"hidden"===t.overflowX,z=u||"hidden"===t.overflowY,J=n+q-1<l.y+1||n+1>l.y+l.h-1;if((w+p-1<l.x+1||w+1>l.x+l.w-1)&&y||J&&z){e=!0;break c}f=f.parentNode}e=!1}k={x:g.left+c||0,y:g.top+b||0,w:g.width||0,h:g.height||0,d:(r||e)|0}}else k=void 0;break a}catch(A){}k=void 0}if(k&&!a.cel_b)a.cel_b=k,C({n:a.getAttribute(x),w:a.cel_b.w,h:a.cel_b.h,d:a.cel_b.d,
x:a.cel_b.x,y:a.cel_b.y,t:d,k:"ewi",cl:a.className},{clog:1});else{if(c=k)c=a.cel_b,b=k,c=b.d===c.d&&1===b.d?!1:!(h(c.x,b.x)&&h(c.y,b.y)&&h(c.w,b.w)&&h(c.h,b.h)&&c.d===b.d);c&&(a.cel_b=k,C({n:a.getAttribute(x),w:a.cel_b.w,h:a.cel_b.h,d:a.cel_b.d,x:a.cel_b.x,y:a.cel_b.y,t:d,k:"ewi"},{clog:1}))}}function y(b,g){var h;h=b.c?c.getElementsByClassName(b.c):b.id?[c.getElementById(b.id)]:c.querySelectorAll(b.s);b.w=[];for(var f=0;f<h.length;f++){var e=h[f];if(e){if(!e.getAttribute(x)){var r=e.getAttribute("cel_widget_id")||
(b.id_gen||v)(e,f)||e.id;e.setAttribute(x,r)}b.w.push(e);k(Q,e,g)}}!1===B&&(E++,E===d.length&&(B=!0,a.ue_utils.notifyWidgetsLabeled()))}function u(a,c){g.contains(a)||C({n:a.getAttribute(x),t:c,k:"ewd"},{clog:1})}function p(a){K.length&&ue_cel.timeout(function(){if(q){for(var c=R(),d=!1;R()-c<e&&!d;){for(d=S;0<d--&&0<K.length;){var b=K.shift();T[b.type](b.elem,b.time)}d=0===K.length}U++;p(a)}},0)}function k(a,c,d){K.push({type:a,elem:c,time:d})}function b(a,c){for(var b=0;b<d.length;b++)for(var e=
d[b].w||[],g=0;g<e.length;g++)k(a,e[g],c)}function r(){M||(M=a.ue_cel.timeout(function(){M=null;var c=t();b(W,c);for(var g=0;g<d.length;g++)k(X,d[g],c);0===d.length&&!1===B&&(B=!0,a.ue_utils.notifyWidgetsLabeled());p(c)},n))}function w(){M||N||(N=a.ue_cel.timeout(function(){N=null;var a=t();b(Q,a);p(a)},n))}function s(){return z&&D&&g&&g.contains&&g.getBoundingClientRect&&t}var n=50,e=4.5,q=!1,t,x="data-cel-widget",d=[],E=0,B=!1,v=function(){},C=a.ue_cel.log,g,l,z,D,H=m.MutationObserver||m.WebKitMutationObserver||
m.MozMutationObserver,I=!!H,F,G,O="DOMAttrModified",L="DOMNodeInserted",J="DOMNodeRemoved",N,M,K=[],U=0,S=null,W="removedWidget",X="updateWidgets",Q="processWidget",T,V=m.performance||{},R=V.now&&function(){return V.now()}||function(){return Date.now()};"function"==typeof uet&&uet("bb","csmCELLSfem",{wb:1});return{on:function(b){function e(){if(s()){T={removedWidget:u,updateWidgets:y,processWidget:A};if(I){var a={attributes:!0,subtree:!0};F=new H(w);G=new H(r);F.observe(g,a);G.observe(g,{childList:!0,
subtree:!0});G.observe(l,a)}else z.call(g,O,w),z.call(g,L,r),z.call(g,J,r),z.call(l,L,w),z.call(l,J,w);r()}}g=c.body;l=c.head;z=g.addEventListener;D=g.removeEventListener;t=b.ts;d=a.cel_widgets||[];S=b.bs||5;f.deffered?e():f.attach&&f.attach("load",e);"function"==typeof uex&&uex("ld","csmCELLSfem",{wb:1});q=!0},off:function(){s()&&(G&&(G.disconnect(),G=null),F&&(F.disconnect(),F=null),D.call(g,O,w),D.call(g,L,r),D.call(g,J,r),D.call(l,L,w),D.call(l,J,w));f.count&&f.count("cel.widgets.batchesProcessed",
U);q=!1},ready:function(){return a.ue_cel&&a.ue_cel.log},reset:function(){d=a.cel_widgets||[]}}}(),a.ue_cel&&a.ue_fem&&a.ue_cel.registerModule("features module",a.ue_fem))}})(ue_csm);
(function(a){!a.ue_mcm&&a.ue_cel&&a.ue_utils&&!a.ue.isBF&&(a.ue_mcm=function(){function f(a,b){var h=a.srcElement||a.target||{},f={k:m,w:(b||{}).ow||(A.body||{}).scrollWidth,h:(b||{}).oh||(A.body||{}).scrollHeight,t:(b||{}).ots||c(),x:a.pageX,y:a.pageY,p:p.getXPath(h),n:h.nodeName};y&&"function"===typeof y.now&&a.timeStamp&&(f.dt=(b||{}).odt||y.now()-a.timeStamp,f.dt=parseFloat(f.dt.toFixed(2)));a.button&&(f.b=a.button);h.href&&(f.r=p.extractStringValue(h.href));h.id&&(f.i=h.id);h.className&&h.className.split&&
(f.c=h.className.split(/\s+/));u(f,{c:1})}var m="mcm",c,h=a.window,A=h.document,y=h.performance,u=a.ue_cel.log,p=a.ue_utils;return{on:function(k){c=k.ts;a.ue_cel_stub&&a.ue_cel_stub.replayModule(m,f);h.addEventListener&&h.addEventListener("mousedown",f,!0)},off:function(a){h.addEventListener&&h.removeEventListener("mousedown",f,!0)},ready:function(){return a.ue_cel&&a.ue_cel.log},reset:function(){}}}(),a.ue_cel&&a.ue_cel.registerModule("mouse click module",a.ue_mcm))})(ue_csm);
(function(a){a.ue_mmm||!a.ue_cel||a.ue.isBF||(a.ue_mmm=function(f){function m(a,c){var b={x:a.pageX||a.x||0,y:a.pageY||a.y||0,t:p()};!c&&l&&(b.t-l.t<A||b.x==l.x&&b.y==l.y)||(l=b,v.push(b))}function c(){if(v.length){E=F.now();for(var a=0;a<v.length;a++){var c=v[a],b=a;z=v[g];D=c;var e=void 0;if(!(e=2>b)){e=void 0;a:if(v[b].t-v[b-1].t>h)e=0;else{for(e=g+1;e<b;e++){var f=z,k=D,l=v[e];H=(k.x-f.x)*(f.y-l.y)-(f.x-l.x)*(k.y-f.y);if(H*H/((k.x-f.x)*(k.x-f.x)+(k.y-f.y)*(k.y-f.y))>y){e=0;break a}}e=1}e=!e}(I=
e)?g=b-1:C.pop();C.push(c)}B=F.now()-E;q=Math.min(q,B);t=Math.max(t,B);x=(x*d+B)/(d+1);d+=1;n({k:u,e:C,min:Math.floor(1E3*q),max:Math.floor(1E3*t),avg:Math.floor(1E3*x)},{c:1});v=[];C=[];g=0}}var h=100,A=20,y=25,u="mmm1",p,k,b=a.window,r=b.document,w=b.setInterval,s=a.ue,n=a.ue_cel.log,e,q=1E3,t=0,x=0,d=0,E,B,v=[],C=[],g=0,l,z,D,H,I,F=f&&f.now&&f||Date.now&&Date||{now:function(){return(new Date).getTime()}};return{on:function(a){p=a.ts;k=a.ns;s.attach&&s.attach("mousemove",m,r);e=w(c,3E3)},off:function(a){k&&
(l&&m(l,!0),c());clearInterval(e);s.detach&&s.detach("mousemove",m,r)},ready:function(){return a.ue_cel&&a.ue_cel.log},reset:function(){v=[];C=[];g=0;l=null}}}(window.performance),a.ue_cel&&a.ue_cel.registerModule("mouse move module",a.ue_mmm))})(ue_csm);




ue_csm.ue_unrt = 1500;
(function(d,b,t){function u(a,g){var c=a.srcElement||a.target||{},b={k:v,t:g.t,dt:g.dt,x:a.pageX,y:a.pageY,p:e.getXPath(c),n:c.nodeName};a.button&&(b.b=a.button);c.type&&(b.ty=c.type);c.href&&(b.r=e.extractStringValue(c.href));c.id&&(b.i=c.id);c.className&&c.className.split&&(b.c=c.className.split(/\s+/));h+=1;e.getFirstAscendingWidget(c,function(a){b.wd=a;d.ue.log(b,r)})}function w(a){if(!x(a.srcElement||a.target)){m+=1;n=!0;var g=f=d.ue.d(),c;p&&"function"===typeof p.now&&a.timeStamp&&(c=p.now()-
a.timeStamp,c=parseFloat(c.toFixed(2)));s=b.setTimeout(function(){u(a,{t:g,dt:c})},y)}}function z(a){if(a){var b=a.filter(A);a.length!==b.length&&(q=!0,k=d.ue.d(),n&&q&&(k&&f&&d.ue.log({k:B,t:f,m:Math.abs(k-f)},r),l(),q=!1,k=0))}}function A(a){if(!a)return!1;var b="characterData"===a.type?a.target.parentElement:a.target;if(!b||!b.hasAttributes||!b.attributes)return!1;var c={"class":"gw-clock gw-clock-aria s-item-container-height-auto feed-carousel using-mouse kfs-inner-container".split(" "),id:["dealClock",
"deal_expiry_timer","timer"],role:["timer"]},d=!1;Object.keys(c).forEach(function(a){var e=b.attributes[a]?b.attributes[a].value:"";(c[a]||"").forEach(function(a){-1!==e.indexOf(a)&&(d=!0)})});return d}function x(a){if(!a)return!1;var b=(e.extractStringValue(a.nodeName)||"").toLowerCase(),c=(e.extractStringValue(a.type)||"").toLowerCase(),d=(e.extractStringValue(a.href)||"").toLowerCase();a=(e.extractStringValue(a.id)||"").toLowerCase();var f="checkbox color date datetime-local email file month number password radio range reset search tel text time url week".split(" ");
if(-1!==["select","textarea","html"].indexOf(b)||"input"===b&&-1!==f.indexOf(c)||"a"===b&&-1!==d.indexOf("http")||-1!==["sitbreaderrightpageturner","sitbreaderleftpageturner","sitbreaderpagecontainer"].indexOf(a))return!0}function l(){n=!1;f=0;b.clearTimeout(s)}function C(){b.ue.onunload(function(){ue.count("armored-cxguardrails.unresponsive-clicks.violations",h);ue.count("armored-cxguardrails.unresponsive-clicks.violationRate",h/m*100||0)})}if(b.MutationObserver&&b.addEventListener&&Object.keys&&
d&&d.ue&&d.ue.log&&d.ue_unrt&&d.ue_utils){var y=d.ue_unrt,r="cel",v="unr_mcm",B="res_mcm",p=b.performance,e=d.ue_utils,n=!1,f=0,s=0,q=!1,k=0,h=0,m=0;b.addEventListener&&(b.addEventListener("mousedown",w,!0),b.addEventListener("beforeunload",l,!0),b.addEventListener("visibilitychange",l,!0),b.addEventListener("pagehide",l,!0));b.ue&&b.ue.event&&b.ue.onSushiUnload&&b.ue.onunload&&C();(new MutationObserver(z)).observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}})(ue_csm,window,document);


ue_csm.ue.exec(function(g,e){if(e.ue_err){var f="";e.ue_err.errorHandlers||(e.ue_err.errorHandlers=[]);e.ue_err.errorHandlers.push({name:"fctx",handler:function(a){if(!a.logLevel||"FATAL"===a.logLevel)if(f=g.getElementsByTagName("html")[0].innerHTML){var b=f.indexOf("var ue_t0=ue_t0||+new Date();");if(-1!==b){var b=f.substr(0,b).split(String.fromCharCode(10)),d=Math.max(b.length-10-1,0),b=b.slice(d,b.length-1);a.fcsmln=d+b.length+1;a.cinfo=a.cinfo||{};for(var c=0;c<b.length;c++)a.cinfo[d+c+1+""]=
b[c]}b=f.split(String.fromCharCode(10));a.cinfo=a.cinfo||{};if(!(a.f||void 0===a.l||a.l in a.cinfo))for(c=+a.l-1,d=Math.max(c-5,0),c=Math.min(c+5,b.length-1);d<=c;d++)a.cinfo[d+1+""]=b[d]}}})}},"fatals-context")(document,window);


(function(m,a){function c(k){function f(b){b&&"string"===typeof b&&(b=(b=b.match(/^(?:https?:)?\/\/(.*?)(\/|$)/i))&&1<b.length?b[1]:null,b&&b&&("number"===typeof e[b]?e[b]++:e[b]=1))}function d(b){var e=10,d=+new Date;b&&b.timeRemaining?e=b.timeRemaining():b={timeRemaining:function(){return Math.max(0,e-(+new Date-d))}};for(var c=a.performance.getEntries(),k=e;g<c.length&&k>n;)c[g].name&&f(c[g].name),g++,k=b.timeRemaining();g>=c.length?h(!0):l()}function h(b){if(!b){b=m.scripts;var c;if(b)for(var d=
0;d<b.length;d++)(c=b[d].getAttribute("src"))&&"undefined"!==c&&f(c)}0<Object.keys(e).length&&(p&&ue_csm.ue&&ue_csm.ue.event&&ue_csm.ue.event({domains:e,pageType:a.ue_pty||null,subPageType:a.ue_spty||null,pageTypeId:a.ue_pti||null},"csm","csm.CrossOriginDomains.2"),a.ue_ext=e)}function l(){!0===k?d():a.requestIdleCallback?a.requestIdleCallback(d):a.requestAnimationFrame?a.requestAnimationFrame(d):a.setTimeout(d,100)}function c(){if(a.performance&&a.performance.getEntries){var b=a.performance.getEntries();
!b||0>=b.length?h(!1):l()}else h(!1)}var e=a.ue_ext||{};a.ue_ext||c();return e}function q(){setTimeout(c,r)}var s=a.ue_dserr||!1,p=!0,n=1,r=2E3,g=0;a.ue_err&&s&&(a.ue_err.errorHandlers||(a.ue_err.errorHandlers=[]),a.ue_err.errorHandlers.push({name:"ext",handler:function(a){if(!a.logLevel||"FATAL"===a.logLevel){var f=c(!0),d=[],h;for(h in f){var f=h,g=f.match(/amazon(\.com?)?\.\w{2,3}$/i);g&&1<g.length||-1!==f.indexOf("amazon-adsystem.com")||-1!==f.indexOf("amazonpay.com")||-1!==f.indexOf("cloudfront-labs.amazonaws.com")||
d.push(h)}a.ext=d}}}));a.ue&&a.ue.isl?c():a.ue&&ue.attach&&ue.attach("load",q)})(document,window);





var ue_wtc_c = 3;
ue_csm.ue.exec(function(b,e){function l(){for(var a=0;a<f.length;a++)a:for(var d=s.replace(A,f[a])+g[f[a]]+t,c=arguments,b=0;b<c.length;b++)try{c[b].send(d);break a}catch(e){}g={};f=[];n=0;k=p}function u(){B?l(q):l(C,q)}function v(a,m,c){r++;if(r>w)d.count&&1==r-w&&(d.count("WeblabTriggerThresholdReached",1),b.ue_int&&console.error("Number of max call reached. Data will no longer be send"));else{var h=c||{};h&&-1<h.constructor.toString().indexOf(D)&&a&&-1<a.constructor.toString().indexOf(x)&&m&&-1<
m.constructor.toString().indexOf(x)?(h=b.ue_id,c&&c.rid&&(h=c.rid),c=h,a=encodeURIComponent(",wl="+a+"/"+m),2E3>a.length+p?(2E3<k+a.length&&u(),void 0===g[c]&&(g[c]="",f.push(c)),g[c]+=a,k+=a.length,n||(n=e.setTimeout(u,E))):b.ue_int&&console.error("Invalid API call. The input provided is over 2000 chars.")):d.count&&(d.count("WeblabTriggerImproperAPICall",1),b.ue_int&&console.error("Invalid API call. The input provided does not match the API protocol i.e ue.trigger(String, String, Object)."))}}function F(){d.trigger&&
d.trigger.isStub&&d.trigger.replay(function(a){v.apply(this,a)})}function y(){z||(f.length&&l(q),z=!0)}var t=":1234",s="//"+b.ue_furl+"/1/remote-weblab-triggers/1/OE/"+b.ue_mid+":"+b.ue_sid+":PLCHLDR_RID$s:wl-client-id%3DCSMTriger",A="PLCHLDR_RID",E=b.wtt||1E4,p=s.length+t.length,w=b.mwtc||2E3,G=1===e.ue_wtc_c,B=3===e.ue_wtc_c,H=e.XMLHttpRequest&&"withCredentials"in new e.XMLHttpRequest,x="String",D="Object",d=b.ue,g={},f=[],k=p,n,z=!1,r=0,C=function(){return{send:function(a){if(H){var b=new e.XMLHttpRequest;
b.open("GET",a,!0);G&&(b.withCredentials=!0);b.send()}else throw"";}}}(),q=function(){return{send:function(a){(new Image).src=a}}}();e.encodeURIComponent&&(d.attach&&(d.attach("beforeunload",y),d.attach("pagehide",y)),F(),d.trigger=v)},"client-wbl-trg")(ue_csm,window);


(function(k,d,h){function f(a,c,b){a&&a.indexOf&&0===a.indexOf("http")&&0!==a.indexOf("https")&&l(s,c,a,b)}function g(a,c,b){a&&a.indexOf&&(location.href.split("#")[0]!=a&&null!==a&&"undefined"!==typeof a||l(t,c,a,b))}function l(a,c,b,e){m[b]||(e=u&&e?n(e):"N/A",d.ueLogError&&d.ueLogError({message:a+c+" : "+b,logLevel:v,stack:"N/A"},{attribution:e}),m[b]=1,p++)}function e(a,c){if(a&&c)for(var b=0;b<a.length;b++)try{c(a[b])}catch(d){}}function q(){return d.performance&&d.performance.getEntriesByType?
d.performance.getEntriesByType("resource"):[]}function n(a){if(a.id)return"//*[@id='"+a.id+"']";var c;c=1;var b;for(b=a.previousSibling;b;b=b.previousSibling)b.nodeName==a.nodeName&&(c+=1);b=a.nodeName;1!=c&&(b+="["+c+"]");a.parentNode&&(b=n(a.parentNode)+"/"+b);return b}function w(){var a=h.images;a&&a.length&&e(a,function(a){var b=a.getAttribute("src");f(b,"img",a);g(b,"img",a)})}function x(){var a=h.scripts;a&&a.length&&e(a,function(a){var b=a.getAttribute("src");f(b,"script",a);g(b,"script",a)})}
function y(){var a=h.styleSheets;a&&a.length&&e(a,function(a){if(a=a.ownerNode){var b=a.getAttribute("href");f(b,"style",a);g(b,"style",a)}})}function z(){if(A){var a=q();e(a,function(a){f(a.name,a.initiatorType)})}}function B(){e(q(),function(a){g(a.name,a.initiatorType)})}function r(){var a;a=d.location&&d.location.protocol?d.location.protocol:void 0;"https:"==a&&(z(),w(),x(),y(),B(),p<C&&setTimeout(r,D))}var s="[CSM] Insecure content detected ",t="[CSM] Ajax request to same page detected ",v="WARN",
m={},p=0,D=k.ue_nsip||1E3,C=5,A=1==k.ue_urt,u=!0;ue_csm.ue_disableNonSecure||(d.performance&&d.performance.setResourceTimingBufferSize&&d.performance.setResourceTimingBufferSize(300),r())})(ue_csm,window,document);


var ue_aa_a = "";
if (ue.trigger && (ue_aa_a === "C" || ue_aa_a === "T1")) {
    ue.trigger("UEDATA_AA_SERVERSIDE_ASSIGNMENT_CLIENTSIDE_TRIGGER_190249", ue_aa_a);
}
(function(f,b){function g(){try{b.PerformanceObserver&&"function"===typeof b.PerformanceObserver&&(a=new b.PerformanceObserver(function(b){c(b.getEntries())}),a.observe(d))}catch(h){k()}}function m(){for(var h=d.entryTypes,a=0;a<h.length;a++)c(b.performance.getEntriesByType(h[a]))}function c(a){if(a&&Array.isArray(a)){for(var c=0,e=0;e<a.length;e++){var d=l.indexOf(a[e].name);if(-1!==d){var g=Math.round(b.performance.timing.navigationStart+a[e].startTime);f.uet(n[d],void 0,void 0,g);c++}}l.length===
c&&k()}}function k(){a&&a.disconnect&&"function"===typeof a.disconnect&&a.disconnect()}if("function"===typeof f.uet&&b.performance&&"object"===typeof b.performance&&b.performance.getEntriesByType&&"function"===typeof b.performance.getEntriesByType&&b.performance.timing&&"object"===typeof b.performance.timing&&"number"===typeof b.performance.timing.navigationStart){var d={entryTypes:["paint"]},l=["first-paint","first-contentful-paint"],n=["fp","fcp"],a;try{m(),g()}catch(p){f.ueLogError(p,{logLevel:"ERROR",
attribution:"performanceMetrics"})}}})(ue_csm,window);


if (window.csa) {
    csa("Events")("setEntity", {
        page:{pageType: "kswag", subPageType: "checkout", pageTypeId: ""}
    });
}
csa.plugin(function(c){var m="transitionStart",n="pageVisible",e="PageTiming",t="visibilitychange",s="$latency.visible",i=c.global,r=(i.performance||{}).timing,a=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],o=i.Math,u=o.max,l=o.floor,d=i.document||{},g=(r||{}).navigationStart,f=g,v=0,p=null;if(i.Object.keys&&[].forEach&&!c.config["KillSwitch."+e]){if(!r||null===g||g<=0||void 0===g)return c.error("Invalid navigation timing data: "+g);p=new S({schemaId:"<ns>.PageLatency.5",producerId:"csa"}),"boolean"!=typeof d.hidden&&"string"!=typeof d.visibilityState||!d.removeEventListener?c.emit(s):h()?(c.emit(s),E(n,g)):c.on(d,t,function e(){h()&&(f=c.time(),d.removeEventListener(t,e),E(m,f),E(n,f),c.emit(s))}),c.once("$unload",I),c.once("$load",I),c.on("$pageTransition",function(){f=c.time()}),c.register(e,{mark:E,instance:function(e){return new S(e)}})}function S(e){var i,r=null,a=e.ent||{page:["pageType","subPageType","requestId"]},o=e.logger||c("Events",{producerId:e.producerId});if(!e||!e.producerId||!e.schemaId)return c.error("The producer id and schema Id must be defined for PageLatencyInstance.");function d(){return i||f}function n(){r=c.UUID()}this.mark=function(n,t){if(null!=n)return t=t||c.time(),n===m&&(i=t),c.once(s,function(){o("log",{messageId:r,__merge:function(e){e.markers[n]=function(e,n){return u(0,n-(e||f))}(d(),t),e.markerTimestamps[n]=l(t)},markers:{},markerTimestamps:{},navigationStartTimestamp:d()?new Date(d()).toISOString():null,schemaId:e.schemaId},{ent:a})}),t},n(),c.on("$beforePageTransition",n)}function E(e,n){e===m&&(f=n);var t=p.mark(e,n);c.emit("$timing:"+e,t)}function I(){if(!v){for(var e=0;e<a.length;e++)r[a[e]]&&E(a[e],r[a[e]]);v=1}}function h(){return!d.hidden||"visible"===d.visibilityState}});csa.plugin(function(f){var o,u="length",c="parentElement",t="target",i="getEntriesByName",e="perf",n=null,r="_osrc",l="_elt",s="_eid",d=10,a=5,g=10,h=100,m=f.global,p=f.timeout,v=m.Math,y=v.max,E=v.floor,S=v.ceil,b=m.document,x=m.performance||{},O=(x.timing||{}).navigationStart,w=Date.now,L=Object.values||(f.types||{}).ovl,T=f("PageTiming"),N=f("SpeedIndexBuffers"),I=[],_=[],k=[],B=[],Y=[],C=.1,F=.1,H=0,R=0,V=!0,W=0,$=0,M=1==f.config["SpeedIndex.ForceReplay"],P=0,X=1,D=0,J={},j=[],q=0,Q={buffered:1};function U(e){f.global.ue_csa_ss_tag||f.emit("$csmTag:"+e,0,Q)}function z(){for(var e=w(),n=0;o;){if(0!==o[u]){if(!1!==o.h(o[0])&&o.shift(),n++,!M&&n%d==0&&w()-e>a)break}else o=o.n}H=0,o&&(H||(!0===b.hidden?(M=1,z()):f.timeout(z,0)))}function A(e,n,t,i){D=E(e),I=n,_=t,Y=i;var r=b.createTreeWalker(b.body,NodeFilter.SHOW_TEXT,null,null),a={w:m.innerWidth,h:m.innerHeight,x:m.pageXOffset,y:m.pageYOffset};b.body[l]=e,k.push({w:r,vp:a}),B.push({img:b.images,iter:0}),I.h=G,(I.n=_).h=K,(_.n=k).h=Z,(k.n=B).h=ee,(B.n=Y).h=ne,o=I,z()}function G(e){e.m.forEach(function(e){var n=e[t];r in n||(n[r]=e.oldValue)})}function K(n){n.m.forEach(function(e){e[t][l]=n.t-O})}function Z(e){for(var n,t=e.vp,i=e.w,r=d;(n=i.nextNode())&&0<r;){r-=1;var a=(n[c]||{}).nodeName;"SCRIPT"!==a&&"STYLE"!==a&&"NOSCRIPT"!==a&&"BODY"!==a&&0!==(n.nodeValue||"").trim()[u]&&oe(n[c],te(n),t)}return!n}function ee(e){for(var n={w:m.innerWidth,h:m.innerHeight,x:m.pageXOffset,y:m.pageYOffset},t=d;e.iter<e.img[u]&&0<t;){var i,r=e.img[e.iter],a=ae(r);i=re(a&&(r=a).querySelector('[aria-posinset="1"] img')||r),oe(r,i,n),e.iter+=1,t-=1}return e.img[u]<=e.iter}function ne(e){var n=[],i=0,r=0,a=R,t=E(e.y/h),o=S((e.y+m.innerHeight)/h);j.slice(t,o).forEach(function(e){(e.elems||[]).forEach(function(e){e.lt in n||(n[e.lt]={}),e.id in n[e.lt]||(i+=(n[e.lt][e.id]=e).a)})}),U("startVL"),L(n).forEach(function(e){L(e).forEach(function(e){var n=1-r/i,t=y(e.lt,a);q+=n*(t-a),a=t,function(e,n){var t;for(;C<=1&&C-.01<=e;)fe("visuallyLoaded"+(t=(100*C).toFixed(0)),n.lt),"50"!==t&&"90"!==t||f("Content",{target:n.e})("mark","visuallyLoaded"+t),C+=F}((r+=e.a)/i,e)})}),U("endVL"),R=e.t-O,Y[u]<=1&&(fe("speedIndex",q),fe("visuallyLoaded0",D)),V&&(V=!1,fe("atfSpeedIndex",q))}function te(e){for(var n=e[c],t=g;n&&0<t;){if(n[l]||0===n[l])return y(n[l],D);n=n.parentElement,t-=1}}function ie(e,n){if(e){if(!e.indexOf("data:"))return te(n);var t=x[i](e)||[];if(0<t[u])return y(S(t[0].responseEnd||0),D)}}function re(e){return ie(e[r],e)||ie(e.currentSrc,e)||ie(e.src,e)}function ae(e){for(var n=10,t=e.parentElement;t&&0<n;){if(t.classList&&t.classList.contains("a-carousel-viewport"))return t;t=t.parentElement,n-=1}return null}function oe(e,n,t){if((n||0===n)&&!e[s]){var i=e.getBoundingClientRect(),r=i.width*i.height,a=i.width/2,o=X++;if(0!=r&&!(a<i.right-t.w||i.right<a)){for(var f={e:e,lt:n,a:r,id:o},u=E((i.top+t.y)/h),c=S((i.top+t.y+i.height)/h),l=u;l<=c;l++)l in j||(j[l]={elems:[],lt:0}),j[l].elems.push(f);e[s]=o}}}function fe(e,n){T("mark",e,O+S((J[e]=n)||0))}function ue(e){P||(U("browserQuite"+e),N("getBuffers",A),P=1)}O&&L&&x[i]?(U(e+"Yes"),N("registerListener",function(e){$&&(clearTimeout(W),W=p(ue.bind(n,"Mut"),2500))}),f.once("$unload",function(){M=1,ue("Ud")}),f.once("$load",function(){$=1,W=p(ue.bind(n,"Ld"),2500)}),f.once("$timing:functional",ue.bind(n,"Fn")),f.register("SpeedIndex",{getMarkers:function(e){e&&e(JSON.parse(JSON.stringify(J)))}})):U(e+"No")});csa.plugin(function(e){var m=!!e.config["LCP.elementDedup"],t=!1,n=e("PageTiming"),r=e.global.PerformanceObserver,a=e.global.performance;function i(){return a.timing.navigationStart}function o(){t||function(o){var l=new r(function(e){var t=e.getEntries();if(0!==t.length){var n=t[t.length-1];if(m&&""!==n.id&&n.element&&"IMG"===n.element.tagName){for(var r={},a=t[0],i=0;i<t.length;i++)t[i].id in r||(""!==t[i].id&&(r[t[i].id]=!0),a.startTime<t[i].startTime&&(a=t[i]));n=a}l.disconnect(),o({startTime:n.startTime,renderTime:n.renderTime,loadTime:n.loadTime})}});try{l.observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}}(function(e){e&&(t=!0,n("mark","largestContentfulPaint",Math.floor(e.startTime+i())),e.renderTime&&n("mark","largestContentfulPaint.render",Math.floor(e.renderTime+i())),e.loadTime&&n("mark","largestContentfulPaint.load",Math.floor(e.loadTime+i())))})}r&&a&&a.timing&&(e.once("$unload",o),e.once("$load",o),e.register("LargestContentfulPaint",{}))});csa.plugin(function(r){var e=r("Metrics",{producerId:"csa"}),n=r.global.PerformanceObserver;n&&(n=new n(function(r){var t=r.getEntries();if(0===t.length||!t[0].processingStart||!t[0].startTime)return;!function(r){r=r||0,n.disconnect(),0<=r?e("recordMetric","firstInputDelay",r):e("recordMetric","firstInputDelay.invalid",1)}(t[0].processingStart-t[0].startTime)}),function(){try{n.observe({type:"first-input",buffered:!0})}catch(r){}}())});csa.plugin(function(d){var e="Metrics",g=0;function r(i){var c,t,e=i.producerId,r=i.logger,s=r||d("Events",{producerId:e}),o=(i||{}).dimensions||{},u={},n=-1;if(!e&&!r)return d.error("Either a producer id or custom logger must be defined");function a(){n!==g&&(c=d.UUID(),t=d.UUID(),u={},n=g)}this.recordMetric=function(r,n){var e=i.logOptions||{ent:{page:["pageType","subPageType","requestId"]}};e.debugMetric=i.debugMetric,a(),s("log",{messageId:c,schemaId:i.schemaId||"<ns>.Metric.3",metrics:{},dimensions:o,__merge:function(e){e.metrics[r]=n}},e)},this.recordCounter=function(r,e){var n=i.logOptions||{ent:{page:["pageType","subPageType","requestId"]}};if("string"!=typeof r||"number"!=typeof e||!isFinite(e))return d.error("Invalid type given for counter name or counter value: "+r+"/"+e);a(),r in u||(u[r]={});var c=u[r];"f"in c||(c.f=e),c.c=(c.c||0)+1,c.s=(c.s||0)+e,c.l=e,s("log",{messageId:t,schemaId:i.schemaId||"<ns>.InternalCounters.2",c:{},__merge:function(e){r in e.c||(e.c[r]={}),c.fs||(c.fs=1,e.c[r].f=c.f),1<c.c&&(e.c[r].s=c.s,e.c[r].l=c.l,e.c[r].c=c.c)}},n)}}d.config["KillSwitch."+e]||(new r({producerId:"csa"}).recordMetric("baselineMetricEvent",1),d.on("$beforePageTransition",function(){g++}),d.register(e,{instance:function(e){return new r(e||{})}}))});csa.plugin(function(t){var a,r=(t.global.performance||{}).timing,s=(r||{}).navigationStart||t.time();function e(){a=t.UUID()}function n(i){var r=(i=i||{}).producerId,e=i.logger,o=e||t("Events",{producerId:r});if(!r&&!e)return t.error("Either a producer id or custom logger must be defined");this.mark=function(e,r){var n=(void 0===r?t.time():r)-s;o("log",{messageId:a,schemaId:i.schemaId||"<ns>.Timer.1",markers:{},__merge:function(r){r.markers[e]=n}},i.logOptions)}}r&&(e(),t.on("$beforePageTransition",e),t.register("Timers",{instance:function(r){return new n(r||{})}}))});csa.plugin(function(t){var e="takeRecords",i="disconnect",n="function",o=t("Metrics",{producerId:"csa"}),c=t("PageTiming"),a=t.global,u=t.timeout,r=t.on,f=a.PerformanceObserver,m=0,l=!1,s=0,d=a.performance,h=a.document,v=null,y=!1,g=t.blank;function p(){l||(l=!0,clearTimeout(v),typeof f[e]===n&&f[e](),typeof f[i]===n&&f[i](),o("recordMetric","documentCumulativeLayoutShift",m),c("mark","cumulativeLayoutShiftLastTimestamp",Math.floor(s+d.timing.navigationStart)))}f&&d&&d.timing&&h&&(f=new f(function(t){v&&clearTimeout(v);t.getEntries().forEach(function(t){t.hadRecentInput||(m+=t.value,s<t.startTime&&(s=t.startTime))}),v=u(p,5e3)}),function(){try{f.observe({type:"layout-shift",buffered:!0}),v=u(p,5e3)}catch(t){}}(),g=r(h,"click",function(t){y||(y=!0,o("recordMetric","documentCumulativeLayoutShiftToFirstInput",m),g())}),r(h,"visibilitychange",function(){"hidden"===h.visibilityState&&p()}),t.once("$unload",p))});csa.plugin(function(e){var t,n=e.global,r=n.PerformanceObserver,c=e("Metrics",{producerId:"csa"}),o=0,i=0,a=-1,l=n.Math,f=l.max,u=l.ceil;if(r){t=new r(function(e){e.getEntries().forEach(function(e){var t=e.duration;o+=t,i+=t,a=f(t,a)})});try{t.observe({type:"longtask",buffered:!0})}catch(e){}t=new r(function(e){0<e.getEntries().length&&(i=0,a=-1)});try{t.observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}e.on("$unload",g),e.on("$beforePageTransition",g)}function g(){c("recordMetric","totalBlockingTime",u(i||0)),c("recordMetric","totalBlockingTimeInclLCP",u(o||0)),c("recordMetric","maxBlockingTime",u(a||0)),i=o=0,a=-1}});csa.plugin(function(r){var e="CacheDetection",o="csa-ctoken-",n=r.store,t=r.deleteStored,c=r.config,a=c[e+".RequestID"],i=c[e+".Callback"],s=r.global,u=s.document||{},d=s.Date,f=r("Events"),l=r("Events",{producerId:"csa"});function p(e){try{var n=u.cookie.match(RegExp("(^| )"+e+"=([^;]+)"));return n&&n[2].trim()}catch(e){}}!function(){var e=function(){var e=p("cdn-rid");if(e)return{r:e,s:"cdn"}}()||function(){if(r.store(o+a))return{r:r.UUID().toUpperCase().replace(/-/g,"").slice(0,20),s:"device"}}()||{},n=e.r,c=e.s;if(!!n){var t=p("session-id");!function(e,n,c,t){f("setEntity",{page:{pageSource:"cache",requestId:e,cacheRequestId:a,cacheSource:t},session:{id:c}})}(n,0,t,c),"device"===c&&l("log",{schemaId:"<ns>.CacheImpression.1"},{ent:"all"}),i&&i(n,t,c)}}(),n(o+a,d.now()+36e5),r.once("$load",function(){var c=d.now();t(function(e,n){return 0==e.indexOf(o)&&parseInt(n)<c})})});csa.plugin(function(u){var i,t="Content",e="MutationObserver",n="addedNodes",a="querySelectorAll",f="matches",o="getAttributeNames",r="getAttribute",s="dataset",c="widget",l="producerId",d={ent:{element:1,page:["pageType","subPageType","requestId"]}},h=5,g=u.config[t+".BubbleUp.SearchDepth"]||20,p=u.config[t+".SearchPage"]||0,m="csaC",y=m+"Id",v="logRender",b={},E=u.config,w=E[t+".Selectors"]||[],I=E[t+".WhitelistedAttributes"]||{href:1,class:1},O=E[t+".EnableContentEntities"],C=E["KillSwitch.ContentRendered"],N=u.global,k=N.document||{},A=k.documentElement,S=N.HTMLElement,U={},L=[],R=function(t,e,n,i){var r=this,o=u("Events",{producerId:t||"csa"});e.type=e.type||c,r.id=e.id,r.l=o,r.e=e,r.el=n,r.rt=i,r.dlo=d,r.op=H(n,"csaOp"),r.log=function(t,e){o("log",t,e||d)},e.id&&o("setEntity",{element:e})},_=R.prototype;function j(t){var e=(t=t||{}).element,n=t.target;return e?function(t,e){var n;n=t instanceof S?$(t)||B(e[l],t,K,u.time()):U[t.id]||Y(e[l],0,t,u.time());return n}(e,t):n?x(n):u.error("No element or target argument provided.")}function x(t){var e=function(t){var e=null,n=0;for(;t&&n<g;){if(n++,D(t,y)){e=t;break}t=t.parentElement}return e}(t);return e?$(e):new R("csa",{id:null},null,u.time())}function D(t,e){if(t&&t.dataset)return t.dataset[e]}function M(t,e,n){L.push({n:n,e:t,t:e}),T()}function P(){for(var t=u.time(),e=0;0<L.length;){var n=L.shift();if(b[n.n](n.e,n.t),++e%10==0&&u.time()-t>h)break}i=0,L.length&&T()}function T(){i=i||u.raf(P)}function q(t,e,n){return{n:t,e:e,t:n}}function B(t,e,n,i){var r=u.UUID(),o={id:r},c=x(e);return e[s][y]=r,n(o,e),c&&c.id&&(o.parentId=c.id),Y(t,e,o,i)}function X(t){return isNaN(t)?null:Math.round(t)}function Y(t,e,n,i){O&&(n.schemaId="<ns>.ContentEntity.2"),n.id=n.id||u.UUID();var r=new R(t,n,e,i);return function(t){return!C&&((t.op||{}).hasOwnProperty(v)||p)}(r)&&function(t,e){var n={},i=u.exec(X);t.el&&(n=t.el.getBoundingClientRect()),t.log({schemaId:"<ns>.ContentRender.2",timestamp:e,width:i(n.width),height:i(n.height),positionX:i(n.left+N.pageXOffset),positionY:i(n.top+N.pageYOffset)})}(r,i),u.emit("$content.register",r),U[n.id]=r}function $(t){return U[(t[s]||{})[y]]}function H(n,i){var r={};return o in(n=n||{})&&Object.keys(n[s]).forEach(function(t){if(!t.indexOf(i)&&i.length<t.length){var e=function(t){return(t[0]||"").toLowerCase()+t.slice(1)}(t.slice(i.length));r[e]=n[s][t]}}),r}function K(t,e){o in e&&(function(t,e){var n=H(t,m);Object.keys(n).forEach(function(t){e[t]=n[t]})}(e,t),function(e,n){(e[o]()||[]).forEach(function(t){t in I&&(n[t]=e[r](t))})}(e,t))}A&&k[a]&&N[e]&&(w.push({selector:"*[data-csa-c-type]",entity:K}),w.push({selector:".celwidget",entity:function(t,e){K(t,e),t.slotId=t.slotId||e[r]("cel_widget_id")||e.id,t.legacyId=e[r]("cel_widget_id")||e.id,t.type=t.type||c}}),b[1]=function(t,e){t.forEach(function(t){t[n]&&t[n].constructor&&"NodeList"===t[n].constructor.name&&Array.prototype.forEach.call(t[n],function(t){L.unshift(q(2,t,e))})})},b[2]=function(o,c){a in o&&f in o&&w.forEach(function(t){for(var e=t.selector,n=o[f](e),i=o[a](e),r=i.length-1;0<=r;r--)L.unshift(q(3,{e:i[r],s:t},c));n&&L.unshift(q(3,{e:o,s:t},c))})},b[3]=function(t,e){var n=t.e;$(n)||B("csa",n,t.s.entity,e)},b[4]=function(){u.register(t,{instance:j})},new N[e](function(t){M(t,u.time(),1)}).observe(A,{childList:!0,subtree:!0}),M(A,u.time(),2),M(null,u.time(),4),u.on("$content.export",function(e){Object.keys(e).forEach(function(t){_[t]=e[t]})}))});csa.plugin(function(o){var i,t="ContentImpressions",e="KillSwitch.",n="IntersectionObserver",r="getAttribute",s="dataset",c="intersectionRatio",a="csaCId",m=1e3,l=o.global,f=o.config,u=f[e+t],v=f[e+t+".ContentViews"],g=((l.performance||{}).timing||{}).navigationStart||o.time(),d={};function h(t){t&&(t.v=1,function(t){t.vt=o.time(),t.el.log({schemaId:"<ns>.ContentView.3",timeToViewed:t.vt-t.el.rt,pageFirstPaintToElementViewed:t.vt-g})}(t))}function I(t){t&&!t.it&&(t.i=o.time()-t.is>m,function(t){t.it=o.time(),t.el.log({schemaId:"<ns>.ContentImpressed.2",timeToImpressed:t.it-t.el.rt,pageFirstPaintToElementImpressed:t.it-g})}(t))}!u&&l[n]&&(i=new l[n](function(t){var n=o.time();t.forEach(function(t){var e=function(t){if(t&&t[r])return d[t[s][a]]}(t.target);if(e){o.emit("$content.intersection",{meta:e.el,t:n,e:t});var i=t.intersectionRect;t.isIntersecting&&0<i.width&&0<i.height&&(v||e.v||h(e),.5<=t[c]&&!e.is&&(e.is=n,e.timer=o.timeout(function(){I(e)},m))),t[c]<.5&&!e.it&&e.timer&&(l.clearTimeout(e.timer),e.is=0,e.timer=0)}})},{threshold:[0,.5,.99]}),o.on("$content.register",function(t){var e=t.el;e&&(d[t.id]={el:t,v:0,i:0,is:0,vt:0,it:0},i.observe(e))}))});csa.plugin(function(e){e.config["KillSwitch.ContentLatency"]||e.emit("$content.export",{mark:function(t,n){var o=this;o.t||(o.t=e("Timers",{logger:o.l,schemaId:"<ns>.ContentLatency.1",logOptions:o.dlo})),o.t("mark",t,n)}})});csa.plugin(function(t){function n(i,e,o){var c={};function r(t,n,e){t in c&&o<=n-c[t].s&&(function(n,e,i){if(!p)return;S(function(t){T(n,t),t.w[n][e]=a((t.w[n][e]||0)+i)})}(t,i,n-c[t].d),c[t].d=n),e||delete c[t]}this.update=function(t,n){n.isIntersecting&&e<=n.intersectionRatio?function(t,n){t in c||(c[t]={s:n,d:n})}(t,u()):r(t,u())},this.stopAll=function(t){var n=u();for(var e in c)r(e,n,t)},this.reset=function(){var t=u();for(var n in c)c[n].s=t,c[n].d=t}}var e=t.config,u=t.time,i="ContentInteractionsSummary",o=e[i+".FlushInterval"]||5e3,c=e[i+".FlushBackoff"]||1.5,r=t.global,s=t.on,a=Math.floor,f=(r.document||{}).documentElement||{},l=((r.performance||{}).timing||{}).responseStart||t.time(),d=o,m=0,p=!0,v=t.UUID(),g=t("Events",{producerId:"csa"}),I=new n("it0",0,0),w=new n("it50",.5,1e3),h=new n("it100",.99,0),A={},b={};function $(){I.stopAll(!0),w.stopAll(!0),h.stopAll(!0),U()}function C(){I.reset(),w.reset(),h.reset(),U()}function U(){d&&(clearTimeout(m),m=t.timeout($,d),d*=c)}function E(n){S(function(t){T(n,t),t.w[n].mc=(t.w[n].mc||0)+1})}function S(t){g("log",{messageId:v,schemaId:"<ns>.ContentInteractionsSummary.1",w:{},__merge:t},{ent:{page:["requestId"]}})}function T(t,n){t in n.w||(n.w[t]={})}s("$content.intersection",function(t){if(t&&t.meta&&t.e){var n=t.meta.id;if(n in A){var e=t.e.boundingClientRect||{};e.width<5||e.height<5||(I.update(n,t.e),w.update(n,t.e),h.update(n,t.e),!t.e.isIntersecting||n in b||(b[n]=1,function(n,e){S(function(t){T(n,t),t.w[n].ttfv=a(e)})}(n,u()-l)))}}}),s("$content.register",function(t){(t.e||{}).slotId&&(A[t.id]={},function(e){S(function(t){var n=e.id;T(n,t),t.w[n].sid=(e.e||{}).slotId,t.w[n].cid=(e.e||{}).contentId})}(t))}),s("$beforePageTransition",function(){$(),C(),v=t.UUID(),U()}),s("$beforeunload",function(){I.stopAll(),w.stopAll(),h.stopAll(),d=null}),s("$visible",function(t){t?C():($(),clearTimeout(m)),p=t},{buffered:1}),s(f,"click",function(t){for(var n=t.target,e=25;n&&0<e;){var i=(n.dataset||{}).csaCId;i&&E(i),n=n.parentElement,e-=1}},{capture:!0,passive:!0}),U()});csa.plugin(function(o){var t,n,i="normal",s="reload",e="history",d="new-tab",a="ajax",r=1,c=2,u="lastActive",l="lastInteraction",f="used",p="csa-tabbed-browsing",g="visibilityState",v={"back-memory-cache":1,"tab-switch":1,"history-navigation-page-cache":1},b="<ns>.TabbedBrowsing.2",m="visible",y=o.global,I=o("Events",{producerId:"csa"}),h=y.location||{},T=y.document,w=y.JSON,z=((y.performance||{}).navigation||{}).type,P=o.store,S=o.on,k=o.storageSupport(),x=!1,A={},C={},O={},$={},j=!1,q=!1,B=!1;function E(i){try{return w.parse(P(p,void 0,{session:i})||"{}")||{}}catch(i){o.error('Could not parse storage value for key "'+p+'": '+i)}return{}}function J(i,t){P(p,w.stringify(t||{}),{session:i})}function N(i){var t=C.tid||i.id,n=A[u]||{};n.tid===t&&(n.pid=i.id),$={pid:i.id,tid:t,lastInteraction:C[l]||{},initialized:!0},O={lastActive:n,lastInteraction:A[l]||{},time:o.time()}}function D(i){var t=i===d,n=T.referrer,e=!(n&&n.length)||!~n.indexOf(h.origin||""),a=t&&e,r={type:i,toTabId:$.tid,toPageId:$.pid,transitTime:o.time()-A.time||null};a||function(i,t,n){var e=i===s,a=t?A[u]||{}:C,r=A[l]||{},o=C[l]||{},d=t?r:o;n.fromTabId=a.tid,n.fromPageId=a.pid,e||!d.id||d[f]||(n.interactionId=d.id||null,r.id===d.id&&(r[f]=!0),o.id===d.id&&(o[f]=!0))}(i,t,r),I("log",{navigation:r,schemaId:b},{ent:{page:["pageType","subPageType","requestId"]}})}function F(i){B=function(i){return i&&i in v}(i.transitionType),function(){A=E(!1),C=E(!0);var i=A[l],t=C[l],n=!1,e=!1;i&&t&&i.id===t.id&&i[f]!==t[f]&&(n=!i[f],e=!t[f],t[f]=i[f]=!0,n&&J(!1,A),e&&J(!0,C))}(),N(i),j=!0,function(i){var t,n;t=H(),n=K(),(t||n)&&N(i)}(i)}function G(){x&&!B?D(a):(x=!0,D(z===c||B?e:z===r?C.initialized?s:d:C.initialized?i:d))}function H(){return!(!j||!t)&&(C[l]={id:t.messageId,used:!(A[l]={id:t.messageId,used:!1})},!(t=null))}function K(){var i=!1;if(q=T[g]===m,j){var t=A[u]||{};i=function(i,t,n){var e=!1,a=i[u];return q?a&&a.tid===$.tid&&a[m]&&a.pid===n||(i[u]={visible:!0,pid:n,tid:t},e=!0):a&&a.tid===$.tid&&a[m]&&(e=!(a[m]=!1)),e}(A,C.tid||t.tid||$.tid,C.pid||t.pid||$.pid)}return i}k.local&&k.session&&w&&T&&g in T&&(n=function(){try{return y.self!==y.top}catch(i){return!0}}(),S("$pageChange",function(i){n||(F(i),G(),J(!1,O),J(!0,$),C=$,A=O)},{buffered:1}),S("$content.interaction",function(i){t=i,H()&&(J(!1,A),J(!0,C))}),S(T,"visibilitychange",function(){!n&&K()&&J(!1,A)},{capture:!1,passive:!0}))});csa.plugin(function(c){var e=c("Metrics",{producerId:"csa"});c.on(c.global,"pageshow",function(c){c&&c.persisted&&e("recordMetric","bfCache",1)})});csa.plugin(function(n){var e,t,i,o,r,a,c,u,f,s,l,d,m,p,g,v,h="hasFocus",b="$app.",y="avail",S="client",T="document",$="inner",I="offset",P="screen",w="scroll",D="Width",E="Height",F=y+D,O=y+E,q=S+D,x=S+E,z=$+D,C=$+E,H=I+D,K=I+E,M=w+D,W=w+E,X=n.config["KillSwitch.PageInteractionsSummary"],Y=n("Events",{producerId:"csa"}),j=1,k=n.global||{},A=n.time,B=n.on,G=n.once,J=k[T]||{},L=k[P]||{},N=k.Math||{},Q=N.abs,R=N.max,U=N.ceil,V=((k.performance||{}).timing||{}).responseStart,Z=function(){return J[h]()},_=1,nn=100,en={},tn=1;function on(){c=t=o=r=e,i=0,a=u=f=s=0,cn(),an()}function rn(){V&&!o&&(c=U((o=l)-V),tn=1)}function an(){u=U(R(u,m+v)),d&&(f=U(R(f,d+g))),tn=1}function cn(){l=A(),d=Q(k.pageXOffset||0),m=Q(k.pageYOffset||0),p=0<d||0<m,g=k[z]||0,v=k[C]||0}function un(){cn(),rn(),function(){var n=m-i;t&&!(t&&t<=l)||(n&&(++a,tn=1),i=m,n),t=l+nn}(),an()}function fn(){if(r){var n=U(A()-r);s+=n,r=e,tn=0<n}}function sn(){r=r||A()}function ln(n,e,t,i){e[n+D]=U(t||0),e[n+E]=U(i||0)}function dn(n){var e=n===en,t=Z();if(t||tn){if(!e){if(!j)return;j=0,t&&fn()}var i=function(){var n={},e=J.documentElement||{},t=J.body||{};return ln("availableScreen",n,L[F],L[O]),ln(T,n,R(t[M]||0,t[H]||0,e[q]||0,e[M]||0,e[H]||0),R(t[W]||0,t[K]||0,e[x]||0,e[W]||0,e[K]||0)),ln(P,n,L.width,L.height),ln("viewport",n,k[z],k[C]),n}(),o=function(){var n={scrollCounts:a,reachedDepth:u,horizontalScrollDistance:f,dwellTime:s};return"number"==typeof c&&(n.clientTimeToFirstScroll=c),n}();e?tn=0:(on(),V=A(),t&&(r=V)),Y("log",{activity:o,dimensions:i,schemaId:"<ns>.PageInteractionsSummary.1"},{ent:{page:["pageType","subPageType","requestId"]}})}}function mn(){fn(),dn(en)}function pn(n,e){return function(){_=e,n()}}function gn(){Z=function(){return _},_&&!r&&(r=A())}"function"!=typeof J[h]||X||(on(),p&&rn(),B(k,w,un,{passive:!0}),B(k,"blur",mn),B(k,"focus",pn(sn,1)),G(b+"android",gn),G(b+"ios",gn),B(b+"pause",pn(mn,0)),B(b+"resume",pn(sn,1)),B(b+"resign",pn(mn,0)),B(b+"active",pn(sn,1)),Z()&&(r=V||A()),G("$beforeunload",dn),B("$beforeunload",dn),B("$document.hidden",mn),B("$beforePageTransition",dn),B("$afterPageTransition",function(){tn=j=1}))});csa.plugin(function(e){var o,n,r="<ns>.Navigator.4",a=e.global,i=a.navigator||{},d=i.connection||{},c=a.Math.round,t=e("Events",{producerId:"csa"});function l(){o={network:{downlink:void 0,downlinkMax:void 0,rtt:void 0,type:void 0,effectiveType:void 0,saveData:void 0},language:void 0,doNotTrack:void 0,hardwareConcurrency:void 0,deviceMemory:void 0,cookieEnabled:void 0,webdriver:void 0},v(),o.language=i.language||null,o.doNotTrack=function(){switch(i.doNotTrack){case"1":return"enabled";case"0":return"disabled";case"unspecified":return i.doNotTrack;default:return null}}(),o.hardwareConcurrency="hardwareConcurrency"in i?c(i.hardwareConcurrency||0):null,o.deviceMemory="deviceMemory"in i?c(i.deviceMemory||0):null,o.cookieEnabled="cookieEnabled"in i?i.cookieEnabled:null,o.webdriver="webdriver"in i?i.webdriver:null}function u(){t("log",{network:(n={},Object.keys(o.network).forEach(function(e){n[e]=o.network[e]+""}),n),language:o.language,doNotTrack:o.doNotTrack,hardwareConcurrency:o.hardwareConcurrency,deviceMemory:o.deviceMemory,cookieEnabled:o.cookieEnabled,webdriver:o.webdriver,schemaId:r},{ent:{page:["pageType","subPageType","requestId"]}})}function v(){!function(n){Object.keys(o.network).forEach(function(e){o.network[e]=n[e]})}({downlink:"downlink"in d?c(d.downlink||0):null,downlinkMax:"downlinkMax"in d?c(d.downlinkMax||0):null,rtt:"rtt"in d?(d.rtt||0).toFixed():null,type:d.type||null,effectiveType:d.effectiveType||null,saveData:"saveData"in d?d.saveData:null})}function k(){v(),u()}function w(){l(),u()}l(),u(),e.on("$afterPageTransition",w),e.on(d,"change",k)});
if (window.ue && window.ue.uels) {
    ue.uels("https://c.amazon-adsystem.com/bao-csm/forensics/a9-tq-forensics.min.js");
}


ue.exec(function(d,c){function g(e,c){e&&ue.tag(e+c);return!!e}function n(){for(var e=RegExp("^https://(.*\.(images|ssl-images|media)-amazon\.com|"+c.location.hostname+")/images/","i"),d={},h=0,k=c.performance.getEntriesByType("resource"),l=!1,b,a,m,f=0;f<k.length;f++)if(a=k[f],0<a.transferSize&&a.transferSize>=a.encodedBodySize&&(b=e.exec(String(a.name)))&&3===b.length){a:{b=a.serverTiming||[];for(a=0;a<b.length;a++)if("provider"===b[a].name){b=b[a].description;break a}b=void 0}b&&(l||(l=g(b,"_cdn_fr")),
a=d[b]=(d[b]||0)+1,a>h&&(m=b,h=a))}g(m,"_cdn_mp")}d.ue&&"function"===typeof d.ue.tag&&c.performance&&c.location&&n()},"cdnTagging")(ue_csm,window);


}
/*  */
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="./BFO Page_files/31YXrY93hfL.js" title="Open URL: https://images-eu.ssl-images-amazon.com/images/I/31YXrY93hfL.js (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="./BFO Page_files/31YXrY93hfL.js" title="Open URL in Popup: https://images-eu.ssl-images-amazon.com/images/I/31YXrY93hfL.js (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>

</div>

<noscript>
    <img height="1" width="1" style='display:none;visibility:hidden;' src='//fls-eu.amazon.in/1/batch/1/OP/A21TJRUUN4KGV:257-6328836-0330509:E2WFHK2PD2NF0NVZ86FC$uedata=s:%2Fuedata%2Fuedata%3Fnoscript%26id%3DE2WFHK2PD2NF0NVZ86FC:0' alt=""/>
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: lightgreen; display: inline-block; line-height: normal;"><a href="https://greener-na.aka.amazon.com/GreenerPasture/#objectId=USAmazon:257-6328836-0330509" title="US Pasture: 257-6328836-0330509 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> US</a></span></span></noscript>

<script>window.ue && ue.count && ue.count('CSMLibrarySize', 58457)</script></div>










<script>
(window.AmazonUIPageJS ? AmazonUIPageJS : P).when('afterLoad').execute(function() {
(function(f){var c=window.AmazonUIPageJS||window.P,g=c._namespace||c.attributeErrors,a=g?g("TMCJavascriptAssets",""):c;a.guardFatal?a.guardFatal(f)(a,window):a.execute(function(){f(a,window)})})(function(f,c,g){f.when("A").execute(function(a){var b=new Uint32Array(8);var d=c.crypto||c.msCrypto;if(d){d.getRandomValues(b);d="";for(var e=0;e<b.length;e++)d+=(2>e||5<e?"":"-")+b[e].toString(16).slice(-4);b=d}else b=void 0;b&&(a.preload("https://dr3fr5q4g2ul9.cloudfront.net?"+b),a.preload("https://d2ef20sk9hi1u3.cloudfront.net?"+
b))})});
});
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://dr3fr5q4g2ul9.cloudfront.net/?" title="Open URL: https://dr3fr5q4g2ul9.cloudfront.net? (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://dr3fr5q4g2ul9.cloudfront.net/?" title="Open URL in Popup: https://dr3fr5q4g2ul9.cloudfront.net? (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>
<!-- sp:end-feature:configured-sitewide-assets -->
<!-- sp:feature:csm:body-close -->
<div id="be" style="display:none;visibility:hidden;"><form name="ue_backdetect" action="https://www.amazon.in/dppui/get"><input type="hidden" name="ue_back" value="1"></form>


<script type="text/javascript">
window.ue_ibe = (window.ue_ibe || 0) + 1;
if (window.ue_ibe === 1) {
(function(e,c){function h(b,a){f.push([b,a])}function g(b,a){if(b){var c=e.head||e.getElementsByTagName("head")[0]||e.documentElement,d=e.createElement("script");d.async="async";d.src=b;d.setAttribute("crossorigin","anonymous");a&&a.onerror&&(d.onerror=a.onerror);a&&a.onload&&(d.onload=a.onload);c.insertBefore(d,c.firstChild)}}function k(){ue.uels=g;for(var b=0;b<f.length;b++){var a=f[b];g(a[0],a[1])}ue.deffered=1}var f=[];c.ue&&(ue.uels=h,c.ue.attach&&c.ue.attach("load",k))})(document,window);


if (window.ue && window.ue.uels) {
        var cel_widgets = [ { "c":"celwidget" },{ "s":"#nav-swmslot > div", "id_gen":function(elem, index){ return 'nav_sitewide_msg'; } } ];

                ue.uels("https://images-eu.ssl-images-amazon.com/images/I/31QYhx-taiL.js");
}
var ue_mbl=ue_csm.ue.exec(function(h,a){function s(c){b=c||{};a.AMZNPerformance=b;b.transition=b.transition||{};b.timing=b.timing||{};if(a.csa){var d;b.timing.transitionStart&&(d=b.timing.transitionStart);b.timing.processStart&&(d=b.timing.processStart);d&&(csa("PageTiming")("mark","nativeTransitionStart",d),csa("PageTiming")("mark","transitionStart",d))}h.ue.exec(t,"csm-android-check")()&&b.tags instanceof Array&&(c=-1!=b.tags.indexOf("usesAppStartTime")||b.transition.type?!b.transition.type&&-1<
b.tags.indexOf("usesAppStartTime")?"warm-start":void 0:"view-transition",c&&(b.transition.type=c));n=null;"reload"===e._nt&&h.ue_orct||"intrapage-transition"===e._nt?u(b):"undefined"===typeof e._nt&&f&&f.timing&&f.timing.navigationStart&&a.history&&"function"===typeof a.History&&"object"===typeof a.history&&a.history.length&&1!=a.history.length&&(b.timing.transitionStart=f.timing.navigationStart);p&&e.ssw(q,""+(b.timing.transitionStart||n||""));c=b.transition;d=e._nt?e._nt:void 0;c.subType=d;a.ue&&
a.ue.tag&&a.ue.tag("has-AMZNPerformance");e.isl&&a.uex&&a.uex("at","csm-timing");v()}function w(c){a.ue&&a.ue.count&&a.ue.count("csm-cordova-plugin-failed",1)}function t(){return a.cordova&&a.cordova.platformId&&"android"==a.cordova.platformId}function u(){if(p){var c=e.ssw(q),a=function(){},x=e.count||a,a=e.tag||a,k=b.timing.transitionStart,g=c&&!c.e&&c.val;n=c=g?+c.val:null;k&&g&&k>c?(x("csm.jumpStart.mtsDiff",k-c||0),a("csm-rld-mts-gt")):k&&g?a("csm-rld-mts-leq"):g?k||a("csm-rld-mts-no-new"):a("csm-rld-mts-no-old")}f&&
f.timing&&f.timing.navigationStart?b.timing.transitionStart=f.timing.navigationStart:delete b.timing.transitionStart}function v(){try{a.P.register("AMZNPerformance",function(){return b})}catch(c){}}function r(){if(!b)return"";ue_mbl.cnt=null;var c=b.timing,d=b.transition,d=["mts",l(c.transitionStart),"mps",l(c.processStart),"mtt",d.type,"mtst",d.subType,"mtlt",d.launchType];a.ue&&a.ue.tag&&(c.fr_ovr&&a.ue.tag("fr_ovr"),c.fcp_ovr&&a.ue.tag("fcp_ovr"),d.push("fr_ovr",l(c.fr_ovr),"fcp_ovr",l(c.fcp_ovr)));
for(var c="",e=0;e<d.length;e+=2){var f=d[e],g=d[e+1];"undefined"!==typeof g&&(c+="&"+f+"="+g)}return c}function l(a){if("undefined"!==typeof a&&"undefined"!==typeof m)return a-m}function y(a,d){b&&(m=d,b.timing.transitionStart=a,b.transition.type="view-transition",b.transition.subType="ajax-transition",b.transition.launchType="normal",ue_mbl.cnt=r)}var e=h.ue||{},m=h.ue_t0,q="csm-last-mts",p=1===h.ue_sswmts,n,f=a.performance,b;if(a.P&&a.P.when&&a.P.register)return 1===a.ue_fnt&&(m=a.aPageStart||
h.ue_t0),a.P.when("CSMPlugin").execute(function(a){a.buildAMZNPerformance&&a.buildAMZNPerformance({successCallback:s,failCallback:w})}),{cnt:r,ajax:y}},"mobile-timing")(ue_csm,ue_csm.window);

(function(d){d._uess=function(){var a="";screen&&screen.width&&screen.height&&(a+="&sw="+screen.width+"&sh="+screen.height);var b=function(a){var b=document.documentElement["client"+a];return"CSS1Compat"===document.compatMode&&b||document.body["client"+a]||b},c=b("Width"),b=b("Height");c&&b&&(a+="&vw="+c+"&vh="+b);return a}})(ue_csm);

(function(a){function c(a){d("log",a)}if(1===a.ue_csa_errors){var d=csa("Errors",{producerId:"csa"});a.ue_err.buffer&&d&&(a.ue_err.buffer.forEach(c),a.ue_err.buffer.push=c)}var b=document.ue_backdetect;b&&b.ue_back&&a.ue&&(a.ue.bfini=b.ue_back.value);a.uet&&a.uet("be");a.onLdEnd&&(window.addEventListener?window.addEventListener("load",a.onLdEnd,!1):window.attachEvent&&window.attachEvent("onload",a.onLdEnd));a.ueh&&a.ueh(0,window,"load",a.onLd,1);a.ue&&a.ue.tag&&(a.ue_furl?(b=a.ue_furl.replace(/\./g,
"-"),a.ue.tag(b)):a.ue.tag("nofls"))})(ue_csm);

(function(g,h){function d(a,d){var b={};if(!e||!f)try{var c=h.sessionStorage;c?a&&("undefined"!==typeof d?c.setItem(a,d):b.val=c.getItem(a)):f=1}catch(g){e=1}e&&(b.e=1);return b}var b=g.ue||{},a="",f,e,c,a=d("csmtid");f?a="NA":a.e?a="ET":(a=a.val,a||(a=b.oid||"NI",d("csmtid",a)),c=d(b.oid),c.e||(c.val=c.val||0,d(b.oid,c.val+1)),b.ssw=d);b.tabid=a})(ue_csm,ue_csm.window);

ue_csm.ue.exec(function(e,f){var a=e.ue||{},b=a._wlo,d;if(a.ssw){d=a.ssw("CSM_previousURL").val;var c=f.location,b=b?b:c&&c.href?c.href.split("#")[0]:void 0;c=(b||"")===a.ssw("CSM_previousURL").val;!c&&b&&a.ssw("CSM_previousURL",b);d=c?"reload":d?"intrapage-transition":"first-view"}else d="unknown";a._nt=d},"NavTypeModule")(ue_csm,window);
ue_csm.ue.exec(function(c,a){function g(a){a.run(function(e){d.tag("csm-feature-"+a.name+":"+e);d.isl&&c.uex("at")})}if(a.addEventListener)for(var d=c.ue||{},f=[{name:"touch-enabled",run:function(b){var e=function(){a.removeEventListener("touchstart",c,!0);a.removeEventListener("mousemove",d,!0)},c=function(){b("true");e()},d=function(){b("false");e()};a.addEventListener("touchstart",c,!0);a.addEventListener("mousemove",d,!0)}}],b=0;b<f.length;b++)g(f[b])},"csm-features")(ue_csm,window);


(function(a,e){function c(a){d("recordCounter",a.c,a.v)}var b=e.images,d=csa("Metrics",{producerId:"csa"});b&&b.length&&a.ue.count("totalImages",b.length);a.ue.cv.buffer&&d&&(a.ue.cv.buffer.forEach(c),a.ue.cv.buffer.push=c)})(ue_csm,document);
(function(b){function c(){var d=[];a.log&&a.log.isStub&&a.log.replay(function(a){e(d,a)});a.clog&&a.clog.isStub&&a.clog.replay(function(a){e(d,a)});d.length&&(a._flhs+=1,n(d),p(d))}function g(){a.log&&a.log.isStub&&(a.onflush&&a.onflush.replay&&a.onflush.replay(function(a){a[0]()}),a.onunload&&a.onunload.replay&&a.onunload.replay(function(a){a[0]()}),c())}function e(d,b){var c=b[1],f=b[0],e={};a._lpn[c]=(a._lpn[c]||0)+1;e[c]=f;d.push(e)}function n(b){q&&(a._lpn.csm=(a._lpn.csm||0)+1,b.push({csm:{k:"chk",
f:a._flhs,l:a._lpn,s:"inln"}}))}function p(a){if(h)a=k(a),b.navigator.sendBeacon(l,a);else{a=k(a);var c=new b[f];c.open("POST",l,!0);c.setRequestHeader&&c.setRequestHeader("Content-type","text/plain");c.send(a)}}function k(a){return JSON.stringify({rid:b.ue_id,sid:b.ue_sid,mid:b.ue_mid,mkt:b.ue_mkt,sn:b.ue_sn,reqs:a})}var f="XMLHttpRequest",q=1===b.ue_ddq,a=b.ue,r=b[f]&&"withCredentials"in new b[f],h=b.navigator&&b.navigator.sendBeacon,l="//"+b.ue_furl+"/1/batch/1/OE/",m=b.ue_fci_ft||5E3;a&&(r||h)&&
(a._flhs=a._flhs||0,a._lpn=a._lpn||{},a.attach&&(a.attach("beforeunload",a.exec(g,"fcli-bfu")),a.attach("pagehide",a.exec(g,"fcli-ph"))),m&&b.setTimeout(a.exec(c,"fcli-t"),m),a._ffci=a.exec(c))})(window);


(function(k,c){function l(a,b){return a.filter(function(a){return a.initiatorType==b})}function f(a,c){if(b.t[a]){var g=b.t[a]-b._t0,e=c.filter(function(a){return 0!==a.responseEnd&&m(a)<g}),f=l(e,"script"),h=l(e,"link"),k=l(e,"img"),n=e.map(function(a){return a.name.split("/")[2]}).filter(function(a,b,c){return a&&c.lastIndexOf(a)==b}),q=e.filter(function(a){return a.duration<p}),s=g-Math.max.apply(null,e.map(m))<r|0;"af"==a&&(b._afjs=f.length);return a+":"+[e[d],f[d],h[d],k[d],n[d],q[d],s].join("-")}}
function m(a){return a.responseEnd-(b._t0-c.timing.navigationStart)}function n(){var a=c[h]("resource"),d=f("cf",a),g=f("af",a),a=f("ld",a);delete b._rt;b._ld=b.t.ld-b._t0;b._art&&b._art();return[d,g,a].join("_")}var p=20,r=50,d="length",b=k.ue,h="getEntriesByType";b._rre=m;b._rt=c&&c.timing&&c[h]&&n})(ue_csm,window.performance);


(function(c,d){var b=c.ue,a=d.navigator;b&&b.tag&&a&&(a=a.connection||a.mozConnection||a.webkitConnection)&&a.type&&b.tag("netInfo:"+a.type)})(ue_csm,window);


(function(c,d){function h(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=b.encode(e);if(e[k]){var g=b.metaSep,e=e[k],l=b.metaPairSep,h=[],m=void 0;for(m in e)e.hasOwnProperty(m)&&h.push(m+"="+e[m]);e=h.join(l);f+=g+e}c.push(f)}return c.join(b.resourceSep)}function s(a){var b=a[k]=a[k]||{};b[t]||(b[t]=c.ue_mid);b[u]||(b[u]=c.ue_sid);b[f]||(b[f]=c.ue_id);b.csm=1;a="//"+c.ue_furl+"/1/"+a[v]+"/1/OP/"+a[w]+"/"+a[x]+"/"+h([a],y);if(n)try{n.call(d[p],a)}catch(g){c.ue.sbf=1,(new Image).src=a}else(new Image).src=
a}function q(){g&&g.isStub&&g.replay(function(a,b,c){a=a[0];b=a[k]=a[k]||{};b[f]=b[f]||c;s(a)});l.impression=s;g=null}if(!(1<c.ueinit)){var k="metadata",x="impressionType",v="foresterChannel",w="programGroup",t="marketplaceId",u="session",f="requestId",p="navigator",l=c.ue||{},n=d[p]&&d[p].sendBeacon,r=function(a,b,c,d){return{encode:d,resourceSep:a,metaSep:b,metaPairSep:c}},y=r("","?","&",function(a){return h(a.impressionData,z)}),z=r("/",":",",",function(a){return a.featureName+":"+h(a.resources,
A)}),A=r(",","@","|",function(a){return a.id}),g=l.impression;n?q():(l.attach("load",q),l.attach("beforeunload",q));try{d.P&&d.P.register&&d.P.register("impression-client",function(){})}catch(B){c.ueLogError(B,{logLevel:"WARN"})}}})(ue_csm,window);



var ue_pty = "VoltronPayments";



    var uept = window.uept || {
        "pageType":"VoltronPayments"
    };

var ue_adb = 4;
var ue_adb_rtla = 1;
ue_csm.ue.exec(function(y,a){function t(){if(d&&f){var a;a:{try{a=d.getItem(g);break a}catch(c){}a=void 0}if(a)return b=a,!0}return!1}function u(){if(a.fetch)fetch(m).then(function(a){if(!a.ok)throw Error(a.statusText);return a.text?a.text():null}).then(function(b){b?(-1<b.indexOf("window.ue_adb_chk = 1")&&(a.ue_adb_chk=1),n()):h()})["catch"](h);else e.uels(m,{onerror:h,onload:n})}function h(){b=k;l();if(f)try{d.setItem(g,b)}catch(a){}}function n(){b=1===a.ue_adb_chk?p:k;l();if(f)try{d.setItem(g,
b)}catch(c){}}function q(){a.ue_adb_rtla&&c&&0<c.ec&&!1===r&&(c.elh=null,ueLogError({m:"Hit Info",fromOnError:1},{logLevel:"INFO",adb:b}),r=!0)}function l(){e.tag(b);e.isl&&a.uex&&uex("at",b);s&&s.updateCsmHit("adb",b);c&&0<c.ec?q():a.ue_adb_rtla&&c&&(c.elh=q)}function v(){return b}if(a.ue_adb){a.ue_fadb=a.ue_fadb||10;var e=a.ue,k="adblk_yes",p="adblk_no",m="https://m.media-amazon.com/images/G/01/csm/showads.v2.js?action=ads&banner.id=_300x250Banner_&AdType=_google_ads_",b="adblk_unk",d;a:{try{d=
a.localStorage;break a}catch(z){}d=void 0}var g="csm:adb",c=a.ue_err,s=e.cookie,f=void 0!==a.localStorage,w=Math.random()>1-1/a.ue_fadb,r=!1,x=t();w||!x?u():l();a.ue_isAdb=v;a.ue_isAdb.unk="adblk_unk";a.ue_isAdb.no=p;a.ue_isAdb.yes=k}},"adb")(document,window);




(function(c,l,m){function h(a){if(a)try{if(a.id)return"//*[@id='"+a.id+"']";var b,d=1,e;for(e=a.previousSibling;e;e=e.previousSibling)e.nodeName===a.nodeName&&(d+=1);b=d;var c=a.nodeName;1!==b&&(c+="["+b+"]");a.parentNode&&(c=h(a.parentNode)+"/"+c);return c}catch(f){return"DETACHED"}}function f(a){if(a&&a.getAttribute)return a.getAttribute(k)?a.getAttribute(k):f(a.parentElement)}var k="data-cel-widget",g=!1,d=[];(c.ue||{}).isBF=function(){try{var a=JSON.parse(localStorage["csm-bf"]||"[]"),b=0<=a.indexOf(c.ue_id);
a.unshift(c.ue_id);a=a.slice(0,20);localStorage["csm-bf"]=JSON.stringify(a);return b}catch(d){return!1}}();c.ue_utils={getXPath:h,getFirstAscendingWidget:function(a,b){c.ue_cel&&c.ue_fem?!0===g?b(f(a)):d.push({element:a,callback:b}):b()},notifyWidgetsLabeled:function(){if(!1===g){g=!0;for(var a=f,b=0;b<d.length;b++)if(d[b].hasOwnProperty("callback")&&d[b].hasOwnProperty("element")){var c=d[b].callback,e=d[b].element;"function"===typeof c&&"function"===typeof a&&c(a(e))}d=null}},extractStringValue:function(a){if("string"===
typeof a)return a}}})(ue_csm,window,document);


(function(a){a.ue_cel||(a.ue_cel=function(){function f(a,c){c?c.r=v:c={r:v,c:1};!ue_csm.ue_sclog&&c.clog&&d.clog?d.clog(a,c.ns||q,c):c.glog&&d.glog?d.glog(a,c.ns||q,c):d.log(a,c.ns||q,c)}function m(a,d){"function"===typeof g&&g("log",{schemaId:s+".RdCSI.1",eventType:a,clientData:d},{ent:{page:["requestId"]}})}function c(){var a=n.length;if(0<a){for(var c=[],b=0;b<a;b++){var F=n[b].api;F.ready()?(F.on({ts:d.d,ns:q}),e.push(n[b]),f({k:"mso",n:n[b].name,t:d.d()})):c.push(n[b])}n=c}}function h(){if(!h.executed){for(var a=
0;a<e.length;a++)e[a].api.off&&e[a].api.off({ts:d.d,ns:q});A();f({k:"eod",t0:d.t0,t:d.d()},{c:1,il:1});h.executed=1;for(a=0;a<e.length;a++)n.push(e[a]);e=[];b(t);b(x)}}function A(a){f({k:"hrt",t:d.d()},{c:1,il:1,n:a});l=Math.min(w,r*l);y()}function y(){b(x);x=k(function(){A(!0)},l)}function u(){h.executed||A()}var p=a.window,k=p.setTimeout,b=p.clearTimeout,r=1.5,w=p.ue_cel_max_hrt||3E4,s="robotdetection",n=[],e=[],q=a.ue_cel_ns||"cel",t,x,d=a.ue,E=a.uet,B=a.uex,v=d.rid,C=p.csa,g,l=p.ue_cel_hrt_int||
3E3,z=p.requestAnimationFrame||function(a){a()};!a.ue_cel_lclia&&C&&(g=C("Events",{producerId:s}));if(d.isBF)f({k:"bft",t:d.d()});else{"function"==typeof E&&E("bb","csmCELLSframework",{wb:1});k(c,0);d.onunload(h);if(d.onflush)d.onflush(u);t=k(h,6E5);y();"function"==typeof B&&B("ld","csmCELLSframework",{wb:1});return{registerModule:function(a,b){n.push({name:a,api:b});f({k:"mrg",n:a,t:d.d()});c()},reset:function(a){f({k:"rst",t0:d.t0,t:d.d()});n=n.concat(e);e=[];for(var r=n.length,g=0;g<r;g++)n[g].api.off(),
n[g].api.reset();v=a||d.rid;c();b(t);t=k(h,6E5);h.executed=0},timeout:function(a,d){return k(function(){z(function(){h.executed||a()})},d)},log:f,csaEventLog:m,off:h}}}())})(ue_csm);
(function(a){a.ue_pdm||!a.ue_cel||a.ue.isBF||(a.ue_pdm=function(){function f(){try{var d=b.screen;if(d){var c={w:d.width,aw:d.availWidth,h:d.height,ah:d.availHeight,cd:d.colorDepth,pd:d.pixelDepth};e&&e.w===c.w&&e.h===c.h&&e.aw===c.aw&&e.ah===c.ah&&e.pd===c.pd&&e.cd===c.cd||(e=c,e.t=s(),e.k="sci",E(e),!C&&g&&l("sci",{h:(e.h||"0")+""}))}var k=r.body||{},h=r.documentElement||{},m={w:Math.max(k.scrollWidth||0,k.offsetWidth||0,h.clientWidth||0,h.scrollWidth||0,h.offsetWidth||0),h:Math.max(k.scrollHeight||
0,k.offsetHeight||0,h.clientHeight||0,h.scrollHeight||0,h.offsetHeight||0)};q&&q.w===m.w&&q.h===m.h||(q=m,q.t=s(),q.k="doi",E(q));w=a.ue_cel.timeout(f,n);x+=1}catch(p){b.ueLogError&&ueLogError(p,{attribution:"csm-cel-page-module",logLevel:"WARN"})}}function m(){u("ebl","default",!1)}function c(){u("efo","default",!0)}function h(){u("ebl","app",!1)}function A(){u("efo","app",!0)}function y(){b.setTimeout(function(){r[H]?u("ebl","pageviz",!1):u("efo","pageviz",!0)},0)}function u(a,d,c){t!==c&&(E({k:a,
t:s(),s:d},{ff:!0===c?0:1}),!C&&g&&l(a,{t:(s()||"0")+"",s:d}));t=c}function p(){d.attach&&(z&&d.attach(D,y,r),I&&P.when("mash").execute(function(a){a&&a.addEventListener&&(a.addEventListener("appPause",h),a.addEventListener("appResume",A))}),d.attach("blur",m,b),d.attach("focus",c,b))}function k(){d.detach&&(z&&d.detach(D,y,r),I&&P.when("mash").execute(function(a){a&&a.removeEventListener&&(a.removeEventListener("appPause",h),a.removeEventListener("appResume",A))}),d.detach("blur",m,b),d.detach("focus",
c,b))}var b=a.window,r=a.document,w,s,n,e,q,t=null,x=0,d=a.ue,E=a.ue_cel.log,B=a.uet,v=a.uex,C=a.ue_cel_lclia,g=b.csa,l=a.ue_cel.csaEventLog,z=!!d.pageViz,D=z&&d.pageViz.event,H=z&&d.pageViz.propHid,I=b.P&&b.P.when;"function"==typeof B&&B("bb","csmCELLSpdm",{wb:1});return{on:function(a){n=a.timespan||500;s=a.ts;p();a=b.location;E({k:"pmd",o:a.origin,p:a.pathname,t:s()});f();"function"==typeof v&&v("ld","csmCELLSpdm",{wb:1})},off:function(a){clearTimeout(w);k();d.count&&d.count("cel.PDM.TotalExecutions",
x)},ready:function(){return r.body&&a.ue_cel&&a.ue_cel.log},reset:function(){e=q=null}}}(),a.ue_cel&&a.ue_cel.registerModule("page module",a.ue_pdm))})(ue_csm);
(function(a){a.ue_vpm||!a.ue_cel||a.ue.isBF||(a.ue_vpm=function(){function f(){var a=y(),b={w:k.innerWidth,h:k.innerHeight,x:k.pageXOffset,y:k.pageYOffset};c&&c.w==b.w&&c.h==b.h&&c.x==b.x&&c.y==b.y||(b.t=a,b.k="vpi",c=b,r(c,{clog:1}),!q&&t&&x("vpi",{t:(c.t||"0")+"",h:(c.h||"0")+"",y:(c.y||"0")+"",w:(c.w||"0")+"",x:(c.x||"0")+""}));h=0;u=y()-a;p+=1}function m(){h||(h=a.ue_cel.timeout(f,A))}var c,h,A,y,u=0,p=0,k=a.window,b=a.ue,r=a.ue_cel.log,w=a.uet,s=a.uex,n=b.attach,e=b.detach,q=a.ue_cel_lclia,t=
k.csa,x=a.ue_cel.csaEventLog;"function"==typeof w&&w("bb","csmCELLSvpm",{wb:1});return{on:function(a){y=a.ts;A=a.timespan||100;f();n&&(n("scroll",m),n("resize",m));"function"==typeof s&&s("ld","csmCELLSvpm",{wb:1})},off:function(a){clearTimeout(h);e&&(e("scroll",m),e("resize",m));b.count&&(b.count("cel.VPI.TotalExecutions",p),b.count("cel.VPI.TotalExecutionTime",u),b.count("cel.VPI.AverageExecutionTime",u/p))},ready:function(){return a.ue_cel&&a.ue_cel.log},reset:function(){c=void 0},getVpi:function(){return c}}}(),
a.ue_cel&&a.ue_cel.registerModule("viewport module",a.ue_vpm))})(ue_csm);
(function(a){if(!a.ue_fem&&a.ue_cel&&a.ue_utils){var f=a.ue||{},m=a.window,c=m.document;!f.isBF&&!a.ue_fem&&c.querySelector&&m.getComputedStyle&&[].forEach&&(a.ue_fem=function(){function h(a,d){return a>d?3>a-d:3>d-a}function A(a,d){var c=m.pageXOffset,b=m.pageYOffset,k;a:{try{if(a){var g=a.getBoundingClientRect(),e,r=0===a.offsetWidth&&0===a.offsetHeight;c:{for(var f=a.parentNode,w=g.left||0,n=g.top||0,p=g.width||0,q=g.height||0;f&&f!==document.body;){var l;d:{try{var s=void 0;if(f)var G=f.getBoundingClientRect(),
s={x:G.left||0,y:G.top||0,w:G.width||0,h:G.height||0};else s=void 0;l=s;break d}catch(v){}l=void 0}var t=window.getComputedStyle(f),u="hidden"===t.overflow,y=u||"hidden"===t.overflowX,z=u||"hidden"===t.overflowY,J=n+q-1<l.y+1||n+1>l.y+l.h-1;if((w+p-1<l.x+1||w+1>l.x+l.w-1)&&y||J&&z){e=!0;break c}f=f.parentNode}e=!1}k={x:g.left+c||0,y:g.top+b||0,w:g.width||0,h:g.height||0,d:(r||e)|0}}else k=void 0;break a}catch(A){}k=void 0}if(k&&!a.cel_b)a.cel_b=k,C({n:a.getAttribute(x),w:a.cel_b.w,h:a.cel_b.h,d:a.cel_b.d,
x:a.cel_b.x,y:a.cel_b.y,t:d,k:"ewi",cl:a.className},{clog:1});else{if(c=k)c=a.cel_b,b=k,c=b.d===c.d&&1===b.d?!1:!(h(c.x,b.x)&&h(c.y,b.y)&&h(c.w,b.w)&&h(c.h,b.h)&&c.d===b.d);c&&(a.cel_b=k,C({n:a.getAttribute(x),w:a.cel_b.w,h:a.cel_b.h,d:a.cel_b.d,x:a.cel_b.x,y:a.cel_b.y,t:d,k:"ewi"},{clog:1}))}}function y(b,g){var h;h=b.c?c.getElementsByClassName(b.c):b.id?[c.getElementById(b.id)]:c.querySelectorAll(b.s);b.w=[];for(var f=0;f<h.length;f++){var e=h[f];if(e){if(!e.getAttribute(x)){var r=e.getAttribute("cel_widget_id")||
(b.id_gen||v)(e,f)||e.id;e.setAttribute(x,r)}b.w.push(e);k(Q,e,g)}}!1===B&&(E++,E===d.length&&(B=!0,a.ue_utils.notifyWidgetsLabeled()))}function u(a,c){g.contains(a)||C({n:a.getAttribute(x),t:c,k:"ewd"},{clog:1})}function p(a){K.length&&ue_cel.timeout(function(){if(q){for(var c=R(),d=!1;R()-c<e&&!d;){for(d=S;0<d--&&0<K.length;){var b=K.shift();T[b.type](b.elem,b.time)}d=0===K.length}U++;p(a)}},0)}function k(a,c,d){K.push({type:a,elem:c,time:d})}function b(a,c){for(var b=0;b<d.length;b++)for(var e=
d[b].w||[],g=0;g<e.length;g++)k(a,e[g],c)}function r(){M||(M=a.ue_cel.timeout(function(){M=null;var c=t();b(W,c);for(var g=0;g<d.length;g++)k(X,d[g],c);0===d.length&&!1===B&&(B=!0,a.ue_utils.notifyWidgetsLabeled());p(c)},n))}function w(){M||N||(N=a.ue_cel.timeout(function(){N=null;var a=t();b(Q,a);p(a)},n))}function s(){return z&&D&&g&&g.contains&&g.getBoundingClientRect&&t}var n=50,e=4.5,q=!1,t,x="data-cel-widget",d=[],E=0,B=!1,v=function(){},C=a.ue_cel.log,g,l,z,D,H=m.MutationObserver||m.WebKitMutationObserver||
m.MozMutationObserver,I=!!H,F,G,O="DOMAttrModified",L="DOMNodeInserted",J="DOMNodeRemoved",N,M,K=[],U=0,S=null,W="removedWidget",X="updateWidgets",Q="processWidget",T,V=m.performance||{},R=V.now&&function(){return V.now()}||function(){return Date.now()};"function"==typeof uet&&uet("bb","csmCELLSfem",{wb:1});return{on:function(b){function e(){if(s()){T={removedWidget:u,updateWidgets:y,processWidget:A};if(I){var a={attributes:!0,subtree:!0};F=new H(w);G=new H(r);F.observe(g,a);G.observe(g,{childList:!0,
subtree:!0});G.observe(l,a)}else z.call(g,O,w),z.call(g,L,r),z.call(g,J,r),z.call(l,L,w),z.call(l,J,w);r()}}g=c.body;l=c.head;z=g.addEventListener;D=g.removeEventListener;t=b.ts;d=a.cel_widgets||[];S=b.bs||5;f.deffered?e():f.attach&&f.attach("load",e);"function"==typeof uex&&uex("ld","csmCELLSfem",{wb:1});q=!0},off:function(){s()&&(G&&(G.disconnect(),G=null),F&&(F.disconnect(),F=null),D.call(g,O,w),D.call(g,L,r),D.call(g,J,r),D.call(l,L,w),D.call(l,J,w));f.count&&f.count("cel.widgets.batchesProcessed",
U);q=!1},ready:function(){return a.ue_cel&&a.ue_cel.log},reset:function(){d=a.cel_widgets||[]}}}(),a.ue_cel&&a.ue_fem&&a.ue_cel.registerModule("features module",a.ue_fem))}})(ue_csm);
(function(a){!a.ue_mcm&&a.ue_cel&&a.ue_utils&&!a.ue.isBF&&(a.ue_mcm=function(){function f(a,b){var h=a.srcElement||a.target||{},f={k:m,w:(b||{}).ow||(A.body||{}).scrollWidth,h:(b||{}).oh||(A.body||{}).scrollHeight,t:(b||{}).ots||c(),x:a.pageX,y:a.pageY,p:p.getXPath(h),n:h.nodeName};y&&"function"===typeof y.now&&a.timeStamp&&(f.dt=(b||{}).odt||y.now()-a.timeStamp,f.dt=parseFloat(f.dt.toFixed(2)));a.button&&(f.b=a.button);h.href&&(f.r=p.extractStringValue(h.href));h.id&&(f.i=h.id);h.className&&h.className.split&&
(f.c=h.className.split(/\s+/));u(f,{c:1})}var m="mcm",c,h=a.window,A=h.document,y=h.performance,u=a.ue_cel.log,p=a.ue_utils;return{on:function(k){c=k.ts;a.ue_cel_stub&&a.ue_cel_stub.replayModule(m,f);h.addEventListener&&h.addEventListener("mousedown",f,!0)},off:function(a){h.addEventListener&&h.removeEventListener("mousedown",f,!0)},ready:function(){return a.ue_cel&&a.ue_cel.log},reset:function(){}}}(),a.ue_cel&&a.ue_cel.registerModule("mouse click module",a.ue_mcm))})(ue_csm);
(function(a){a.ue_mmm||!a.ue_cel||a.ue.isBF||(a.ue_mmm=function(f){function m(a,c){var b={x:a.pageX||a.x||0,y:a.pageY||a.y||0,t:p()};!c&&l&&(b.t-l.t<A||b.x==l.x&&b.y==l.y)||(l=b,v.push(b))}function c(){if(v.length){E=F.now();for(var a=0;a<v.length;a++){var c=v[a],b=a;z=v[g];D=c;var e=void 0;if(!(e=2>b)){e=void 0;a:if(v[b].t-v[b-1].t>h)e=0;else{for(e=g+1;e<b;e++){var f=z,k=D,l=v[e];H=(k.x-f.x)*(f.y-l.y)-(f.x-l.x)*(k.y-f.y);if(H*H/((k.x-f.x)*(k.x-f.x)+(k.y-f.y)*(k.y-f.y))>y){e=0;break a}}e=1}e=!e}(I=
e)?g=b-1:C.pop();C.push(c)}B=F.now()-E;q=Math.min(q,B);t=Math.max(t,B);x=(x*d+B)/(d+1);d+=1;n({k:u,e:C,min:Math.floor(1E3*q),max:Math.floor(1E3*t),avg:Math.floor(1E3*x)},{c:1});v=[];C=[];g=0}}var h=100,A=20,y=25,u="mmm1",p,k,b=a.window,r=b.document,w=b.setInterval,s=a.ue,n=a.ue_cel.log,e,q=1E3,t=0,x=0,d=0,E,B,v=[],C=[],g=0,l,z,D,H,I,F=f&&f.now&&f||Date.now&&Date||{now:function(){return(new Date).getTime()}};return{on:function(a){p=a.ts;k=a.ns;s.attach&&s.attach("mousemove",m,r);e=w(c,3E3)},off:function(a){k&&
(l&&m(l,!0),c());clearInterval(e);s.detach&&s.detach("mousemove",m,r)},ready:function(){return a.ue_cel&&a.ue_cel.log},reset:function(){v=[];C=[];g=0;l=null}}}(window.performance),a.ue_cel&&a.ue_cel.registerModule("mouse move module",a.ue_mmm))})(ue_csm);



ue_csm.ue.exec(function(b,c){var e=function(){},f=function(){return{send:function(b,d){if(d&&b){var a;if(c.XDomainRequest)a=new XDomainRequest,a.onerror=e,a.ontimeout=e,a.onprogress=e,a.onload=e,a.timeout=0;else if(c.XMLHttpRequest){if(a=new XMLHttpRequest,!("withCredentials"in a))throw"";}else a=void 0;if(!a)throw"";a.open("POST",b,!0);a.setRequestHeader&&a.setRequestHeader("Content-type","text/plain");a.send(d)}},isSupported:!0}}(),g=function(){return{send:function(c,d){if(c&&d)if(navigator.sendBeacon(c,
d))b.ue_sbuimp&&b.ue&&b.ue.ssw&&b.ue.ssw("eelsts","scs");else throw"";},isSupported:!!navigator.sendBeacon&&!(c.cordova&&c.cordova.platformId&&"ios"==c.cordova.platformId)}}();b.ue._ajx=f;b.ue._sBcn=g},"Transportation-clients")(ue_csm,window);
ue_csm.ue.exec(function(b,k){function A(){for(var a=0;a<arguments.length;a++){var c=arguments[a];try{var h;if(c.isSupported){var b=t.buildPayload(l,e);h=c.send(J,b)}else throw dummyException;return h}catch(d){}}B({m:"All supported clients failed",attribution:"CSMSushiClient_TRANSPORTATION_FAIL",f:"sushi-client.js",logLevel:"ERROR"},k.ue_err_chan||"jserr")}function m(){if(e.length){for(var a=0;a<n.length;a++)n[a]();A(d._sBcn||{},d._ajx||{});e=[];f={};l={};u=v=q=w=0}}function K(){var a=new Date,c=function(a){return 10>
a?"0"+a:a};return Date.prototype.toISOString?a.toISOString():a.getUTCFullYear()+"-"+c(a.getUTCMonth()+1)+"-"+c(a.getUTCDate())+"T"+c(a.getUTCHours())+":"+c(a.getUTCMinutes())+":"+c(a.getUTCSeconds())+"."+String((a.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}function x(a){try{return JSON.stringify(a)}catch(c){}return null}function C(a,c,h,g){var p=!1;g=g||{};r++;r==D&&B({m:"Max number of Sushi Logs exceeded",f:"sushi-client.js",logLevel:"ERROR",attribution:"CSMSushiClient_MAX_CALLS"},k.ue_err_chan||
"jserr");var f;if(f=!(r>=D))(f=a&&-1<a.constructor.toString().indexOf("Object")&&c&&-1<c.constructor.toString().indexOf("String")&&h&&-1<h.constructor.toString().indexOf("String"))||L++;f&&(d.count&&d.count("Event:"+h,1),a.producerId=a.producerId||c,a.schemaId=a.schemaId||h,a.timestamp=K(),c=Date.now?Date.now():+new Date,h=Math.random().toString().substring(2,12),a.messageId=b.ue_id+"-"+c+"-"+h,g&&!g.ssd&&(a.sessionId=a.sessionId||b.ue_sid,a.requestId=a.requestId||b.ue_id,a.obfuscatedMarketplaceId=
a.obfuscatedMarketplaceId||b.ue_mid),(c=x(a))?(c=c.length,(e.length==M||q+c>N)&&m(),q+=c,a={data:t.compressEvent(a)},e.push(a),(g||{}).n?0===E?m():u||(u=k.setTimeout(m,E)):v||(v=k.setTimeout(m,O)),p=!0):p=!1);!p&&b.ue_int&&console.error("Invalid JS Nexus API call");return p}function F(){if(!G){for(var a=0;a<y.length;a++)y[a]();for(a=0;a<n.length;a++)n[a]();e.length&&(b.ue_sbuimp&&b.ue&&b.ue.ssw&&(a=x({dct:l,evt:e}),b.ue.ssw("eeldata",a),b.ue.ssw("eelsts","unk")),A(d._sBcn||{}));G=!0}}function H(a){y.push(a)}
function I(a){n.push(a)}var D=1E3,M=499,N=524288,s=function(){},d=b.ue||{},B=d.log||s,P=b.uex||s;(b.uet||s)("bb","ue_sushi_v1",{wb:1});var J=b.ue_surl||"https://unagi-na.amazon.com/1/events/com.amazon.csm.nexusclient.gamma",Q=["messageId","timestamp"],z="#",e=[],f={},l={},q=0,w=0,L=0,r=0,y=[],n=[],G=!1,u,v,E=void 0===b.ue_hpsi?1E3:b.ue_hpsi,O=void 0===b.ue_lpsi?1E4:b.ue_lpsi,t=function(){function a(a){f[a]=z+w++;l[f[a]]=a;return f[a]}function c(b){if(!(b instanceof Function)){if(b instanceof Array){for(var g=
[],d=b.length,e=0;e<d;e++)g[e]=c(b[e]);return g}if(b instanceof Object){g={};for(d in b)b.hasOwnProperty(d)&&(g[f[d]?f[d]:a(d)]=-1===Q.indexOf(d)?c(b[d]):b[d]);return g}return"string"===typeof b&&(b.length>(z+w).length||b.charAt(0)===z)?f[b]?f[b]:a(b):b}}return{compressEvent:c,buildPayload:function(){return x({cs:{dct:l},events:e})}}}();(function(){if(d.event&&d.event.isStub){if(b.ue_sbuimp&&b.ue&&b.ue.ssw){var a=b.ue.ssw("eelsts").val;if(a&&"unk"===a&&(a=b.ue.ssw("eeldata").val)){var c;a:{try{c=
JSON.parse(a);break a}catch(f){}c=null}c&&c.evt instanceof Array&&c.dct instanceof Object&&(e=c.evt,l=c.dct,e&&l&&(m(),b.ue.ssw("eeldata","{}"),b.ue.ssw("eelsts","scs")))}}d.event.replay(function(a){a[3]=a[3]||{};a[3].n=1;C.apply(this,a)});d.onSushiUnload.replay(function(a){H(a[0])});d.onSushiFlush.replay(function(a){I(a[0])})}})();d.attach("beforeunload",F);d.attach("pagehide",F);d._cmps=t;d.event=C;d.event.reset=function(){r=0};d.onSushiUnload=H;d.onSushiFlush=I;try{k.P&&k.P.register&&k.P.register("sushi-client",
s)}catch(R){b.ueLogError(R,{logLevel:"WARN"})}P("ld","ue_sushi_v1",{wb:1})},"Nxs-JS-Client")(ue_csm,window);


ue_csm.ue_unrt = 1500;
(function(d,b,t){function u(a,g){var c=a.srcElement||a.target||{},b={k:v,t:g.t,dt:g.dt,x:a.pageX,y:a.pageY,p:e.getXPath(c),n:c.nodeName};a.button&&(b.b=a.button);c.type&&(b.ty=c.type);c.href&&(b.r=e.extractStringValue(c.href));c.id&&(b.i=c.id);c.className&&c.className.split&&(b.c=c.className.split(/\s+/));h+=1;e.getFirstAscendingWidget(c,function(a){b.wd=a;d.ue.log(b,r)})}function w(a){if(!x(a.srcElement||a.target)){m+=1;n=!0;var g=f=d.ue.d(),c;p&&"function"===typeof p.now&&a.timeStamp&&(c=p.now()-
a.timeStamp,c=parseFloat(c.toFixed(2)));s=b.setTimeout(function(){u(a,{t:g,dt:c})},y)}}function z(a){if(a){var b=a.filter(A);a.length!==b.length&&(q=!0,k=d.ue.d(),n&&q&&(k&&f&&d.ue.log({k:B,t:f,m:Math.abs(k-f)},r),l(),q=!1,k=0))}}function A(a){if(!a)return!1;var b="characterData"===a.type?a.target.parentElement:a.target;if(!b||!b.hasAttributes||!b.attributes)return!1;var c={"class":"gw-clock gw-clock-aria s-item-container-height-auto feed-carousel using-mouse kfs-inner-container".split(" "),id:["dealClock",
"deal_expiry_timer","timer"],role:["timer"]},d=!1;Object.keys(c).forEach(function(a){var e=b.attributes[a]?b.attributes[a].value:"";(c[a]||"").forEach(function(a){-1!==e.indexOf(a)&&(d=!0)})});return d}function x(a){if(!a)return!1;var b=(e.extractStringValue(a.nodeName)||"").toLowerCase(),c=(e.extractStringValue(a.type)||"").toLowerCase(),d=(e.extractStringValue(a.href)||"").toLowerCase();a=(e.extractStringValue(a.id)||"").toLowerCase();var f="checkbox color date datetime-local email file month number password radio range reset search tel text time url week".split(" ");
if(-1!==["select","textarea","html"].indexOf(b)||"input"===b&&-1!==f.indexOf(c)||"a"===b&&-1!==d.indexOf("http")||-1!==["sitbreaderrightpageturner","sitbreaderleftpageturner","sitbreaderpagecontainer"].indexOf(a))return!0}function l(){n=!1;f=0;b.clearTimeout(s)}function C(){b.ue.onunload(function(){ue.count("armored-cxguardrails.unresponsive-clicks.violations",h);ue.count("armored-cxguardrails.unresponsive-clicks.violationRate",h/m*100||0)})}if(b.MutationObserver&&b.addEventListener&&Object.keys&&
d&&d.ue&&d.ue.log&&d.ue_unrt&&d.ue_utils){var y=d.ue_unrt,r="cel",v="unr_mcm",B="res_mcm",p=b.performance,e=d.ue_utils,n=!1,f=0,s=0,q=!1,k=0,h=0,m=0;b.addEventListener&&(b.addEventListener("mousedown",w,!0),b.addEventListener("beforeunload",l,!0),b.addEventListener("visibilitychange",l,!0),b.addEventListener("pagehide",l,!0));b.ue&&b.ue.event&&b.ue.onSushiUnload&&b.ue.onunload&&C();(new MutationObserver(z)).observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}})(ue_csm,window,document);


ue_csm.ue.exec(function(g,e){if(e.ue_err){var f="";e.ue_err.errorHandlers||(e.ue_err.errorHandlers=[]);e.ue_err.errorHandlers.push({name:"fctx",handler:function(a){if(!a.logLevel||"FATAL"===a.logLevel)if(f=g.getElementsByTagName("html")[0].innerHTML){var b=f.indexOf("var ue_t0=ue_t0||+new Date();");if(-1!==b){var b=f.substr(0,b).split(String.fromCharCode(10)),d=Math.max(b.length-10-1,0),b=b.slice(d,b.length-1);a.fcsmln=d+b.length+1;a.cinfo=a.cinfo||{};for(var c=0;c<b.length;c++)a.cinfo[d+c+1+""]=
b[c]}b=f.split(String.fromCharCode(10));a.cinfo=a.cinfo||{};if(!(a.f||void 0===a.l||a.l in a.cinfo))for(c=+a.l-1,d=Math.max(c-5,0),c=Math.min(c+5,b.length-1);d<=c;d++)a.cinfo[d+1+""]=b[d]}}})}},"fatals-context")(document,window);


(function(m,a){function c(k){function f(b){b&&"string"===typeof b&&(b=(b=b.match(/^(?:https?:)?\/\/(.*?)(\/|$)/i))&&1<b.length?b[1]:null,b&&b&&("number"===typeof e[b]?e[b]++:e[b]=1))}function d(b){var e=10,d=+new Date;b&&b.timeRemaining?e=b.timeRemaining():b={timeRemaining:function(){return Math.max(0,e-(+new Date-d))}};for(var c=a.performance.getEntries(),k=e;g<c.length&&k>n;)c[g].name&&f(c[g].name),g++,k=b.timeRemaining();g>=c.length?h(!0):l()}function h(b){if(!b){b=m.scripts;var c;if(b)for(var d=
0;d<b.length;d++)(c=b[d].getAttribute("src"))&&"undefined"!==c&&f(c)}0<Object.keys(e).length&&(p&&ue_csm.ue&&ue_csm.ue.event&&ue_csm.ue.event({domains:e,pageType:a.ue_pty||null,subPageType:a.ue_spty||null,pageTypeId:a.ue_pti||null},"csm","csm.CrossOriginDomains.2"),a.ue_ext=e)}function l(){!0===k?d():a.requestIdleCallback?a.requestIdleCallback(d):a.requestAnimationFrame?a.requestAnimationFrame(d):a.setTimeout(d,100)}function c(){if(a.performance&&a.performance.getEntries){var b=a.performance.getEntries();
!b||0>=b.length?h(!1):l()}else h(!1)}var e=a.ue_ext||{};a.ue_ext||c();return e}function q(){setTimeout(c,r)}var s=a.ue_dserr||!1,p=!0,n=1,r=2E3,g=0;a.ue_err&&s&&(a.ue_err.errorHandlers||(a.ue_err.errorHandlers=[]),a.ue_err.errorHandlers.push({name:"ext",handler:function(a){if(!a.logLevel||"FATAL"===a.logLevel){var f=c(!0),d=[],h;for(h in f){var f=h,g=f.match(/amazon(\.com?)?\.\w{2,3}$/i);g&&1<g.length||-1!==f.indexOf("amazon-adsystem.com")||-1!==f.indexOf("amazonpay.com")||-1!==f.indexOf("cloudfront-labs.amazonaws.com")||
d.push(h)}a.ext=d}}}));a.ue&&a.ue.isl?c():a.ue&&ue.attach&&ue.attach("load",q)})(document,window);





var ue_wtc_c = 3;
ue_csm.ue.exec(function(b,e){function l(){for(var a=0;a<f.length;a++)a:for(var d=s.replace(A,f[a])+g[f[a]]+t,c=arguments,b=0;b<c.length;b++)try{c[b].send(d);break a}catch(e){}g={};f=[];n=0;k=p}function u(){B?l(q):l(C,q)}function v(a,m,c){r++;if(r>w)d.count&&1==r-w&&(d.count("WeblabTriggerThresholdReached",1),b.ue_int&&console.error("Number of max call reached. Data will no longer be send"));else{var h=c||{};h&&-1<h.constructor.toString().indexOf(D)&&a&&-1<a.constructor.toString().indexOf(x)&&m&&-1<
m.constructor.toString().indexOf(x)?(h=b.ue_id,c&&c.rid&&(h=c.rid),c=h,a=encodeURIComponent(",wl="+a+"/"+m),2E3>a.length+p?(2E3<k+a.length&&u(),void 0===g[c]&&(g[c]="",f.push(c)),g[c]+=a,k+=a.length,n||(n=e.setTimeout(u,E))):b.ue_int&&console.error("Invalid API call. The input provided is over 2000 chars.")):d.count&&(d.count("WeblabTriggerImproperAPICall",1),b.ue_int&&console.error("Invalid API call. The input provided does not match the API protocol i.e ue.trigger(String, String, Object)."))}}function F(){d.trigger&&
d.trigger.isStub&&d.trigger.replay(function(a){v.apply(this,a)})}function y(){z||(f.length&&l(q),z=!0)}var t=":1234",s="//"+b.ue_furl+"/1/remote-weblab-triggers/1/OE/"+b.ue_mid+":"+b.ue_sid+":PLCHLDR_RID$s:wl-client-id%3DCSMTriger",A="PLCHLDR_RID",E=b.wtt||1E4,p=s.length+t.length,w=b.mwtc||2E3,G=1===e.ue_wtc_c,B=3===e.ue_wtc_c,H=e.XMLHttpRequest&&"withCredentials"in new e.XMLHttpRequest,x="String",D="Object",d=b.ue,g={},f=[],k=p,n,z=!1,r=0,C=function(){return{send:function(a){if(H){var b=new e.XMLHttpRequest;
b.open("GET",a,!0);G&&(b.withCredentials=!0);b.send()}else throw"";}}}(),q=function(){return{send:function(a){(new Image).src=a}}}();e.encodeURIComponent&&(d.attach&&(d.attach("beforeunload",y),d.attach("pagehide",y)),F(),d.trigger=v)},"client-wbl-trg")(ue_csm,window);


(function(k,d,h){function f(a,c,b){a&&a.indexOf&&0===a.indexOf("http")&&0!==a.indexOf("https")&&l(s,c,a,b)}function g(a,c,b){a&&a.indexOf&&(location.href.split("#")[0]!=a&&null!==a&&"undefined"!==typeof a||l(t,c,a,b))}function l(a,c,b,e){m[b]||(e=u&&e?n(e):"N/A",d.ueLogError&&d.ueLogError({message:a+c+" : "+b,logLevel:v,stack:"N/A"},{attribution:e}),m[b]=1,p++)}function e(a,c){if(a&&c)for(var b=0;b<a.length;b++)try{c(a[b])}catch(d){}}function q(){return d.performance&&d.performance.getEntriesByType?
d.performance.getEntriesByType("resource"):[]}function n(a){if(a.id)return"//*[@id='"+a.id+"']";var c;c=1;var b;for(b=a.previousSibling;b;b=b.previousSibling)b.nodeName==a.nodeName&&(c+=1);b=a.nodeName;1!=c&&(b+="["+c+"]");a.parentNode&&(b=n(a.parentNode)+"/"+b);return b}function w(){var a=h.images;a&&a.length&&e(a,function(a){var b=a.getAttribute("src");f(b,"img",a);g(b,"img",a)})}function x(){var a=h.scripts;a&&a.length&&e(a,function(a){var b=a.getAttribute("src");f(b,"script",a);g(b,"script",a)})}
function y(){var a=h.styleSheets;a&&a.length&&e(a,function(a){if(a=a.ownerNode){var b=a.getAttribute("href");f(b,"style",a);g(b,"style",a)}})}function z(){if(A){var a=q();e(a,function(a){f(a.name,a.initiatorType)})}}function B(){e(q(),function(a){g(a.name,a.initiatorType)})}function r(){var a;a=d.location&&d.location.protocol?d.location.protocol:void 0;"https:"==a&&(z(),w(),x(),y(),B(),p<C&&setTimeout(r,D))}var s="[CSM] Insecure content detected ",t="[CSM] Ajax request to same page detected ",v="WARN",
m={},p=0,D=k.ue_nsip||1E3,C=5,A=1==k.ue_urt,u=!0;ue_csm.ue_disableNonSecure||(d.performance&&d.performance.setResourceTimingBufferSize&&d.performance.setResourceTimingBufferSize(300),r())})(ue_csm,window,document);


var ue_aa_a = "";
if (ue.trigger && (ue_aa_a === "C" || ue_aa_a === "T1")) {
    ue.trigger("UEDATA_AA_SERVERSIDE_ASSIGNMENT_CLIENTSIDE_TRIGGER_190249", ue_aa_a);
}
(function(f,b){function g(){try{b.PerformanceObserver&&"function"===typeof b.PerformanceObserver&&(a=new b.PerformanceObserver(function(b){c(b.getEntries())}),a.observe(d))}catch(h){k()}}function m(){for(var h=d.entryTypes,a=0;a<h.length;a++)c(b.performance.getEntriesByType(h[a]))}function c(a){if(a&&Array.isArray(a)){for(var c=0,e=0;e<a.length;e++){var d=l.indexOf(a[e].name);if(-1!==d){var g=Math.round(b.performance.timing.navigationStart+a[e].startTime);f.uet(n[d],void 0,void 0,g);c++}}l.length===
c&&k()}}function k(){a&&a.disconnect&&"function"===typeof a.disconnect&&a.disconnect()}if("function"===typeof f.uet&&b.performance&&"object"===typeof b.performance&&b.performance.getEntriesByType&&"function"===typeof b.performance.getEntriesByType&&b.performance.timing&&"object"===typeof b.performance.timing&&"number"===typeof b.performance.timing.navigationStart){var d={entryTypes:["paint"]},l=["first-paint","first-contentful-paint"],n=["fp","fcp"],a;try{m(),g()}catch(p){f.ueLogError(p,{logLevel:"ERROR",
attribution:"performanceMetrics"})}}})(ue_csm,window);


if (window.csa) {
    csa("Events")("setEntity", {
        page:{pageType: "VoltronPayments", subPageType: "", pageTypeId: ""}
    });
}
csa.plugin(function(c){var m="transitionStart",n="pageVisible",e="PageTiming",t="visibilitychange",s="$latency.visible",i=c.global,r=(i.performance||{}).timing,a=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],o=i.Math,u=o.max,l=o.floor,d=i.document||{},g=(r||{}).navigationStart,f=g,v=0,p=null;if(i.Object.keys&&[].forEach&&!c.config["KillSwitch."+e]){if(!r||null===g||g<=0||void 0===g)return c.error("Invalid navigation timing data: "+g);p=new S({schemaId:"<ns>.PageLatency.5",producerId:"csa"}),"boolean"!=typeof d.hidden&&"string"!=typeof d.visibilityState||!d.removeEventListener?c.emit(s):h()?(c.emit(s),E(n,g)):c.on(d,t,function e(){h()&&(f=c.time(),d.removeEventListener(t,e),E(m,f),E(n,f),c.emit(s))}),c.once("$unload",I),c.once("$load",I),c.on("$pageTransition",function(){f=c.time()}),c.register(e,{mark:E,instance:function(e){return new S(e)}})}function S(e){var i,r=null,a=e.ent||{page:["pageType","subPageType","requestId"]},o=e.logger||c("Events",{producerId:e.producerId});if(!e||!e.producerId||!e.schemaId)return c.error("The producer id and schema Id must be defined for PageLatencyInstance.");function d(){return i||f}function n(){r=c.UUID()}this.mark=function(n,t){if(null!=n)return t=t||c.time(),n===m&&(i=t),c.once(s,function(){o("log",{messageId:r,__merge:function(e){e.markers[n]=function(e,n){return u(0,n-(e||f))}(d(),t),e.markerTimestamps[n]=l(t)},markers:{},markerTimestamps:{},navigationStartTimestamp:d()?new Date(d()).toISOString():null,schemaId:e.schemaId},{ent:a})}),t},n(),c.on("$beforePageTransition",n)}function E(e,n){e===m&&(f=n);var t=p.mark(e,n);c.emit("$timing:"+e,t)}function I(){if(!v){for(var e=0;e<a.length;e++)r[a[e]]&&E(a[e],r[a[e]]);v=1}}function h(){return!d.hidden||"visible"===d.visibilityState}});csa.plugin(function(f){var o,u="length",c="parentElement",t="target",i="getEntriesByName",e="perf",n=null,r="_osrc",l="_elt",s="_eid",d=10,a=5,g=10,h=100,m=f.global,p=f.timeout,v=m.Math,y=v.max,E=v.floor,S=v.ceil,b=m.document,x=m.performance||{},O=(x.timing||{}).navigationStart,w=Date.now,L=Object.values||(f.types||{}).ovl,T=f("PageTiming"),N=f("SpeedIndexBuffers"),I=[],_=[],k=[],B=[],Y=[],C=.1,F=.1,H=0,R=0,V=!0,W=0,$=0,M=1==f.config["SpeedIndex.ForceReplay"],P=0,X=1,D=0,J={},j=[],q=0,Q={buffered:1};function U(e){f.global.ue_csa_ss_tag||f.emit("$csmTag:"+e,0,Q)}function z(){for(var e=w(),n=0;o;){if(0!==o[u]){if(!1!==o.h(o[0])&&o.shift(),n++,!M&&n%d==0&&w()-e>a)break}else o=o.n}H=0,o&&(H||(!0===b.hidden?(M=1,z()):f.timeout(z,0)))}function A(e,n,t,i){D=E(e),I=n,_=t,Y=i;var r=b.createTreeWalker(b.body,NodeFilter.SHOW_TEXT,null,null),a={w:m.innerWidth,h:m.innerHeight,x:m.pageXOffset,y:m.pageYOffset};b.body[l]=e,k.push({w:r,vp:a}),B.push({img:b.images,iter:0}),I.h=G,(I.n=_).h=K,(_.n=k).h=Z,(k.n=B).h=ee,(B.n=Y).h=ne,o=I,z()}function G(e){e.m.forEach(function(e){var n=e[t];r in n||(n[r]=e.oldValue)})}function K(n){n.m.forEach(function(e){e[t][l]=n.t-O})}function Z(e){for(var n,t=e.vp,i=e.w,r=d;(n=i.nextNode())&&0<r;){r-=1;var a=(n[c]||{}).nodeName;"SCRIPT"!==a&&"STYLE"!==a&&"NOSCRIPT"!==a&&"BODY"!==a&&0!==(n.nodeValue||"").trim()[u]&&oe(n[c],te(n),t)}return!n}function ee(e){for(var n={w:m.innerWidth,h:m.innerHeight,x:m.pageXOffset,y:m.pageYOffset},t=d;e.iter<e.img[u]&&0<t;){var i,r=e.img[e.iter],a=ae(r);i=re(a&&(r=a).querySelector('[aria-posinset="1"] img')||r),oe(r,i,n),e.iter+=1,t-=1}return e.img[u]<=e.iter}function ne(e){var n=[],i=0,r=0,a=R,t=E(e.y/h),o=S((e.y+m.innerHeight)/h);j.slice(t,o).forEach(function(e){(e.elems||[]).forEach(function(e){e.lt in n||(n[e.lt]={}),e.id in n[e.lt]||(i+=(n[e.lt][e.id]=e).a)})}),U("startVL"),L(n).forEach(function(e){L(e).forEach(function(e){var n=1-r/i,t=y(e.lt,a);q+=n*(t-a),a=t,function(e,n){var t;for(;C<=1&&C-.01<=e;)fe("visuallyLoaded"+(t=(100*C).toFixed(0)),n.lt),"50"!==t&&"90"!==t||f("Content",{target:n.e})("mark","visuallyLoaded"+t),C+=F}((r+=e.a)/i,e)})}),U("endVL"),R=e.t-O,Y[u]<=1&&(fe("speedIndex",q),fe("visuallyLoaded0",D)),V&&(V=!1,fe("atfSpeedIndex",q))}function te(e){for(var n=e[c],t=g;n&&0<t;){if(n[l]||0===n[l])return y(n[l],D);n=n.parentElement,t-=1}}function ie(e,n){if(e){if(!e.indexOf("data:"))return te(n);var t=x[i](e)||[];if(0<t[u])return y(S(t[0].responseEnd||0),D)}}function re(e){return ie(e[r],e)||ie(e.currentSrc,e)||ie(e.src,e)}function ae(e){for(var n=10,t=e.parentElement;t&&0<n;){if(t.classList&&t.classList.contains("a-carousel-viewport"))return t;t=t.parentElement,n-=1}return null}function oe(e,n,t){if((n||0===n)&&!e[s]){var i=e.getBoundingClientRect(),r=i.width*i.height,a=i.width/2,o=X++;if(0!=r&&!(a<i.right-t.w||i.right<a)){for(var f={e:e,lt:n,a:r,id:o},u=E((i.top+t.y)/h),c=S((i.top+t.y+i.height)/h),l=u;l<=c;l++)l in j||(j[l]={elems:[],lt:0}),j[l].elems.push(f);e[s]=o}}}function fe(e,n){T("mark",e,O+S((J[e]=n)||0))}function ue(e){P||(U("browserQuite"+e),N("getBuffers",A),P=1)}O&&L&&x[i]?(U(e+"Yes"),N("registerListener",function(e){$&&(clearTimeout(W),W=p(ue.bind(n,"Mut"),2500))}),f.once("$unload",function(){M=1,ue("Ud")}),f.once("$load",function(){$=1,W=p(ue.bind(n,"Ld"),2500)}),f.once("$timing:functional",ue.bind(n,"Fn")),f.register("SpeedIndex",{getMarkers:function(e){e&&e(JSON.parse(JSON.stringify(J)))}})):U(e+"No")});csa.plugin(function(e){var m=!!e.config["LCP.elementDedup"],t=!1,n=e("PageTiming"),r=e.global.PerformanceObserver,a=e.global.performance;function i(){return a.timing.navigationStart}function o(){t||function(o){var l=new r(function(e){var t=e.getEntries();if(0!==t.length){var n=t[t.length-1];if(m&&""!==n.id&&n.element&&"IMG"===n.element.tagName){for(var r={},a=t[0],i=0;i<t.length;i++)t[i].id in r||(""!==t[i].id&&(r[t[i].id]=!0),a.startTime<t[i].startTime&&(a=t[i]));n=a}l.disconnect(),o({startTime:n.startTime,renderTime:n.renderTime,loadTime:n.loadTime})}});try{l.observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}}(function(e){e&&(t=!0,n("mark","largestContentfulPaint",Math.floor(e.startTime+i())),e.renderTime&&n("mark","largestContentfulPaint.render",Math.floor(e.renderTime+i())),e.loadTime&&n("mark","largestContentfulPaint.load",Math.floor(e.loadTime+i())))})}r&&a&&a.timing&&(e.once("$unload",o),e.once("$load",o),e.register("LargestContentfulPaint",{}))});csa.plugin(function(r){var e=r("Metrics",{producerId:"csa"}),n=r.global.PerformanceObserver;n&&(n=new n(function(r){var t=r.getEntries();if(0===t.length||!t[0].processingStart||!t[0].startTime)return;!function(r){r=r||0,n.disconnect(),0<=r?e("recordMetric","firstInputDelay",r):e("recordMetric","firstInputDelay.invalid",1)}(t[0].processingStart-t[0].startTime)}),function(){try{n.observe({type:"first-input",buffered:!0})}catch(r){}}())});csa.plugin(function(d){var e="Metrics",g=0;function r(i){var c,t,e=i.producerId,r=i.logger,s=r||d("Events",{producerId:e}),o=(i||{}).dimensions||{},u={},n=-1;if(!e&&!r)return d.error("Either a producer id or custom logger must be defined");function a(){n!==g&&(c=d.UUID(),t=d.UUID(),u={},n=g)}this.recordMetric=function(r,n){var e=i.logOptions||{ent:{page:["pageType","subPageType","requestId"]}};e.debugMetric=i.debugMetric,a(),s("log",{messageId:c,schemaId:i.schemaId||"<ns>.Metric.3",metrics:{},dimensions:o,__merge:function(e){e.metrics[r]=n}},e)},this.recordCounter=function(r,e){var n=i.logOptions||{ent:{page:["pageType","subPageType","requestId"]}};if("string"!=typeof r||"number"!=typeof e||!isFinite(e))return d.error("Invalid type given for counter name or counter value: "+r+"/"+e);a(),r in u||(u[r]={});var c=u[r];"f"in c||(c.f=e),c.c=(c.c||0)+1,c.s=(c.s||0)+e,c.l=e,s("log",{messageId:t,schemaId:i.schemaId||"<ns>.InternalCounters.2",c:{},__merge:function(e){r in e.c||(e.c[r]={}),c.fs||(c.fs=1,e.c[r].f=c.f),1<c.c&&(e.c[r].s=c.s,e.c[r].l=c.l,e.c[r].c=c.c)}},n)}}d.config["KillSwitch."+e]||(new r({producerId:"csa"}).recordMetric("baselineMetricEvent",1),d.on("$beforePageTransition",function(){g++}),d.register(e,{instance:function(e){return new r(e||{})}}))});csa.plugin(function(t){var a,r=(t.global.performance||{}).timing,s=(r||{}).navigationStart||t.time();function e(){a=t.UUID()}function n(i){var r=(i=i||{}).producerId,e=i.logger,o=e||t("Events",{producerId:r});if(!r&&!e)return t.error("Either a producer id or custom logger must be defined");this.mark=function(e,r){var n=(void 0===r?t.time():r)-s;o("log",{messageId:a,schemaId:i.schemaId||"<ns>.Timer.1",markers:{},__merge:function(r){r.markers[e]=n}},i.logOptions)}}r&&(e(),t.on("$beforePageTransition",e),t.register("Timers",{instance:function(r){return new n(r||{})}}))});csa.plugin(function(t){var e="takeRecords",i="disconnect",n="function",o=t("Metrics",{producerId:"csa"}),c=t("PageTiming"),a=t.global,u=t.timeout,r=t.on,f=a.PerformanceObserver,m=0,l=!1,s=0,d=a.performance,h=a.document,v=null,y=!1,g=t.blank;function p(){l||(l=!0,clearTimeout(v),typeof f[e]===n&&f[e](),typeof f[i]===n&&f[i](),o("recordMetric","documentCumulativeLayoutShift",m),c("mark","cumulativeLayoutShiftLastTimestamp",Math.floor(s+d.timing.navigationStart)))}f&&d&&d.timing&&h&&(f=new f(function(t){v&&clearTimeout(v);t.getEntries().forEach(function(t){t.hadRecentInput||(m+=t.value,s<t.startTime&&(s=t.startTime))}),v=u(p,5e3)}),function(){try{f.observe({type:"layout-shift",buffered:!0}),v=u(p,5e3)}catch(t){}}(),g=r(h,"click",function(t){y||(y=!0,o("recordMetric","documentCumulativeLayoutShiftToFirstInput",m),g())}),r(h,"visibilitychange",function(){"hidden"===h.visibilityState&&p()}),t.once("$unload",p))});csa.plugin(function(e){var t,n=e.global,r=n.PerformanceObserver,c=e("Metrics",{producerId:"csa"}),o=0,i=0,a=-1,l=n.Math,f=l.max,u=l.ceil;if(r){t=new r(function(e){e.getEntries().forEach(function(e){var t=e.duration;o+=t,i+=t,a=f(t,a)})});try{t.observe({type:"longtask",buffered:!0})}catch(e){}t=new r(function(e){0<e.getEntries().length&&(i=0,a=-1)});try{t.observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}e.on("$unload",g),e.on("$beforePageTransition",g)}function g(){c("recordMetric","totalBlockingTime",u(i||0)),c("recordMetric","totalBlockingTimeInclLCP",u(o||0)),c("recordMetric","maxBlockingTime",u(a||0)),i=o=0,a=-1}});csa.plugin(function(r){var e="CacheDetection",o="csa-ctoken-",n=r.store,t=r.deleteStored,c=r.config,a=c[e+".RequestID"],i=c[e+".Callback"],s=r.global,u=s.document||{},d=s.Date,f=r("Events"),l=r("Events",{producerId:"csa"});function p(e){try{var n=u.cookie.match(RegExp("(^| )"+e+"=([^;]+)"));return n&&n[2].trim()}catch(e){}}!function(){var e=function(){var e=p("cdn-rid");if(e)return{r:e,s:"cdn"}}()||function(){if(r.store(o+a))return{r:r.UUID().toUpperCase().replace(/-/g,"").slice(0,20),s:"device"}}()||{},n=e.r,c=e.s;if(!!n){var t=p("session-id");!function(e,n,c,t){f("setEntity",{page:{pageSource:"cache",requestId:e,cacheRequestId:a,cacheSource:t},session:{id:c}})}(n,0,t,c),"device"===c&&l("log",{schemaId:"<ns>.CacheImpression.1"},{ent:"all"}),i&&i(n,t,c)}}(),n(o+a,d.now()+36e5),r.once("$load",function(){var c=d.now();t(function(e,n){return 0==e.indexOf(o)&&parseInt(n)<c})})});csa.plugin(function(u){var i,t="Content",e="MutationObserver",n="addedNodes",a="querySelectorAll",f="matches",o="getAttributeNames",r="getAttribute",s="dataset",c="widget",l="producerId",d="slotId",h="iSlotId",g={ent:{element:1,page:["pageType","subPageType","requestId"]}},p=5,m=u.config[t+".BubbleUp.SearchDepth"]||20,y=u.config[t+".SearchPage"]||0,v="csaC",b=v+"Id",E="logRender",w={},I=u.config,O=I[t+".Selectors"]||[],C=I[t+".WhitelistedAttributes"]||{href:1,class:1},N=I[t+".EnableContentEntities"],S=I["KillSwitch.ContentRendered"],k=u.global,A=k.document||{},U=A.documentElement,L=k.HTMLElement,R={},_=[],j=function(t,e,n,i){var r=this,o=u("Events",{producerId:t||"csa"});e.type=e.type||c,r.id=e.id,r.l=o,r.e=e,r.el=n,r.rt=i,r.dlo=g,r.op=W(n,"csaOp"),r.log=function(t,e){o("log",t,e||g)},e.id&&o("setEntity",{element:e})},x=j.prototype;function D(t){var e=(t=t||{}).element,n=t.target;return e?function(t,e){var n;n=t instanceof L?K(t)||Y(e[l],t,z,u.time()):R[t.id]||H(e[l],0,t,u.time());return n}(e,t):n?M(n):u.error("No element or target argument provided.")}function M(t){var e=function(t){var e=null,n=0;for(;t&&n<m;){if(n++,P(t,b)){e=t;break}t=t.parentElement}return e}(t);return e?K(e):new j("csa",{id:null},null,u.time())}function P(t,e){if(t&&t.dataset)return t.dataset[e]}function T(t,e,n){_.push({n:n,e:t,t:e}),B()}function q(){for(var t=u.time(),e=0;0<_.length;){var n=_.shift();if(w[n.n](n.e,n.t),++e%10==0&&u.time()-t>p)break}i=0,_.length&&B()}function B(){i=i||u.raf(q)}function X(t,e,n){return{n:t,e:e,t:n}}function Y(t,e,n,i){var r=u.UUID(),o={id:r},c=M(e);return e[s][b]=r,n(o,e),c&&c.id&&(o.parentId=c.id),H(t,e,o,i)}function $(t){return isNaN(t)?null:Math.round(t)}function H(t,e,n,i){N&&(n.schemaId="<ns>.ContentEntity.2"),n.id=n.id||u.UUID();var r=new j(t,n,e,i);return function(t){return!S&&((t.op||{}).hasOwnProperty(E)||y)}(r)&&function(t,e){var n={},i=u.exec($);t.el&&(n=t.el.getBoundingClientRect()),t.log({schemaId:"<ns>.ContentRender.2",timestamp:e,width:i(n.width),height:i(n.height),positionX:i(n.left+k.pageXOffset),positionY:i(n.top+k.pageYOffset)})}(r,i),u.emit("$content.register",r),R[n.id]=r}function K(t){return R[(t[s]||{})[b]]}function W(n,i){var r={};return o in(n=n||{})&&Object.keys(n[s]).forEach(function(t){if(!t.indexOf(i)&&i.length<t.length){var e=function(t){return(t[0]||"").toLowerCase()+t.slice(1)}(t.slice(i.length));r[e]=n[s][t]}}),r}function z(t,e){o in e&&(function(t,e){var n=W(t,v);Object.keys(n).forEach(function(t){e[t]=n[t]})}(e,t),d in t&&(t[h]=t[d]),function(e,n){(e[o]()||[]).forEach(function(t){t in C&&(n[t]=e[r](t))})}(e,t))}U&&A[a]&&k[e]&&(O.push({selector:"*[data-csa-c-type]",entity:z}),O.push({selector:".celwidget",entity:function(t,e){z(t,e),t[d]=t[d]||e[r]("cel_widget_id")||e.id,t.legacyId=e[r]("cel_widget_id")||e.id,t.type=t.type||c}}),w[1]=function(t,e){t.forEach(function(t){t[n]&&t[n].constructor&&"NodeList"===t[n].constructor.name&&Array.prototype.forEach.call(t[n],function(t){_.unshift(X(2,t,e))})})},w[2]=function(o,c){a in o&&f in o&&O.forEach(function(t){for(var e=t.selector,n=o[f](e),i=o[a](e),r=i.length-1;0<=r;r--)_.unshift(X(3,{e:i[r],s:t},c));n&&_.unshift(X(3,{e:o,s:t},c))})},w[3]=function(t,e){var n=t.e;K(n)||Y("csa",n,t.s.entity,e)},w[4]=function(){u.register(t,{instance:D})},new k[e](function(t){T(t,u.time(),1)}).observe(U,{childList:!0,subtree:!0}),T(U,u.time(),2),T(null,u.time(),4),u.on("$content.export",function(e){Object.keys(e).forEach(function(t){x[t]=e[t]})}))});csa.plugin(function(o){var i,t="ContentImpressions",e="KillSwitch.",n="IntersectionObserver",r="getAttribute",s="dataset",c="intersectionRatio",a="csaCId",m=1e3,l=o.global,f=o.config,u=f[e+t],v=f[e+t+".ContentViews"],g=((l.performance||{}).timing||{}).navigationStart||o.time(),d={};function h(t){t&&(t.v=1,function(t){t.vt=o.time(),t.el.log({schemaId:"<ns>.ContentView.3",timeToViewed:t.vt-t.el.rt,pageFirstPaintToElementViewed:t.vt-g})}(t))}function I(t){t&&!t.it&&(t.i=o.time()-t.is>m,function(t){t.it=o.time(),t.el.log({schemaId:"<ns>.ContentImpressed.2",timeToImpressed:t.it-t.el.rt,pageFirstPaintToElementImpressed:t.it-g})}(t))}!u&&l[n]&&(i=new l[n](function(t){var n=o.time();t.forEach(function(t){var e=function(t){if(t&&t[r])return d[t[s][a]]}(t.target);if(e){o.emit("$content.intersection",{meta:e.el,t:n,e:t});var i=t.intersectionRect;t.isIntersecting&&0<i.width&&0<i.height&&(v||e.v||h(e),.5<=t[c]&&!e.is&&(e.is=n,e.timer=o.timeout(function(){I(e)},m))),t[c]<.5&&!e.it&&e.timer&&(l.clearTimeout(e.timer),e.is=0,e.timer=0)}})},{threshold:[0,.5,.99]}),o.on("$content.register",function(t){var e=t.el;e&&(d[t.id]={el:t,v:0,i:0,is:0,vt:0,it:0},i.observe(e))}))});csa.plugin(function(e){e.config["KillSwitch.ContentLatency"]||e.emit("$content.export",{mark:function(t,n){var o=this;o.t||(o.t=e("Timers",{logger:o.l,schemaId:"<ns>.ContentLatency.1",logOptions:o.dlo})),o.t("mark",t,n)}})});csa.plugin(function(t){function n(i,e,o){var c={};function r(t,n,e){t in c&&o<=n-c[t].s&&(function(n,e,i){if(!p)return;S(function(t){T(n,t),t.w[n][e]=a((t.w[n][e]||0)+i)})}(t,i,n-c[t].d),c[t].d=n),e||delete c[t]}this.update=function(t,n){n.isIntersecting&&e<=n.intersectionRatio?function(t,n){t in c||(c[t]={s:n,d:n})}(t,u()):r(t,u())},this.stopAll=function(t){var n=u();for(var e in c)r(e,n,t)},this.reset=function(){var t=u();for(var n in c)c[n].s=t,c[n].d=t}}var e=t.config,u=t.time,i="ContentInteractionsSummary",o=e[i+".FlushInterval"]||5e3,c=e[i+".FlushBackoff"]||1.5,r=t.global,s=t.on,a=Math.floor,f=(r.document||{}).documentElement||{},l=((r.performance||{}).timing||{}).responseStart||t.time(),d=o,m=0,p=!0,v=t.UUID(),g=t("Events",{producerId:"csa"}),I=new n("it0",0,0),w=new n("it50",.5,1e3),h=new n("it100",.99,0),A={},b={};function $(){I.stopAll(!0),w.stopAll(!0),h.stopAll(!0),U()}function C(){I.reset(),w.reset(),h.reset(),U()}function U(){d&&(clearTimeout(m),m=t.timeout($,d),d*=c)}function E(n){S(function(t){T(n,t),t.w[n].mc=(t.w[n].mc||0)+1})}function S(t){g("log",{messageId:v,schemaId:"<ns>.ContentInteractionsSummary.1",w:{},__merge:t},{ent:{page:["requestId"]}})}function T(t,n){t in n.w||(n.w[t]={})}s("$content.intersection",function(t){if(t&&t.meta&&t.e){var n=t.meta.id;if(n in A){var e=t.e.boundingClientRect||{};e.width<5||e.height<5||(I.update(n,t.e),w.update(n,t.e),h.update(n,t.e),!t.e.isIntersecting||n in b||(b[n]=1,function(n,e){S(function(t){T(n,t),t.w[n].ttfv=a(e)})}(n,u()-l)))}}}),s("$content.register",function(t){(t.e||{}).slotId&&(A[t.id]={},function(e){S(function(t){var n=e.id;T(n,t),t.w[n].sid=(e.e||{}).slotId,t.w[n].cid=(e.e||{}).contentId})}(t))}),s("$beforePageTransition",function(){$(),C(),v=t.UUID(),U()}),s("$beforeunload",function(){I.stopAll(),w.stopAll(),h.stopAll(),d=null}),s("$visible",function(t){t?C():($(),clearTimeout(m)),p=t},{buffered:1}),s(f,"click",function(t){for(var n=t.target,e=25;n&&0<e;){var i=(n.dataset||{}).csaCId;i&&E(i),n=n.parentElement,e-=1}},{capture:!0,passive:!0}),U()});csa.plugin(function(o){var t,n,i="normal",s="reload",e="history",d="new-tab",a="ajax",r=1,c=2,u="lastActive",l="lastInteraction",f="used",p="csa-tabbed-browsing",g="visibilityState",v={"back-memory-cache":1,"tab-switch":1,"history-navigation-page-cache":1},b="<ns>.TabbedBrowsing.2",m="visible",y=o.global,I=o("Events",{producerId:"csa"}),h=y.location||{},T=y.document,w=y.JSON,z=((y.performance||{}).navigation||{}).type,P=o.store,S=o.on,k=o.storageSupport(),x=!1,A={},C={},O={},$={},j=!1,q=!1,B=!1;function E(i){try{return w.parse(P(p,void 0,{session:i})||"{}")||{}}catch(i){o.error('Could not parse storage value for key "'+p+'": '+i)}return{}}function J(i,t){P(p,w.stringify(t||{}),{session:i})}function N(i){var t=C.tid||i.id,n=A[u]||{};n.tid===t&&(n.pid=i.id),$={pid:i.id,tid:t,lastInteraction:C[l]||{},initialized:!0},O={lastActive:n,lastInteraction:A[l]||{},time:o.time()}}function D(i){var t=i===d,n=T.referrer,e=!(n&&n.length)||!~n.indexOf(h.origin||""),a=t&&e,r={type:i,toTabId:$.tid,toPageId:$.pid,transitTime:o.time()-A.time||null};a||function(i,t,n){var e=i===s,a=t?A[u]||{}:C,r=A[l]||{},o=C[l]||{},d=t?r:o;n.fromTabId=a.tid,n.fromPageId=a.pid,e||!d.id||d[f]||(n.interactionId=d.id||null,r.id===d.id&&(r[f]=!0),o.id===d.id&&(o[f]=!0))}(i,t,r),I("log",{navigation:r,schemaId:b},{ent:{page:["pageType","subPageType","requestId"]}})}function F(i){B=function(i){return i&&i in v}(i.transitionType),function(){A=E(!1),C=E(!0);var i=A[l],t=C[l],n=!1,e=!1;i&&t&&i.id===t.id&&i[f]!==t[f]&&(n=!i[f],e=!t[f],t[f]=i[f]=!0,n&&J(!1,A),e&&J(!0,C))}(),N(i),j=!0,function(i){var t,n;t=H(),n=K(),(t||n)&&N(i)}(i)}function G(){x&&!B?D(a):(x=!0,D(z===c||B?e:z===r?C.initialized?s:d:C.initialized?i:d))}function H(){return!(!j||!t)&&(C[l]={id:t.messageId,used:!(A[l]={id:t.messageId,used:!1})},!(t=null))}function K(){var i=!1;if(q=T[g]===m,j){var t=A[u]||{};i=function(i,t,n){var e=!1,a=i[u];return q?a&&a.tid===$.tid&&a[m]&&a.pid===n||(i[u]={visible:!0,pid:n,tid:t},e=!0):a&&a.tid===$.tid&&a[m]&&(e=!(a[m]=!1)),e}(A,C.tid||t.tid||$.tid,C.pid||t.pid||$.pid)}return i}k.local&&k.session&&w&&T&&g in T&&(n=function(){try{return y.self!==y.top}catch(i){return!0}}(),S("$pageChange",function(i){n||(F(i),G(),J(!1,O),J(!0,$),C=$,A=O)},{buffered:1}),S("$content.interaction",function(i){t=i,H()&&(J(!1,A),J(!0,C))}),S(T,"visibilitychange",function(){!n&&K()&&J(!1,A)},{capture:!1,passive:!0}))});csa.plugin(function(c){var e=c("Metrics",{producerId:"csa"});c.on(c.global,"pageshow",function(c){c&&c.persisted&&e("recordMetric","bfCache",1)})});csa.plugin(function(n){var e,t,i,o,r,a,c,u,f,s,l,d,m,p,g,v,h="hasFocus",b="$app.",y="avail",S="client",T="document",$="inner",I="offset",P="screen",w="scroll",D="Width",E="Height",F=y+D,O=y+E,q=S+D,x=S+E,z=$+D,C=$+E,H=I+D,K=I+E,M=w+D,W=w+E,X=n.config["KillSwitch.PageInteractionsSummary"],Y=n("Events",{producerId:"csa"}),j=1,k=n.global||{},A=n.time,B=n.on,G=n.once,J=k[T]||{},L=k[P]||{},N=k.Math||{},Q=N.abs,R=N.max,U=N.ceil,V=((k.performance||{}).timing||{}).responseStart,Z=function(){return J[h]()},_=1,nn=100,en={},tn=1;function on(){c=t=o=r=e,i=0,a=u=f=s=0,cn(),an()}function rn(){V&&!o&&(c=U((o=l)-V),tn=1)}function an(){u=U(R(u,m+v)),d&&(f=U(R(f,d+g))),tn=1}function cn(){l=A(),d=Q(k.pageXOffset||0),m=Q(k.pageYOffset||0),p=0<d||0<m,g=k[z]||0,v=k[C]||0}function un(){cn(),rn(),function(){var n=m-i;t&&!(t&&t<=l)||(n&&(++a,tn=1),i=m,n),t=l+nn}(),an()}function fn(){if(r){var n=U(A()-r);s+=n,r=e,tn=0<n}}function sn(){r=r||A()}function ln(n,e,t,i){e[n+D]=U(t||0),e[n+E]=U(i||0)}function dn(n){var e=n===en,t=Z();if(t||tn){if(!e){if(!j)return;j=0,t&&fn()}var i=function(){var n={},e=J.documentElement||{},t=J.body||{};return ln("availableScreen",n,L[F],L[O]),ln(T,n,R(t[M]||0,t[H]||0,e[q]||0,e[M]||0,e[H]||0),R(t[W]||0,t[K]||0,e[x]||0,e[W]||0,e[K]||0)),ln(P,n,L.width,L.height),ln("viewport",n,k[z],k[C]),n}(),o=function(){var n={scrollCounts:a,reachedDepth:u,horizontalScrollDistance:f,dwellTime:s};return"number"==typeof c&&(n.clientTimeToFirstScroll=c),n}();e?tn=0:(on(),V=A(),t&&(r=V)),Y("log",{activity:o,dimensions:i,schemaId:"<ns>.PageInteractionsSummary.1"},{ent:{page:["pageType","subPageType","requestId"]}})}}function mn(){fn(),dn(en)}function pn(n,e){return function(){_=e,n()}}function gn(){Z=function(){return _},_&&!r&&(r=A())}"function"!=typeof J[h]||X||(on(),p&&rn(),B(k,w,un,{passive:!0}),B(k,"blur",mn),B(k,"focus",pn(sn,1)),G(b+"android",gn),G(b+"ios",gn),B(b+"pause",pn(mn,0)),B(b+"resume",pn(sn,1)),B(b+"resign",pn(mn,0)),B(b+"active",pn(sn,1)),Z()&&(r=V||A()),G("$beforeunload",dn),B("$beforeunload",dn),B("$document.hidden",mn),B("$beforePageTransition",dn),B("$afterPageTransition",function(){tn=j=1}))});csa.plugin(function(e){var o,n,r="<ns>.Navigator.4",a=e.global,i=a.navigator||{},d=i.connection||{},c=a.Math.round,t=e("Events",{producerId:"csa"});function l(){o={network:{downlink:void 0,downlinkMax:void 0,rtt:void 0,type:void 0,effectiveType:void 0,saveData:void 0},language:void 0,doNotTrack:void 0,hardwareConcurrency:void 0,deviceMemory:void 0,cookieEnabled:void 0,webdriver:void 0},v(),o.language=i.language||null,o.doNotTrack=function(){switch(i.doNotTrack){case"1":return"enabled";case"0":return"disabled";case"unspecified":return i.doNotTrack;default:return null}}(),o.hardwareConcurrency="hardwareConcurrency"in i?c(i.hardwareConcurrency||0):null,o.deviceMemory="deviceMemory"in i?c(i.deviceMemory||0):null,o.cookieEnabled="cookieEnabled"in i?i.cookieEnabled:null,o.webdriver="webdriver"in i?i.webdriver:null}function u(){t("log",{network:(n={},Object.keys(o.network).forEach(function(e){n[e]=o.network[e]+""}),n),language:o.language,doNotTrack:o.doNotTrack,hardwareConcurrency:o.hardwareConcurrency,deviceMemory:o.deviceMemory,cookieEnabled:o.cookieEnabled,webdriver:o.webdriver,schemaId:r},{ent:{page:["pageType","subPageType","requestId"]}})}function v(){!function(n){Object.keys(o.network).forEach(function(e){o.network[e]=n[e]})}({downlink:"downlink"in d?c(d.downlink||0):null,downlinkMax:"downlinkMax"in d?c(d.downlinkMax||0):null,rtt:"rtt"in d?(d.rtt||0).toFixed():null,type:d.type||null,effectiveType:d.effectiveType||null,saveData:"saveData"in d?d.saveData:null})}function k(){v(),u()}function w(){l(),u()}l(),u(),e.on("$afterPageTransition",w),e.on(d,"change",k)});
if (window.ue && window.ue.uels) {
    ue.uels("https://c.amazon-adsystem.com/bao-csm/forensics/a9-tq-forensics.min.js");
}


ue.exec(function(d,c){function g(e,c){e&&ue.tag(e+c);return!!e}function n(){for(var e=RegExp("^https://(.*\.(images|ssl-images|media)-amazon\.com|"+c.location.hostname+")/images/","i"),d={},h=0,k=c.performance.getEntriesByType("resource"),l=!1,b,a,m,f=0;f<k.length;f++)if(a=k[f],0<a.transferSize&&a.transferSize>=a.encodedBodySize&&(b=e.exec(String(a.name)))&&3===b.length){a:{b=a.serverTiming||[];for(a=0;a<b.length;a++)if("provider"===b[a].name){b=b[a].description;break a}b=void 0}b&&(l||(l=g(b,"_cdn_fr")),
a=d[b]=(d[b]||0)+1,a>h&&(m=b,h=a))}g(m,"_cdn_mp")}d.ue&&"function"===typeof d.ue.tag&&c.performance&&c.location&&n()},"cdnTagging")(ue_csm,window);


}
/*  */
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: yellow; display: inline-block; line-height: normal;"><a href="https://images-eu.ssl-images-amazon.com/images/I/31QYhx-taiL.js" title="Open URL: https://images-eu.ssl-images-amazon.com/images/I/31QYhx-taiL.js (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> LNK</a></span></span><span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: cyan; display: inline-block; line-height: normal;"><a href="https://images-eu.ssl-images-amazon.com/images/I/31QYhx-taiL.js" title="Open URL in Popup: https://images-eu.ssl-images-amazon.com/images/I/31QYhx-taiL.js (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> POP</a></span></span></script>

</div>

<noscript>
    <img height="1" width="1" style='display:none;visibility:hidden;' src='//fls-eu.amazon.in/1/batch/1/OP/A21TJRUUN4KGV:257-6328836-0330509:E2WFHK2PD2NF0NVZ86FC$uedata=s:%2Frd%2Fuedata%3Fnoscript%26id%3DE2WFHK2PD2NF0NVZ86FC:0' alt=""/>
<span class="stringLinks" id="stringLinks"><span class="stringLinksInner" style="background-color: lightgreen; display: inline-block; line-height: normal;"><a href="https://greener-na.aka.amazon.com/GreenerPasture/#objectId=USAmazon:257-6328836-0330509" title="US Pasture: 257-6328836-0330509 (right-click for more options)" style="color: black; text-decoration: none; font-size: 7pt; font-family: Verdana, Geneva, sans-serif; padding: 0px;"> US</a></span></span></noscript>

<script>window.ue && ue.count && ue.count('CSMLibrarySize', 63101)</script>
<!-- sp:end-feature:csm:body-close -->
</div>


<div class="stringLinksCMenu" style="visibility: hidden; display: none; left: 0px; top: 0px;"><div class="stringLinksCMenuHelp"><a title="View StringLinks wiki" href="https://w.amazon.com/?StringLinks" target="_blank"><img border="0" width="16" height="16" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACz0lEQVR4nE2S7U9SYRjGz//Q1rc+9qlv1XLLVtk0dbMydZXTaeq0Is2V2mal6Zy6jBcDCTEElIGZ6ZaZKfgChVaimBZwOIfDQeRNhDzEUd4PPUTO7j0fnnu7rmf3fT0/KP63YpFwhPRuf5WYBsrg7nQ9PVXPOAv35Fje3CfgOSoWje8XlFDHYv6NVYR3RUc/Y3x5CRUWYgOl4KCCazAnU/csBRusCPuc/wwURfk31/XMCzA7yywp33z3yDlDdyl7XPMcx3SndaweExXrWWkGTnbIt5UwRIO7Rn4+zMmyDNc4Z1le7VsfPOs3L/qxBUIv9yxJ7VPtZkmFnnkel9HALJBndUzPOHe3TX6oOg7OqZbQis55ojmabBtE7h9qxcnGneN1tm+dGaRVC1mGaxF+nm3iaWrzDlDkskKRXa98lUwaRj9vkxua6h7zpJAJsy86prsgmJeHDdwEE7NeG4Hi8D3K6vKLVQFwAW2VIBB0m7I7vPaP7Qg/H5NUQTA7E5fdci/2oz/Xkq9y5YEiXuTJSAjcjzygZpY9TSIMrGcSFaGCGxAIG5fddi8KSetyLisIRKfbojRx+DtG7m8V+bKgcc51m0TFqKAQQgTXscHyLRUXxCKUe5KiSe1eNPg7pTWx+rHGMKGftk91oH0F+FA1ZB1vAkvbJ9t21sZtJhiMfvRhLEgS0T2ia3wPGOr7HR6NzDrWAKJ3KbkQgagMrDR86I5LxSUMisvPfTUiEvxrmHDAiA0Y5FMqh7wLGywFHATcZigaCeJDNCM3Z2OkFnzw+4lParWWtGhIy5IPUT7mrzsVdFxaZXiRYZtoBVgk0Aj92jT2FgAPiMv2ocU1z3arX7nVfc4ZJiAFk5QBNSosiQbJA/iChMMyWmfoTkd6r2LiElxWaZZWmoRFgEUd4yx4G2RwQGuiKAoQTlpW7AqGWUpDxSXABiBwKXkBNxL/r/4AkFclJQMtWr8AAAAASUVORK5CYII%3D"></a></div><ul class="stringLinksCMenu"></ul></div>                                                                                          <div id="asinhelper-bigPopup" style="display: none;">                                                       <h4 id="asinhelper-bigPopupTitle"></h4>                                                                 <div id="asinhelper-bigPopupButtons"></div>                                                             <button id="asinhelper-closeButton" class="close-btn">x</button>                                    </div>                                                                                                                                                                                        <div id="asinhelper-smallPopup" style="display: none;">                                                     <img src="./BFO Page_files/favicon.ico" alt="ASIN" height="25" width="25">                  </div>                                                                                                                                                                                        <div id="asinhelper-marketplaceNamePopup" style="display: none;">                                           <strong id="asinhelper-marketplaceName" class="text-center" style="margin: 0px;"></strong>          </div>                                                                                              <div id="a-popover-root" style="z-index:-1;position:absolute;"></div></body></html>